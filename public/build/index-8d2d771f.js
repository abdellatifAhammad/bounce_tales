(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function e(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=e(s);fetch(s.href,n)}})();/*!
 * melonJS Game Engine - v15.12.0
 * http://www.melonjs.org
 * melonjs is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 * @copyright (C) 2011 - 2023 Olivier Biot (AltByte Pte Ltd)
 */var Dt=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function Ao(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var yi=function(r){return r&&r.Math===Math&&r},nt=yi(typeof globalThis=="object"&&globalThis)||yi(typeof window=="object"&&window)||yi(typeof self=="object"&&self)||yi(typeof Dt=="object"&&Dt)||function(){return this}()||Dt||Function("return this")(),vr={},Mt=function(r){try{return!!r()}catch(t){return!0}},ll=Mt,he=!ll(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),ul=Mt,So=!ul(function(){var r=function(){}.bind();return typeof r!="function"||r.hasOwnProperty("prototype")}),fl=So,mi=Function.prototype.call,_r=fl?mi.bind(mi):function(){return mi.apply(mi,arguments)},Co={},Po={}.propertyIsEnumerable,Mo=Object.getOwnPropertyDescriptor,dl=Mo&&!Po.call({1:2},1);Co.f=dl?function(t){var e=Mo(this,t);return!!e&&e.enumerable}:Po;var Io=function(r,t){return{enumerable:!(r&1),configurable:!(r&2),writable:!(r&4),value:t}},Ro=So,Oo=Function.prototype,Ds=Oo.call,cl=Ro&&Oo.bind.bind(Ds,Ds),pt=Ro?cl:function(r){return function(){return Ds.apply(r,arguments)}},Bo=pt,pl=Bo({}.toString),gl=Bo("".slice),Do=function(r){return gl(pl(r),8,-1)},yl=pt,ml=Mt,xl=Do,fs=Object,vl=yl("".split),_l=ml(function(){return!fs("z").propertyIsEnumerable(0)})?function(r){return xl(r)==="String"?vl(r,""):fs(r)}:fs,Lo=function(r){return r==null},bl=Lo,wl=TypeError,br=function(r){if(bl(r))throw wl("Can't call method on "+r);return r},Tl=_l,El=br,wr=function(r){return Tl(El(r))},Ls=typeof document=="object"&&document.all,Al=typeof Ls=="undefined"&&Ls!==void 0,ko={all:Ls,IS_HTMLDDA:Al},Fo=ko,Sl=Fo.all,gt=Fo.IS_HTMLDDA?function(r){return typeof r=="function"||r===Sl}:function(r){return typeof r=="function"},on=gt,No=ko,Cl=No.all,ni=No.IS_HTMLDDA?function(r){return typeof r=="object"?r!==null:on(r)||r===Cl}:function(r){return typeof r=="object"?r!==null:on(r)},ds=nt,Pl=gt,Ml=function(r){return Pl(r)?r:void 0},Uo=function(r,t){return arguments.length<2?Ml(ds[r]):ds[r]&&ds[r][t]},Il=pt,Rl=Il({}.isPrototypeOf),Ol=typeof navigator!="undefined"&&String(navigator.userAgent)||"",Vo=nt,cs=Ol,an=Vo.process,hn=Vo.Deno,ln=an&&an.versions||hn&&hn.version,un=ln&&ln.v8,ut,Ii;un&&(ut=un.split("."),Ii=ut[0]>0&&ut[0]<4?1:+(ut[0]+ut[1]));!Ii&&cs&&(ut=cs.match(/Edge\/(\d+)/),(!ut||ut[1]>=74)&&(ut=cs.match(/Chrome\/(\d+)/),ut&&(Ii=+ut[1])));var Bl=Ii,fn=Bl,Dl=Mt,Ll=nt,kl=Ll.String,zo=!!Object.getOwnPropertySymbols&&!Dl(function(){var r=Symbol("symbol detection");return!kl(r)||!(Object(r)instanceof Symbol)||!Symbol.sham&&fn&&fn<41}),Fl=zo,Go=Fl&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Nl=Uo,Ul=gt,Vl=Rl,zl=Go,Gl=Object,jo=zl?function(r){return typeof r=="symbol"}:function(r){var t=Nl("Symbol");return Ul(t)&&Vl(t.prototype,Gl(r))},jl=String,Hl=function(r){try{return jl(r)}catch(t){return"Object"}},Yl=gt,Xl=Hl,Wl=TypeError,Kl=function(r){if(Yl(r))return r;throw Wl(Xl(r)+" is not a function")},ql=Kl,Ql=Lo,Jl=function(r,t){var e=r[t];return Ql(e)?void 0:ql(e)},ps=_r,gs=gt,ys=ni,Zl=TypeError,$l=function(r,t){var e,i;if(t==="string"&&gs(e=r.toString)&&!ys(i=ps(e,r))||gs(e=r.valueOf)&&!ys(i=ps(e,r))||t!=="string"&&gs(e=r.toString)&&!ys(i=ps(e,r)))return i;throw Zl("Can't convert object to primitive value")},Ho={exports:{}},dn=nt,tu=Object.defineProperty,Tr=function(r,t){try{tu(dn,r,{value:t,configurable:!0,writable:!0})}catch(e){dn[r]=t}return t},eu=nt,iu=Tr,cn="__core-js_shared__",su=eu[cn]||iu(cn,{}),Er=su,pn=Er;(Ho.exports=function(r,t){return pn[r]||(pn[r]=t!==void 0?t:{})})("versions",[]).push({version:"3.32.2",mode:"global",copyright:"Â© 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.32.2/LICENSE",source:"https://github.com/zloirock/core-js"});var Yo=Ho.exports,ru=br,nu=Object,ou=function(r){return nu(ru(r))},au=pt,hu=ou,lu=au({}.hasOwnProperty),le=Object.hasOwn||function(t,e){return lu(hu(t),e)},uu=pt,fu=0,du=Math.random(),cu=uu(1 .toString),Xo=function(r){return"Symbol("+(r===void 0?"":r)+")_"+cu(++fu+du,36)},pu=nt,gu=Yo,gn=le,yu=Xo,mu=zo,xu=Go,xe=pu.Symbol,ms=gu("wks"),vu=xu?xe.for||xe:xe&&xe.withoutSetter||yu,Ar=function(r){return gn(ms,r)||(ms[r]=mu&&gn(xe,r)?xe[r]:vu("Symbol."+r)),ms[r]},_u=_r,yn=ni,mn=jo,bu=Jl,wu=$l,Tu=Ar,Eu=TypeError,Au=Tu("toPrimitive"),Su=function(r,t){if(!yn(r)||mn(r))return r;var e=bu(r,Au),i;if(e){if(t===void 0&&(t="default"),i=_u(e,r,t),!yn(i)||mn(i))return i;throw Eu("Can't convert object to primitive value")}return t===void 0&&(t="number"),wu(r,t)},Cu=Su,Pu=jo,Wo=function(r){var t=Cu(r,"string");return Pu(t)?t:t+""},Mu=nt,xn=ni,ks=Mu.document,Iu=xn(ks)&&xn(ks.createElement),Ru=function(r){return Iu?ks.createElement(r):{}},Ou=he,Bu=Mt,Du=Ru,Ko=!Ou&&!Bu(function(){return Object.defineProperty(Du("div"),"a",{get:function(){return 7}}).a!==7}),Lu=he,ku=_r,Fu=Co,Nu=Io,Uu=wr,Vu=Wo,zu=le,Gu=Ko,vn=Object.getOwnPropertyDescriptor;vr.f=Lu?vn:function(t,e){if(t=Uu(t),e=Vu(e),Gu)try{return vn(t,e)}catch(i){}if(zu(t,e))return Nu(!ku(Fu.f,t,e),t[e])};var Ki={},ju=he,Hu=Mt,Yu=ju&&Hu(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),Xu=ni,Wu=String,Ku=TypeError,qo=function(r){if(Xu(r))return r;throw Ku(Wu(r)+" is not an object")},qu=he,Qu=Ko,Ju=Yu,xi=qo,_n=Wo,Zu=TypeError,xs=Object.defineProperty,$u=Object.getOwnPropertyDescriptor,vs="enumerable",_s="configurable",bs="writable";Ki.f=qu?Ju?function(t,e,i){if(xi(t),e=_n(e),xi(i),typeof t=="function"&&e==="prototype"&&"value"in i&&bs in i&&!i[bs]){var s=$u(t,e);s&&s[bs]&&(t[e]=i.value,i={configurable:_s in i?i[_s]:s[_s],enumerable:vs in i?i[vs]:s[vs],writable:!1})}return xs(t,e,i)}:xs:function(t,e,i){if(xi(t),e=_n(e),xi(i),Qu)try{return xs(t,e,i)}catch(s){}if("get"in i||"set"in i)throw Zu("Accessors not supported");return"value"in i&&(t[e]=i.value),t};var tf=he,ef=Ki,sf=Io,Qo=tf?function(r,t,e){return ef.f(r,t,sf(1,e))}:function(r,t,e){return r[t]=e,r},Jo={exports:{}},Fs=he,rf=le,Zo=Function.prototype,nf=Fs&&Object.getOwnPropertyDescriptor,Sr=rf(Zo,"name"),of=Sr&&function(){}.name==="something",af=Sr&&(!Fs||Fs&&nf(Zo,"name").configurable),$o={EXISTS:Sr,PROPER:of,CONFIGURABLE:af},hf=pt,lf=gt,Ns=Er,uf=hf(Function.toString);lf(Ns.inspectSource)||(Ns.inspectSource=function(r){return uf(r)});var ff=Ns.inspectSource,df=nt,cf=gt,bn=df.WeakMap,pf=cf(bn)&&/native code/.test(String(bn)),gf=Yo,yf=Xo,wn=gf("keys"),mf=function(r){return wn[r]||(wn[r]=yf(r))},ta={},xf=pf,ea=nt,vf=ni,_f=Qo,ws=le,Ts=Er,bf=mf,wf=ta,Tn="Object already initialized",Us=ea.TypeError,Tf=ea.WeakMap,Ri,Ye,Oi,Ef=function(r){return Oi(r)?Ye(r):Ri(r,{})},Af=function(r){return function(t){var e;if(!vf(t)||(e=Ye(t)).type!==r)throw Us("Incompatible receiver, "+r+" required");return e}};if(xf||Ts.state){var yt=Ts.state||(Ts.state=new Tf);yt.get=yt.get,yt.has=yt.has,yt.set=yt.set,Ri=function(r,t){if(yt.has(r))throw Us(Tn);return t.facade=r,yt.set(r,t),t},Ye=function(r){return yt.get(r)||{}},Oi=function(r){return yt.has(r)}}else{var de=bf("state");wf[de]=!0,Ri=function(r,t){if(ws(r,de))throw Us(Tn);return t.facade=r,_f(r,de,t),t},Ye=function(r){return ws(r,de)?r[de]:{}},Oi=function(r){return ws(r,de)}}var Sf={set:Ri,get:Ye,has:Oi,enforce:Ef,getterFor:Af},Cr=pt,Cf=Mt,Pf=gt,vi=le,Vs=he,Mf=$o.CONFIGURABLE,If=ff,ia=Sf,Rf=ia.enforce,Of=ia.get,En=String,Ci=Object.defineProperty,Bf=Cr("".slice),Df=Cr("".replace),Lf=Cr([].join),kf=Vs&&!Cf(function(){return Ci(function(){},"length",{value:8}).length!==8}),Ff=String(String).split("String"),Nf=Jo.exports=function(r,t,e){Bf(En(t),0,7)==="Symbol("&&(t="["+Df(En(t),/^Symbol\(([^)]*)\)/,"$1")+"]"),e&&e.getter&&(t="get "+t),e&&e.setter&&(t="set "+t),(!vi(r,"name")||Mf&&r.name!==t)&&(Vs?Ci(r,"name",{value:t,configurable:!0}):r.name=t),kf&&e&&vi(e,"arity")&&r.length!==e.arity&&Ci(r,"length",{value:e.arity});try{e&&vi(e,"constructor")&&e.constructor?Vs&&Ci(r,"prototype",{writable:!1}):r.prototype&&(r.prototype=void 0)}catch(s){}var i=Rf(r);return vi(i,"source")||(i.source=Lf(Ff,typeof t=="string"?t:"")),r};Function.prototype.toString=Nf(function(){return Pf(this)&&Of(this).source||If(this)},"toString");var Uf=Jo.exports,Vf=gt,zf=Ki,Gf=Uf,jf=Tr,Hf=function(r,t,e,i){i||(i={});var s=i.enumerable,n=i.name!==void 0?i.name:t;if(Vf(e)&&Gf(e,n,i),i.global)s?r[t]=e:jf(t,e);else{try{i.unsafe?r[t]&&(s=!0):delete r[t]}catch(o){}s?r[t]=e:zf.f(r,t,{value:e,enumerable:!1,configurable:!i.nonConfigurable,writable:!i.nonWritable})}return r},sa={},Yf=Math.ceil,Xf=Math.floor,Wf=Math.trunc||function(t){var e=+t;return(e>0?Xf:Yf)(e)},Kf=Wf,ra=function(r){var t=+r;return t!==t||t===0?0:Kf(t)},qf=ra,Qf=Math.max,Jf=Math.min,Zf=function(r,t){var e=qf(r);return e<0?Qf(e+t,0):Jf(e,t)},$f=ra,td=Math.min,ed=function(r){return r>0?td($f(r),9007199254740991):0},id=ed,sd=function(r){return id(r.length)},rd=wr,nd=Zf,od=sd,An=function(r){return function(t,e,i){var s=rd(t),n=od(s),o=nd(i,n),h;if(r&&e!==e){for(;n>o;)if(h=s[o++],h!==h)return!0}else for(;n>o;o++)if((r||o in s)&&s[o]===e)return r||o||0;return!r&&-1}},ad={includes:An(!0),indexOf:An(!1)},hd=pt,Es=le,ld=wr,ud=ad.indexOf,fd=ta,Sn=hd([].push),dd=function(r,t){var e=ld(r),i=0,s=[],n;for(n in e)!Es(fd,n)&&Es(e,n)&&Sn(s,n);for(;t.length>i;)Es(e,n=t[i++])&&(~ud(s,n)||Sn(s,n));return s},cd=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],pd=dd,gd=cd,yd=gd.concat("length","prototype");sa.f=Object.getOwnPropertyNames||function(t){return pd(t,yd)};var na={};na.f=Object.getOwnPropertySymbols;var md=Uo,xd=pt,vd=sa,_d=na,bd=qo,wd=xd([].concat),Td=md("Reflect","ownKeys")||function(t){var e=vd.f(bd(t)),i=_d.f;return i?wd(e,i(t)):e},Cn=le,Ed=Td,Ad=vr,Sd=Ki,Cd=function(r,t,e){for(var i=Ed(t),s=Sd.f,n=Ad.f,o=0;o<i.length;o++){var h=i[o];!Cn(r,h)&&!(e&&Cn(e,h))&&s(r,h,n(t,h))}},Pd=Mt,Md=gt,Id=/#|\.prototype\./,oi=function(r,t){var e=Od[Rd(r)];return e===Dd?!0:e===Bd?!1:Md(t)?Pd(t):!!t},Rd=oi.normalize=function(r){return String(r).replace(Id,".").toLowerCase()},Od=oi.data={},Bd=oi.NATIVE="N",Dd=oi.POLYFILL="P",Ld=oi,As=nt,kd=vr.f,Fd=Qo,Nd=Hf,Ud=Tr,Vd=Cd,zd=Ld,ai=function(r,t){var e=r.target,i=r.global,s=r.stat,n,o,h,f,u,c;if(i?o=As:s?o=As[e]||Ud(e,{}):o=(As[e]||{}).prototype,o)for(h in t){if(u=t[h],r.dontCallGetSet?(c=kd(o,h),f=c&&c.value):f=o[h],n=zd(i?h:e+(s?".":"#")+h,r.forced),!n&&f!==void 0){if(typeof u==typeof f)continue;Vd(u,f)}(r.sham||f&&f.sham)&&Fd(u,"sham",!0),Nd(o,h,u,r)}},Gd=ai,Ss=nt;Gd({global:!0,forced:Ss.globalThis!==Ss},{globalThis:Ss});var jd=Ar,Hd=jd("toStringTag"),oa={};oa[Hd]="z";var Yd=String(oa)==="[object z]",Xd=Yd,Wd=gt,Pi=Do,Kd=Ar,qd=Kd("toStringTag"),Qd=Object,Jd=Pi(function(){return arguments}())==="Arguments",Zd=function(r,t){try{return r[t]}catch(e){}},$d=Xd?Pi:function(r){var t,e,i;return r===void 0?"Undefined":r===null?"Null":typeof(e=Zd(t=Qd(r),qd))=="string"?e:Jd?Pi(t):(i=Pi(t))==="Object"&&Wd(t.callee)?"Arguments":i},tc=$d,ec=String,ic=function(r){if(tc(r)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return ec(r)},aa=`	
\v\f\r Â áââââââââââââ¯âã\u2028\u2029\uFEFF`,sc=pt,rc=br,nc=ic,zs=aa,Pn=sc("".replace),oc=RegExp("^["+zs+"]+"),ac=RegExp("(^|[^"+zs+"])["+zs+"]+$"),Cs=function(r){return function(t){var e=nc(rc(t));return r&1&&(e=Pn(e,oc,"")),r&2&&(e=Pn(e,ac,"$1")),e}},ha={start:Cs(1),end:Cs(2),trim:Cs(3)},hc=$o.PROPER,lc=Mt,Mn=aa,In="âÂá ",la=function(r){return lc(function(){return!!Mn[r]()||In[r]()!==In||hc&&Mn[r].name!==r})},uc=ha.start,fc=la,ua=fc("trimStart")?function(){return uc(this)}:"".trimStart,dc=ai,Rn=ua;dc({target:"String",proto:!0,name:"trimStart",forced:"".trimLeft!==Rn},{trimLeft:Rn});var cc=ai,On=ua;cc({target:"String",proto:!0,name:"trimStart",forced:"".trimStart!==On},{trimStart:On});var pc=nt,gc=pt,fa=function(r,t){return gc(pc[r].prototype[t])},yc=fa;yc("String","trimLeft");var mc=ha.end,xc=la,da=xc("trimEnd")?function(){return mc(this)}:"".trimEnd,vc=ai,Bn=da;vc({target:"String",proto:!0,name:"trimEnd",forced:"".trimRight!==Bn},{trimRight:Bn});var _c=ai,Dn=da;_c({target:"String",proto:!0,name:"trimEnd",forced:"".trimEnd!==Dn},{trimEnd:Dn});var bc=fa;bc("String","trimRight");typeof globalThis!="undefined"&&typeof globalThis.console=="undefined"&&(globalThis.console={},globalThis.console.log=function(){},globalThis.console.assert=function(){},globalThis.console.warn=function(){},globalThis.console.error=function(){alert(Array.prototype.slice.call(arguments).join(", "))});(()=>{function r(t,e,i,s,n){if(![t,e,i,s].every(y=>Number.isFinite(y)))return;n=d(n);let o,h,f,u;if(n.length===4)o=m(n[0]),h=m(n[1]),f=m(n[2]),u=m(n[3]);else if(n.length===3)o=m(n[0]),h=m(n[1]),u=m(n[1]),f=m(n[2]);else if(n.length===2)o=m(n[0]),f=m(n[0]),h=m(n[1]),u=m(n[1]);else if(n.length===1)o=m(n[0]),h=m(n[0]),f=m(n[0]),u=m(n[0]);else throw new Error(n.length+" is not a valid size for radii sequence.");const c=[o,h,f,u],a=c.find(({x:y,y:_})=>y<0||_<0);if(c.some(({x:y,y:_})=>!Number.isFinite(y)||!Number.isFinite(_)))return;if(a)throw new Error("Radius value "+a+" is negative.");x(c),i<0&&s<0?(this.moveTo(t-o.x,e),this.ellipse(t+i+h.x,e-h.y,h.x,h.y,0,-Math.PI*1.5,-Math.PI),this.ellipse(t+i+f.x,e+s+f.y,f.x,f.y,0,-Math.PI,-Math.PI/2),this.ellipse(t-u.x,e+s+u.y,u.x,u.y,0,-Math.PI/2,0),this.ellipse(t-o.x,e-o.y,o.x,o.y,0,0,-Math.PI/2)):i<0?(this.moveTo(t-o.x,e),this.ellipse(t+i+h.x,e+h.y,h.x,h.y,0,-Math.PI/2,-Math.PI,1),this.ellipse(t+i+f.x,e+s-f.y,f.x,f.y,0,-Math.PI,-Math.PI*1.5,1),this.ellipse(t-u.x,e+s-u.y,u.x,u.y,0,Math.PI/2,0,1),this.ellipse(t-o.x,e+o.y,o.x,o.y,0,0,-Math.PI/2,1)):s<0?(this.moveTo(t+o.x,e),this.ellipse(t+i-h.x,e-h.y,h.x,h.y,0,Math.PI/2,0,1),this.ellipse(t+i-f.x,e+s+f.y,f.x,f.y,0,0,-Math.PI/2,1),this.ellipse(t+u.x,e+s+u.y,u.x,u.y,0,-Math.PI/2,-Math.PI,1),this.ellipse(t+o.x,e-o.y,o.x,o.y,0,-Math.PI,-Math.PI*1.5,1)):(this.moveTo(t+o.x,e),this.ellipse(t+i-h.x,e+h.y,h.x,h.y,0,-Math.PI/2,0),this.ellipse(t+i-f.x,e+s-f.y,f.x,f.y,0,0,Math.PI/2),this.ellipse(t+u.x,e+s-u.y,u.x,u.y,0,Math.PI/2,Math.PI),this.ellipse(t+o.x,e+o.y,o.x,o.y,0,Math.PI,Math.PI*1.5)),this.closePath(),this.moveTo(t,e);function l(y){const{x:_,y:v,z:b,w:T}=y;return{x:_,y:v,z:b,w:T}}function d(y){const _=typeof y;return _==="undefined"||y===null?[0]:_==="function"?[NaN]:_==="object"?typeof y[Symbol.iterator]=="function"?[...y].map(v=>{const b=typeof v;return b==="undefined"||v===null?0:b==="function"?NaN:b==="object"?l(v):p(v)}):[l(y)]:[p(y)]}function p(y){return+y}function m(y){const _=p(y);return Number.isFinite(_)?{x:_,y:_}:Object(y)===y?{x:p(y.x||0),y:p(y.y||0)}:{x:NaN,y:NaN}}function x(y){const[_,v,b,T]=y,A=[Math.abs(i)/(_.x+v.x),Math.abs(s)/(v.y+b.y),Math.abs(i)/(b.x+T.x),Math.abs(s)/(_.y+T.y)],P=Math.min(...A);P<=1&&y.forEach(V=>{V.x*=P,V.y*=P})}}globalThis.CanvasRenderingContext2D&&typeof globalThis.Path2D.prototype.roundRect=="undefined"&&(globalThis.Path2D.prototype.roundRect=r),globalThis.CanvasRenderingContext2D&&typeof globalThis.CanvasRenderingContext2D.prototype.roundRect=="undefined"&&(globalThis.CanvasRenderingContext2D.prototype.roundRect=r),globalThis.OffscreenCanvasRenderingContext2D&&typeof globalThis.OffscreenCanvasRenderingContext2D.prototype.roundRect=="undefined"&&(globalThis.OffscreenCanvasRenderingContext2D.prototype.roundRect=r)})();const ca=Math.PI/180,pa=180/Math.PI,G=Math.PI*2,ga=Math.PI*.5,ya=1e-6;function $t(r){return(r&r-1)===0}function Gs(r){return r--,r|=r>>1,r|=r>>2,r|=r>>4,r|=r>>8,r|=r>>16,r++,r}function Pr(r){return r*ca}function wc(r){return r*pa}function E(r,t,e){return r<t?t:r>e?e:+r}function ze(r,t){return~~(Math.random()*(t-r))+r}function wt(r,t){return Math.random()*(t-r)+r}function ma(r,t){return~~(Math.pow(Math.random(),2)*(t-r))+r}function Tc(r,t=0){const e=Math.pow(10,t);return~~(.5+r*e)/e}function js(r,t,e=2){return Math.abs(r-t)<Math.pow(10,-e)/2}var Ln={__proto__:null,DEG_TO_RAD:ca,EPSILON:ya,ETA:ga,RAD_TO_DEG:pa,TAU:G,clamp:E,degToRad:Pr,isPowerOfTwo:$t,nextPowerOfTwo:Gs,radToDeg:wc,random:ze,randomFloat:wt,round:Tc,toBeCloseTo:js,weightedRandom:ma};class Ec{constructor(){this.objectClass={},this.instance_counter=0}register(t,e,i=!1){if(typeof e!="undefined")this.objectClass[t]={class:e,pool:i?[]:void 0};else throw new Error("Cannot register object '"+t+"', invalid class")}pull(t,...e){let i=this.objectClass[t];if(i){let s=i.class,n=i.pool,o;return n&&(o=n.pop())?(o.onResetEvent.apply(o,e),this.instance_counter--):(o=new(s.bind.apply(s,[s,...e])),n&&(o.className=t)),o}throw new Error("Cannot instantiate object of type '"+t+"'")}purge(){for(let t in this.objectClass)this.objectClass[t]&&(this.objectClass[t].pool=[]);this.instance_counter=0}push(t,e=!0){if(!this.poolable(t)){if(e===!0)throw new Error("me.pool: object "+t+" cannot be recycled");return!1}return this.objectClass[t.className].pool.push(t),this.instance_counter++,!0}exists(t){return t in this.objectClass}poolable(t){let e=t.className;return typeof e!="undefined"&&typeof t.onResetEvent=="function"&&e in this.objectClass&&typeof this.objectClass[e].pool!="undefined"}getInstanceCount(){return this.instance_counter}}let g=new Ec;const kn=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"];function Ht(r){return kn[(r&240)>>4]+kn[r&15]}function Ps(r,t,e){return e<0&&(e+=1),e>1&&(e-=1),e<1/6?r+(t-r)*6*e:e<1/2?t:e<2/3?r+(t-r)*(2/3-e)*6:r}const Ac=/^rgba?\((\d+), ?(\d+), ?(\d+)(, ?([\d\.]+))?\)$/,Sc=/^#([\da-fA-F])([\da-fA-F])([\da-fA-F])$/,Cc=/^#([\da-fA-F])([\da-fA-F])([\da-fA-F])([\da-fA-F])$/,Pc=/^#([\da-fA-F]{2})([\da-fA-F]{2})([\da-fA-F]{2})$/,Mc=/^#([\da-fA-F]{2})([\da-fA-F]{2})([\da-fA-F]{2})([\da-fA-F]{2})$/;let Hs=new Map;[["black",[0,0,0]],["silver",[192,192,129]],["gray",[128,128,128]],["white",[255,255,255]],["maroon",[128,0,0]],["red",[255,0,0]],["purple",[128,0,128]],["fuchsia",[255,0,255]],["green",[0,128,0]],["lime",[0,255,0]],["olive",[128,128,0]],["yellow",[255,255,0]],["navy",[0,0,128]],["blue",[0,0,255]],["teal",[0,128,128]],["aqua",[0,255,255]],["orange",[255,165,0]],["aliceblue",[240,248,245]],["antiquewhite",[250,235,215]],["aquamarine",[127,255,212]],["azure",[240,255,255]],["beige",[245,245,220]],["bisque",[255,228,196]],["blanchedalmond",[255,235,205]],["blueviolet",[138,43,226]],["brown",[165,42,42]],["burlywood",[222,184,35]],["cadetblue",[95,158,160]],["chartreuse",[127,255,0]],["chocolate",[210,105,30]],["coral",[255,127,80]],["cornflowerblue",[100,149,237]],["cornsilk",[255,248,220]],["crimson",[220,20,60]],["darkblue",[0,0,139]],["darkcyan",[0,139,139]],["darkgoldenrod",[184,134,11]],["darkgray[*]",[169,169,169]],["darkgreen",[0,100,0]],["darkgrey[*]",[169,169,169]],["darkkhaki",[189,183,107]],["darkmagenta",[139,0,139]],["darkolivegreen",[85,107,47]],["darkorange",[255,140,0]],["darkorchid",[153,50,204]],["darkred",[139,0,0]],["darksalmon",[233,150,122]],["darkseagreen",[143,188,143]],["darkslateblue",[72,61,139]],["darkslategray",[47,79,79]],["darkslategrey",[47,79,79]],["darkturquoise",[0,206,209]],["darkviolet",[148,0,211]],["deeppink",[255,20,147]],["deepskyblue",[0,191,255]],["dimgray",[105,105,105]],["dimgrey",[105,105,105]],["dodgerblue",[30,144,255]],["firebrick",[178,34,34]],["floralwhite",[255,250,240]],["forestgreen",[34,139,34]],["gainsboro",[220,220,220]],["ghostwhite",[248,248,255]],["gold",[255,215,0]],["goldenrod",[218,165,32]],["greenyellow",[173,255,47]],["grey",[128,128,128]],["honeydew",[240,255,240]],["hotpink",[255,105,180]],["indianred",[205,92,92]],["indigo",[75,0,130]],["ivory",[255,255,240]],["khaki",[240,230,140]],["lavender",[230,230,250]],["lavenderblush",[255,240,245]],["lawngreen",[124,252,0]],["lemonchiffon",[255,250,205]],["lightblue",[173,216,230]],["lightcoral",[240,128,128]],["lightcyan",[224,255,255]],["lightgoldenrodyellow",[250,250,210]],["lightgray",[211,211,211]],["lightgreen",[144,238,144]],["lightgrey",[211,211,211]],["lightpink",[255,182,193]],["lightsalmon",[255,160,122]],["lightseagreen",[32,178,170]],["lightskyblue",[135,206,250]],["lightslategray",[119,136,153]],["lightslategrey",[119,136,153]],["lightsteelblue",[176,196,222]],["lightyellow",[255,255,224]],["limegreen",[50,205,50]],["linen",[250,240,230]],["mediumaquamarine",[102,205,170]],["mediumblue",[0,0,205]],["mediumorchid",[186,85,211]],["mediumpurple",[147,112,219]],["mediumseagreen",[60,179,113]],["mediumslateblue",[123,104,238]],["mediumspringgreen",[0,250,154]],["mediumturquoise",[72,209,204]],["mediumvioletred",[199,21,133]],["midnightblue",[25,25,112]],["mintcream",[245,255,250]],["mistyrose",[255,228,225]],["moccasin",[255,228,181]],["navajowhite",[255,222,173]],["oldlace",[253,245,230]],["olivedrab",[107,142,35]],["orangered",[255,69,0]],["orchid",[218,112,214]],["palegoldenrod",[238,232,170]],["palegreen",[152,251,152]],["paleturquoise",[175,238,238]],["palevioletred",[219,112,147]],["papayawhip",[255,239,213]],["peachpuff",[255,218,185]],["peru",[205,133,63]],["pink",[255,192,203]],["plum",[221,160,221]],["powderblue",[176,224,230]],["rosybrown",[188,143,143]],["royalblue",[65,105,225]],["saddlebrown",[139,69,19]],["salmon",[250,128,114]],["sandybrown",[244,164,96]],["seagreen",[46,139,87]],["seashell",[255,245,238]],["sienna",[160,82,45]],["skyblue",[135,206,235]],["slateblue",[106,90,205]],["slategray",[112,128,144]],["slategrey",[112,128,144]],["snow",[255,250,250]],["springgreen",[0,255,127]],["steelblue",[70,130,180]],["tan",[210,180,140]],["thistle",[216,191,216]],["tomato",[255,99,71]],["turquoise",[64,224,208]],["violet",[238,130,238]],["wheat",[245,222,179]],["whitesmoke",[245,245,245]],["yellowgreen",[154,205,50]]].forEach(r=>{Hs.set(r[0],r[1])});class st{constructor(t=0,e=0,i=0,s=1){this.onResetEvent(t,e,i,s)}onResetEvent(t=0,e=0,i=0,s=1){typeof this.glArray=="undefined"&&(this.glArray=new Float32Array([0,0,0,1])),this.setColor(t,e,i,s)}get r(){return~~(this.glArray[0]*255)}set r(t){this.glArray[0]=E(~~t||0,0,255)/255}get g(){return~~(this.glArray[1]*255)}set g(t){this.glArray[1]=E(~~t||0,0,255)/255}get b(){return~~(this.glArray[2]*255)}set b(t){this.glArray[2]=E(~~t||0,0,255)/255}get alpha(){return this.glArray[3]}set alpha(t=1){this.glArray[3]=E(+t,0,1)}setColor(t,e,i,s=1){return this.r=t,this.g=e,this.b=i,this.alpha=s,this}setFloat(t,e,i,s=1){const n=this.glArray;return n[0]=E(+t,0,1),n[1]=E(+e,0,1),n[2]=E(+i,0,1),n[3]=E(+s,0,1),this}setHSV(t,e,i){let s,n,o,h=Math.floor(t*6),f=t*6-h,u=i*(1-e),c=i*(1-f*e),a=i*(1-(1-f)*e);switch(h%6){case 0:s=i,n=a,o=u;break;case 1:s=c,n=i,o=u;break;case 2:s=u,n=i,o=a;break;case 3:s=u,n=c,o=i;break;case 4:s=a,n=u,o=i;break;case 5:s=i,n=u,o=c;break}return this.setColor(s*255,n*255,o*255)}setHSL(t,e,i){let s,n,o;if(e===0)s=n=o=i;else{let h=i<.5?i*(1+e):i+e-i*e,f=2*i-h;s=Ps(f,h,t+1/3),n=Ps(f,h,t),o=Ps(f,h,t-1/3)}return this.setColor(s*255,n*255,o*255)}clone(){return g.pull("Color").copy(this)}copy(t){return typeof t=="string"?this.parseCSS(t):(this.glArray.set(t.glArray),this)}add(t){return this.glArray[0]=E(this.glArray[0]+t.glArray[0],0,1),this.glArray[1]=E(this.glArray[1]+t.glArray[1],0,1),this.glArray[2]=E(this.glArray[2]+t.glArray[2],0,1),this.glArray[3]=(this.glArray[3]+t.glArray[3])/2,this}darken(t){return t=E(t,0,1),this.glArray[0]*=t,this.glArray[1]*=t,this.glArray[2]*=t,this}lerp(t,e){return e=E(e,0,1),this.glArray[0]+=(t.glArray[0]-this.glArray[0])*e,this.glArray[1]+=(t.glArray[1]-this.glArray[1])*e,this.glArray[2]+=(t.glArray[2]-this.glArray[2])*e,this}lighten(t){return t=E(t,0,1),this.glArray[0]=E(this.glArray[0]+(1-this.glArray[0])*t,0,1),this.glArray[1]=E(this.glArray[1]+(1-this.glArray[1])*t,0,1),this.glArray[2]=E(this.glArray[2]+(1-this.glArray[2])*t,0,1),this}random(t=0,e=255){return t<0&&(t=0),e>255&&(e=255),this.setColor(ze(t,e),ze(t,e),ze(t,e),this.alpha)}equals(t){return this.glArray[0]===t.glArray[0]&&this.glArray[1]===t.glArray[1]&&this.glArray[2]===t.glArray[2]&&this.glArray[3]===t.glArray[3]}parseCSS(t){return Hs.has(t)?this.setColor.apply(this,Hs.get(t)):this.parseRGB(t)}parseRGB(t){let e=Ac.exec(t);return e?this.setColor(+e[1],+e[2],+e[3],+e[5]):this.parseHex(t)}parseHex(t,e=!1){let i;if(i=Mc.exec(t))return this.setColor(parseInt(i[e===!1?1:2],16),parseInt(i[e===!1?2:3],16),parseInt(i[e===!1?3:4],16),(E(parseInt(i[e===!1?4:1],16),0,255)/255).toFixed(1));if(i=Pc.exec(t))return this.setColor(parseInt(i[1],16),parseInt(i[2],16),parseInt(i[3],16));if(i=Cc.exec(t)){let s=i[e===!1?1:2],n=i[e===!1?2:3],o=i[e===!1?3:4],h=i[e===!1?4:1];return this.setColor(parseInt(s+s,16),parseInt(n+n,16),parseInt(o+o,16),(E(parseInt(h+h,16),0,255)/255).toFixed(1))}if(i=Sc.exec(t))return this.setColor(parseInt(i[1]+i[1],16),parseInt(i[2]+i[2],16),parseInt(i[3]+i[3],16));throw new Error("invalid parameter: "+t)}toUint32(t=1){const e=this.glArray,i=e[0]*255>>0,s=e[1]*255>>0,n=e[2]*255>>0;return t*255>>0<<24|i<<16|s<<8|n}toArray(){return this.glArray}toHex(){return"#"+Ht(this.r)+Ht(this.g)+Ht(this.b)}toHex8(t=this.alpha){return"#"+Ht(this.r)+Ht(this.g)+Ht(this.b)+Ht(t*255)}toRGB(){return"rgb("+this.r+","+this.g+","+this.b+")"}toRGBA(t=this.alpha){return"rgba("+this.r+","+this.g+","+this.b+","+t+")"}}class C{constructor(t=0,e=0){this.onResetEvent(t,e)}onResetEvent(t=0,e=0){this.x=t,this.y=e}_set(t,e){return this.x=t,this.y=e,this}set(t,e){if(t!==+t||e!==+e)throw new Error("invalid x,y parameters (not a number)");return this._set(t,e)}setZero(){return this.set(0,0)}setV(t){return this._set(t.x,t.y)}add(t){return this._set(this.x+t.x,this.y+t.y)}sub(t){return this._set(this.x-t.x,this.y-t.y)}scale(t,e=t){return this._set(this.x*t,this.y*e)}toIso(){return this._set(this.x-this.y,(this.x+this.y)*.5)}to2d(){return this._set(this.y+this.x/2,this.y-this.x/2)}scaleV(t){return this._set(this.x*t.x,this.y*t.y)}div(t){return this._set(this.x/t,this.y/t)}abs(){return this._set(this.x<0?-this.x:this.x,this.y<0?-this.y:this.y)}clamp(t,e){return new C(E(this.x,t,e),E(this.y,t,e))}clampSelf(t,e){return this._set(E(this.x,t,e),E(this.y,t,e))}minV(t){return this._set(this.x<t.x?this.x:t.x,this.y<t.y?this.y:t.y)}maxV(t){return this._set(this.x>t.x?this.x:t.x,this.y>t.y?this.y:t.y)}floor(){return new C(Math.floor(this.x),Math.floor(this.y))}floorSelf(){return this._set(Math.floor(this.x),Math.floor(this.y))}ceil(){return new C(Math.ceil(this.x),Math.ceil(this.y))}ceilSelf(){return this._set(Math.ceil(this.x),Math.ceil(this.y))}negate(){return new C(-this.x,-this.y)}negateSelf(){return this._set(-this.x,-this.y)}copy(t){return this._set(t.x,t.y)}equals(){let t,e;return arguments.length===2?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y),this.x===t&&this.y===e}normalize(){return this.div(this.length()||1)}perp(){return this._set(this.y,-this.x)}rotate(t,e){let i=0,s=0;typeof e=="object"&&(i=e.x,s=e.y);let n=this.x-i,o=this.y-s,h=Math.cos(t),f=Math.sin(t);return this._set(n*h-o*f+i,n*f+o*h+s)}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}length2(){return this.dot(this)}length(){return Math.sqrt(this.length2())}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}moveTowards(t,e){let i=Math.atan2(t.y-this.y,t.x-this.x),s=this.distance(t);return s===0||e>=0&&s<=e*e?t:(this.x+=Math.cos(i)*e,this.y+=Math.sin(i)*e,this)}distance(t){let e=this.x-t.x,i=this.y-t.y;return Math.sqrt(e*e+i*i)}angle(t){return Math.acos(E(this.dot(t)/(this.length()*t.length()),-1,1))}project(t){return this.scale(this.dot(t)/t.length2())}projectN(t){return this.scale(this.dot(t))}clone(){return g.pull("Vector2d",this.x,this.y)}toString(){return"x:"+this.x+",y:"+this.y}}class Et{constructor(t=0,e=0,i=0){this.onResetEvent(t,e,i)}onResetEvent(t=0,e=0,i=0){this.x=t,this.y=e,this.z=i}_set(t,e,i=0){return this.x=t,this.y=e,this.z=i,this}set(t,e,i){if(t!==+t||e!==+e||typeof i!="undefined"&&i!==+i)throw new Error("invalid x, y, z parameters (not a number)");return this._set(t,e,i)}setZero(){return this.set(0,0,0)}setV(t){return this._set(t.x,t.y,t.z)}add(t){return this._set(this.x+t.x,this.y+t.y,this.z+(t.z||0))}sub(t){return this._set(this.x-t.x,this.y-t.y,this.z-(t.z||0))}scale(t,e=t,i=1){return this._set(this.x*t,this.y*e,this.z*i)}scaleV(t){return this.scale(t.x,t.y,t.z)}toIso(){return this._set(this.x-this.y,(this.x+this.y)*.5,this.z)}to2d(){return this._set(this.y+this.x/2,this.y-this.x/2,this.z)}div(t){return this._set(this.x/t,this.y/t,this.z/t)}abs(){return this._set(this.x<0?-this.x:this.x,this.y<0?-this.y:this.y,this.z<0?-this.z:this.z)}clamp(t,e){return new Et(E(this.x,t,e),E(this.y,t,e),E(this.z,t,e))}clampSelf(t,e){return this._set(E(this.x,t,e),E(this.y,t,e),E(this.z,t,e))}minV(t){let e=t.z||0;return this._set(this.x<t.x?this.x:t.x,this.y<t.y?this.y:t.y,this.z<e?this.z:e)}maxV(t){let e=t.z||0;return this._set(this.x>t.x?this.x:t.x,this.y>t.y?this.y:t.y,this.z>e?this.z:e)}floor(){return new Et(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))}floorSelf(){return this._set(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))}ceil(){return new Et(Math.ceil(this.x),Math.ceil(this.y),Math.ceil(this.z))}ceilSelf(){return this._set(Math.ceil(this.x),Math.ceil(this.y),Math.ceil(this.z))}negate(){return new Et(-this.x,-this.y,-this.z)}negateSelf(){return this._set(-this.x,-this.y,-this.z)}copy(t){return this._set(t.x,t.y,t.z||0)}equals(){let t,e,i;return arguments.length>=2?(t=arguments[0],e=arguments[1],i=arguments[2]):(t=arguments[0].x,e=arguments[0].y,i=arguments[0].z),typeof i=="undefined"&&(i=this.z),this.x===t&&this.y===e&&this.z===i}normalize(){return this.div(this.length()||1)}perp(){return this._set(this.y,-this.x,this.z)}rotate(t,e){let i=0,s=0;typeof e=="object"&&(i=e.x,s=e.y);let n=this.x-i,o=this.y-s,h=Math.cos(t),f=Math.sin(t);return this._set(n*h-o*f+i,n*f+o*h+s,this.z)}dot(t){return this.x*t.x+this.y*t.y+this.z*(typeof t.z!="undefined"?t.z:this.z)}cross(t){let e=this.x,i=this.y,s=this.z,n=t.x,o=t.y,h=t.z;return this.x=i*h-s*o,this.y=s*n-e*h,this.z=e*o-i*n,this}length2(){return this.dot(this)}length(){return Math.sqrt(this.length2())}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}moveTowards(t,e){let i=Math.atan2(t.y-this.y,t.x-this.x),s=this.x-t.x,n=this.y-t.y,o=Math.sqrt(s*s+n*n);return o===0||e>=0&&o<=e*e?t:(this.x+=Math.cos(i)*e,this.y+=Math.sin(i)*e,this)}distance(t){let e=this.x-t.x,i=this.y-t.y,s=this.z-(t.z||0);return Math.sqrt(e*e+i*i+s*s)}angle(t){return Math.acos(E(this.dot(t)/(this.length()*t.length()),-1,1))}project(t){let e=this.dot(t)/t.length2();return this.scale(e,e,e)}projectN(t){let e=this.dot(t)/t.length2();return this.scale(e,e,e)}clone(){return g.pull("Vector3d",this.x,this.y,this.z)}toString(){return"x:"+this.x+",y:"+this.y+",z:"+this.z}}class At extends C{constructor(t=0,e=0,i){if(super(t,e),typeof i=="undefined")throw new Error("undefined `onUpdate` callback");this.setCallback(i.onUpdate,i.scope)}onResetEvent(t=0,e=0,i){this.setMuted(t,e),typeof i!="undefined"&&this.setCallback(i.onUpdate,i.scope)}get x(){return this._x}set x(t){let e=this.onUpdate.call(this.scope,t,this._y,this._x,this._y);e&&"x"in e?this._x=e.x:this._x=t}get y(){return this._y}set y(t){let e=this.onUpdate.call(this.scope,this._x,t,this._x,this._y);e&&"y"in e?this._y=e.y:this._y=t}_set(t,e){let i=this.onUpdate.call(this.scope,t,e,this._x,this._y);return i&&"x"in i&&"y"in i?(this._x=i.x,this._y=i.y):(this._x=t,this._y=e),this}setMuted(t,e){return this._x=t,this._y=e,this}setCallback(t,e=null){if(typeof t!="function")throw new Error("invalid `onUpdate` callback");return this.onUpdate=t,this.scope=e,this}add(t){return this._set(this._x+t.x,this._y+t.y)}sub(t){return this._set(this._x-t.x,this._y-t.y)}scale(t,e=t){return this._set(this._x*t,this._y*e)}scaleV(t){return this._set(this._x*t.x,this._y*t.y)}div(t){return this._set(this._x/t,this._y/t)}abs(){return this._set(this._x<0?-this._x:this._x,this._y<0?-this._y:this._y)}clamp(t,e){return new At(E(this.x,t,e),E(this.y,t,e),{onUpdate:this.onUpdate,scope:this.scope})}clampSelf(t,e){return this._set(E(this._x,t,e),E(this._y,t,e))}minV(t){return this._set(this._x<t.x?this._x:t.x,this._y<t.y?this._y:t.y)}maxV(t){return this._set(this._x>t.x?this._x:t.x,this._y>t.y?this._y:t.y)}floor(){return new At(Math.floor(this._x),Math.floor(this._y),{onUpdate:this.onUpdate,scope:this.scope})}floorSelf(){return this._set(Math.floor(this._x),Math.floor(this._y))}ceil(){return new At(Math.ceil(this._x),Math.ceil(this._y),{onUpdate:this.onUpdate,scope:this.scope})}ceilSelf(){return this._set(Math.ceil(this._x),Math.ceil(this._y))}negate(){return new At(-this._x,-this._y,{onUpdate:this.onUpdate,scope:this.scope})}negateSelf(){return this._set(-this._x,-this._y)}copy(t){return this._set(t.x,t.y)}equals(t){return this._x===t.x&&this._y===t.y}perp(){return this._set(this._y,-this._x)}rotate(t,e){let i=0,s=0;typeof e=="object"&&(i=e.x,s=e.y);let n=this._x-i,o=this._y-s,h=Math.cos(t),f=Math.sin(t);return this._set(n*h-o*f+i,n*f+o*h+s)}dot(t){return this._x*t.x+this._y*t.y}cross(t){return this._x*t.y-this._y*t.x}lerp(t,e){return this._set(this._x+(t.x-this._x)*e,this._y+(t.y-this._y)*e)}moveTowards(t,e){let i=Math.atan2(t.y-this._y,t.x-this._x),s=this.distance(t);return s===0||e>=0&&s<=e*e?t:(this._x+=Math.cos(i)*e,this._y+=Math.sin(i)*e,this)}distance(t){return Math.sqrt((this._x-t.x)*(this._x-t.x)+(this._y-t.y)*(this._y-t.y))}clone(){return g.pull("ObservableVector2d",this._x,this._y,{onUpdate:this.onUpdate,scope:this.scope})}toVector2d(){return g.pull("Vector2d",this._x,this._y)}toString(){return"x:"+this._x+",y:"+this._y}}class St extends Et{constructor(t=0,e=0,i=0,s){if(super(t,e,i),typeof s=="undefined")throw new Error("undefined `onUpdate` callback");this.setCallback(s.onUpdate,s.scope)}onResetEvent(t=0,e=0,i=0,s){return this.setMuted(t,e,i),typeof s!="undefined"&&this.setCallback(s.onUpdate,s.scope),this}get x(){return this._x}set x(t){let e=this.onUpdate.call(this.scope,t,this._y,this._z,this._x,this._y,this._z);e&&"x"in e?this._x=e.x:this._x=t}get y(){return this._y}set y(t){let e=this.onUpdate.call(this.scope,this._x,t,this._z,this._x,this._y,this._z);e&&"y"in e?this._y=e.y:this._y=t}get z(){return this._z}set z(t){let e=this.onUpdate.call(this.scope,this._x,this._y,t,this._x,this._y,this._z);e&&"z"in e?this._z=e.z:this._z=t}_set(t,e,i){let s=this.onUpdate.call(this.scope,t,e,i,this._x,this._y,this._z);return s&&"x"in s&&"y"in s&&"z"in s?(this._x=s.x,this._y=s.y,this._z=s.z):(this._x=t,this._y=e,this._z=i||0),this}setMuted(t,e,i){return this._x=t,this._y=e,this._z=i||0,this}setCallback(t,e=null){if(typeof t!="function")throw new Error("invalid `onUpdate` callback");return this.onUpdate=t,this.scope=e,this}add(t){return this._set(this._x+t.x,this._y+t.y,this._z+(t.z||0))}sub(t){return this._set(this._x-t.x,this._y-t.y,this._z-(t.z||0))}scale(t,e=t,i=1){return this._set(this._x*t,this._y*e,this._z*i)}scaleV(t){return this._set(this._x*t.x,this._y*t.y,this._z*(t.z||1))}div(t){return this._set(this._x/t,this._y/t,this._z/t)}abs(){return this._set(this._x<0?-this._x:this._x,this._y<0?-this._y:this._y,this._Z<0?-this._z:this._z)}clamp(t,e){return new St(E(this._x,t,e),E(this._y,t,e),E(this._z,t,e),{onUpdate:this.onUpdate,scope:this.scope})}clampSelf(t,e){return this._set(E(this._x,t,e),E(this._y,t,e),E(this._z,t,e))}minV(t){let e=t.z||0;return this._set(this._x<t.x?this._x:t.x,this._y<t.y?this._y:t.y,this._z<e?this._z:e)}maxV(t){let e=t.z||0;return this._set(this._x>t.x?this._x:t.x,this._y>t.y?this._y:t.y,this._z>e?this._z:e)}floor(){return new St(Math.floor(this._x),Math.floor(this._y),Math.floor(this._z),{onUpdate:this.onUpdate,scope:this.scope})}floorSelf(){return this._set(Math.floor(this._x),Math.floor(this._y),Math.floor(this._z))}ceil(){return new St(Math.ceil(this._x),Math.ceil(this._y),Math.ceil(this._z),{onUpdate:this.onUpdate,scope:this.scope})}ceilSelf(){return this._set(Math.ceil(this._x),Math.ceil(this._y),Math.ceil(this._z))}negate(){return new St(-this._x,-this._y,-this._z,{onUpdate:this.onUpdate,scope:this.scope})}negateSelf(){return this._set(-this._x,-this._y,-this._z)}copy(t){return this._set(t.x,t.y,t.z||0)}equals(t){return this._x===t.x&&this._y===t.y&&this._z===(t.z||this._z)}perp(){return this._set(this._y,-this._x,this._z)}rotate(t,e){let i=0,s=0;typeof e=="object"&&(i=e.x,s=e.y);let n=this.x-i,o=this.y-s,h=Math.cos(t),f=Math.sin(t);return this._set(n*h-o*f+i,n*f+o*h+s,this.z)}dot(t){return this._x*t.x+this._y*t.y+this._z*(t.z||1)}cross(t){let e=this._x,i=this._y,s=this._z,n=t.x,o=t.y,h=t.z;return this._set(i*h-s*o,s*n-e*h,e*o-i*n)}lerp(t,e){return this._set(this._x+(t.x-this._x)*e,this._y+(t.y-this._y)*e,this._z+(t.z-this._z)*e)}moveTowards(t,e){let i=Math.atan2(t.y-this._y,t.x-this._x),s=this._x-t.x,n=this._y-t.y,o=Math.sqrt(s*s+n*n);return o===0||e>=0&&o<=e*e?t:this._set(this._x+Math.cos(i)*e,this._y+Math.sin(i)*e,this._z)}distance(t){let e=this._x-t.x,i=this._y-t.y,s=this._z-(t.z||0);return Math.sqrt(e*e+i*i+s*s)}clone(){return g.pull("ObservableVector3d",this._x,this._y,this._z,{onUpdate:this.onUpdate})}toVector3d(){return g.pull("Vector3d",this._x,this._y,this._z)}toString(){return"x:"+this._x+",y:"+this._y+",z:"+this._z}}class Xe{constructor(...t){this.onResetEvent(...t)}onResetEvent(){const t=arguments[0],e=arguments.length;if(typeof this.val=="undefined"&&(this.val=new Float32Array(9)),e===1)if(t.val.length===9)this.copy(t);else if(t.val.length===16)this.fromMat3d(arguments[0]);else throw new Error("invalid Matrix2d constructor parameter");else arguments.length>=6?this.setTransform.apply(this,arguments):this.identity()}get tx(){return this.val[6]}get ty(){return this.val[7]}identity(){return this.setTransform(1,0,0,0,1,0,0,0,1),this}setTransform(){let t=this.val;return arguments.length===9?(t[0]=arguments[0],t[1]=arguments[1],t[2]=arguments[2],t[3]=arguments[3],t[4]=arguments[4],t[5]=arguments[5],t[6]=arguments[6],t[7]=arguments[7],t[8]=arguments[8]):arguments.length===6&&(t[0]=arguments[0],t[1]=arguments[2],t[2]=arguments[4],t[3]=arguments[1],t[4]=arguments[3],t[5]=arguments[5],t[6]=0,t[7]=0,t[8]=1),this}transform(t,e,i,s,n,o){let h=this.val,f=h[0],u=h[1],c=h[3],a=h[4],l=t,d=e,p=i,m=s,x=n,y=o;return h[0]=f*l+c*d,h[1]=u*l+a*d,h[3]=f*p+c*m,h[4]=u*p+a*m,h[6]+=f*x+c*y,h[7]+=u*x+a*y,this}copy(t){return this.val.set(t.val),this}fromMat3d(t){let e=t.val,i=this.val;return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[4],i[4]=e[5],i[5]=e[6],i[6]=e[8],i[7]=e[9],i[8]=e[10],this}multiply(t){let e=t.val,i=this.val,s=i[0],n=i[1],o=i[3],h=i[4],f=e[0],u=e[1],c=e[3],a=e[4],l=e[6],d=e[7];return i[0]=s*f+o*u,i[1]=n*f+h*u,i[3]=s*c+o*a,i[4]=n*c+h*a,i[6]+=s*l+o*d,i[7]+=n*l+h*d,this}transpose(){let t=this.val,e=t[1],i=t[2],s=t[5];return t[1]=t[3],t[2]=t[6],t[3]=e,t[5]=t[7],t[6]=i,t[7]=s,this}invert(){let t=this.val,e=t[0],i=t[1],s=t[2],n=t[3],o=t[4],h=t[5],f=t[6],u=t[7],c=t[8],a=c*o-h*u,l=h*f-c*n,d=u*n-o*f,p=e*a+i*l+s*d;return t[0]=a/p,t[1]=(s*u-c*i)/p,t[2]=(h*i-s*o)/p,t[3]=l/p,t[4]=(c*e-s*f)/p,t[5]=(s*n-h*e)/p,t[6]=d/p,t[7]=(i*f-u*e)/p,t[8]=(o*e-i*n)/p,this}apply(t){let e=this.val,i=t.x,s=t.y,n=typeof t.z!="undefined"?t.z:1;return t.x=i*e[0]+s*e[3]+n*e[6],t.y=i*e[1]+s*e[4]+n*e[7],typeof t.z!="undefined"&&(t.z=i*e[2]+s*e[5]+n*e[8]),t}applyInverse(t){let e=this.val,i=t.x,s=t.y,n=1/(e[0]*e[4]+e[3]*-e[1]);return t.x=e[4]*n*i+-e[3]*n*s+(e[7]*e[3]-e[6]*e[4])*n,t.y=e[0]*n*s+-e[1]*n*i+(-e[7]*e[0]+e[6]*e[1])*n,t}scale(t,e=t){let i=this.val;return i[0]*=t,i[1]*=t,i[3]*=e,i[4]*=e,this}scaleV(t){return this.scale(t.x,t.y)}scaleX(t){return this.scale(t,1)}scaleY(t){return this.scale(1,t)}rotate(t){if(t!==0){let e=this.val,i=e[0],s=e[1],n=e[2],o=e[3],h=e[4],f=e[5],u=Math.sin(t),c=Math.cos(t);e[0]=c*i+u*o,e[1]=c*s+u*h,e[2]=c*n+u*f,e[3]=c*o-u*i,e[4]=c*h-u*s,e[5]=c*f-u*n}return this}translate(){let t=this.val,e,i;return arguments.length===2?(e=arguments[0],i=arguments[1]):(e=arguments[0].x,i=arguments[0].y),t[6]+=t[0]*e+t[3]*i,t[7]+=t[1]*e+t[4]*i,this}isIdentity(){let t=this.val;return t[0]===1&&t[1]===0&&t[2]===0&&t[3]===0&&t[4]===1&&t[5]===0&&t[6]===0&&t[7]===0&&t[8]===1}equals(t){let e=t.val,i=this.val;return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]&&i[4]===e[4]&&i[5]===e[5]&&i[6]===e[6]&&i[7]===e[7]&&i[8]===e[8]}clone(){return g.pull("Matrix2d",this)}toArray(){return this.val}toString(){let t=this.val;return"me.Matrix2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}}class Bi{constructor(...t){this.onResetEvent(...t)}onResetEvent(){const t=arguments[0],e=arguments.length;typeof this.val=="undefined"&&(this.val=new Float32Array(16)),e===1&&t.val.length===16?this.copy(t):e===16?this.setTransform.apply(this,arguments):this.identity()}get tx(){return this.val[12]}get ty(){return this.val[13]}get tz(){return this.val[14]}identity(){return this.setTransform(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}setTransform(t,e,i,s,n,o,h,f,u,c,a,l,d,p,m,x){let y=this.val;return y[0]=t,y[1]=e,y[2]=i,y[3]=s,y[4]=n,y[5]=o,y[6]=h,y[7]=f,y[8]=u,y[9]=c,y[10]=a,y[11]=l,y[12]=d,y[13]=p,y[14]=m,y[15]=x,this}copy(t){return this.val.set(t.val),this}fromMat2d(t){let e=t.val;return this.setTransform(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1)}multiply(t){let e=this.val,i=t.val,s=e[0],n=e[1],o=e[2],h=e[3],f=e[4],u=e[5],c=e[6],a=e[7],l=e[8],d=e[9],p=e[10],m=e[11],x=e[12],y=e[13],_=e[14],v=e[15],b=i[0],T=i[1],A=i[2],P=i[3];return e[0]=b*s+T*f+A*l+P*x,e[1]=b*n+T*u+A*d+P*y,e[2]=b*o+T*c+A*p+P*_,e[3]=b*h+T*a+A*m+P*v,b=i[4],T=i[5],A=i[6],P=i[7],e[4]=b*s+T*f+A*l+P*x,e[5]=b*n+T*u+A*d+P*y,e[6]=b*o+T*c+A*p+P*_,e[7]=b*h+T*a+A*m+P*v,b=i[8],T=i[9],A=i[10],P=i[11],e[8]=b*s+T*f+A*l+P*x,e[9]=b*n+T*u+A*d+P*y,e[10]=b*o+T*c+A*p+P*_,e[11]=b*h+T*a+A*m+P*v,b=i[12],T=i[13],A=i[14],P=i[15],e[12]=b*s+T*f+A*l+P*x,e[13]=b*n+T*u+A*d+P*y,e[14]=b*o+T*c+A*p+P*_,e[15]=b*h+T*a+A*m+P*v,this}transpose(){let t=this.val,e=t[1],i=t[2],s=t[3],n=t[6],o=t[7],h=t[11];return t[1]=t[4],t[2]=t[8],t[3]=t[12],t[4]=e,t[6]=t[9],t[7]=t[13],t[8]=i,t[9]=n,t[11]=t[14],t[12]=s,t[13]=o,t[14]=h,this}invert(){let t=this.val,e=t[0],i=t[1],s=t[2],n=t[3],o=t[4],h=t[5],f=t[6],u=t[7],c=t[8],a=t[9],l=t[10],d=t[11],p=t[12],m=t[13],x=t[14],y=t[15],_=e*h-i*o,v=e*f-s*o,b=e*u-n*o,T=i*f-s*h,A=i*u-n*h,P=s*u-n*f,V=c*m-a*p,I=c*x-l*p,j=c*y-d*p,H=a*x-l*m,q=a*y-d*m,K=l*y-d*x,D=_*K-v*q+b*H+T*j-A*I+P*V;return D?(D=1/D,t[0]=(h*K-f*q+u*H)*D,t[1]=(s*q-i*K-n*H)*D,t[2]=(m*P-x*A+y*T)*D,t[3]=(l*A-a*P-d*T)*D,t[4]=(f*j-o*K-u*I)*D,t[5]=(e*K-s*j+n*I)*D,t[6]=(x*b-p*P-y*v)*D,t[7]=(c*P-l*b+d*v)*D,t[8]=(o*q-h*j+u*V)*D,t[9]=(i*j-e*q-n*V)*D,t[10]=(p*A-m*b+y*_)*D,t[11]=(a*b-c*A-d*_)*D,t[12]=(h*I-o*H-f*V)*D,t[13]=(e*H-i*I+s*V)*D,t[14]=(m*v-p*T-x*_)*D,t[15]=(c*T-a*v+l*_)*D,this):null}apply(t){let e=this.val,i=t.x,s=t.y,n=typeof t.z!="undefined"?t.z:1,o=e[3]*i+e[7]*s+e[11]*n+e[15]||1;return t.x=(e[0]*i+e[4]*s+e[8]*n+e[12])/o,t.y=(e[1]*i+e[5]*s+e[9]*n+e[13])/o,typeof t.z!="undefined"&&(t.z=(e[2]*i+e[6]*s+e[10]*n+e[14])/o),t}applyInverse(t){let e=g.pull("Matrix3d",this).invert();return e.apply(t),g.push(e),t}ortho(t,e,i,s,n,o){let h=this.val,f=1/(t-e),u=1/(i-s),c=1/(n-o);return h[0]=-2*f,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=-2*u,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=2*c,h[11]=0,h[12]=(t+e)*f,h[13]=(s+i)*u,h[14]=(o+n)*c,h[15]=1,this}scale(t,e=t,i=0){let s=this.val;return s[0]=s[0]*t,s[1]=s[1]*t,s[2]=s[2]*t,s[3]=s[3]*t,s[4]=s[4]*e,s[5]=s[5]*e,s[6]=s[6]*e,s[7]=s[7]*e,s[8]=s[8]*i,s[9]=s[9]*i,s[10]=s[10]*i,s[11]=s[11]*i,this}scaleV(t){return this.scale(t.x,t.y,t.z)}scaleX(t){return this.scale(t,1)}scaleY(t){return this.scale(1,t)}rotate(t,e){if(t!==0){let i=this.val,s=e.x,n=e.y,o=e.z,h=Math.sqrt(s*s+n*n+o*o),f,u,c,a,l,d,p,m,x,y,_,v,b,T,A,P,V,I,j,H,q,K,D,jt;if(h<ya)return null;h=1/h,s*=h,n*=h,o*=h,f=Math.sin(t),u=Math.cos(t),c=1-u,a=i[0],l=i[1],d=i[2],p=i[3],m=i[4],x=i[5],y=i[6],_=i[7],v=i[8],b=i[9],T=i[10],A=i[11],P=s*s*c+u,V=n*s*c+o*f,I=o*s*c-n*f,j=s*n*c-o*f,H=n*n*c+u,q=o*n*c+s*f,K=s*o*c+n*f,D=n*o*c-s*f,jt=o*o*c+u,i[0]=a*P+m*V+v*I,i[1]=l*P+x*V+b*I,i[2]=d*P+y*V+T*I,i[3]=p*P+_*V+A*I,i[4]=a*j+m*H+v*q,i[5]=l*j+x*H+b*q,i[6]=d*j+y*H+T*q,i[7]=p*j+_*H+A*q,i[8]=a*K+m*D+v*jt,i[9]=l*K+x*D+b*jt,i[10]=d*K+y*D+T*jt,i[11]=p*K+_*D+A*jt}return this}translate(){let t=this.val,e,i,s;return arguments.length>1?(e=arguments[0],i=arguments[1],s=typeof arguments[2]=="undefined"?0:arguments[2]):(e=arguments[0].x,i=arguments[0].y,s=typeof arguments[0].z=="undefined"?0:arguments[0].z),t[12]=t[0]*e+t[4]*i+t[8]*s+t[12],t[13]=t[1]*e+t[5]*i+t[9]*s+t[13],t[14]=t[2]*e+t[6]*i+t[10]*s+t[14],t[15]=t[3]*e+t[7]*i+t[11]*s+t[15],this}isIdentity(){let t=this.val;return t[0]===1&&t[1]===0&&t[2]===0&&t[3]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[7]===0&&t[8]===0&&t[9]===0&&t[10]===1&&t[11]===0&&t[12]===0&&t[13]===0&&t[14]===0&&t[15]===1}equals(t){let e=t.val,i=this.val;return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]&&i[4]===e[4]&&i[5]===e[5]&&i[6]===e[6]&&i[7]===e[7]&&i[8]===e[8]&&i[9]===e[9]&&i[10]===e[10]&&i[11]===e[11]&&i[12]===e[12]&&i[13]===e[13]&&i[14]===e[14]&&i[15]===e[15]}clone(){return g.pull("Matrix3d",this)}toArray(){return this.val}toString(){let t=this.val;return"me.Matrix3d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}}var Mr={exports:{}};Mr.exports=qi;Mr.exports.default=qi;function qi(r,t,e){e=e||2;var i=t&&t.length,s=i?t[0]*e:r.length,n=xa(r,0,s,e,!0),o=[];if(!n||n.next===n.prev)return o;var h,f,u,c,a,l,d;if(i&&(n=Dc(r,t,n,e)),r.length>80*e){h=u=r[0],f=c=r[1];for(var p=e;p<s;p+=e)a=r[p],l=r[p+1],a<h&&(h=a),l<f&&(f=l),a>u&&(u=a),l>c&&(c=l);d=Math.max(u-h,c-f),d=d!==0?32767/d:0}return We(n,o,e,h,f,d,0),o}function xa(r,t,e,i,s){var n,o;if(s===Ws(r,t,e,i)>0)for(n=t;n<e;n+=i)o=Fn(n,r[n],r[n+1],o);else for(n=e-i;n>=t;n-=i)o=Fn(n,r[n],r[n+1],o);return o&&Qi(o,o.next)&&(qe(o),o=o.next),o}function te(r,t){if(!r)return r;t||(t=r);var e=r,i;do if(i=!1,!e.steiner&&(Qi(e,e.next)||U(e.prev,e,e.next)===0)){if(qe(e),e=t=e.prev,e===e.next)break;i=!0}else e=e.next;while(i||e!==t);return t}function We(r,t,e,i,s,n,o){if(r){!o&&n&&Uc(r,i,s,n);for(var h=r,f,u;r.prev!==r.next;){if(f=r.prev,u=r.next,n?Rc(r,i,s,n):Ic(r)){t.push(f.i/e|0),t.push(r.i/e|0),t.push(u.i/e|0),qe(r),r=u.next,h=u.next;continue}if(r=u,r===h){o?o===1?(r=Oc(te(r),t,e),We(r,t,e,i,s,n,2)):o===2&&Bc(r,t,e,i,s,n):We(te(r),t,e,i,s,n,1);break}}}}function Ic(r){var t=r.prev,e=r,i=r.next;if(U(t,e,i)>=0)return!1;for(var s=t.x,n=e.x,o=i.x,h=t.y,f=e.y,u=i.y,c=s<n?s<o?s:o:n<o?n:o,a=h<f?h<u?h:u:f<u?f:u,l=s>n?s>o?s:o:n>o?n:o,d=h>f?h>u?h:u:f>u?f:u,p=i.next;p!==t;){if(p.x>=c&&p.x<=l&&p.y>=a&&p.y<=d&&ve(s,h,n,f,o,u,p.x,p.y)&&U(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function Rc(r,t,e,i){var s=r.prev,n=r,o=r.next;if(U(s,n,o)>=0)return!1;for(var h=s.x,f=n.x,u=o.x,c=s.y,a=n.y,l=o.y,d=h<f?h<u?h:u:f<u?f:u,p=c<a?c<l?c:l:a<l?a:l,m=h>f?h>u?h:u:f>u?f:u,x=c>a?c>l?c:l:a>l?a:l,y=Ys(d,p,t,e,i),_=Ys(m,x,t,e,i),v=r.prevZ,b=r.nextZ;v&&v.z>=y&&b&&b.z<=_;){if(v.x>=d&&v.x<=m&&v.y>=p&&v.y<=x&&v!==s&&v!==o&&ve(h,c,f,a,u,l,v.x,v.y)&&U(v.prev,v,v.next)>=0||(v=v.prevZ,b.x>=d&&b.x<=m&&b.y>=p&&b.y<=x&&b!==s&&b!==o&&ve(h,c,f,a,u,l,b.x,b.y)&&U(b.prev,b,b.next)>=0))return!1;b=b.nextZ}for(;v&&v.z>=y;){if(v.x>=d&&v.x<=m&&v.y>=p&&v.y<=x&&v!==s&&v!==o&&ve(h,c,f,a,u,l,v.x,v.y)&&U(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;b&&b.z<=_;){if(b.x>=d&&b.x<=m&&b.y>=p&&b.y<=x&&b!==s&&b!==o&&ve(h,c,f,a,u,l,b.x,b.y)&&U(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function Oc(r,t,e){var i=r;do{var s=i.prev,n=i.next.next;!Qi(s,n)&&va(s,i,i.next,n)&&Ke(s,n)&&Ke(n,s)&&(t.push(s.i/e|0),t.push(i.i/e|0),t.push(n.i/e|0),qe(i),qe(i.next),i=r=n),i=i.next}while(i!==r);return te(i)}function Bc(r,t,e,i,s,n){var o=r;do{for(var h=o.next.next;h!==o.prev;){if(o.i!==h.i&&Gc(o,h)){var f=_a(o,h);o=te(o,o.next),f=te(f,f.next),We(o,t,e,i,s,n,0),We(f,t,e,i,s,n,0);return}h=h.next}o=o.next}while(o!==r)}function Dc(r,t,e,i){var s=[],n,o,h,f,u;for(n=0,o=t.length;n<o;n++)h=t[n]*i,f=n<o-1?t[n+1]*i:r.length,u=xa(r,h,f,i,!1),u===u.next&&(u.steiner=!0),s.push(zc(u));for(s.sort(Lc),n=0;n<s.length;n++)e=kc(s[n],e);return e}function Lc(r,t){return r.x-t.x}function kc(r,t){var e=Fc(r,t);if(!e)return t;var i=_a(e,r);return te(i,i.next),te(e,e.next)}function Fc(r,t){var e=t,i=r.x,s=r.y,n=-1/0,o;do{if(s<=e.y&&s>=e.next.y&&e.next.y!==e.y){var h=e.x+(s-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(h<=i&&h>n&&(n=h,o=e.x<e.next.x?e:e.next,h===i))return o}e=e.next}while(e!==t);if(!o)return null;var f=o,u=o.x,c=o.y,a=1/0,l;e=o;do i>=e.x&&e.x>=u&&i!==e.x&&ve(s<c?i:n,s,u,c,s<c?n:i,s,e.x,e.y)&&(l=Math.abs(s-e.y)/(i-e.x),Ke(e,r)&&(l<a||l===a&&(e.x>o.x||e.x===o.x&&Nc(o,e)))&&(o=e,a=l)),e=e.next;while(e!==f);return o}function Nc(r,t){return U(r.prev,r,t.prev)<0&&U(t.next,r,r.next)<0}function Uc(r,t,e,i){var s=r;do s.z===0&&(s.z=Ys(s.x,s.y,t,e,i)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==r);s.prevZ.nextZ=null,s.prevZ=null,Vc(s)}function Vc(r){var t,e,i,s,n,o,h,f,u=1;do{for(e=r,r=null,n=null,o=0;e;){for(o++,i=e,h=0,t=0;t<u&&(h++,i=i.nextZ,!!i);t++);for(f=u;h>0||f>0&&i;)h!==0&&(f===0||!i||e.z<=i.z)?(s=e,e=e.nextZ,h--):(s=i,i=i.nextZ,f--),n?n.nextZ=s:r=s,s.prevZ=n,n=s;e=i}n.nextZ=null,u*=2}while(o>1);return r}function Ys(r,t,e,i,s){return r=(r-e)*s|0,t=(t-i)*s|0,r=(r|r<<8)&16711935,r=(r|r<<4)&252645135,r=(r|r<<2)&858993459,r=(r|r<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,r|t<<1}function zc(r){var t=r,e=r;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==r);return e}function ve(r,t,e,i,s,n,o,h){return(s-o)*(t-h)>=(r-o)*(n-h)&&(r-o)*(i-h)>=(e-o)*(t-h)&&(e-o)*(n-h)>=(s-o)*(i-h)}function Gc(r,t){return r.next.i!==t.i&&r.prev.i!==t.i&&!jc(r,t)&&(Ke(r,t)&&Ke(t,r)&&Hc(r,t)&&(U(r.prev,r,t.prev)||U(r,t.prev,t))||Qi(r,t)&&U(r.prev,r,r.next)>0&&U(t.prev,t,t.next)>0)}function U(r,t,e){return(t.y-r.y)*(e.x-t.x)-(t.x-r.x)*(e.y-t.y)}function Qi(r,t){return r.x===t.x&&r.y===t.y}function va(r,t,e,i){var s=bi(U(r,t,e)),n=bi(U(r,t,i)),o=bi(U(e,i,r)),h=bi(U(e,i,t));return!!(s!==n&&o!==h||s===0&&_i(r,e,t)||n===0&&_i(r,i,t)||o===0&&_i(e,r,i)||h===0&&_i(e,t,i))}function _i(r,t,e){return t.x<=Math.max(r.x,e.x)&&t.x>=Math.min(r.x,e.x)&&t.y<=Math.max(r.y,e.y)&&t.y>=Math.min(r.y,e.y)}function bi(r){return r>0?1:r<0?-1:0}function jc(r,t){var e=r;do{if(e.i!==r.i&&e.next.i!==r.i&&e.i!==t.i&&e.next.i!==t.i&&va(e,e.next,r,t))return!0;e=e.next}while(e!==r);return!1}function Ke(r,t){return U(r.prev,r,r.next)<0?U(r,t,r.next)>=0&&U(r,r.prev,t)>=0:U(r,t,r.prev)<0||U(r,r.next,t)<0}function Hc(r,t){var e=r,i=!1,s=(r.x+t.x)/2,n=(r.y+t.y)/2;do e.y>n!=e.next.y>n&&e.next.y!==e.y&&s<(e.next.x-e.x)*(n-e.y)/(e.next.y-e.y)+e.x&&(i=!i),e=e.next;while(e!==r);return i}function _a(r,t){var e=new Xs(r.i,r.x,r.y),i=new Xs(t.i,t.x,t.y),s=r.next,n=t.prev;return r.next=t,t.prev=r,e.next=s,s.prev=e,i.next=e,e.prev=i,n.next=i,i.prev=n,i}function Fn(r,t,e,i){var s=new Xs(r,t,e);return i?(s.next=i.next,s.prev=i,i.next.prev=s,i.next=s):(s.prev=s,s.next=s),s}function qe(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function Xs(r,t,e){this.i=r,this.x=t,this.y=e,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}qi.deviation=function(r,t,e,i){var s=t&&t.length,n=s?t[0]*e:r.length,o=Math.abs(Ws(r,0,n,e));if(s)for(var h=0,f=t.length;h<f;h++){var u=t[h]*e,c=h<f-1?t[h+1]*e:r.length;o-=Math.abs(Ws(r,u,c,e))}var a=0;for(h=0;h<i.length;h+=3){var l=i[h]*e,d=i[h+1]*e,p=i[h+2]*e;a+=Math.abs((r[l]-r[p])*(r[d+1]-r[l+1])-(r[l]-r[d])*(r[p+1]-r[l+1]))}return o===0&&a===0?0:Math.abs((a-o)/o)};function Ws(r,t,e,i){for(var s=0,n=t,o=e-i;n<e;n+=i)s+=(r[o]-r[n])*(r[n+1]+r[o+1]),o=n;return s}qi.flatten=function(r){for(var t=r[0][0].length,e={vertices:[],holes:[],dimensions:t},i=0,s=0;s<r.length;s++){for(var n=0;n<r[s].length;n++)for(var o=0;o<t;o++)e.vertices.push(r[s][n][o]);s>0&&(i+=r[s-1].length,e.holes.push(i))}return e};var Yc=Mr.exports,ba=Ao(Yc);class Vt{constructor(t=0,e=0,i){this.pos=g.pull("Vector2d"),this.points=[],this.edges=[],this.indices=[],this.normals=[],this._bounds,this.type="Polygon",this.setShape(t,e,i)}onResetEvent(t,e,i){this.setShape(t,e,i)}setShape(t,e,i){return this.pos.set(t,e),this.setVertices(i),this}setVertices(t){if(!Array.isArray(t))return this;if(typeof t[0]=="object")typeof t[0].setV=="function"?this.points=t:(this.points.length=0,t.forEach(e=>{this.points.push(g.pull("Vector2d",e.x,e.y))}));else{let e=t.length;this.points.length=0;for(let i=0;i<e;i+=2)this.points.push(g.pull("Vector2d",t[i],t[i+1]))}return this.recalc(),this.updateBounds(),this}transform(t){let e=this.points,i=e.length;for(let s=0;s<i;s++)t.apply(e[s]);return this.recalc(),this.updateBounds(),this}toIso(){return this.rotate(Math.PI/4).scale(Math.SQRT2,Math.SQRT1_2)}to2d(){return this.scale(Math.SQRT1_2,Math.SQRT2).rotate(-Math.PI/4)}rotate(t,e){if(t!==0){let i=this.points,s=i.length;for(let n=0;n<s;n++)i[n].rotate(t,e);this.recalc(),this.updateBounds()}return this}scale(t,e=t){let i=this.points,s=i.length;for(let n=0;n<s;n++)i[n].scale(t,e);return this.recalc(),this.updateBounds(),this}scaleV(t){return this.scale(t.x,t.y)}recalc(){let t=this.edges,e=this.normals,i=this.indices,s=this.points,n=s.length;if(n<3)throw new Error("Requires at least 3 points");for(let o=0;o<n;o++){let h=t[o];typeof h=="undefined"&&(h=t[o]=g.pull("Vector2d")),h.copy(s[(o+1)%n]).sub(s[o]);let f=e[o];typeof f=="undefined"&&(f=e[o]=g.pull("Vector2d")),f.copy(h).perp().normalize()}for(let o=n;o<t.length;o++)g.push(t[o]),g.push(e[o]);return t.length=n,e.length=n,i.length=0,this}getIndices(){return this.indices.length===0&&(this.indices=ba(this.points.flatMap(t=>[t.x,t.y]))),this.indices}isConvex(){let t=0,e=this.points,i=e.length;if(i<3)return null;for(let s=0;s<i;s++){let n=(s+1)%i,o=(s+2)%i,h=(e[n].x-e[s].x)*(e[o].y-e[n].y);if(h-=(e[n].y-e[s].y)*(e[o].x-e[n].x),h<0?t|=1:h>0&&(t|=2),t===3)return!1}return t!==0?!0:null}translate(){let t,e;return arguments.length===2?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y),this.pos.x+=t,this.pos.y+=e,this.getBounds().translate(t,e),this}shift(){let t,e;arguments.length===2?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y),this.pos.x=t,this.pos.y=e,this.updateBounds()}contains(){let t,e;arguments.length===2?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y);let i=!1,s=this.pos.x,n=this.pos.y,o=this.points,h=o.length;for(let f=0,u=h-1;f<h;u=f++){const c=o[f].y+n,a=o[f].x+s,l=o[u].y+n,d=o[u].x+s;c>e!=l>e&&t<(d-a)*(e-c)/(l-c)+a&&(i=!i)}return i}getBounds(){return typeof this._bounds=="undefined"&&(this._bounds=g.pull("Bounds")),this._bounds}updateBounds(){let t=this.getBounds();return t.update(this.points),t.translate(this.pos),t}clone(){let t=[];return this.points.forEach(e=>{t.push(e.clone())}),new Vt(this.pos.x,this.pos.y,t)}}class Di extends Vt{contains(){let t,e;arguments.length===2?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y),t-=this.pos.x,e-=this.pos.y;let i=this.points[0],s=this.points[1];return(e-i.y)*(s.x-i.x)===(s.y-i.y)*(t-i.x)}recalc(){let t=this.edges,e=this.normals,i=this.indices,s=this.points;if(s.length!==2)throw new Error("Requires exactly 2 points");return t[0]===void 0&&(t[0]=g.pull("Vector2d")),t[0].copy(s[1]).sub(s[0]),e[0]===void 0&&(e[0]=g.pull("Vector2d")),e[0].copy(t[0]).perp().normalize(),i.length=0,this}clone(){let t=[];return this.points.forEach(e=>{t.push(e.clone())}),new Di(this.pos.x,this.pos.y,t)}}class Qe{constructor(t,e,i,s){this.pos=g.pull("Vector2d"),this._bounds=void 0,this.radius=NaN,this.radiusV=g.pull("Vector2d"),this.radiusSq=g.pull("Vector2d"),this.ratio=g.pull("Vector2d"),this.type="Ellipse",this.setShape(t,e,i,s)}onResetEvent(t,e,i,s){this.setShape(t,e,i,s)}setShape(t,e,i,s){const n=i/2,o=s/2,h=Math.max(n,o),f=h*h;this.pos.set(t,e),this.radius=h,this.ratio.set(n/h,o/h),this.radiusV.set(h,h).scaleV(this.ratio),this.radiusSq.set(f,f).scaleV(this.ratio);let u=this.getBounds();return u.setMinMax(t,e,t+i,t+s),u.translate(-this.radiusV.x,-this.radiusV.y),this}rotate(t,e){let i=this.getBounds();return this.pos.rotate(t,e),i.shift(this.pos),i.translate(-this.radiusV.x,-this.radiusV.y),this}scale(t,e=t){return this.setShape(this.pos.x,this.pos.y,this.radiusV.x*2*t,this.radiusV.y*2*e)}scaleV(t){return this.scale(t.x,t.y)}transform(t){return this}translate(){let t,e;return arguments.length===2?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y),this.pos.x+=t,this.pos.y+=e,this.getBounds().translate(t,e),this}contains(){let t,e;return arguments.length===2?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y),t-=this.pos.x,e-=this.pos.y,t*t/this.radiusSq.x+e*e/this.radiusSq.y<=1}getBounds(){return typeof this._bounds=="undefined"&&(this._bounds=g.pull("Bounds")),this._bounds}clone(){return new Qe(this.pos.x,this.pos.y,this.radiusV.x*2,this.radiusV.y*2)}}class Je{constructor(t=0,e=0){this.x=t,this.y=e,this.type="Point"}onResetEvent(t=0,e=0){this.set(t,e)}set(t=0,e=0){return this.x=t,this.y=e,this}equals(){let t,e;return arguments.length===2?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y),this.x===t&&this.y===e}clone(){return new Je(this.x,this.y)}}class tt extends Vt{constructor(t,e,i,s){super(t,e,[g.pull("Vector2d",0,0),g.pull("Vector2d",i,0),g.pull("Vector2d",i,s),g.pull("Vector2d",0,s)]),this.type="Rectangle"}onResetEvent(t,e,i,s){this.setShape(t,e,i,s)}setShape(t,e,i,s){let n=i;return this.pos.set(t,e),arguments.length===4&&(n=this.points,n[0].set(0,0),n[1].set(i,0),n[2].set(i,s),n[3].set(0,s)),this.setVertices(n),this}get left(){return this.pos.x}get right(){let t=this.width;return this.left+t||t}get top(){return this.pos.y}get bottom(){let t=this.height;return this.top+t||t}get width(){return this.points[2].x}set width(t){this.points[1].x=this.points[2].x=t,this.recalc(),this.updateBounds()}get height(){return this.points[2].y}set height(t){this.points[2].y=this.points[3].y=t,this.recalc(),this.updateBounds()}get centerX(){return isFinite(this.width)?this.left+this.width/2:this.width}set centerX(t){this.pos.x=t-this.width/2,this.recalc(),this.updateBounds()}get centerY(){return isFinite(this.height)?this.top+this.height/2:this.height}set centerY(t){this.pos.y=t-this.height/2,this.recalc(),this.updateBounds()}centerOn(t,e){return this.centerX=t,this.centerY=e,this}resize(t,e){return this.width=t,this.height=e,this}scale(t,e=t){return this.width*=t,this.height*=e,this}clone(){return new tt(this.left,this.top,this.width,this.height)}copy(t){return this.setShape(t.left,t.top,t.width,t.height)}union(t){let e=Math.min(this.left,t.left),i=Math.min(this.top,t.top);return this.resize(Math.max(this.right,t.right)-e,Math.max(this.bottom,t.bottom)-i),this.pos.set(e,i),this}overlaps(t){return this.left<t.right&&t.left<this.right&&this.top<t.bottom&&t.top<this.bottom}contains(){let t=arguments[0],e,i,s,n;return arguments.length===2?(e=i=t,s=n=arguments[1]):typeof t.bottom=="number"?(e=t.left,i=t.right,s=t.top,n=t.bottom):(e=i=t.x,s=n=t.y),e>=this.left&&i<=this.right&&s>=this.top&&n<=this.bottom}equals(t){return t.left===this.left&&t.right===this.right&&t.top===this.top&&t.bottom===this.bottom}isFinite(){return isFinite(this.left)&&isFinite(this.top)&&isFinite(this.width)&&isFinite(this.height)}toPolygon(){return g.pull("Polygon",this.left,this.top,this.points)}}class Li extends tt{constructor(t,e,i,s,n=20){super(t,e,i,s),this.type="RoundRect",this.radius=n}onResetEvent(t,e,i,s,n){super.setShape(t,e,i,s),this.radius=n}get radius(){return this._radius}set radius(t){this.width<2*t&&(t=this.width/2),this.height<2*t&&(t=this.height/2),this._radius=t}copy(t){return super.setShape(t.pos.x,t.pos.y,t.width,t.height),this.radius=t.radius,this}contains(){let t=arguments[0],e,i;if(arguments.length===2)e=t,i=arguments[1];else{if(typeof t.radius=="undefined"&&typeof t.bottom=="number")return super.contains(t);e=t.x,i=t.y}if(e<this.left||e>=this.right||i<this.top||i>=this.bottom)return!1;if(e>=this.left+this.radius&&e<=this.right-this.radius||i>=this.top+this.radius&&i<=this.bottom-this.radius)return!0;let s,n;const o=Math.max(0,Math.min(this.radius,this.width/2)),h=Math.max(0,Math.min(this.radius,this.height/2));if(e<this.left+o&&i<this.top+h)s=e-this.left-o,n=i-this.top-h;else if(e>this.right-o&&i<this.top+h)s=e-this.right+o,n=i-this.top-h;else if(e>this.right-o&&i>this.bottom-h)s=e-this.right+o,n=i-this.bottom+h;else if(e<this.left+o&&i>this.bottom-h)s=e-this.left-o,n=i-this.bottom+h;else return!1;return s*s+n*n<=o*h}equals(t){return super.equals(t)&&this.radius===t.radius}clone(){return new Li(this.pos.x,this.pos.y,this.width,this.height,this.radius)}}function Ze(r,t){let e=Array.prototype.indexOf.call(r,t);return e!==-1&&Array.prototype.splice.call(r,e,1),r}function Xc(r){return r[ze(0,r.length)]}function Wc(r){return r[ma(0,r.length)]}var Kc={__proto__:null,random:Xc,remove:Ze,weightedRandom:Wc};let Ks=[];function wi(r,t,e=4,i=4,s=0){if(Ks.length>0){let n=Ks.pop();return n.world=r,n.bounds=t,n.max_objects=e,n.max_levels=i,n.level=s,n}else return new wa(r,t,e,i,s)}function qc(r){Ks.push(r)}let Nn=new C;class wa{constructor(t,e,i=4,s=4,n=0){this.world=t,this.bounds=e,this.max_objects=i,this.max_levels=s,this.level=n,this.objects=[],this.nodes=[]}split(){let t=this.level+1,e=this.bounds.width/2,i=this.bounds.height/2,s=this.bounds.left,n=this.bounds.top;this.nodes[0]=wi(this.world,{left:s+e,top:n,width:e,height:i},this.max_objects,this.max_levels,t),this.nodes[1]=wi(this.world,{left:s,top:n,width:e,height:i},this.max_objects,this.max_levels,t),this.nodes[2]=wi(this.world,{left:s,top:n+i,width:e,height:i},this.max_objects,this.max_levels,t),this.nodes[3]=wi(this.world,{left:s+e,top:n+i,width:e,height:i},this.max_objects,this.max_levels,t)}getIndex(t){let e,i=t.getBounds();t.isFloating===!0?e=this.world.app.viewport.localToWorld(i.left,i.top,Nn):e=Nn.set(t.left,t.top);let s=-1,n=e.x,o=e.y,h=i.width,f=i.height,u=this.bounds.left+this.bounds.width/2,c=this.bounds.top+this.bounds.height/2,a=o<c&&o+f<c,l=o>c;return n<u&&n+h<u?a?s=1:l&&(s=2):n>u&&(a?s=0:l&&(s=3)),s}insertContainer(t){const e=t.children,i=e.length;for(let s=i,n;s--,n=e[s];)n.isKinematic!==!0&&(typeof n.addChild=="function"?(n.name!=="rootContainer"&&this.insert(n),this.insertContainer(n)):typeof n.getBounds=="function"&&this.insert(n))}insert(t){let e=-1;if(this.nodes.length>0&&(e=this.getIndex(t),e!==-1)){this.nodes[e].insert(t);return}if(this.objects.push(t),this.objects.length>this.max_objects&&this.level<this.max_levels){this.nodes.length===0&&this.split();let i=0;for(;i<this.objects.length;)e=this.getIndex(this.objects[i]),e!==-1?this.nodes[e].insert(this.objects.splice(i,1)[0]):i=i+1}}retrieve(t,e){let i=this.objects;if(this.nodes.length>0){let s=this.getIndex(t);if(s!==-1)i=i.concat(this.nodes[s].retrieve(t));else for(let n=0;n<this.nodes.length;n=n+1)i=i.concat(this.nodes[n].retrieve(t))}return typeof e=="function"&&i.sort(e),i}remove(t){let e=!1;if(typeof t.getBounds=="undefined")return!1;if(this.nodes.length>0){let i=this.getIndex(t);i!==-1&&(e=Ze(this.nodes[i],t),e&&this.nodes[i].isPrunable()&&this.nodes.splice(i,1))}return e===!1&&this.objects.indexOf(t)!==-1&&(Ze(this.objects,t),e=!0),e}isPrunable(){return!(this.hasChildren()||this.objects.length>0)}hasChildren(){for(let t=0;t<this.nodes.length;t=t+1){const e=this.nodes[t];if(e.length>0||e.objects.length>0)return!0}return!1}clear(t){this.objects.length=0;for(let e=0;e<this.nodes.length;e++)this.nodes[e].clear(),qc(this.nodes[e]);this.nodes.length=0,typeof t!="undefined"&&this.bounds.setMinMax(t.min.x,t.min.y,t.max.x,t.max.y)}}class ct{constructor(t){this._center=new C,this.onResetEvent(t),this.type="Bounds"}onResetEvent(t){typeof this.min=="undefined"?(this.min={x:1/0,y:1/0},this.max={x:-1/0,y:-1/0}):this.clear(),typeof t!="undefined"&&this.update(t)}clear(){this.setMinMax(1/0,1/0,-1/0,-1/0)}setMinMax(t,e,i,s){this.min.x=t,this.min.y=e,this.max.x=i,this.max.y=s}get x(){return this.min.x}set x(t){let e=this.max.x-this.min.x;this.min.x=t,this.max.x=t+e}get y(){return this.min.y}set y(t){let e=this.max.y-this.min.y;this.min.y=t,this.max.y=t+e}get width(){return this.max.x-this.min.x}set width(t){this.max.x=this.min.x+t}get height(){return this.max.y-this.min.y}set height(t){this.max.y=this.min.y+t}get left(){return this.min.x}get right(){return this.max.x}get top(){return this.min.y}get bottom(){return this.max.y}get centerX(){return this.min.x+this.width/2}get centerY(){return this.min.y+this.height/2}get center(){return this._center.set(this.centerX,this.centerY)}centerOn(t,e){return this.shift(t-this.width/2,e-this.height/2),this}update(t){this.add(t,!0)}add(t,e=!1){const i=t.length;e===!0&&this.clear();for(let s=0;s<i;s++){const n=t[s];n.x>this.max.x&&(this.max.x=n.x),n.x<this.min.x&&(this.min.x=n.x),n.y>this.max.y&&(this.max.y=n.y),n.y<this.min.y&&(this.min.y=n.y)}}addBounds(t,e=!1){e===!0?(this.max.x=t.max.x,this.min.x=t.min.x,this.max.y=t.max.y,this.min.y=t.min.y):(t.max.x>this.max.x&&(this.max.x=t.max.x),t.min.x<this.min.x&&(this.min.x=t.min.x),t.max.y>this.max.y&&(this.max.y=t.max.y),t.min.y<this.min.y&&(this.min.y=t.min.y))}addPoint(t,e){typeof e!="undefined"&&(t=e.apply(t)),this.min.x=Math.min(this.min.x,t.x),this.max.x=Math.max(this.max.x,t.x),this.min.y=Math.min(this.min.y,t.y),this.max.y=Math.max(this.max.y,t.y)}addFrame(t,e,i,s,n){let o=g.pull("Point");this.addPoint(o.set(t,e),n),this.addPoint(o.set(i,e),n),this.addPoint(o.set(t,s),n),this.addPoint(o.set(i,s),n),g.push(o)}contains(){let t=arguments[0],e,i,s,n;return arguments.length===2?(e=i=t,s=n=arguments[1]):typeof t.max!="undefined"?(e=t.min.x,i=t.max.x,s=t.min.y,n=t.max.y):(e=i=t.x,s=n=t.y),e>=this.min.x&&i<=this.max.x&&s>=this.min.y&&n<=this.max.y}overlaps(t){return!(this.right<t.left||this.left>t.right||this.bottom<t.top||this.top>t.bottom)}isFinite(){return isFinite(this.min.x)&&isFinite(this.max.x)&&isFinite(this.min.y)&&isFinite(this.max.y)}translate(){let t,e;arguments.length===2?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y),this.min.x+=t,this.max.x+=t,this.min.y+=e,this.max.y+=e}shift(){let t,e;arguments.length===2?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y);let i=this.max.x-this.min.x,s=this.max.y-this.min.y;this.min.x=t,this.max.x=t+i,this.min.y=e,this.max.y=e+s}clone(){let t=new ct;return t.addBounds(this),t}toPolygon(){return g.pull("Polygon",this.x,this.y,[g.pull("Vector2d",0,0),g.pull("Vector2d",this.width,0),g.pull("Vector2d",this.width,this.height),g.pull("Vector2d",0,this.height)])}}let F={maxChildren:8,maxDepth:4,types:{NO_OBJECT:0,PLAYER_OBJECT:1,NPC_OBJECT:2,ENEMY_OBJECT:4,COLLECTABLE_OBJECT:8,ACTION_OBJECT:16,PROJECTILE_OBJECT:32,WORLD_SHAPE:64,USER:128,ALL_OBJECT:4294967295},rayCast(r,t){return w.world.detector.rayCast(r,t)}};function zt(r,t,...e){return setTimeout(r.bind(t),.01,...e)}function ki(r,t,e){let i=globalThis.performance.now(),s;return typeof e!="boolean"&&(e=!1),function(){let n=globalThis.performance.now(),o=n-i,h=arguments;if(o<t)e===!1&&(clearTimeout(s),s=setTimeout(()=>(i=n,r.apply(null,h)),o));else return i=n,r.apply(null,h)}}var Qc={__proto__:null,defer:zt,throttle:ki},Ta={exports:{}};(function(r){var t=Object.prototype.hasOwnProperty,e="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(e=!1));function s(f,u,c){this.fn=f,this.context=u,this.once=c||!1}function n(f,u,c,a,l){if(typeof c!="function")throw new TypeError("The listener must be a function");var d=new s(c,a||f,l),p=e?e+u:u;return f._events[p]?f._events[p].fn?f._events[p]=[f._events[p],d]:f._events[p].push(d):(f._events[p]=d,f._eventsCount++),f}function o(f,u){--f._eventsCount===0?f._events=new i:delete f._events[u]}function h(){this._events=new i,this._eventsCount=0}h.prototype.eventNames=function(){var u=[],c,a;if(this._eventsCount===0)return u;for(a in c=this._events)t.call(c,a)&&u.push(e?a.slice(1):a);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(c)):u},h.prototype.listeners=function(u){var c=e?e+u:u,a=this._events[c];if(!a)return[];if(a.fn)return[a.fn];for(var l=0,d=a.length,p=new Array(d);l<d;l++)p[l]=a[l].fn;return p},h.prototype.listenerCount=function(u){var c=e?e+u:u,a=this._events[c];return a?a.fn?1:a.length:0},h.prototype.emit=function(u,c,a,l,d,p){var m=e?e+u:u;if(!this._events[m])return!1;var x=this._events[m],y=arguments.length,_,v;if(x.fn){switch(x.once&&this.removeListener(u,x.fn,void 0,!0),y){case 1:return x.fn.call(x.context),!0;case 2:return x.fn.call(x.context,c),!0;case 3:return x.fn.call(x.context,c,a),!0;case 4:return x.fn.call(x.context,c,a,l),!0;case 5:return x.fn.call(x.context,c,a,l,d),!0;case 6:return x.fn.call(x.context,c,a,l,d,p),!0}for(v=1,_=new Array(y-1);v<y;v++)_[v-1]=arguments[v];x.fn.apply(x.context,_)}else{var b=x.length,T;for(v=0;v<b;v++)switch(x[v].once&&this.removeListener(u,x[v].fn,void 0,!0),y){case 1:x[v].fn.call(x[v].context);break;case 2:x[v].fn.call(x[v].context,c);break;case 3:x[v].fn.call(x[v].context,c,a);break;case 4:x[v].fn.call(x[v].context,c,a,l);break;default:if(!_)for(T=1,_=new Array(y-1);T<y;T++)_[T-1]=arguments[T];x[v].fn.apply(x[v].context,_)}}return!0},h.prototype.on=function(u,c,a){return n(this,u,c,a,!1)},h.prototype.once=function(u,c,a){return n(this,u,c,a,!0)},h.prototype.removeListener=function(u,c,a,l){var d=e?e+u:u;if(!this._events[d])return this;if(!c)return o(this,d),this;var p=this._events[d];if(p.fn)p.fn===c&&(!l||p.once)&&(!a||p.context===a)&&o(this,d);else{for(var m=0,x=[],y=p.length;m<y;m++)(p[m].fn!==c||l&&!p[m].once||a&&p[m].context!==a)&&x.push(p[m]);x.length?this._events[d]=x.length===1?x[0]:x:o(this,d)}return this},h.prototype.removeAllListeners=function(u){var c;return u?(c=e?e+u:u,this._events[c]&&o(this,c)):(this._events=new i,this._eventsCount=0),this},h.prototype.off=h.prototype.removeListener,h.prototype.addListener=h.prototype.on,h.prefixed=e,h.EventEmitter=h,r.exports=h})(Ta);var Jc=Ta.exports,Zc=Ao(Jc);let Ji=new Zc;const Ir="dom_ready",hi="me.boot",Rr="me.tick",Fi="me.blur",Ni="me.focus",Ea="me.state.onPause",Me="me.state.onResume",Aa="me.state.onStop",Zi="me.state.onRestart",$i="me.state.onChange",Or="me.stage.onReset",Br="me.video.onInit",Sa="me.game.onInit",ke="me.game.onReset",ts="me.game.beforeUpdate",Ca="me.game.afterUpdate",Pa="me.game.onUpdate",Ma="me.game.beforeDraw",Ge="me.game.afterDraw",Ia="me.world.step",es="me.game.onLevelLoaded",Ra="me.loader.onload",Ui="me.loader.onProgress",Oa="me.input.keydown",Ba="me.input.keyup",Da="gamepad.connected",La="gamepad.disconnected",qs="gamepad.update",ka="me.event.pointermove",Fa="me.event.pointerlockChange",$c="me.game.dragstart",tp="me.game.dragend",Dr="globalThis.onresize",li="canvas.onresize",Gt="viewport.onresize",je="globalThis.orientationchange",Na="globalThis.onscroll",Vi="viewport.onchange",is="renderer.contextlost",$e="renderer.contextrestored";function M(r,...t){return Ji.emit(r,...t)}function O(r,t,e){return Ji.on(r,t,e)}function Ee(r,t,e){return Ji.once(r,t,e)}function Ut(r,t){return Ji.off(r,t)}var Y={__proto__:null,BLUR:Fi,BOOT:hi,CANVAS_ONRESIZE:li,DOM_READY:Ir,DRAGEND:tp,DRAGSTART:$c,FOCUS:Ni,GAMEPAD_CONNECTED:Da,GAMEPAD_DISCONNECTED:La,GAMEPAD_UPDATE:qs,GAME_AFTER_DRAW:Ge,GAME_AFTER_UPDATE:Ca,GAME_BEFORE_DRAW:Ma,GAME_BEFORE_UPDATE:ts,GAME_INIT:Sa,GAME_RESET:ke,GAME_UPDATE:Pa,KEYDOWN:Oa,KEYUP:Ba,LEVEL_LOADED:es,LOADER_COMPLETE:Ra,LOADER_PROGRESS:Ui,ONCONTEXT_LOST:is,ONCONTEXT_RESTORED:$e,POINTERLOCKCHANGE:Fa,POINTERMOVE:ka,STAGE_RESET:Or,STATE_CHANGE:$i,STATE_PAUSE:Ea,STATE_RESTART:Zi,STATE_RESUME:Me,STATE_STOP:Aa,TICK:Rr,VIDEO_INIT:Br,VIEWPORT_ONCHANGE:Vi,VIEWPORT_ONRESIZE:Gt,WINDOW_ONORIENTATION_CHANGE:je,WINDOW_ONRESIZE:Dr,WINDOW_ONSCROLL:Na,WORLD_STEP:Ia,emit:M,off:Ut,on:O,once:Ee},et={};/*!
 *  howler.js v2.2.4
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */(function(r){(function(){var t=function(){this.init()};t.prototype={init:function(){var a=this||e;return a._counter=1e3,a._html5AudioPool=[],a.html5PoolSize=10,a._codecs={},a._howls=[],a._muted=!1,a._volume=1,a._canPlayEvent="canplaythrough",a._navigator=typeof window!="undefined"&&window.navigator?window.navigator:null,a.masterGain=null,a.noAudio=!1,a.usingWebAudio=!0,a.autoSuspend=!0,a.ctx=null,a.autoUnlock=!0,a._setup(),a},volume:function(a){var l=this||e;if(a=parseFloat(a),l.ctx||c(),typeof a!="undefined"&&a>=0&&a<=1){if(l._volume=a,l._muted)return l;l.usingWebAudio&&l.masterGain.gain.setValueAtTime(a,e.ctx.currentTime);for(var d=0;d<l._howls.length;d++)if(!l._howls[d]._webAudio)for(var p=l._howls[d]._getSoundIds(),m=0;m<p.length;m++){var x=l._howls[d]._soundById(p[m]);x&&x._node&&(x._node.volume=x._volume*a)}return l}return l._volume},mute:function(a){var l=this||e;l.ctx||c(),l._muted=a,l.usingWebAudio&&l.masterGain.gain.setValueAtTime(a?0:l._volume,e.ctx.currentTime);for(var d=0;d<l._howls.length;d++)if(!l._howls[d]._webAudio)for(var p=l._howls[d]._getSoundIds(),m=0;m<p.length;m++){var x=l._howls[d]._soundById(p[m]);x&&x._node&&(x._node.muted=a?!0:x._muted)}return l},stop:function(){for(var a=this||e,l=0;l<a._howls.length;l++)a._howls[l].stop();return a},unload:function(){for(var a=this||e,l=a._howls.length-1;l>=0;l--)a._howls[l].unload();return a.usingWebAudio&&a.ctx&&typeof a.ctx.close!="undefined"&&(a.ctx.close(),a.ctx=null,c()),a},codecs:function(a){return(this||e)._codecs[a.replace(/^x-/,"")]},_setup:function(){var a=this||e;if(a.state=a.ctx&&a.ctx.state||"suspended",a._autoSuspend(),!a.usingWebAudio)if(typeof Audio!="undefined")try{var l=new Audio;typeof l.oncanplaythrough=="undefined"&&(a._canPlayEvent="canplay")}catch(d){a.noAudio=!0}else a.noAudio=!0;try{var l=new Audio;l.muted&&(a.noAudio=!0)}catch(d){}return a.noAudio||a._setupCodecs(),a},_setupCodecs:function(){var a=this||e,l=null;try{l=typeof Audio!="undefined"?new Audio:null}catch(b){return a}if(!l||typeof l.canPlayType!="function")return a;var d=l.canPlayType("audio/mpeg;").replace(/^no$/,""),p=a._navigator?a._navigator.userAgent:"",m=p.match(/OPR\/(\d+)/g),x=m&&parseInt(m[0].split("/")[1],10)<33,y=p.indexOf("Safari")!==-1&&p.indexOf("Chrome")===-1,_=p.match(/Version\/(.*?) /),v=y&&_&&parseInt(_[1],10)<15;return a._codecs={mp3:!!(!x&&(d||l.canPlayType("audio/mp3;").replace(/^no$/,""))),mpeg:!!d,opus:!!l.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!l.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!l.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(l.canPlayType('audio/wav; codecs="1"')||l.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!l.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!l.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(l.canPlayType("audio/x-m4a;")||l.canPlayType("audio/m4a;")||l.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(l.canPlayType("audio/x-m4b;")||l.canPlayType("audio/m4b;")||l.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(l.canPlayType("audio/x-mp4;")||l.canPlayType("audio/mp4;")||l.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!(!v&&l.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!!(!v&&l.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!l.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(l.canPlayType("audio/x-flac;")||l.canPlayType("audio/flac;")).replace(/^no$/,"")},a},_unlockAudio:function(){var a=this||e;if(!(a._audioUnlocked||!a.ctx)){a._audioUnlocked=!1,a.autoUnlock=!1,!a._mobileUnloaded&&a.ctx.sampleRate!==44100&&(a._mobileUnloaded=!0,a.unload()),a._scratchBuffer=a.ctx.createBuffer(1,1,22050);var l=function(d){for(;a._html5AudioPool.length<a.html5PoolSize;)try{var p=new Audio;p._unlocked=!0,a._releaseHtml5Audio(p)}catch(b){a.noAudio=!0;break}for(var m=0;m<a._howls.length;m++)if(!a._howls[m]._webAudio)for(var x=a._howls[m]._getSoundIds(),y=0;y<x.length;y++){var _=a._howls[m]._soundById(x[y]);_&&_._node&&!_._node._unlocked&&(_._node._unlocked=!0,_._node.load())}a._autoResume();var v=a.ctx.createBufferSource();v.buffer=a._scratchBuffer,v.connect(a.ctx.destination),typeof v.start=="undefined"?v.noteOn(0):v.start(0),typeof a.ctx.resume=="function"&&a.ctx.resume(),v.onended=function(){v.disconnect(0),a._audioUnlocked=!0,document.removeEventListener("touchstart",l,!0),document.removeEventListener("touchend",l,!0),document.removeEventListener("click",l,!0),document.removeEventListener("keydown",l,!0);for(var b=0;b<a._howls.length;b++)a._howls[b]._emit("unlock")}};return document.addEventListener("touchstart",l,!0),document.addEventListener("touchend",l,!0),document.addEventListener("click",l,!0),document.addEventListener("keydown",l,!0),a}},_obtainHtml5Audio:function(){var a=this||e;if(a._html5AudioPool.length)return a._html5AudioPool.pop();var l=new Audio().play();return l&&typeof Promise!="undefined"&&(l instanceof Promise||typeof l.then=="function")&&l.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")}),new Audio},_releaseHtml5Audio:function(a){var l=this||e;return a._unlocked&&l._html5AudioPool.push(a),l},_autoSuspend:function(){var a=this;if(!(!a.autoSuspend||!a.ctx||typeof a.ctx.suspend=="undefined"||!e.usingWebAudio)){for(var l=0;l<a._howls.length;l++)if(a._howls[l]._webAudio){for(var d=0;d<a._howls[l]._sounds.length;d++)if(!a._howls[l]._sounds[d]._paused)return a}return a._suspendTimer&&clearTimeout(a._suspendTimer),a._suspendTimer=setTimeout(function(){if(a.autoSuspend){a._suspendTimer=null,a.state="suspending";var p=function(){a.state="suspended",a._resumeAfterSuspend&&(delete a._resumeAfterSuspend,a._autoResume())};a.ctx.suspend().then(p,p)}},3e4),a}},_autoResume:function(){var a=this;if(!(!a.ctx||typeof a.ctx.resume=="undefined"||!e.usingWebAudio))return a.state==="running"&&a.ctx.state!=="interrupted"&&a._suspendTimer?(clearTimeout(a._suspendTimer),a._suspendTimer=null):a.state==="suspended"||a.state==="running"&&a.ctx.state==="interrupted"?(a.ctx.resume().then(function(){a.state="running";for(var l=0;l<a._howls.length;l++)a._howls[l]._emit("resume")}),a._suspendTimer&&(clearTimeout(a._suspendTimer),a._suspendTimer=null)):a.state==="suspending"&&(a._resumeAfterSuspend=!0),a}};var e=new t,i=function(a){var l=this;if(!a.src||a.src.length===0){console.error("An array of source files must be passed with any new Howl.");return}l.init(a)};i.prototype={init:function(a){var l=this;return e.ctx||c(),l._autoplay=a.autoplay||!1,l._format=typeof a.format!="string"?a.format:[a.format],l._html5=a.html5||!1,l._muted=a.mute||!1,l._loop=a.loop||!1,l._pool=a.pool||5,l._preload=typeof a.preload=="boolean"||a.preload==="metadata"?a.preload:!0,l._rate=a.rate||1,l._sprite=a.sprite||{},l._src=typeof a.src!="string"?a.src:[a.src],l._volume=a.volume!==void 0?a.volume:1,l._xhr={method:a.xhr&&a.xhr.method?a.xhr.method:"GET",headers:a.xhr&&a.xhr.headers?a.xhr.headers:null,withCredentials:a.xhr&&a.xhr.withCredentials?a.xhr.withCredentials:!1},l._duration=0,l._state="unloaded",l._sounds=[],l._endTimers={},l._queue=[],l._playLock=!1,l._onend=a.onend?[{fn:a.onend}]:[],l._onfade=a.onfade?[{fn:a.onfade}]:[],l._onload=a.onload?[{fn:a.onload}]:[],l._onloaderror=a.onloaderror?[{fn:a.onloaderror}]:[],l._onplayerror=a.onplayerror?[{fn:a.onplayerror}]:[],l._onpause=a.onpause?[{fn:a.onpause}]:[],l._onplay=a.onplay?[{fn:a.onplay}]:[],l._onstop=a.onstop?[{fn:a.onstop}]:[],l._onmute=a.onmute?[{fn:a.onmute}]:[],l._onvolume=a.onvolume?[{fn:a.onvolume}]:[],l._onrate=a.onrate?[{fn:a.onrate}]:[],l._onseek=a.onseek?[{fn:a.onseek}]:[],l._onunlock=a.onunlock?[{fn:a.onunlock}]:[],l._onresume=[],l._webAudio=e.usingWebAudio&&!l._html5,typeof e.ctx!="undefined"&&e.ctx&&e.autoUnlock&&e._unlockAudio(),e._howls.push(l),l._autoplay&&l._queue.push({event:"play",action:function(){l.play()}}),l._preload&&l._preload!=="none"&&l.load(),l},load:function(){var a=this,l=null;if(e.noAudio){a._emit("loaderror",null,"No audio support.");return}typeof a._src=="string"&&(a._src=[a._src]);for(var d=0;d<a._src.length;d++){var p,m;if(a._format&&a._format[d])p=a._format[d];else{if(m=a._src[d],typeof m!="string"){a._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}p=/^data:audio\/([^;,]+);/i.exec(m),p||(p=/\.([^.]+)$/.exec(m.split("?",1)[0])),p&&(p=p[1].toLowerCase())}if(p||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),p&&e.codecs(p)){l=a._src[d];break}}if(!l){a._emit("loaderror",null,"No codec support for selected audio sources.");return}return a._src=l,a._state="loading",window.location.protocol==="https:"&&l.slice(0,5)==="http:"&&(a._html5=!0,a._webAudio=!1),new s(a),a._webAudio&&o(a),a},play:function(a,l){var d=this,p=null;if(typeof a=="number")p=a,a=null;else{if(typeof a=="string"&&d._state==="loaded"&&!d._sprite[a])return null;if(typeof a=="undefined"&&(a="__default",!d._playLock)){for(var m=0,x=0;x<d._sounds.length;x++)d._sounds[x]._paused&&!d._sounds[x]._ended&&(m++,p=d._sounds[x]._id);m===1?a=null:p=null}}var y=p?d._soundById(p):d._inactiveSound();if(!y)return null;if(p&&!a&&(a=y._sprite||"__default"),d._state!=="loaded"){y._sprite=a,y._ended=!1;var _=y._id;return d._queue.push({event:"play",action:function(){d.play(_)}}),_}if(p&&!y._paused)return l||d._loadQueue("play"),y._id;d._webAudio&&e._autoResume();var v=Math.max(0,y._seek>0?y._seek:d._sprite[a][0]/1e3),b=Math.max(0,(d._sprite[a][0]+d._sprite[a][1])/1e3-v),T=b*1e3/Math.abs(y._rate),A=d._sprite[a][0]/1e3,P=(d._sprite[a][0]+d._sprite[a][1])/1e3;y._sprite=a,y._ended=!1;var V=function(){y._paused=!1,y._seek=v,y._start=A,y._stop=P,y._loop=!!(y._loop||d._sprite[a][2])};if(v>=P){d._ended(y);return}var I=y._node;if(d._webAudio){var j=function(){d._playLock=!1,V(),d._refreshBuffer(y);var D=y._muted||d._muted?0:y._volume;I.gain.setValueAtTime(D,e.ctx.currentTime),y._playStart=e.ctx.currentTime,typeof I.bufferSource.start=="undefined"?y._loop?I.bufferSource.noteGrainOn(0,v,86400):I.bufferSource.noteGrainOn(0,v,b):y._loop?I.bufferSource.start(0,v,86400):I.bufferSource.start(0,v,b),T!==1/0&&(d._endTimers[y._id]=setTimeout(d._ended.bind(d,y),T)),l||setTimeout(function(){d._emit("play",y._id),d._loadQueue()},0)};e.state==="running"&&e.ctx.state!=="interrupted"?j():(d._playLock=!0,d.once("resume",j),d._clearTimer(y._id))}else{var H=function(){I.currentTime=v,I.muted=y._muted||d._muted||e._muted||I.muted,I.volume=y._volume*e.volume(),I.playbackRate=y._rate;try{var D=I.play();if(D&&typeof Promise!="undefined"&&(D instanceof Promise||typeof D.then=="function")?(d._playLock=!0,V(),D.then(function(){d._playLock=!1,I._unlocked=!0,l?d._loadQueue():d._emit("play",y._id)}).catch(function(){d._playLock=!1,d._emit("playerror",y._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),y._ended=!0,y._paused=!0})):l||(d._playLock=!1,V(),d._emit("play",y._id)),I.playbackRate=y._rate,I.paused){d._emit("playerror",y._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");return}a!=="__default"||y._loop?d._endTimers[y._id]=setTimeout(d._ended.bind(d,y),T):(d._endTimers[y._id]=function(){d._ended(y),I.removeEventListener("ended",d._endTimers[y._id],!1)},I.addEventListener("ended",d._endTimers[y._id],!1))}catch(jt){d._emit("playerror",y._id,jt)}};I.src==="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"&&(I.src=d._src,I.load());var q=window&&window.ejecta||!I.readyState&&e._navigator.isCocoonJS;if(I.readyState>=3||q)H();else{d._playLock=!0,d._state="loading";var K=function(){d._state="loaded",H(),I.removeEventListener(e._canPlayEvent,K,!1)};I.addEventListener(e._canPlayEvent,K,!1),d._clearTimer(y._id)}}return y._id},pause:function(a){var l=this;if(l._state!=="loaded"||l._playLock)return l._queue.push({event:"pause",action:function(){l.pause(a)}}),l;for(var d=l._getSoundIds(a),p=0;p<d.length;p++){l._clearTimer(d[p]);var m=l._soundById(d[p]);if(m&&!m._paused&&(m._seek=l.seek(d[p]),m._rateSeek=0,m._paused=!0,l._stopFade(d[p]),m._node))if(l._webAudio){if(!m._node.bufferSource)continue;typeof m._node.bufferSource.stop=="undefined"?m._node.bufferSource.noteOff(0):m._node.bufferSource.stop(0),l._cleanBuffer(m._node)}else(!isNaN(m._node.duration)||m._node.duration===1/0)&&m._node.pause();arguments[1]||l._emit("pause",m?m._id:null)}return l},stop:function(a,l){var d=this;if(d._state!=="loaded"||d._playLock)return d._queue.push({event:"stop",action:function(){d.stop(a)}}),d;for(var p=d._getSoundIds(a),m=0;m<p.length;m++){d._clearTimer(p[m]);var x=d._soundById(p[m]);x&&(x._seek=x._start||0,x._rateSeek=0,x._paused=!0,x._ended=!0,d._stopFade(p[m]),x._node&&(d._webAudio?x._node.bufferSource&&(typeof x._node.bufferSource.stop=="undefined"?x._node.bufferSource.noteOff(0):x._node.bufferSource.stop(0),d._cleanBuffer(x._node)):(!isNaN(x._node.duration)||x._node.duration===1/0)&&(x._node.currentTime=x._start||0,x._node.pause(),x._node.duration===1/0&&d._clearSound(x._node))),l||d._emit("stop",x._id))}return d},mute:function(a,l){var d=this;if(d._state!=="loaded"||d._playLock)return d._queue.push({event:"mute",action:function(){d.mute(a,l)}}),d;if(typeof l=="undefined")if(typeof a=="boolean")d._muted=a;else return d._muted;for(var p=d._getSoundIds(l),m=0;m<p.length;m++){var x=d._soundById(p[m]);x&&(x._muted=a,x._interval&&d._stopFade(x._id),d._webAudio&&x._node?x._node.gain.setValueAtTime(a?0:x._volume,e.ctx.currentTime):x._node&&(x._node.muted=e._muted?!0:a),d._emit("mute",x._id))}return d},volume:function(){var a=this,l=arguments,d,p;if(l.length===0)return a._volume;if(l.length===1||l.length===2&&typeof l[1]=="undefined"){var m=a._getSoundIds(),x=m.indexOf(l[0]);x>=0?p=parseInt(l[0],10):d=parseFloat(l[0])}else l.length>=2&&(d=parseFloat(l[0]),p=parseInt(l[1],10));var y;if(typeof d!="undefined"&&d>=0&&d<=1){if(a._state!=="loaded"||a._playLock)return a._queue.push({event:"volume",action:function(){a.volume.apply(a,l)}}),a;typeof p=="undefined"&&(a._volume=d),p=a._getSoundIds(p);for(var _=0;_<p.length;_++)y=a._soundById(p[_]),y&&(y._volume=d,l[2]||a._stopFade(p[_]),a._webAudio&&y._node&&!y._muted?y._node.gain.setValueAtTime(d,e.ctx.currentTime):y._node&&!y._muted&&(y._node.volume=d*e.volume()),a._emit("volume",y._id))}else return y=p?a._soundById(p):a._sounds[0],y?y._volume:0;return a},fade:function(a,l,d,p){var m=this;if(m._state!=="loaded"||m._playLock)return m._queue.push({event:"fade",action:function(){m.fade(a,l,d,p)}}),m;a=Math.min(Math.max(0,parseFloat(a)),1),l=Math.min(Math.max(0,parseFloat(l)),1),d=parseFloat(d),m.volume(a,p);for(var x=m._getSoundIds(p),y=0;y<x.length;y++){var _=m._soundById(x[y]);if(_){if(p||m._stopFade(x[y]),m._webAudio&&!_._muted){var v=e.ctx.currentTime,b=v+d/1e3;_._volume=a,_._node.gain.setValueAtTime(a,v),_._node.gain.linearRampToValueAtTime(l,b)}m._startFadeInterval(_,a,l,d,x[y],typeof p=="undefined")}}return m},_startFadeInterval:function(a,l,d,p,m,x){var y=this,_=l,v=d-l,b=Math.abs(v/.01),T=Math.max(4,b>0?p/b:p),A=Date.now();a._fadeTo=d,a._interval=setInterval(function(){var P=(Date.now()-A)/p;A=Date.now(),_+=v*P,_=Math.round(_*100)/100,v<0?_=Math.max(d,_):_=Math.min(d,_),y._webAudio?a._volume=_:y.volume(_,a._id,!0),x&&(y._volume=_),(d<l&&_<=d||d>l&&_>=d)&&(clearInterval(a._interval),a._interval=null,a._fadeTo=null,y.volume(d,a._id),y._emit("fade",a._id))},T)},_stopFade:function(a){var l=this,d=l._soundById(a);return d&&d._interval&&(l._webAudio&&d._node.gain.cancelScheduledValues(e.ctx.currentTime),clearInterval(d._interval),d._interval=null,l.volume(d._fadeTo,a),d._fadeTo=null,l._emit("fade",a)),l},loop:function(){var a=this,l=arguments,d,p,m;if(l.length===0)return a._loop;if(l.length===1)if(typeof l[0]=="boolean")d=l[0],a._loop=d;else return m=a._soundById(parseInt(l[0],10)),m?m._loop:!1;else l.length===2&&(d=l[0],p=parseInt(l[1],10));for(var x=a._getSoundIds(p),y=0;y<x.length;y++)m=a._soundById(x[y]),m&&(m._loop=d,a._webAudio&&m._node&&m._node.bufferSource&&(m._node.bufferSource.loop=d,d&&(m._node.bufferSource.loopStart=m._start||0,m._node.bufferSource.loopEnd=m._stop,a.playing(x[y])&&(a.pause(x[y],!0),a.play(x[y],!0)))));return a},rate:function(){var a=this,l=arguments,d,p;if(l.length===0)p=a._sounds[0]._id;else if(l.length===1){var m=a._getSoundIds(),x=m.indexOf(l[0]);x>=0?p=parseInt(l[0],10):d=parseFloat(l[0])}else l.length===2&&(d=parseFloat(l[0]),p=parseInt(l[1],10));var y;if(typeof d=="number"){if(a._state!=="loaded"||a._playLock)return a._queue.push({event:"rate",action:function(){a.rate.apply(a,l)}}),a;typeof p=="undefined"&&(a._rate=d),p=a._getSoundIds(p);for(var _=0;_<p.length;_++)if(y=a._soundById(p[_]),y){a.playing(p[_])&&(y._rateSeek=a.seek(p[_]),y._playStart=a._webAudio?e.ctx.currentTime:y._playStart),y._rate=d,a._webAudio&&y._node&&y._node.bufferSource?y._node.bufferSource.playbackRate.setValueAtTime(d,e.ctx.currentTime):y._node&&(y._node.playbackRate=d);var v=a.seek(p[_]),b=(a._sprite[y._sprite][0]+a._sprite[y._sprite][1])/1e3-v,T=b*1e3/Math.abs(y._rate);(a._endTimers[p[_]]||!y._paused)&&(a._clearTimer(p[_]),a._endTimers[p[_]]=setTimeout(a._ended.bind(a,y),T)),a._emit("rate",y._id)}}else return y=a._soundById(p),y?y._rate:a._rate;return a},seek:function(){var a=this,l=arguments,d,p;if(l.length===0)a._sounds.length&&(p=a._sounds[0]._id);else if(l.length===1){var m=a._getSoundIds(),x=m.indexOf(l[0]);x>=0?p=parseInt(l[0],10):a._sounds.length&&(p=a._sounds[0]._id,d=parseFloat(l[0]))}else l.length===2&&(d=parseFloat(l[0]),p=parseInt(l[1],10));if(typeof p=="undefined")return 0;if(typeof d=="number"&&(a._state!=="loaded"||a._playLock))return a._queue.push({event:"seek",action:function(){a.seek.apply(a,l)}}),a;var y=a._soundById(p);if(y)if(typeof d=="number"&&d>=0){var _=a.playing(p);_&&a.pause(p,!0),y._seek=d,y._ended=!1,a._clearTimer(p),!a._webAudio&&y._node&&!isNaN(y._node.duration)&&(y._node.currentTime=d);var v=function(){_&&a.play(p,!0),a._emit("seek",p)};if(_&&!a._webAudio){var b=function(){a._playLock?setTimeout(b,0):v()};setTimeout(b,0)}else v()}else if(a._webAudio){var T=a.playing(p)?e.ctx.currentTime-y._playStart:0,A=y._rateSeek?y._rateSeek-y._seek:0;return y._seek+(A+T*Math.abs(y._rate))}else return y._node.currentTime;return a},playing:function(a){var l=this;if(typeof a=="number"){var d=l._soundById(a);return d?!d._paused:!1}for(var p=0;p<l._sounds.length;p++)if(!l._sounds[p]._paused)return!0;return!1},duration:function(a){var l=this,d=l._duration,p=l._soundById(a);return p&&(d=l._sprite[p._sprite][1]/1e3),d},state:function(){return this._state},unload:function(){for(var a=this,l=a._sounds,d=0;d<l.length;d++)l[d]._paused||a.stop(l[d]._id),a._webAudio||(a._clearSound(l[d]._node),l[d]._node.removeEventListener("error",l[d]._errorFn,!1),l[d]._node.removeEventListener(e._canPlayEvent,l[d]._loadFn,!1),l[d]._node.removeEventListener("ended",l[d]._endFn,!1),e._releaseHtml5Audio(l[d]._node)),delete l[d]._node,a._clearTimer(l[d]._id);var p=e._howls.indexOf(a);p>=0&&e._howls.splice(p,1);var m=!0;for(d=0;d<e._howls.length;d++)if(e._howls[d]._src===a._src||a._src.indexOf(e._howls[d]._src)>=0){m=!1;break}return n&&m&&delete n[a._src],e.noAudio=!1,a._state="unloaded",a._sounds=[],a=null,null},on:function(a,l,d,p){var m=this,x=m["_on"+a];return typeof l=="function"&&x.push(p?{id:d,fn:l,once:p}:{id:d,fn:l}),m},off:function(a,l,d){var p=this,m=p["_on"+a],x=0;if(typeof l=="number"&&(d=l,l=null),l||d)for(x=0;x<m.length;x++){var y=d===m[x].id;if(l===m[x].fn&&y||!l&&y){m.splice(x,1);break}}else if(a)p["_on"+a]=[];else{var _=Object.keys(p);for(x=0;x<_.length;x++)_[x].indexOf("_on")===0&&Array.isArray(p[_[x]])&&(p[_[x]]=[])}return p},once:function(a,l,d){var p=this;return p.on(a,l,d,1),p},_emit:function(a,l,d){for(var p=this,m=p["_on"+a],x=m.length-1;x>=0;x--)(!m[x].id||m[x].id===l||a==="load")&&(setTimeout(function(y){y.call(this,l,d)}.bind(p,m[x].fn),0),m[x].once&&p.off(a,m[x].fn,m[x].id));return p._loadQueue(a),p},_loadQueue:function(a){var l=this;if(l._queue.length>0){var d=l._queue[0];d.event===a&&(l._queue.shift(),l._loadQueue()),a||d.action()}return l},_ended:function(a){var l=this,d=a._sprite;if(!l._webAudio&&a._node&&!a._node.paused&&!a._node.ended&&a._node.currentTime<a._stop)return setTimeout(l._ended.bind(l,a),100),l;var p=!!(a._loop||l._sprite[d][2]);if(l._emit("end",a._id),!l._webAudio&&p&&l.stop(a._id,!0).play(a._id),l._webAudio&&p){l._emit("play",a._id),a._seek=a._start||0,a._rateSeek=0,a._playStart=e.ctx.currentTime;var m=(a._stop-a._start)*1e3/Math.abs(a._rate);l._endTimers[a._id]=setTimeout(l._ended.bind(l,a),m)}return l._webAudio&&!p&&(a._paused=!0,a._ended=!0,a._seek=a._start||0,a._rateSeek=0,l._clearTimer(a._id),l._cleanBuffer(a._node),e._autoSuspend()),!l._webAudio&&!p&&l.stop(a._id,!0),l},_clearTimer:function(a){var l=this;if(l._endTimers[a]){if(typeof l._endTimers[a]!="function")clearTimeout(l._endTimers[a]);else{var d=l._soundById(a);d&&d._node&&d._node.removeEventListener("ended",l._endTimers[a],!1)}delete l._endTimers[a]}return l},_soundById:function(a){for(var l=this,d=0;d<l._sounds.length;d++)if(a===l._sounds[d]._id)return l._sounds[d];return null},_inactiveSound:function(){var a=this;a._drain();for(var l=0;l<a._sounds.length;l++)if(a._sounds[l]._ended)return a._sounds[l].reset();return new s(a)},_drain:function(){var a=this,l=a._pool,d=0,p=0;if(!(a._sounds.length<l)){for(p=0;p<a._sounds.length;p++)a._sounds[p]._ended&&d++;for(p=a._sounds.length-1;p>=0;p--){if(d<=l)return;a._sounds[p]._ended&&(a._webAudio&&a._sounds[p]._node&&a._sounds[p]._node.disconnect(0),a._sounds.splice(p,1),d--)}}},_getSoundIds:function(a){var l=this;if(typeof a=="undefined"){for(var d=[],p=0;p<l._sounds.length;p++)d.push(l._sounds[p]._id);return d}else return[a]},_refreshBuffer:function(a){var l=this;return a._node.bufferSource=e.ctx.createBufferSource(),a._node.bufferSource.buffer=n[l._src],a._panner?a._node.bufferSource.connect(a._panner):a._node.bufferSource.connect(a._node),a._node.bufferSource.loop=a._loop,a._loop&&(a._node.bufferSource.loopStart=a._start||0,a._node.bufferSource.loopEnd=a._stop||0),a._node.bufferSource.playbackRate.setValueAtTime(a._rate,e.ctx.currentTime),l},_cleanBuffer:function(a){var l=this,d=e._navigator&&e._navigator.vendor.indexOf("Apple")>=0;if(!a.bufferSource)return l;if(e._scratchBuffer&&a.bufferSource&&(a.bufferSource.onended=null,a.bufferSource.disconnect(0),d))try{a.bufferSource.buffer=e._scratchBuffer}catch(p){}return a.bufferSource=null,l},_clearSound:function(a){var l=/MSIE |Trident\//.test(e._navigator&&e._navigator.userAgent);l||(a.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var s=function(a){this._parent=a,this.init()};s.prototype={init:function(){var a=this,l=a._parent;return a._muted=l._muted,a._loop=l._loop,a._volume=l._volume,a._rate=l._rate,a._seek=0,a._paused=!0,a._ended=!0,a._sprite="__default",a._id=++e._counter,l._sounds.push(a),a.create(),a},create:function(){var a=this,l=a._parent,d=e._muted||a._muted||a._parent._muted?0:a._volume;return l._webAudio?(a._node=typeof e.ctx.createGain=="undefined"?e.ctx.createGainNode():e.ctx.createGain(),a._node.gain.setValueAtTime(d,e.ctx.currentTime),a._node.paused=!0,a._node.connect(e.masterGain)):e.noAudio||(a._node=e._obtainHtml5Audio(),a._errorFn=a._errorListener.bind(a),a._node.addEventListener("error",a._errorFn,!1),a._loadFn=a._loadListener.bind(a),a._node.addEventListener(e._canPlayEvent,a._loadFn,!1),a._endFn=a._endListener.bind(a),a._node.addEventListener("ended",a._endFn,!1),a._node.src=l._src,a._node.preload=l._preload===!0?"auto":l._preload,a._node.volume=d*e.volume(),a._node.load()),a},reset:function(){var a=this,l=a._parent;return a._muted=l._muted,a._loop=l._loop,a._volume=l._volume,a._rate=l._rate,a._seek=0,a._rateSeek=0,a._paused=!0,a._ended=!0,a._sprite="__default",a._id=++e._counter,a},_errorListener:function(){var a=this;a._parent._emit("loaderror",a._id,a._node.error?a._node.error.code:0),a._node.removeEventListener("error",a._errorFn,!1)},_loadListener:function(){var a=this,l=a._parent;l._duration=Math.ceil(a._node.duration*10)/10,Object.keys(l._sprite).length===0&&(l._sprite={__default:[0,l._duration*1e3]}),l._state!=="loaded"&&(l._state="loaded",l._emit("load"),l._loadQueue()),a._node.removeEventListener(e._canPlayEvent,a._loadFn,!1)},_endListener:function(){var a=this,l=a._parent;l._duration===1/0&&(l._duration=Math.ceil(a._node.duration*10)/10,l._sprite.__default[1]===1/0&&(l._sprite.__default[1]=l._duration*1e3),l._ended(a)),a._node.removeEventListener("ended",a._endFn,!1)}};var n={},o=function(a){var l=a._src;if(n[l]){a._duration=n[l].duration,u(a);return}if(/^data:[^;]+;base64,/.test(l)){for(var d=atob(l.split(",")[1]),p=new Uint8Array(d.length),m=0;m<d.length;++m)p[m]=d.charCodeAt(m);f(p.buffer,a)}else{var x=new XMLHttpRequest;x.open(a._xhr.method,l,!0),x.withCredentials=a._xhr.withCredentials,x.responseType="arraybuffer",a._xhr.headers&&Object.keys(a._xhr.headers).forEach(function(y){x.setRequestHeader(y,a._xhr.headers[y])}),x.onload=function(){var y=(x.status+"")[0];if(y!=="0"&&y!=="2"&&y!=="3"){a._emit("loaderror",null,"Failed loading audio file with status: "+x.status+".");return}f(x.response,a)},x.onerror=function(){a._webAudio&&(a._html5=!0,a._webAudio=!1,a._sounds=[],delete n[l],a.load())},h(x)}},h=function(a){try{a.send()}catch(l){a.onerror()}},f=function(a,l){var d=function(){l._emit("loaderror",null,"Decoding audio data failed.")},p=function(m){m&&l._sounds.length>0?(n[l._src]=m,u(l,m)):d()};typeof Promise!="undefined"&&e.ctx.decodeAudioData.length===1?e.ctx.decodeAudioData(a).then(p).catch(d):e.ctx.decodeAudioData(a,p,d)},u=function(a,l){l&&!a._duration&&(a._duration=l.duration),Object.keys(a._sprite).length===0&&(a._sprite={__default:[0,a._duration*1e3]}),a._state!=="loaded"&&(a._state="loaded",a._emit("load"),a._loadQueue())},c=function(){if(e.usingWebAudio){try{typeof AudioContext!="undefined"?e.ctx=new AudioContext:typeof webkitAudioContext!="undefined"?e.ctx=new webkitAudioContext:e.usingWebAudio=!1}catch(m){e.usingWebAudio=!1}e.ctx||(e.usingWebAudio=!1);var a=/iP(hone|od|ad)/.test(e._navigator&&e._navigator.platform),l=e._navigator&&e._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),d=l?parseInt(l[1],10):null;if(a&&d&&d<9){var p=/safari/.test(e._navigator&&e._navigator.userAgent.toLowerCase());e._navigator&&!p&&(e.usingWebAudio=!1)}e.usingWebAudio&&(e.masterGain=typeof e.ctx.createGain=="undefined"?e.ctx.createGainNode():e.ctx.createGain(),e.masterGain.gain.setValueAtTime(e._muted?0:e._volume,e.ctx.currentTime),e.masterGain.connect(e.ctx.destination)),e._setup()}};r.Howler=e,r.Howl=i,typeof Dt!="undefined"?(Dt.HowlerGlobal=t,Dt.Howler=e,Dt.Howl=i,Dt.Sound=s):typeof window!="undefined"&&(window.HowlerGlobal=t,window.Howler=e,window.Howl=i,window.Sound=s)})();/*!
 *  Spatial Plugin - Adds support for stereo and 3D audio where Web Audio is supported.
 *  
 *  howler.js v2.2.4
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */(function(){HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(e){var i=this;if(!i.ctx||!i.ctx.listener)return i;for(var s=i._howls.length-1;s>=0;s--)i._howls[s].stereo(e);return i},HowlerGlobal.prototype.pos=function(e,i,s){var n=this;if(!n.ctx||!n.ctx.listener)return n;if(i=typeof i!="number"?n._pos[1]:i,s=typeof s!="number"?n._pos[2]:s,typeof e=="number")n._pos=[e,i,s],typeof n.ctx.listener.positionX!="undefined"?(n.ctx.listener.positionX.setTargetAtTime(n._pos[0],Howler.ctx.currentTime,.1),n.ctx.listener.positionY.setTargetAtTime(n._pos[1],Howler.ctx.currentTime,.1),n.ctx.listener.positionZ.setTargetAtTime(n._pos[2],Howler.ctx.currentTime,.1)):n.ctx.listener.setPosition(n._pos[0],n._pos[1],n._pos[2]);else return n._pos;return n},HowlerGlobal.prototype.orientation=function(e,i,s,n,o,h){var f=this;if(!f.ctx||!f.ctx.listener)return f;var u=f._orientation;if(i=typeof i!="number"?u[1]:i,s=typeof s!="number"?u[2]:s,n=typeof n!="number"?u[3]:n,o=typeof o!="number"?u[4]:o,h=typeof h!="number"?u[5]:h,typeof e=="number")f._orientation=[e,i,s,n,o,h],typeof f.ctx.listener.forwardX!="undefined"?(f.ctx.listener.forwardX.setTargetAtTime(e,Howler.ctx.currentTime,.1),f.ctx.listener.forwardY.setTargetAtTime(i,Howler.ctx.currentTime,.1),f.ctx.listener.forwardZ.setTargetAtTime(s,Howler.ctx.currentTime,.1),f.ctx.listener.upX.setTargetAtTime(n,Howler.ctx.currentTime,.1),f.ctx.listener.upY.setTargetAtTime(o,Howler.ctx.currentTime,.1),f.ctx.listener.upZ.setTargetAtTime(h,Howler.ctx.currentTime,.1)):f.ctx.listener.setOrientation(e,i,s,n,o,h);else return u;return f},Howl.prototype.init=function(e){return function(i){var s=this;return s._orientation=i.orientation||[1,0,0],s._stereo=i.stereo||null,s._pos=i.pos||null,s._pannerAttr={coneInnerAngle:typeof i.coneInnerAngle!="undefined"?i.coneInnerAngle:360,coneOuterAngle:typeof i.coneOuterAngle!="undefined"?i.coneOuterAngle:360,coneOuterGain:typeof i.coneOuterGain!="undefined"?i.coneOuterGain:0,distanceModel:typeof i.distanceModel!="undefined"?i.distanceModel:"inverse",maxDistance:typeof i.maxDistance!="undefined"?i.maxDistance:1e4,panningModel:typeof i.panningModel!="undefined"?i.panningModel:"HRTF",refDistance:typeof i.refDistance!="undefined"?i.refDistance:1,rolloffFactor:typeof i.rolloffFactor!="undefined"?i.rolloffFactor:1},s._onstereo=i.onstereo?[{fn:i.onstereo}]:[],s._onpos=i.onpos?[{fn:i.onpos}]:[],s._onorientation=i.onorientation?[{fn:i.onorientation}]:[],e.call(this,i)}}(Howl.prototype.init),Howl.prototype.stereo=function(e,i){var s=this;if(!s._webAudio)return s;if(s._state!=="loaded")return s._queue.push({event:"stereo",action:function(){s.stereo(e,i)}}),s;var n=typeof Howler.ctx.createStereoPanner=="undefined"?"spatial":"stereo";if(typeof i=="undefined")if(typeof e=="number")s._stereo=e,s._pos=[e,0,0];else return s._stereo;for(var o=s._getSoundIds(i),h=0;h<o.length;h++){var f=s._soundById(o[h]);if(f)if(typeof e=="number")f._stereo=e,f._pos=[e,0,0],f._node&&(f._pannerAttr.panningModel="equalpower",(!f._panner||!f._panner.pan)&&t(f,n),n==="spatial"?typeof f._panner.positionX!="undefined"?(f._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),f._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),f._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):f._panner.setPosition(e,0,0):f._panner.pan.setValueAtTime(e,Howler.ctx.currentTime)),s._emit("stereo",f._id);else return f._stereo}return s},Howl.prototype.pos=function(e,i,s,n){var o=this;if(!o._webAudio)return o;if(o._state!=="loaded")return o._queue.push({event:"pos",action:function(){o.pos(e,i,s,n)}}),o;if(i=typeof i!="number"?0:i,s=typeof s!="number"?-.5:s,typeof n=="undefined")if(typeof e=="number")o._pos=[e,i,s];else return o._pos;for(var h=o._getSoundIds(n),f=0;f<h.length;f++){var u=o._soundById(h[f]);if(u)if(typeof e=="number")u._pos=[e,i,s],u._node&&((!u._panner||u._panner.pan)&&t(u,"spatial"),typeof u._panner.positionX!="undefined"?(u._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),u._panner.positionY.setValueAtTime(i,Howler.ctx.currentTime),u._panner.positionZ.setValueAtTime(s,Howler.ctx.currentTime)):u._panner.setPosition(e,i,s)),o._emit("pos",u._id);else return u._pos}return o},Howl.prototype.orientation=function(e,i,s,n){var o=this;if(!o._webAudio)return o;if(o._state!=="loaded")return o._queue.push({event:"orientation",action:function(){o.orientation(e,i,s,n)}}),o;if(i=typeof i!="number"?o._orientation[1]:i,s=typeof s!="number"?o._orientation[2]:s,typeof n=="undefined")if(typeof e=="number")o._orientation=[e,i,s];else return o._orientation;for(var h=o._getSoundIds(n),f=0;f<h.length;f++){var u=o._soundById(h[f]);if(u)if(typeof e=="number")u._orientation=[e,i,s],u._node&&(u._panner||(u._pos||(u._pos=o._pos||[0,0,-.5]),t(u,"spatial")),typeof u._panner.orientationX!="undefined"?(u._panner.orientationX.setValueAtTime(e,Howler.ctx.currentTime),u._panner.orientationY.setValueAtTime(i,Howler.ctx.currentTime),u._panner.orientationZ.setValueAtTime(s,Howler.ctx.currentTime)):u._panner.setOrientation(e,i,s)),o._emit("orientation",u._id);else return u._orientation}return o},Howl.prototype.pannerAttr=function(){var e=this,i=arguments,s,n,o;if(!e._webAudio)return e;if(i.length===0)return e._pannerAttr;if(i.length===1)if(typeof i[0]=="object")s=i[0],typeof n=="undefined"&&(s.pannerAttr||(s.pannerAttr={coneInnerAngle:s.coneInnerAngle,coneOuterAngle:s.coneOuterAngle,coneOuterGain:s.coneOuterGain,distanceModel:s.distanceModel,maxDistance:s.maxDistance,refDistance:s.refDistance,rolloffFactor:s.rolloffFactor,panningModel:s.panningModel}),e._pannerAttr={coneInnerAngle:typeof s.pannerAttr.coneInnerAngle!="undefined"?s.pannerAttr.coneInnerAngle:e._coneInnerAngle,coneOuterAngle:typeof s.pannerAttr.coneOuterAngle!="undefined"?s.pannerAttr.coneOuterAngle:e._coneOuterAngle,coneOuterGain:typeof s.pannerAttr.coneOuterGain!="undefined"?s.pannerAttr.coneOuterGain:e._coneOuterGain,distanceModel:typeof s.pannerAttr.distanceModel!="undefined"?s.pannerAttr.distanceModel:e._distanceModel,maxDistance:typeof s.pannerAttr.maxDistance!="undefined"?s.pannerAttr.maxDistance:e._maxDistance,refDistance:typeof s.pannerAttr.refDistance!="undefined"?s.pannerAttr.refDistance:e._refDistance,rolloffFactor:typeof s.pannerAttr.rolloffFactor!="undefined"?s.pannerAttr.rolloffFactor:e._rolloffFactor,panningModel:typeof s.pannerAttr.panningModel!="undefined"?s.pannerAttr.panningModel:e._panningModel});else return o=e._soundById(parseInt(i[0],10)),o?o._pannerAttr:e._pannerAttr;else i.length===2&&(s=i[0],n=parseInt(i[1],10));for(var h=e._getSoundIds(n),f=0;f<h.length;f++)if(o=e._soundById(h[f]),o){var u=o._pannerAttr;u={coneInnerAngle:typeof s.coneInnerAngle!="undefined"?s.coneInnerAngle:u.coneInnerAngle,coneOuterAngle:typeof s.coneOuterAngle!="undefined"?s.coneOuterAngle:u.coneOuterAngle,coneOuterGain:typeof s.coneOuterGain!="undefined"?s.coneOuterGain:u.coneOuterGain,distanceModel:typeof s.distanceModel!="undefined"?s.distanceModel:u.distanceModel,maxDistance:typeof s.maxDistance!="undefined"?s.maxDistance:u.maxDistance,refDistance:typeof s.refDistance!="undefined"?s.refDistance:u.refDistance,rolloffFactor:typeof s.rolloffFactor!="undefined"?s.rolloffFactor:u.rolloffFactor,panningModel:typeof s.panningModel!="undefined"?s.panningModel:u.panningModel};var c=o._panner;c||(o._pos||(o._pos=e._pos||[0,0,-.5]),t(o,"spatial"),c=o._panner),c.coneInnerAngle=u.coneInnerAngle,c.coneOuterAngle=u.coneOuterAngle,c.coneOuterGain=u.coneOuterGain,c.distanceModel=u.distanceModel,c.maxDistance=u.maxDistance,c.refDistance=u.refDistance,c.rolloffFactor=u.rolloffFactor,c.panningModel=u.panningModel}return e},Sound.prototype.init=function(e){return function(){var i=this,s=i._parent;i._orientation=s._orientation,i._stereo=s._stereo,i._pos=s._pos,i._pannerAttr=s._pannerAttr,e.call(this),i._stereo?s.stereo(i._stereo):i._pos&&s.pos(i._pos[0],i._pos[1],i._pos[2],i._id)}}(Sound.prototype.init),Sound.prototype.reset=function(e){return function(){var i=this,s=i._parent;return i._orientation=s._orientation,i._stereo=s._stereo,i._pos=s._pos,i._pannerAttr=s._pannerAttr,i._stereo?s.stereo(i._stereo):i._pos?s.pos(i._pos[0],i._pos[1],i._pos[2],i._id):i._panner&&(i._panner.disconnect(0),i._panner=void 0,s._refreshBuffer(i)),e.call(this)}}(Sound.prototype.reset);var t=function(e,i){i=i||"spatial",i==="spatial"?(e._panner=Howler.ctx.createPanner(),e._panner.coneInnerAngle=e._pannerAttr.coneInnerAngle,e._panner.coneOuterAngle=e._pannerAttr.coneOuterAngle,e._panner.coneOuterGain=e._pannerAttr.coneOuterGain,e._panner.distanceModel=e._pannerAttr.distanceModel,e._panner.maxDistance=e._pannerAttr.maxDistance,e._panner.refDistance=e._pannerAttr.refDistance,e._panner.rolloffFactor=e._pannerAttr.rolloffFactor,e._panner.panningModel=e._pannerAttr.panningModel,typeof e._panner.positionX!="undefined"?(e._panner.positionX.setValueAtTime(e._pos[0],Howler.ctx.currentTime),e._panner.positionY.setValueAtTime(e._pos[1],Howler.ctx.currentTime),e._panner.positionZ.setValueAtTime(e._pos[2],Howler.ctx.currentTime)):e._panner.setPosition(e._pos[0],e._pos[1],e._pos[2]),typeof e._panner.orientationX!="undefined"?(e._panner.orientationX.setValueAtTime(e._orientation[0],Howler.ctx.currentTime),e._panner.orientationY.setValueAtTime(e._orientation[1],Howler.ctx.currentTime),e._panner.orientationZ.setValueAtTime(e._orientation[2],Howler.ctx.currentTime)):e._panner.setOrientation(e._orientation[0],e._orientation[1],e._orientation[2])):(e._panner=Howler.ctx.createStereoPanner(),e._panner.pan.setValueAtTime(e._stereo,Howler.ctx.currentTime)),e._panner.connect(e._node),e._paused||e._parent.pause(e._id,!0).play(e._id,!0)}})()})(et);let ue="",ht={},ep,ui=!1;function Ua(r=!1){ue=r?"?"+~~(Math.random()*1e7):""}function ip(r,t){r!=="*"?ht[r]=t:(ht.audio=t,ht.binary=t,ht.image=t,ht.json=t,ht.js=t,ht.tmx=t,ht.tsx=t)}function Lr(r){return r.charAt(0).toUpperCase()+r.slice(1)}function kr(r){return typeof r=="string"&&(r=r.trim()),!isNaN(r)&&/^[+-]?(\d+(\.\d+)?|\.\d+)$/.test(r)}function Va(r){const t=r.trim();return t==="true"||t==="false"}function za(r){let t="",e=0;for(;e<r.length;)t+=r.charCodeAt(e++).toString(16);return t}function Fr(r){return/^data:(.+);base64,(.+)$/.test(r)}var sp={__proto__:null,capitalize:Lr,isBoolean:Va,isDataUrl:Fr,isNumeric:kr,toHex:za};let X={},_t=null,Ga=0,Mi=[],rp=function(r,t){if(Ga++>3){let e="melonJS: failed loading "+r;throw new Error(e)}else X[r].load()},np=!0;function op(r="mp3"){return Mi=r.split(","),!et.Howler.noAudio}function ap(r){return ja()&&et.Howler.codecs(r)}function ja(){return!et.Howler.noAudio}function hp(){qa()}function lp(){Ka()}function Ha(r,t,e){let i=[];if(Mi.length===0)throw new Error("target audio extension(s) should be set through me.audio.init() before calling the preloader.");if(Fr(r.src)===!0)i.push(r.src);else for(let s=0;s<Mi.length;s++)i.push(r.src+r.name+"."+Mi[s]+ue);return X[r.name]=new et.Howl({src:i,volume:et.Howler.volume(),html5:r.stream===!0||r.html5===!0,xhrWithCredentials:ui,onloaderror(){rp.call(this,r.name,e)},onload(){Ga=0,typeof t=="function"&&t()}}),1}function Ya(r,t=!1,e,i){let s=X[r];if(s&&typeof s!="undefined"){let n=s.play();return typeof t=="boolean"&&s.loop(t,n),s.volume(typeof i=="number"?E(i,0,1):et.Howler.volume(),n),typeof e=="function"&&(t===!0?s.on("end",e,n):s.once("end",e,n)),n}else throw new Error("audio clip "+r+" does not exist")}function up(r,t,e,i,s){let n=X[r];if(n&&typeof n!="undefined")n.fade(t,e,i,s);else throw new Error("audio clip "+r+" does not exist")}function fp(r,...t){let e=X[r];if(e&&typeof e!="undefined")return e.seek(...t);throw new Error("audio clip "+r+" does not exist")}function dp(r,...t){let e=X[r];if(e&&typeof e!="undefined")return e.rate(...t);throw new Error("audio clip "+r+" does not exist")}function cp(r,t){if(typeof r!="undefined"){let e=X[r];if(e&&typeof e!="undefined")e.stop(t),e.off("end",void 0,t);else throw new Error("audio clip "+r+" does not exist")}else et.Howler.stop()}function pp(r,t){let e=X[r];if(e&&typeof e!="undefined")e.pause(t);else throw new Error("audio clip "+r+" does not exist")}function gp(r,t){let e=X[r];if(e&&typeof e!="undefined")e.play(t);else throw new Error("audio clip "+r+" does not exist")}function yp(r,t){return _t=r,Ya(_t,!0,null,t)}function mp(){_t!==null&&(X[_t].stop(),_t=null)}function Xa(){_t!==null&&X[_t].pause()}function Qs(){_t!==null&&X[_t].play()}function xp(){return _t}function vp(r){et.Howler.volume(r)}function _p(){return et.Howler.volume()}function Wa(r,t,e=!0){let i=X[r];if(i&&typeof i!="undefined")i.mute(e,t);else throw new Error("audio clip "+r+" does not exist")}function bp(r,t){Wa(r,t,!1)}function Ka(){et.Howler.mute(!0)}function qa(){et.Howler.mute(!1)}function wp(){return et.Howler._muted}function Nr(r){return r in X?(X[r].unload(),delete X[r],!0):!1}function Qa(){for(let r in X)X.hasOwnProperty(r)&&Nr(r)}var Jt={__proto__:null,disable:lp,enable:hp,fade:up,getCurrentTrack:xp,getVolume:_p,hasAudio:ja,hasFormat:ap,init:op,load:Ha,mute:Wa,muteAll:Ka,muted:wp,pause:pp,pauseTrack:Xa,play:Ya,playTrack:yp,rate:dp,resume:gp,resumeTrack:Qs,seek:fp,setVolume:vp,stop:cp,stopOnAudioError:np,stopTrack:mp,unload:Nr,unloadAll:Qa,unmute:bp,unmuteAll:qa};let Ot={},Ae=!1;try{Ae=typeof globalThis!="undefined"&&typeof globalThis.localStorage!="undefined"}catch(r){Ae=!1}function Un(r){return r==="add"||r==="remove"}O(hi,()=>{if(Ae===!0){let r=globalThis.localStorage.getItem("me.save");typeof r=="string"&&r.length>0&&(JSON.parse(r)||[]).forEach(e=>{Ot[e]=JSON.parse(globalThis.localStorage.getItem("me.save."+e))})}});let Ja={add(r){let t=Ja;Object.keys(r).forEach(e=>{Un(e)||(function(i){Object.defineProperty(t,i,{configurable:!0,enumerable:!0,get(){return Ot[i]},set(s){Ot[i]=s,Ae===!0&&globalThis.localStorage.setItem("me.save."+i,JSON.stringify(s))}})}(e),e in Ot||(t[e]=r[e]))}),Ae===!0&&globalThis.localStorage.setItem("me.save",JSON.stringify(Object.keys(Ot)))},remove(r){Un(r)||typeof Ot[r]!="undefined"&&(delete Ot[r],Ae===!0&&(globalThis.localStorage.removeItem("me.save."+r),globalThis.localStorage.setItem("me.save",JSON.stringify(Object.keys(Ot)))))}};const Za=["ms","MS","moz","webkit","o"];function Pt(r,t){if(t=t||globalThis,r in t)return t[r];let e=Lr(r),i;return Za.some(s=>{let n=s+e;return i=n in t?t[n]:void 0}),i}function Ur(r,t,e){if(e=e||globalThis,r in e){e[r]=t;return}let i=Lr(r);return Za.some(s=>{let n=s+i;return n in e?(e[n]=t,!0):!1}),!1}var Tp={__proto__:null,prefixed:Pt,setPrefixed:Ur};const ot=typeof globalThis.navigator!="undefined"?globalThis.navigator.userAgent:"",$a=/iPhone|iPad|iPod/i.test(ot),th=/Android/i.test(ot),Ep=/Android 2/i.test(ot),Ap=/Linux/i.test(ot),Sp=/CrOS/.test(ot),eh=/Windows Phone/i.test(ot),ih=/BlackBerry/i.test(ot),sh=/Kindle|Silk.*Mobile Safari/i.test(ot),Cp=typeof globalThis.ejecta!="undefined",Pp=/MicroMessenger/i.test(ot),rh=typeof globalThis.process!="undefined"&&typeof globalThis.process.release!="undefined"&&globalThis.process.release.name==="node",nh=/Mobi/i.test(ot)||$a||th||eh||ih||sh||!1;var Mp={__proto__:null,BlackBerry:ih,Kindle:sh,android:th,android2:Ep,chromeOS:Sp,ejecta:Cp,iOS:$a,isMobile:nh,isWeixin:Pp,linux:Ap,nodeJS:rh,ua:ot,wp:eh};let Vn=!1,Js=!1;function Se(){if(!Js){if(typeof globalThis.document!="undefined"&&!globalThis.document.body)return setTimeout(Se,13);typeof globalThis.document!="undefined"&&typeof globalThis.document.removeEventListener=="function"&&globalThis.document.removeEventListener("DOMContentLoaded",Se,!1),typeof globalThis.removeEventListener=="function"&&globalThis.removeEventListener("load",Se,!1),M(Ir),Js=!0}}function Ip(r){Js?r.call(globalThis,[]):(Ee(Ir,r,globalThis),Vn||(rh===!0||typeof globalThis.document!="undefined"&&globalThis.document.readyState==="complete"?globalThis.setTimeout(Se,0):(typeof globalThis.document!="undefined"&&typeof globalThis.document.addEventListener=="function"&&globalThis.document.addEventListener("DOMContentLoaded",Se,!1),globalThis.addEventListener("load",Se,!1)),Vn=!0))}let _e=!1,be=!1,Ti=!0,Ne={left:0,top:0,x:0,y:0,width:0,height:0,right:0,bottom:0};function zn(r){return r.preventDefault(),typeof globalThis.scroll=="function"&&globalThis.scroll(0,0),!1}function Rp(){try{return!!globalThis.localStorage}catch(r){return!1}}function Op(){try{return typeof globalThis.OffscreenCanvas!="undefined"&&new globalThis.OffscreenCanvas(0,0).getContext("2d")!==null}catch(r){return!1}}function Zs(r){dh=r.accelerationIncludingGravity.x,ch=r.accelerationIncludingGravity.y,ph=r.accelerationIncludingGravity.z}function zi(r){gh=r.gamma,yh=r.beta,mh=r.alpha}let Ie=Mp;const ss="ontouchstart"in globalThis,Re=!!globalThis.PointerEvent,Vr=ss||Re&&globalThis.navigator.maxTouchPoints>0,oh=Vr?Re?globalThis.navigator.maxTouchPoints||1:10:1,Bp=typeof globalThis.document!="undefined"&&"onwheel"in globalThis.document.createElement("div"),rs=typeof globalThis.document!="undefined"&&typeof globalThis.document.pointerLockElement!="undefined",ah=!!globalThis.DeviceOrientationEvent,zr=typeof screen!="undefined"&&typeof screen.orientation!="undefined",hh=!!globalThis.DeviceMotionEvent,fi=typeof globalThis.document!="undefined"&&(Pt("fullscreenEnabled",globalThis.document)||globalThis.document.mozFullScreenEnabled);fi===!0&&(globalThis.document.exitFullscreen=Pt("cancelFullScreen",globalThis.document)||Pt("exitFullscreen",globalThis.document));const Gr=!!(globalThis.AudioContext||globalThis.webkitAudioContext),lh=typeof globalThis.Audio!="undefined",Dp=Gr||lh,Lp=Rp(),uh=Op(),kp=typeof globalThis.atob=="function",fh=typeof globalThis.navigator!="undefined"&&(globalThis.navigator.language||globalThis.navigator.browserLanguage||globalThis.navigator.userLanguage)||"en",jr=globalThis.devicePixelRatio||1,Fp=Ie.isMobile;let dh=0,ch=0,ph=0,gh=0,yh=0,mh=0,Np=!0,Up=!0,Vp=!1,zp=!0;function xh(r){typeof globalThis.addEventListener=="function"&&(globalThis.addEventListener("blur",()=>{M(Fi)},!1),globalThis.addEventListener("focus",()=>{M(Ni),ti()},!1)),typeof globalThis.document!="undefined"&&typeof globalThis.document.addEventListener=="function"&&globalThis.document.addEventListener("visibilitychange",()=>{globalThis.document.visibilityState==="visible"?(M(Ni),ti()):M(Fi)},!1),Ip(r)}function vh(r){let t=Re?"pointermove":ss?"touchmove":"mousemove";r!==!1?Ti===!1&&(globalThis.document.removeEventListener(t,zn),Ti=!0):Ti===!0&&(globalThis.document.addEventListener(t,zn,{passive:!1}),Ti=!1)}function Hr(){return fi?!!(Pt("fullscreenElement",globalThis.document)||globalThis.document.mozFullScreenElement):!1}function Gp(r){fi&&!Hr()&&(r=r||Ah(),r.requestFullscreen=Pt("requestFullscreen",r)||r.mozRequestFullScreen,r.requestFullscreen())}function jp(){fi&&Hr()&&globalThis.document.exitFullscreen()}function ns(){const r="portrait",t="landscape";let e=globalThis.screen;if(zr===!0){let i=Pt("orientation",e);if(typeof i!="undefined"&&typeof i.type=="string")return i.type;if(typeof i=="string")return i}return typeof globalThis.orientation=="number"?Math.abs(globalThis.orientation)===90?t:r:globalThis.outerWidth>globalThis.outerHeight?t:r}function Hp(r){let t=globalThis.screen;if(typeof t!="undefined"){let e=Pt("lockOrientation",t);if(typeof e!="undefined")return e(r)}return!1}function Yp(){let r=globalThis.screen;if(typeof r!="undefined"){let t=Pt("unlockOrientation",r);if(typeof t!="undefined")return t()}return!1}function Xp(){return ns().includes("portrait")}function Wp(){return ns().includes("landscape")}function Kp(r="local"){switch(r){case"local":return Ja;default:throw new Error("storage type "+r+" not supported")}}function _h(r){let t=Gi(r);return t.parentNode!==null&&(t=t.parentNode),t}function Gi(r){let t=null;return r!=="undefined"&&(typeof r=="string"?t=globalThis.document.getElementById(r):typeof r=="object"&&r.nodeType===Node.ELEMENT_NODE&&(t=r)),t||(t=globalThis.document.body),t}function os(r){return typeof r=="object"&&r!==globalThis.document.body&&typeof r.getBoundingClientRect!="undefined"?r.getBoundingClientRect():(Ne.width=Ne.right=globalThis.innerWidth,Ne.height=Ne.bottom=globalThis.innerHeight,Ne)}function bh(r){return os(_h(r))}function wh(r){let t=!1;try{let e=globalThis.document.createElement("canvas"),i={stencil:!0,failIfMajorPerformanceCaveat:r.failIfMajorPerformanceCaveat};t=!!(globalThis.WebGLRenderingContext&&(e.getContext("webgl",i)||e.getContext("experimental-webgl",i)))}catch(e){t=!1}return t}function ti(){typeof globalThis.focus=="function"&&globalThis.focus()}function qp(){return hh&&!_e&&(DeviceOrientationEvent&&typeof DeviceOrientationEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(r=>{r==="granted"&&(globalThis.addEventListener("devicemotion",Zs,!1),_e=!0)}).catch(console.error):(globalThis.addEventListener("devicemotion",Zs,!1),_e=!0)),_e}function Qp(){_e&&(globalThis.removeEventListener("devicemotion",Zs,!1),_e=!1)}function Jp(){return ah&&!be&&(typeof DeviceOrientationEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(r=>{r==="granted"&&(globalThis.addEventListener("deviceorientation",zi,!1),be=!0)}).catch(console.error):(globalThis.addEventListener("deviceorientation",zi,!1),be=!0)),be}function Zp(){be&&(globalThis.removeEventListener("deviceorientation",zi,!1),be=!1)}function $p(r){typeof globalThis.navigator!="undefined"&&typeof globalThis.navigator.vibrate=="function"&&globalThis.navigator.vibrate(r)}var $s={__proto__:null,get accelerationX(){return dh},get accelerationY(){return ch},get accelerationZ(){return ph},get alpha(){return mh},autoFocus:zp,get beta(){return yh},devicePixelRatio:jr,enableSwipe:vh,exitFullscreen:jp,focus:ti,get gamma(){return gh},getElement:Gi,getElementBounds:os,getParentBounds:bh,getParentElement:_h,getScreenOrientation:ns,getStorage:Kp,hasAccelerometer:hh,hasDeviceOrientation:ah,hasFullscreenSupport:fi,hasHTML5Audio:lh,hasPointerLockSupport:rs,hasWebAudio:Gr,isFullscreen:Hr,isLandscape:Wp,isMobile:Fp,isPortrait:Xp,isWebGLSupported:wh,language:fh,localStorage:Lp,lockOrientation:Hp,maxTouchPoints:oh,nativeBase64:kp,offscreenCanvas:uh,onDeviceRotate:zi,onReady:xh,pauseOnBlur:Np,platform:Ie,pointerEvent:Re,requestFullscreen:Gp,resumeOnFocus:Up,screenOrientation:zr,sound:Dp,stopOnBlur:Vp,touch:Vr,touchEvent:ss,unlockOrientation:Yp,unwatchAccelerometer:Qp,unwatchDeviceOrientation:Zp,vibrate:$p,watchAccelerometer:qp,watchDeviceOrientation:Jp,wheel:Bp};const Th=0,tr=1,Eh=2;let k=null;function tg(r,t,e){if(!xr)throw new Error("me.video.init() called before engine initialization.");try{w.init(r,t,e)}catch(i){return console.log(i.message),!1}return k=w.renderer,globalThis.addEventListener("resize",ki(i=>{M(Dr,i)},100),!1),globalThis.addEventListener("orientationchange",i=>{M(je,i)},!1),globalThis.addEventListener("onmozorientationchange",i=>{M(je,i)},!1),zr===!0&&(globalThis.screen.orientation.onchange=function(i){M(je,i)}),globalThis.addEventListener("scroll",ki(i=>{M(Na,i)},100),!1),M(Br,w.renderer),!0}function ei(r,t,e=!1){let i;if(r===0||t===0)throw new Error("width or height was zero, Canvas could not be initialized !");return uh===!0&&e===!0?(i=new globalThis.OffscreenCanvas(0,0),typeof i.style=="undefined"&&(i.style={})):i=globalThis.document.createElement("canvas"),i.width=r,i.height=t,i}function Ah(){return w.getParentElement()}var ji={__proto__:null,AUTO:Eh,CANVAS:Th,WEBGL:tr,createCanvas:ei,getParent:Ah,init:tg,get renderer(){return k}};let ee={},Yr={},ie={},ii={},as={},Oe={},Sh=function(r,t,e){t=t||r.keyCode||r.button;let i=Oe[t];if(M(Oa,i,t,i?!ie[i]:!0),i){if(!ie[i]){let s=typeof e!="undefined"?e:t;ii[i][s]||(ee[i]++,ii[i][s]=!0)}return as[t]&&typeof r.preventDefault=="function"?r.preventDefault():!0}return!0},Ch=function(r,t,e){t=t||r.keyCode||r.button;let i=Oe[t];if(M(Ba,i,t),i){let s=typeof e!="undefined"?e:t;return ii[i][s]=void 0,ee[i]>0&&ee[i]--,ie[i]=!1,as[t]&&typeof r.preventDefault=="function"?r.preventDefault():!0}return!0},ge=null;const eg={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PRINT_SCREEN:42,INSERT:45,DELETE:46,NUM0:48,NUM1:49,NUM2:50,NUM3:51,NUM4:52,NUM5:53,NUM6:54,NUM7:55,NUM8:56,NUM9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,WINDOW_KEY:91,NUMPAD0:96,NUMPAD1:97,NUMPAD2:98,NUMPAD3:99,NUMPAD4:100,NUMPAD5:101,NUMPAD6:102,NUMPAD7:103,NUMPAD8:104,NUMPAD9:105,MULTIPLY:106,ADD:107,SUBSTRACT:109,DECIMAL:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,TILDE:126,NUM_LOCK:144,SCROLL_LOCK:145,SEMICOLON:186,PLUS:187,COMMA:188,MINUS:189,PERIOD:190,FORWAND_SLASH:191,GRAVE_ACCENT:192,OPEN_BRACKET:219,BACK_SLASH:220,CLOSE_BRACKET:221,SINGLE_QUOTE:222};function Ph(){ge===null&&nh===!1&&(ge=globalThis,typeof ge.addEventListener=="function"&&(ge.addEventListener("keydown",Sh,!1),ge.addEventListener("keyup",Ch,!1)))}function ig(r){return ee[r]&&!ie[r]?(Yr[r]&&(ie[r]=!0),!0):!1}function sg(r){return ee[r]>0}function qt(r,t,e){t===!0?Sh({},r,e):Ch({},r,e)}function rg(r,t,e,i=ls){Oe[r]=t,as[r]=i,ee[t]=0,Yr[t]=e||!1,ie[t]=!1,ii[t]={}}function Xr(r){return Oe[r]}function ng(r){ie[r]=!1}function og(r){let t=Oe[r];ee[t]=0,Yr[t]=!1,ii[t]={},Oe[r]=null,as[r]=null}let ce=new C;class Mh extends ct{constructor(t=0,e=0,i=1,s=1){super(),this.setMinMax(t,e,t+i,e+s),this.LEFT=0,this.MIDDLE=1,this.RIGHT=2,this.event=void 0,this.type=void 0,this.button=0,this.isPrimary=!1,this.pageX=0,this.pageY=0,this.clientX=0,this.clientY=0,this.movementX=0,this.movementY=0,this.deltaMode=0,this.deltaX=0,this.deltaY=0,this.deltaZ=0,this.gameX=0,this.gameY=0,this.gameScreenX=0,this.gameScreenY=0,this.gameWorldX=0,this.gameWorldY=0,this.gameLocalX=0,this.gameLocalY=0,this.pointerId=void 0,this.isNormalized=!1,this.locked=!1,this.bind=[0,0,0]}setEvent(t,e=0,i=0,s=0,n=0,o=1){this.event=t,this.pageX=e,this.pageY=i,this.clientX=s,this.clientY=n,Lh(this.pageX,this.pageY,ce),this.gameScreenX=this.x=ce.x,this.gameScreenY=this.y=ce.y,this.isNormalized=typeof globalThis.PointerEvent!="undefined"&&!(t instanceof globalThis.PointerEvent),this.locked=Yi,this.movementX=t.movementX||0,this.movementY=t.movementY||0,t.type==="wheel"?(this.deltaMode=t.deltaMode||0,this.deltaX=t.deltaX||0,this.deltaY=t.deltaY||0,this.deltaZ=t.deltaZ||0):(this.deltaMode=0,this.deltaX=0,this.deltaY=0,this.deltaZ=0),this.pointerId=o,this.isPrimary=typeof t.isPrimary!="undefined"?t.isPrimary:!0,this.button=t.button||0,this.type=t.type,typeof w.viewport!="undefined"&&w.viewport.localToWorld(this.gameScreenX,this.gameScreenY,ce),this.gameWorldX=ce.x,this.gameWorldY=ce.y,this.isNormalized===!1?(this.width=t.width||1,this.height=t.height||1):typeof t.radiusX=="number"?(this.width=t.radiusX*2||1,this.height=t.radiusY*2||1):this.width=this.height=1}}let Hi=[],Ct=new Map,er,Gn=!1,jn=0,Z=[];const Wr=["wheel"],ft=["pointermove","mousemove","touchmove"],di=["pointerdown","mousedown","touchstart"],kt=["pointerup","mouseup","touchend"],Ft=["pointercancel","mousecancel","touchcancel"],ci=["pointerenter","mouseenter","touchenter"],hs=["pointerover","mouseover","touchover"],pi=["pointerleave","mouseleave","touchleave"],si=[Wr[0],ft[0],di[0],kt[0],Ft[0],ci[0],hs[0],pi[0]],ag=[Wr[0],ft[1],di[1],kt[1],Ft[1],ci[1],hs[1],pi[1]],hg=[ft[2],di[2],kt[2],Ft[2],ci[2],hs[2],pi[2]],Ih={wheel:Wr,pointermove:ft,pointerdown:di,pointerup:kt,pointercancel:Ft,pointerenter:ci,pointerover:hs,pointerleave:pi};let Tt=[];function lg(r,t){for(let e=0;e<r.length;e++)ft.indexOf(r[e])===-1&&Bt.addEventListener(r[e],t,{passive:ls===!1})}function Rh(){if(!Gn){er=new tt(0,0,1,1);for(let t=0;t<oh;t++)Hi.push(new Mh);Bt===null&&(Bt=k.getCanvas()),Re?Z=si:Z=ag,Vr&&!Re&&(Z=Z.concat(hg)),lg(Z,ug),typeof Ue=="undefined"&&(Ue=~~(1e3/z.maxfps)),ti(),Bt.addEventListener(Z[2],()=>{ti()},{passive:ls===!1});let r=Kr(Z,ft);if(Ue<17)for(let t=0;t<r.length;t++)Z.indexOf(r[t])!==-1&&Bt.addEventListener(r[t],Yn,{passive:!0});else for(let t=0;t<r.length;t++)Z.indexOf(r[t])!==-1&&Bt.addEventListener(r[t],ki(Yn,Ue,!1),{passive:!0});kh(Bt),rs&&globalThis.document.addEventListener("pointerlockchange",()=>{Yi=globalThis.document.pointerLockElement===w.getParentElement(),M(Fa,Yi)},!0),Gn=!0}}function Hn(r,t){for(let e=0;e<t.length;e++)if(r.indexOf(t[e])!==-1)return t[e]}function Kr(r,t){let e=[];for(let i=0;i<t.length;i++)r.indexOf(t[i])!==-1&&e.push(t[i]);return e}function pe(r,t,e,i){let s;if(r.callbacks[t]){r.pointerId=i;for(let n=r.callbacks[t].length-1;n>=0&&(s=r.callbacks[t][n]);n--)if(s(e)===!1)return!0}return!1}function Oh(r){let t=!1;for(;r.length>0;){let e=r.pop();if(Hi.push(e),e.isNormalized===!0&&typeof e.event.timeStamp!="undefined"){if(e.event.timeStamp<jn)continue;jn=e.event.timeStamp}er.setShape(e.gameWorldX,e.gameWorldY,e.width,e.height),ft.includes(e.type)&&(e.gameX=e.gameLocalX=e.gameScreenX,e.gameY=e.gameLocalY=e.gameScreenY,M(ka,e));let i=w.world.broadphase.retrieve(er,w.world._sortReverseZ);i=i.concat([w.viewport]);for(let s=i.length,n;s--,n=i[s];){if(Ct.has(n)&&n.isKinematic!==!0){const o=Ct.get(n),h=o.region,f=h.ancestor,u=h.getBounds();let c=!1;if(h.isFloating===!0?(e.gameX=e.gameLocalX=e.gameScreenX,e.gameY=e.gameLocalY=e.gameScreenY):(e.gameX=e.gameLocalX=e.gameWorldX,e.gameY=e.gameLocalY=e.gameWorldY),typeof f!="undefined"){let a=f.getBounds();e.gameLocalX=e.gameX-a.x,e.gameLocalY=e.gameY-a.y}switch(c=u.contains(e.gameX,e.gameY),e.type){case ft[0]:case ft[1]:case ft[2]:case ft[3]:if(o.pointerId===e.pointerId&&!c){if(pe(o,Hn(Z,pi),e,null)){t=!0;break}}else if(o.pointerId===null&&c&&pe(o,Hn(Z,ci),e,e.pointerId)){t=!0;break}if(c&&pe(o,e.type,e,e.pointerId)){t=!0;break}break;case kt[0]:case kt[1]:case kt[2]:case kt[3]:if(o.pointerId===e.pointerId&&c&&pe(o,e.type,e,null)){t=!0;break}break;case Ft[0]:case Ft[1]:case Ft[2]:case Ft[3]:if(o.pointerId===e.pointerId&&pe(o,e.type,e,null)){t=!0;break}break;default:if(c&&pe(o,e.type,e,e.pointerId)){t=!0;break}break}}if(t===!0)break}}return t}function Bh(r){let t;if(ss&&r.changedTouches)for(let e=0,i=r.changedTouches.length;e<i;e++){const s=r.changedTouches[e];t=Hi.pop(),t.setEvent(r,s.pageX,s.pageY,s.clientX,s.clientY,s.identifier),Tt.push(t)}else t=Hi.pop(),t.setEvent(r,r.pageX,r.pageY,r.clientX,r.clientY,r.pointerId),Tt.push(t);return r.isPrimary===!1||(Tt[0].isPrimary=!0,Object.assign(se,Tt[0])),Tt}function Yn(r){Oh(Bh(r))}function ug(r){Bh(r);let t=Tt[0].button;(Oh(Tt)||r.type==="wheel")&&r.preventDefault();let e=se.bind[t];e&&qt(e,di.includes(r.type),t+1)}let Bt=null,se=new Mh(0,0,1,1),Yi=!1,Ue;function fg(){return Tt.length>0}function Dh(){return Ct.size>0}function Lh(r,t,e){e=e||g.pull("Vector2d");let i=os(k.getCanvas()),s=globalThis.devicePixelRatio||1;r-=i.left+(globalThis.pageXOffset||0),t-=i.top+(globalThis.pageYOffset||0);let n=k.scaleRatio;return(n.x!==1||n.y!==1)&&(r/=n.x,t/=n.y),e.set(r*s,t*s)}function kh(r,t){r.style["touch-action"]=t||"none"}function dg(){let r=arguments.length<2?se.LEFT:arguments[0],t=arguments.length<2?arguments[0]:arguments[1];if(Rh(),!Xr(t))throw new Error("no action defined for keycode "+t);se.bind[r]=t}function cg(r){se.bind[typeof r=="undefined"?se.LEFT:r]=null}function ye(r,t,e){if(Rh(),si.indexOf(r)===-1)throw new Error("invalid event type : "+r);if(typeof t=="undefined")throw new Error("registerPointerEvent: region for "+toString(t)+" event is undefined ");let i=Kr(Z,Ih[r]);Ct.has(t)||Ct.set(t,{region:t,callbacks:{},pointerId:null});let s=Ct.get(t);for(let n=0;n<i.length;n++){const o=i[n];s.callbacks[o]?s.callbacks[o].push(e):s.callbacks[o]=[e]}}function Qt(r,t,e){if(si.indexOf(r)===-1)throw new Error("invalid event type : "+r);let i=Kr(Z,Ih[r]),s=Ct.get(t);if(typeof s!="undefined"){for(let n=0;n<i.length;n++){const o=i[n];if(s.callbacks[o]){if(typeof e!="undefined")Ze(s.callbacks[o],e);else for(;s.callbacks[o].length>0;)s.callbacks[o].pop();s.callbacks[o].length===0&&delete s.callbacks[o]}}Object.keys(s.callbacks).length===0&&Ct.delete(t)}}function Fh(r){if(Ct.has(r))for(let t=0;t<si.length;t++)Qt(si[t],r)}function pg(){return rs?(w.getParentElement().requestPointerLock(),!0):!1}function gg(){return rs?(globalThis.document.exitPointerLock(),!0):!1}let ir=.1;function yg(r,t,e){return e===this.GAMEPAD.BUTTONS.L2||e===this.GAMEPAD.BUTTONS.R2?(r+1)/2:r}function Xn(r,t,e){return r>0?e===this.GAMEPAD.BUTTONS.L2?r=Math.max(0,r-2e4)/111070:r=(r-1)/131070:r=(65536+r)/131070+.5,r}const Wn=/^([0-9a-f]{1,4})-([0-9a-f]{1,4})-/i,Kn=/^0+/;function Nh(r,t){const e=r.replace(Wn,(s,n,o)=>"000".slice(n.length-1)+n+"-"+"000".slice(o.length-1)+o+"-"),i=r.replace(Wn,(s,n,o)=>n.replace(Kn,"")+"-"+o.replace(Kn,"")+"-");t.analog=t.analog||t.buttons.map(()=>-1),t.normalize_fn=t.normalize_fn||function(s){return s},sr.set(e,t),sr.set(i,t)}let Zt={},sr=new Map,qn;[["45e-28e-Xbox 360 Wired Controller",{axes:[0,1,3,4],buttons:[11,12,13,14,8,9,-1,-1,5,4,6,7,0,1,2,3,10],analog:[-1,-1,-1,-1,-1,-1,2,5,-1,-1,-1,-1,-1,-1,-1,-1,-1],normalize_fn:yg}],["54c-268-PLAYSTATION(R)3 Controller",{axes:[0,1,2,3],buttons:[14,13,15,12,10,11,8,9,0,3,1,2,4,6,7,5,16]}],["54c-5c4-Wireless Controller",{axes:[0,1,2,3],buttons:[1,0,2,3,4,5,6,7,8,9,10,11,14,15,16,17,12,13]}],["2836-1-OUYA Game Controller",{axes:[0,3,7,9],buttons:[3,6,4,5,7,8,15,16,-1,-1,9,10,11,12,13,14,-1],analog:[-1,-1,-1,-1,-1,-1,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1],normalize_fn:Xn}],["OUYA Game Controller (Vendor: 2836 Product: 0001)",{axes:[0,1,3,4],buttons:[0,3,1,2,4,5,12,13,-1,-1,6,7,8,9,10,11,-1],analog:[-1,-1,-1,-1,-1,-1,2,5,-1,-1,-1,-1,-1,-1,-1,-1,-1],normalize_fn:Xn}]].forEach(r=>{Nh(r[0],r[1])});let mg=function(){let r=navigator.getGamepads();Object.keys(Zt).forEach(t=>{let e=r[t];if(!e)return;let i=null;e.mapping!=="standard"&&(i=sr.get(e.id));let s=Zt[t];Object.keys(s.buttons).forEach(n=>{let o=s.buttons[n],h=n,f=-1;if(i&&(h=i.buttons[n],f=i.analog[n],h<0&&f<0))return;let u=e.buttons[h]||{};if(i&&f>=0){let c=i.normalize_fn(e.axes[f],-1,+n);u={value:c,pressed:u.pressed||Math.abs(c)>=ir}}M(qs,t,"buttons",+n,u),!o.pressed&&u.pressed?qt(o.keyCode,!0,h+256):o.pressed&&!u.pressed&&qt(o.keyCode,!1,h+256),o.value=u.value,o.pressed=u.pressed}),Object.keys(s.axes).forEach(n=>{let o=s.axes[n],h=n;if(i&&(h=i.axes[n],h<0))return;let f=e.axes[h];if(typeof f=="undefined")return;i&&(f=i.normalize_fn(f,+n,-1));let u=Math.sign(f)||1;if(o[u].keyCode===0)return;let c=Math.abs(f)>=ir+Math.abs(o[u].threshold);M(qs,t,"axes",+n,f),!o[u].pressed&&c?(o[-u].pressed&&(qt(o[-u].keyCode,!1,h+256),o[-u].value=0,o[-u].pressed=!1),qt(o[u].keyCode,!0,h+256)):(o[u].pressed||o[-u].pressed)&&!c&&(u=o[u].pressed?u:-u,qt(o[u].keyCode,!1,h+256)),o[u].value=f,o[u].pressed=c})})};globalThis.navigator&&typeof globalThis.navigator.getGamepads=="function"&&(globalThis.addEventListener("gamepadconnected",r=>{M(Da,r.gamepad)},!1),globalThis.addEventListener("gamepaddisconnected",r=>{M(La,r.gamepad)},!1));let xg={AXES:{LX:0,LY:1,RX:2,RY:3,EXTRA_1:4,EXTRA_2:5,EXTRA_3:6,EXTRA_4:7},BUTTONS:{FACE_1:0,FACE_2:1,FACE_3:2,FACE_4:3,L1:4,R1:5,L2:6,R2:7,SELECT:8,BACK:8,START:9,FORWARD:9,L3:10,R3:11,UP:12,DOWN:13,LEFT:14,RIGHT:15,HOME:16,EXTRA_1:17,EXTRA_2:18,EXTRA_3:19,EXTRA_4:20}};function vg(r,t,e){if(!Xr(e))throw new Error("no action defined for keycode "+e);typeof qn=="undefined"&&typeof navigator.getGamepads=="function"&&(qn=O(ts,mg)),Zt[r]||(Zt[r]={axes:{},buttons:{}});let i={keyCode:e,value:0,pressed:!1,threshold:t.threshold},s=Zt[r][t.type];if(t.type==="buttons")s[t.code]=i;else if(t.type==="axes"){let n=Math.sign(t.threshold)||1;s[t.code]||(s[t.code]={});let o=s[t.code];o[n]=i,o[-n]||(o[-n]={keyCode:0,value:0,pressed:!1,threshold:-n})}}function _g(r,t){if(!Zt[r])throw new Error("no bindings for gamepad "+r);Zt[r].buttons[t]={}}function bg(r){ir=r}let wg=Nh,ls=!0;var S={__proto__:null,GAMEPAD:xg,KEY:eg,bindGamepad:vg,bindKey:rg,bindPointer:dg,exitPointerLock:gg,getBindingKey:Xr,globalToLocal:Lh,hasActiveEvents:fg,hasRegisteredEvents:Dh,initKeyboardEvent:Ph,isKeyPressed:ig,get keyBoardEventTarget(){return ge},keyStatus:sg,get locked(){return Yi},pointer:se,get pointerEventTarget(){return Bt},preventDefault:ls,registerPointerEvent:ye,releaseAllPointerEvents:Fh,releasePointerEvent:Qt,requestPointerLock:pg,setGamepadDeadzone:bg,setGamepadMapping:wg,setTouchAction:kh,get throttlingInterval(){return Ue},triggerKeyEvent:qt,unbindGamepad:_g,unbindKey:og,unbindPointer:cg,unlockKey:ng};class N extends tt{constructor(t,e,i,s){super(t,e,i,s),this.pos instanceof St?this.pos.setMuted(t,e,0).setCallback(this.updateBoundsPos,this):this.pos=g.pull("ObservableVector3d",t,e,0,{onUpdate:this.updateBoundsPos,scope:this}),this.anchorPoint instanceof At?this.anchorPoint.setMuted(.5,.5).setCallback(this.onAnchorUpdate,this):this.anchorPoint=g.pull("ObservableVector2d",.5,.5,{onUpdate:this.onAnchorUpdate,scope:this}),typeof this.currentTransform=="undefined"&&(this.currentTransform=g.pull("Matrix2d")),this.currentTransform.identity(),this.body=void 0,this.GUID=void 0,this.onVisibilityChange=void 0,this.alwaysUpdate=!1,this.updateWhenPaused=!1,this.isPersistent=!1,this.floating=!1,this.autoTransform=!0,this.alpha=1,this.ancestor=void 0,this.mask=void 0,this.shader=void 0,this.blendMode="normal",this.name="",this.isRenderable=!0,this.isKinematic=!0,this.isDirty=!0,this._flip={x:!1,y:!1},this._inViewport=!1,this._tint=g.pull("Color",255,255,255,1),this.setOpacity(1)}get isFloating(){return this.floating===!0||typeof this.ancestor!="undefined"&&this.ancestor.isFloating===!0}get tint(){return this._tint}set tint(t){this._tint.copy(t),this.isDirty=!0}get depth(){return this.pos.z}set depth(t){this.pos.z=t,this.isDirty=!0}get inViewport(){return this._inViewport}set inViewport(t){this._inViewport!==t&&(this._inViewport=t,typeof this.onVisibilityChange=="function"&&this.onVisibilityChange.call(this,t))}get isFlippedX(){return this._flip.x===!0}get isFlippedY(){return this._flip.y===!0}getBounds(){return typeof this._bounds=="undefined"&&(super.getBounds(),this.isFinite()?this.updateBounds():this._bounds.setMinMax(this.pos.x,this.pos.y,this.width,this.height)),this._bounds}getOpacity(){return this.alpha}setOpacity(t){typeof t=="number"&&(this.alpha=E(t,0,1),isNaN(this.alpha)&&(this.alpha=1),this.isDirty=!0)}flipX(t=!0){return this._flip.x=!!t,this.isDirty=!0,this}flipY(t=!0){return this._flip.y=!!t,this.isDirty=!0,this}transform(t){return this.currentTransform.multiply(t),this.updateBounds(),this.isDirty=!0,this}angleTo(t){let e=this.getBounds(),i,s;if(t instanceof N){let n=t.getBounds();i=n.centerX-e.centerX,s=n.centerY-e.centerY}else i=t.x-e.centerX,s=t.y-e.centerY;return Math.atan2(s,i)}distanceTo(t){let e=this.getBounds(),i,s;if(t instanceof N){let n=t.getBounds();i=e.centerX-n.centerX,s=e.centerY-n.centerY}else i=e.centerX-t.x,s=e.centerY-t.y;return Math.sqrt(i*i+s*s)}lookAt(t){let e;t instanceof N?e=t.pos:e=t;let i=this.angleTo(e);return this.rotate(i),this}rotate(t,e){return t!==0&&(this.currentTransform.rotate(t,e),this.updateBounds(),this.isDirty=!0),this}scale(t,e=t){return this.currentTransform.scale(t,e),this.updateBounds(),this.isDirty=!0,this}scaleV(t){return this.scale(t.x,t.y),this}update(t){return this.isDirty}updateBounds(t=!0){if(this.isRenderable){let e=this.getBounds();if(e.clear(),this.autoTransform===!0&&!this.currentTransform.isIdentity()?(this.currentTransform.translate(-this.width*this.anchorPoint.x,-this.height*this.anchorPoint.y),e.addFrame(0,0,this.width,this.height,this.currentTransform),this.currentTransform.translate(this.width*this.anchorPoint.x,this.height*this.anchorPoint.y)):(e.addFrame(0,0,this.width,this.height),e.translate(-this.width*this.anchorPoint.x,-this.height*this.anchorPoint.y)),t===!0){let i=this.getAbsolutePosition();e.centerOn(i.x+e.x+e.width/2,i.y+e.y+e.height/2)}return e}else return super.updateBounds(t)}updateBoundsPos(t=this.pos.x,e=this.pos.y){this.getBounds().translate(t-this.pos.x,e-this.pos.y)}getAbsolutePosition(){return typeof this._absPos=="undefined"&&(this._absPos=g.pull("Vector2d")),this._absPos.set(this.pos.x,this.pos.y),typeof this.ancestor!="undefined"&&typeof this.ancestor.getAbsolutePosition=="function"&&this.floating!==!0&&this._absPos.add(this.ancestor.getAbsolutePosition()),this._absPos}onAnchorUpdate(t,e){this.anchorPoint.setMuted(t,e),this.updateBounds(),this.isDirty=!0}preDraw(t){let e=this.width*this.anchorPoint.x,i=this.height*this.anchorPoint.y;if(t.save(),t.setGlobalAlpha(t.globalAlpha()*this.getOpacity()),this._flip.x||this._flip.y){var s=this._flip.x?this.centerX-e:0,n=this._flip.y?this.centerY-i:0;t.translate(s,n),t.scale(this._flip.x?-1:1,this._flip.y?-1:1),t.translate(-s,-n)}typeof this.mask!="undefined"&&(t.translate(this.pos.x,this.pos.y),t.setMask(this.mask),t.translate(-this.pos.x,-this.pos.y)),typeof this.shader=="object"&&typeof t.gl!="undefined"&&(t.customShader=this.shader),this.autoTransform===!0&&!this.currentTransform.isIdentity()&&(t.translate(this.pos.x,this.pos.y),t.transform(this.currentTransform),t.translate(-this.pos.x,-this.pos.y)),t.translate(-e,-i),t.setTint(this.tint,this.getOpacity()),this.blendMode!==t.getBlendMode()&&t.setBlendMode(this.blendMode)}draw(t,e){}postDraw(t){t.clearTint(),typeof this.mask!="undefined"&&t.clearMask(),typeof this.shader=="object"&&typeof t.gl!="undefined"&&(t.customShader=void 0),t.restore(),this.isDirty=!1}onCollision(t,e){return!1}destroy(){g.push(this.currentTransform),this.currentTransform=void 0,g.push(this.anchorPoint),this.anchorPoint=void 0,g.push(this.pos),this.pos=void 0,typeof this._absPos!="undefined"&&(g.push(this._absPos),this._absPos=void 0),g.push(this._bounds),this._bounds=void 0,this.onVisibilityChange=void 0,typeof this.mask!="undefined"&&(g.push(this.mask),this.mask=void 0),typeof this._tint!="undefined"&&(g.push(this._tint),this._tint=void 0),this.ancestor=void 0,typeof this.body!="undefined"&&typeof this.body.destroy=="function"&&(this.body.destroy.apply(this.body,arguments),this.body=void 0),Fh(this),this.onDestroyEvent.apply(this,arguments),typeof this.shader=="object"&&(this.shader.destroy(),this.shader=void 0)}onDestroyEvent(){}}const Qn=Math.min,Jn=Math.max;let at=new C;class Uh extends N{constructor(t,e,i,s){super(t,e,i-t,s-e),this.AXIS={NONE:0,HORIZONTAL:1,VERTICAL:2,BOTH:3},this.bounds=g.pull("Bounds"),this.smoothFollow=!0,this.damping=1,this.near=-1e3,this.far=1e3,this.projectionMatrix=new Bi,this.invCurrentTransform=new Xe,this.offset=new C,this.target=null,this.follow_axis=this.AXIS.NONE,this._shake={intensity:0,duration:0,axis:this.AXIS.BOTH,onComplete:null},this._fadeOut={color:null,tween:null},this._fadeIn={color:null,tween:null},this.name="default",this.setDeadzone(this.width/6,this.height/6),this.anchorPoint.set(0,0),this.isKinematic=!1,this.bounds.setMinMax(t,e,i,s),this._updateProjectionMatrix(),O(ke,this.reset,this),O(li,this.resize,this)}_updateProjectionMatrix(){this.projectionMatrix.ortho(0,this.width,this.height,0,this.near,this.far)}_followH(t){let e=this.pos.x;return t.x-this.pos.x>this.deadzone.right?e=Qn(t.x-this.deadzone.right,this.bounds.width-this.width):t.x-this.pos.x<this.deadzone.pos.x&&(e=Jn(t.x-this.deadzone.pos.x,this.bounds.left)),e}_followV(t){let e=this.pos.y;return t.y-this.pos.y>this.deadzone.bottom?e=Qn(t.y-this.deadzone.bottom,this.bounds.height-this.height):t.y-this.pos.y<this.deadzone.pos.y&&(e=Jn(t.y-this.deadzone.pos.y,this.bounds.top)),e}reset(t=0,e=0){this.pos.x=t,this.pos.y=e,this.unfollow(),this.smoothFollow=!0,this.damping=1,this.currentTransform.identity(),this.invCurrentTransform.identity().invert(),this._updateProjectionMatrix()}setDeadzone(t,e){typeof this.deadzone=="undefined"&&(this.deadzone=new tt(0,0,0,0)),this.deadzone.pos.set(~~((this.width-t)/2),~~((this.height-e)/2-e*.25)),this.deadzone.resize(t,e),this.smoothFollow=!1,this.updateTarget(),this.smoothFollow=!0}resize(t,e){return super.resize(t,e),this.smoothFollow=!1,this.setBounds(0,0,t,e),this.setDeadzone(t/6,e/6),this.update(),this.smoothFollow=!0,this._updateProjectionMatrix(),M(Gt,this.width,this.height,this),this}setBounds(t,e,i,s){this.smoothFollow=!1,this.bounds.setMinMax(t,e,i+t,s+e),this.moveTo(this.pos.x,this.pos.y),this.update(),this.smoothFollow=!0}follow(t,e,i){if(t instanceof N)this.target=t.pos;else if(t instanceof C||t instanceof Et||t instanceof At||t instanceof St)this.target=t;else throw new Error("invalid target for me.Camera2d.follow");this.follow_axis=typeof e=="undefined"?this.AXIS.BOTH:e,this.smoothFollow=!1,typeof i!="number"?this.damping=1:this.damping=E(i,0,1),this.updateTarget(),this.smoothFollow=!0}unfollow(){this.target=null,this.follow_axis=this.AXIS.NONE}move(t,e){this.moveTo(this.pos.x+t,this.pos.y+e)}moveTo(t,e){let i=this.pos.x,s=this.pos.y;this.pos.x=E(t,this.bounds.left,this.bounds.width),this.pos.y=E(e,this.bounds.top,this.bounds.height),(i!==this.pos.x||s!==this.pos.y)&&(this.isDirty=!0)}updateTarget(){if(this.target){switch(at.setV(this.pos),this.follow_axis){case this.AXIS.NONE:break;case this.AXIS.HORIZONTAL:at.x=this._followH(this.target);break;case this.AXIS.VERTICAL:at.y=this._followV(this.target);break;case this.AXIS.BOTH:at.x=this._followH(this.target),at.y=this._followV(this.target);break}if(!this.pos.equals(at)){if(this.smoothFollow===!0&&this.damping<1)if(js(at.x,this.pos.x,2)&&js(at.y,this.pos.y,2)){this.pos.setV(at);return}else this.pos.lerp(at,this.damping);else this.pos.setV(at);this.isDirty=!0}}}update(t){return this.updateTarget(t),this._shake.duration>0&&(this._shake.duration-=t,this._shake.duration<=0?(this._shake.duration=0,this.offset.setZero(),typeof this._shake.onComplete=="function"&&this._shake.onComplete()):((this._shake.axis===this.AXIS.BOTH||this._shake.axis===this.AXIS.HORIZONTAL)&&(this.offset.x=(Math.random()-.5)*this._shake.intensity),(this._shake.axis===this.AXIS.BOTH||this._shake.axis===this.AXIS.VERTICAL)&&(this.offset.y=(Math.random()-.5)*this._shake.intensity)),this.isDirty=!0),this.isDirty===!0&&M(Vi,this.pos),(this._fadeIn.tween!=null||this._fadeOut.tween!=null)&&(this.isDirty=!0),this.currentTransform.isIdentity()?this.invCurrentTransform.identity():this.invCurrentTransform.copy(this.currentTransform).invert(),super.update(t)}shake(t,e,i,s,n){(this._shake.duration===0||n===!0)&&(this._shake.intensity=t,this._shake.duration=e,this._shake.axis=i||this.AXIS.BOTH,this._shake.onComplete=typeof s=="function"?s:void 0)}fadeOut(t,e=1e3,i){this._fadeOut.color=g.pull("Color").copy(t),this._fadeOut.tween=g.pull("Tween",this._fadeOut.color).to({alpha:0},e).onComplete(i||null),this._fadeOut.tween.isPersistent=!0,this._fadeOut.tween.start()}fadeIn(t,e=1e3,i){this._fadeIn.color=g.pull("Color").copy(t);let s=this._fadeIn.color.alpha;this._fadeIn.color.alpha=0,this._fadeIn.tween=g.pull("Tween",this._fadeIn.color).to({alpha:s},e).onComplete(i||null),this._fadeIn.tween.isPersistent=!0,this._fadeIn.tween.start()}focusOn(t){let e=t.getBounds();this.moveTo(t.pos.x+e.left+e.width/2,t.pos.y+e.top+e.height/2)}isVisible(t,e=t.floating){return e===!0||t.floating===!0?k.overlaps(t.getBounds()):t.getBounds().overlaps(this)}localToWorld(t,e,i){return i=i||g.pull("Vector2d"),i.set(t,e).add(this.pos).sub(w.world.pos),this.currentTransform.isIdentity()||this.invCurrentTransform.apply(i),i}worldToLocal(t,e,i){return i=i||g.pull("Vector2d"),i.set(t,e),this.currentTransform.isIdentity()||this.currentTransform.apply(i),i.sub(this.pos).add(w.world.pos)}drawFX(t){this._fadeIn.tween&&(t.save(),t.resetTransform(),t.setColor(this._fadeIn.color),t.fillRect(0,0,this.width,this.height),t.restore(),this._fadeIn.color.alpha===1&&(this._fadeIn.tween=null,g.push(this._fadeIn.color),this._fadeIn.color=null)),this._fadeOut.tween&&(t.save(),t.resetTransform(),t.setColor(this._fadeOut.color),t.fillRect(0,0,this.width,this.height),t.restore(),this._fadeOut.color.alpha===0&&(this._fadeOut.tween=null,g.push(this._fadeOut.color),this._fadeOut.color=null))}draw(t,e){let i=this.pos.x+this.offset.x,s=this.pos.y+this.offset.y;e.currentTransform.translate(-i,-s),t.setProjection(this.projectionMatrix),t.clipRect(0,0,this.width,this.height),this.preDraw(t),e.preDraw(t,this),e.draw(t,this),this.drawFX(t),e.postDraw(t,this),this.postDraw(t),e.currentTransform.translate(i,s)}}let Ms,Tg={cameras:[]};class gi{constructor(t){this.cameras=new Map,this.lights=new Map,this.ambientLight=new st(0,0,0,0),this.settings=Object.assign(Tg,t||{})}reset(){if(this.settings.cameras.forEach(t=>{this.cameras.set(t.name,t)}),this.cameras.has("default")===!1){if(typeof Ms=="undefined"){let t=k.width,e=k.height;Ms=new Uh(0,0,t,e)}this.cameras.set("default",Ms)}M(Or,this),this.onResetEvent.apply(this,arguments)}update(t){let e=!1;return this.cameras.forEach(i=>{i.update(t)===!0&&(e=!0)}),this.lights.forEach(i=>{i.update(t)===!0&&(e=!0)}),e}draw(t,e){this.cameras.forEach(i=>{i.draw(t,e),this.ambientLight.alpha!==0&&(t.save(),this.lights.forEach(s=>{t.setMask(s.getVisibleArea(),!0)}),t.setColor(this.ambientLight),t.fillRect(0,0,i.width,i.height),t.clearMask(),t.restore()),this.lights.forEach(s=>{s.preDraw(t,e),s.draw(t,e),s.postDraw(t,e)})})}destroy(){this.cameras.clear(),this.lights.forEach(t=>{t.destroy()}),this.lights.clear(),this.onDestroyEvent.apply(this,arguments)}onResetEvent(){typeof this.settings.onResetEvent=="function"&&this.settings.onResetEvent.apply(this,arguments)}onDestroyEvent(){typeof this.settings.onDestroyEvent=="function"&&this.settings.onDestroyEvent.apply(this,arguments)}}const Vh=/^.*(\\|\/|\:)/,Eg=/\.[^\.]*$/;function us(r){return r.replace(Vh,"").replace(Eg,"")}function Ag(r){return r.match(Vh)[0]}function qr(r){return r.substring(r.lastIndexOf(".")+1,r.length)}var Sg={__proto__:null,getBasename:us,getExtension:qr,getPath:Ag};let vt={},re={},ne={},oe={};function Cg(r,t,e){return vt[r.name]=new Image,typeof t=="function"&&(vt[r.name].onload=t),typeof e=="function"&&(vt[r.name].onerror=e),vt[r.name].src=r.src+ue,1}function Pg(r,t,e){Fr(r.src)===!0&&(r.src.startsWith("url(")||(r.src="url("+r.src+")"));let i=new FontFace(r.name,r.src);return i.load().then(()=>{globalThis.document.fonts.add(i),globalThis.document.body.style.fontFamily=r.name,typeof t=="function"&&t()},()=>{typeof e=="function"&&e(r.name)}),1}let zh="",rr=0;function Qr(r,t){let e=r.split("."),i=t.split("."),s=Math.min(e.length,i.length),n=0;for(let o=0;o<s&&!(n=+e[o]-+i[o]);o++);return n||e.length-i.length}function Jr(r){let t={};if(typeof r=="undefined")if(typeof globalThis.document!="undefined"){let e=globalThis.document.location;if(e&&e.hash)r=e.hash;else return t}else return t;else{let e=r.indexOf("#");if(e!==-1)r=r.slice(e,r.length);else return t}return r.slice(1).split("&").filter(e=>e!=="").forEach(e=>{let i=e.split("="),s=i.shift(),n=i.join("=");t[s]=n||!0}),t}function Gh(r,t=0){zh=za(r.toString().toUpperCase()),rr=t}function nr(r=1){return rr+=r,zh+"-"+(r||rr)}var or={__proto__:null,agent:Tp,array:Kc,checkVersion:Qr,createGUID:nr,file:Sg,function:Qc,getUriFragment:Jr,resetGUID:Gh,string:sp};class Mg{constructor(t){if(this.TileProperties=[],this.imageCollection=[],this.firstgid=this.lastgid=+t.firstgid,typeof t.source!="undefined"){let n=t.source,o=qr(n);if((o==="tsx"||o==="json")&&(t=rn(us(n)),!t))throw new Error(n+" external TSX/JSON tileset not found")}this.name=t.name,this.tilewidth=+t.tilewidth,this.tileheight=+t.tileheight,this.spacing=+t.spacing||0,this.margin=+t.margin||0,this.tileoffset=new C,this.isAnimated=!1,this.isCollection=!1,this.class=t.class,this.animations=new Map,this._lastUpdate=0;let e=t.tiles;for(let n in e)if(e.hasOwnProperty(n)){if("animation"in e[n]&&(this.isAnimated=!0,this.animations.set(e[+n].animation[0].tileid,{dt:0,idx:0,frames:e[+n].animation,cur:e[+n].animation[0]})),"properties"in e[n])if(Array.isArray(e[n].properties)){let o={};for(let h in e[n].properties)o[e[n].properties[h].name]=e[n].properties[h].value;this.setTileProperty(+e[n].id+this.firstgid,o)}else this.setTileProperty(+n+this.firstgid,e[n].properties);if("image"in e[n]){let o=mt(e[n].image);if(!o)throw new Error("melonJS: '"+e[n].image+"' file for tile '"+(+n+this.firstgid)+"' not found!");this.imageCollection[+n+this.firstgid]=o}}this.isCollection=this.imageCollection.length>0;let i=t.tileoffset;i&&(this.tileoffset.x=+i.x,this.tileoffset.y=+i.y);let s=t.tileproperties;if(s)for(let n in s)s.hasOwnProperty(n)&&this.setTileProperty(+n+this.firstgid,s[n]);if(this.isCollection===!1){if(this.image=mt(t.image),!this.image)throw new Error("melonJS: '"+t.image+"' file for tileset '"+this.name+"' not found!");this.texture=k.cache.get(this.image,{framewidth:this.tilewidth,frameheight:this.tileheight,margin:this.margin,spacing:this.spacing}),this.atlas=this.texture.getAtlas();let n=+t.columns||Math.round(this.image.width/(this.tilewidth+this.spacing)),o=Math.round(this.image.height/(this.tileheight+this.spacing));t.tilecount%n>0&&++o,this.lastgid=this.firstgid+(n*o-1||0),t.tilecount&&this.lastgid-this.firstgid+1!==+t.tilecount&&console.warn("Computed tilecount ("+(this.lastgid-this.firstgid+1)+") does not match expected tilecount ("+t.tilecount+")")}}getTileImage(t){return this.imageCollection[t]}setTileProperty(t,e){this.TileProperties[t]=e}contains(t){return t>=this.firstgid&&t<=this.lastgid}getViewTileId(t){let e=t-this.firstgid;return this.animations.has(e)?this.animations.get(e).cur.tileid:e}getTileProperties(t){return this.TileProperties[t]}update(t){let e=0,i=z.getTime(),s=!1;return this._lastUpdate!==i&&(this._lastUpdate=i,this.animations.forEach(n=>{for(n.dt+=t,e=n.cur.duration;n.dt>=e;)n.dt-=e,n.idx=(n.idx+1)%n.frames.length,n.cur=n.frames[n.idx],e=n.cur.duration,s=!0})),s}drawTile(t,e,i,s){if(s.flipped&&(t.save(),t.translate(e,i),t.transform(s.currentTransform),e=i=0),this.isCollection===!0)t.drawImage(this.imageCollection[s.tileId],0,0,s.width,s.height,e,i,s.width,s.height);else{let n=this.atlas[this.getViewTileId(s.tileId)].offset;t.drawImage(this.image,n.x,n.y,this.tilewidth,this.tileheight,e,i,this.tilewidth+t.uvOffset,this.tileheight+t.uvOffset)}s.flipped&&t.restore()}}const jh=2147483648,Hh=1073741824,Yh=536870912,ar=~(jh|Hh|Yh),Ig="collision";class Rg{constructor(){this.tilesets=[],this.length=0}add(t){this.tilesets.push(t),this.length++}getTilesetByIndex(t){return this.tilesets[t]}getTilesetByGid(t){let e=-1;t&=ar;for(let i=0,s=this.tilesets.length;i<s;i++){if(this.tilesets[i].contains(t))return this.tilesets[i];this.tilesets[i].firstgid===this.tilesets[i].lastgid&&t>=this.tilesets[i].firstgid&&(e=i)}if(e!==-1)return this.tilesets[e];throw new Error("no matching tileset found for gid "+t)}}function Xh(r,t,e){let i;if(typeof e!="string")return e;switch(t){case"int":case"float":e=Number(e);break;case"bool":e=e==="true";break;default:if(!e||Va(e))e=e?e==="true":!0;else if(kr(e))e=Number(e);else if(e.search(/^json:/i)===0){i=e.split(/^json:/i)[1];try{e=JSON.parse(i)}catch(s){throw new Error("Unable to parse JSON: "+i)}}else if(e.search(/^eval:/i)===0){i=e.split(/^eval:/i)[1];try{e=Function("'use strict';return ("+i+")")()}catch(s){throw new Error("Unable to evaluate: "+i)}}else((i=e.match(/^#([\da-fA-F])([\da-fA-F]{3})$/))||(i=e.match(/^#([\da-fA-F]{2})([\da-fA-F]{6})$/)))&&(e="#"+i[2]+i[1]);r.search(/^(ratio|anchorPoint)$/)===0&&typeof e=="number"&&(e={x:e,y:e})}return e}function Og(r,t){if(t.attributes&&t.attributes.length>0)for(let e=0;e<t.attributes.length;e++){const i=t.attributes.item(e);typeof i.name!="undefined"?r[i.name]=i.value:r[i.nodeName]=i.nodeValue}}function Bg(r,t){let e=t.nodeName;switch(e){case"data":{let i=it(t);i.encoding=i.encoding||"xml",typeof i.chunks!="undefined"&&(r.chunks=r.chunks||[],i.chunks.forEach(s=>{r.chunks.push({x:+s.x,y:+s.y,width:+s.width,height:+s.height,data:Xi(s.text,i.encoding,i.compression)})}),r.encoding="none"),typeof i.text!="undefined"&&typeof r.chunks=="undefined"&&(r.data=Xi(i.text,i.encoding,i.compression),r.encoding="none");break}case"chunk":r.chunks=r.chunks||[],r.chunks.push(it(t));break;case"imagelayer":case"layer":case"objectgroup":case"group":{let i=it(t);i.type=e==="layer"?"tilelayer":e,i.image&&(i.image=i.image.source),r.layers=r.layers||[],r.layers.push(i);break}case"animation":r.animation=it(t).frames;break;case"frame":case"object":{const i=e+"s";r[i]=r[i]||[],r[i].push(it(t));break}case"tile":{let i=it(t);i.image&&(i.imagewidth=i.image.width,i.imageheight=i.image.height,i.image=i.image.source),r.tiles=r.tiles||{},r.tiles[i.id]=i;break}case"tileset":{let i=it(t);i.image&&(i.imagewidth=i.image.width,i.imageheight=i.image.height,i.image=i.image.source),r.tilesets=r.tilesets||[],r.tilesets.push(i);break}case"polygon":case"polyline":{r[e]=[];let i=it(t).points.split(" ");for(let s=0;s<i.length;s++){const n=i[s].split(",");r[e].push({x:+n[0],y:+n[1]})}break}case"properties":r.properties=it(t);break;case"property":{const i=it(t),s=typeof i.value!="undefined"?i.value:i.text;r[i.name]=Xh(i.name,i.type||"string",s);break}default:r[e]=it(t);break}}function Dg(r,t){throw new Error("GZIP/ZLIB compressed TMX Tile Map not supported!")}function Lg(r){let t=r.replace(`
`,"").trim().split(","),e=[];for(let i=0;i<t.length;i++)e.push(+t[i]);return e}function kg(r,t=1){let e=globalThis.atob(r.replace(/[^A-Za-z0-9\+\/\=]/g,"")),i=new Uint32Array(e.length/t);for(let s=0,n=e.length/t;s<n;s++){i[s]=0;for(let o=t-1;o>=0;--o)i[s]+=e.charCodeAt(s*t+o)<<(o<<3)}return i}function Xi(r,t,e){switch(e=e||"none",t=t||"none",t){case"csv":return Lg(r);case"base64":return e!=="none"?r=Dg():r=kg(r,4),r;case"none":return r;case"xml":throw new Error("XML encoding is deprecated, use base64 instead");default:throw new Error("Unknown layer encoding: "+t)}}function it(r){let t={},e="";if(r.nodeType===1&&Og(t,r),r.hasChildNodes()){let i=r.childNodes;for(const s of i)switch(s.nodeType){case 1:Bg(t,s);break;case 3:e+=s.nodeValue.trim();break}}return e&&(t.text=e),t}function Be(r,t){let e=t.properties,i=t.propertytypes;if(typeof e!="undefined"){for(let s in e)if(e.hasOwnProperty(s)){let n="string",o=s,h=e[s];typeof e[s].name!="undefined"&&(o=e[s].name),typeof i!="undefined"?n=i[s]:typeof e[s].type!="undefined"&&(n=e[s].type),typeof e[s].value!="undefined"&&(h=e[s].value),r[o]=Xh(o,n,h)}}}class Wh extends ct{constructor(t,e,i,s){let n,o;if(super(),s.isCollection){let h=s.getTileImage(i&ar);n=h.width,o=h.height}else n=s.tilewidth,o=s.tileheight;this.setMinMax(0,0,n,o),this.tileset=s,this.currentTransform=null,this.col=t,this.row=e,this.tileId=i,this.flippedX=(this.tileId&jh)!==0,this.flippedY=(this.tileId&Hh)!==0,this.flippedAD=(this.tileId&Yh)!==0,this.flipped=this.flippedX||this.flippedY||this.flippedAD,this.flipped===!0&&(this.currentTransform===null&&(this.currentTransform=new Xe),this.setTileTransform(this.currentTransform.identity())),this.tileId&=ar}setTileTransform(t){t.translate(this.width/2,this.height/2),this.flippedAD&&(t.rotate(-90*Math.PI/180),t.scale(-1,1)),this.flippedX&&t.scale(this.flippedAD?1:-1,this.flippedAD?-1:1),this.flippedY&&t.scale(this.flippedAD?-1:1,this.flippedAD?1:-1),t.translate(-this.width/2,-this.height/2)}getRenderable(t){let e,i=this.tileset;if(i.animations.has(this.tileId)){let s=[],n=[];i.animations.get(this.tileId).frames.forEach(o=>{n.push(o.tileid),s.push({name:""+o.tileid,delay:o.duration})}),e=i.texture.createAnimationFromName(n,t),e.addAnimation(this.tileId-i.firstgid,s),e.setCurrentAnimation(this.tileId-i.firstgid)}else if(i.isCollection===!0){let s=i.getTileImage(this.tileId);e=new rt(0,0,Object.assign({image:s})),e.anchorPoint.set(0,0),e.scale(t.width/this.width,t.height/this.height),typeof t.rotation!="undefined"&&(e.anchorPoint.set(.5,.5),e.currentTransform.rotate(t.rotation),e.currentTransform.translate(t.width/2,t.height/2),t.rotation=void 0)}else e=i.texture.createSpriteFromName(this.tileId-i.firstgid,t),e.anchorPoint.set(0,0);return this.setTileTransform(e.currentTransform),e}}class Fg{constructor(t,e,i){this.points=void 0,this.name=e.name,this.x=+e.x,this.y=+e.y,this.z=+i,this.width=+e.width||0,this.height=+e.height||0,this.gid=+e.gid||null,this.tintcolor=e.tintcolor,this.type=e.type,this.class=typeof e.class!="undefined"?e.class:e.type,this.text=void 0,this.rotation=Pr(+e.rotation||0),this.id=+e.id||void 0,this.orientation=t.orientation,this.shapes=void 0,this.isEllipse=!1,this.isPoint=!1,this.isPolygon=!1,this.isPolyLine=!1,typeof this.gid=="number"?this.setTile(t.tilesets):typeof e.ellipse!="undefined"?this.isEllipse=!0:typeof e.point!="undefined"?this.isPoint=!0:typeof e.polygon!="undefined"?(this.points=e.polygon,this.isPolygon=!0):typeof e.polyline!="undefined"&&(this.points=e.polyline,this.isPolyLine=!0),typeof e.text!="undefined"?(this.text=e.text,this.text.font=e.text.fontfamily||"sans-serif",this.text.size=e.text.pixelsize||16,this.text.fillStyle=e.text.color||"#000000",this.text.textAlign=e.text.halign||"left",this.text.textBaseline=e.text.valign||"top",this.text.width=this.width,this.text.height=this.height,Be(this.text,e)):(Be(this,e),this.shapes||(this.shapes=this.parseTMXShapes())),t.isEditor||t.getRenderer().adjustPosition(this)}setTile(t){let e=t.getTilesetByGid(this.gid);e.isCollection===!1&&(this.width=this.framewidth=e.tilewidth,this.height=this.frameheight=e.tileheight),this.tile=new Wh(this.x,this.y,this.gid,e)}parseTMXShapes(){let t=[];if(this.isEllipse===!0)t.push(g.pull("Ellipse",this.width/2,this.height/2,this.width,this.height).rotate(this.rotation));else if(this.isPoint===!0)t.push(g.pull("Point",this.x,this.y));else if(this.isPolygon===!0){let e=g.pull("Polygon",0,0,this.points),i=e.isConvex();if(i===!1)throw new Error("collision polygones in Tiled should be defined as Convex");if(i===null)throw new Error("invalid polygone");t.push(e.rotate(this.rotation))}else if(this.isPolyLine===!0){let e=this.points,i,s,n=e.length-1;for(let o=0;o<n;o++)i=g.pull("Vector2d",e[o].x,e[o].y),s=g.pull("Vector2d",e[o+1].x,e[o+1].y),this.rotation!==0&&(i=i.rotate(this.rotation),s=s.rotate(this.rotation)),t.push(g.pull("Line",0,0,[i,s]))}else t.push(g.pull("Polygon",0,0,[g.pull("Vector2d"),g.pull("Vector2d",this.width,0),g.pull("Vector2d",this.width,this.height),g.pull("Vector2d",0,this.height)]).rotate(this.rotation));if(this.orientation==="isometric")for(let e=0;e<t.length;e++)typeof t[e].toIso=="function"&&t[e].toIso();return t}getObjectPropertyByName(t){return this[t]}}class Ng{constructor(){this.points=[],this.arcResolution=5,this.vertices=[],this.startPoint=g.pull("Point"),this.isDirty=!1}beginPath(){this.points.forEach(t=>{g.push(t)}),this.isDirty=!0,this.points.length=0,this.startPoint.set(0,0)}closePath(){let t=this.points;if(t.length>0){let e=t[0];e.equals(t[t.length-1])||this.lineTo(e.x,e.y),this.isDirty=!0}}triangulatePath(){let t=this.vertices;if(this.isDirty){let e=this.points,i=ba(e.flatMap(n=>[n.x,n.y])),s=i.length;for(;t.length<s;)t.push(g.pull("Point"));for(let n=0;n<s;n++){let o=e[i[n]];t[n].set(o.x,o.y)}for(;t.length>s;)g.push(t[t.length-1]),t.length-=1;this.isDirty=!1}return t}moveTo(t,e){this.startPoint.set(t,e),this.isDirty=!0}lineTo(t,e){let i=this.points,s=this.startPoint,n=i.length===0?s:i[i.length-1];s.equals(n)?i.push(g.pull("Point",n.x,n.y)):i.push(g.pull("Point",s.x,s.y)),i.push(g.pull("Point",t,e)),s.x=t,s.y=e,this.isDirty=!0}arc(t,e,i,s,n,o=!1){if(s===n)return;const h=o?Math.abs(s-n)>=G:Math.abs(n-s)>=G;s=s%G,n=n%G,s<0&&(s+=G),n<0&&(n+=G),s>=n&&(n+=G);let f=n-s,u=1;o&&(u=-1,f=G-f),h&&(f=G);const a=f*i/this.arcResolution,d=f/a*u;this.moveTo(t+i*Math.cos(s),e+i*Math.sin(s));let p=s;for(let m=0;m<a;m++)this.lineTo(t+i*Math.cos(p),e+i*Math.sin(p)),p+=d;this.lineTo(t+i*Math.cos(n),e+i*Math.sin(n)),this.isDirty=!0}arcTo(t,e,i,s,n){let o=this.points,h=o[o.length-1].x,f=o[o.length-1].y,u=h-t,c=f-e,a=i-t,l=s-e,d=Math.sqrt(Math.pow(u,2)+Math.pow(c,2)),p=Math.sqrt(Math.pow(a,2)+Math.pow(l,2));u/=d,c/=d,a/=p,l/=p;let m=Math.atan2(c,u)-Math.atan2(l,a),x=Math.tan(m/2),y=n/x,_=t+u*y,v=e+c*y,b=t+a*y,T=e+l*y;this.moveTo(_,v);let A=(u+a)/2,P=(c+l)/2,V=Math.sqrt(Math.pow(A,2)+Math.pow(P,2));A/=V,P/=V;let I=Math.sqrt(Math.pow(n,2)+Math.pow(y,2)),j=t+I*A,H=e+I*P,q=Math.atan2(v-H,_-j),K=Math.atan2(T-H,b-j);this.arc(j,H,n,q,K)}ellipse(t,e,i,s,n,o,h,f=!1){if(o===h)return;let u=f?Math.abs(o-h)>=G:Math.abs(h-o)>=G;o=o%G,h=h%G,o<0&&(o+=G),h<0&&(h+=G),o>=h&&(h+=G);let c=h-o,a=1;f&&(a=-1,c=G-c),u&&(c=G);const d=(c*i+c*s)/2/this.arcResolution,m=c/d*a;let x=o;const y=Math.cos(n),_=Math.sin(n);this.moveTo(t+i*Math.cos(o),e+s*Math.sin(o));for(let v=0;v<d;v++){const b=i*Math.cos(x),T=s*Math.sin(x),A=t+b*y-T*_,P=e+b*_+T*y;this.lineTo(A,P),x+=m}this.lineTo(t+i*Math.cos(o),e+s*Math.sin(o)),this.isDirty=!0}rect(t,e,i,s){this.moveTo(t,e),this.lineTo(t+i,e),this.moveTo(t+i,e),this.lineTo(t+i,e+s),this.moveTo(t+i,e+s),this.lineTo(t,e+s),this.moveTo(t,e+s),this.lineTo(t,e),this.isDirty=!0}roundRect(t,e,i,s,n){this.moveTo(t+n,e),this.lineTo(t+i-n,e),this.arcTo(t+i,e,t+i,e+n,n),this.moveTo(t+i,e+n),this.lineTo(t+i,e+s-n),this.arcTo(t+i,e+s,t+i-n,e+s,n),this.moveTo(t+i-n,e+s),this.lineTo(t+n,e+s),this.arcTo(t,e+s,t,e+s-n,n),this.moveTo(t,e+s-n),this.lineTo(t,e+n),this.arcTo(t,e,t+n,e,n),this.isDirty=!0}}class fe{constructor(t){this.settings=t,this.designRatio=this.settings.width/this.settings.height,this.scaleRatio=new C(this.settings.scale,this.settings.scale),this.isContextValid=!0,this.depthTest="sorting",this.path2D=new Ng,this.type="Generic",this.currentScissor=new Int32Array([0,0,this.settings.width,this.settings.height]),this.maskLevel=0,this.currentBlendMode="none",Ie.ejecta===!0?this.canvas=globalThis.document.getElementById("canvas"):typeof globalThis.canvas!="undefined"?this.canvas=globalThis.canvas:typeof this.settings.canvas!="undefined"?this.canvas=this.settings.canvas:this.canvas=ei(this.settings.width,this.settings.height),this.currentColor=new st(0,0,0,1),this.currentTint=new st(255,255,255,1),this.projectionMatrix=new Bi,this.uvOffset=0}get height(){return this.getCanvas().height}set height(t){this.resize(this.width,t)}get width(){return this.getCanvas().width}set width(t){this.resize(t,this.height)}clear(){}flush(){}reset(){this.resetTransform(),this.setBlendMode(this.settings.blendMode),this.setColor("#000000"),this.clearTint(),this.cache.clear(),this.currentScissor[0]=0,this.currentScissor[1]=0,this.currentScissor[2]=this.width,this.currentScissor[3]=this.height,this.clearMask()}getCanvas(){return this.canvas}getContext(){return this.context}getBlendMode(){return this.currentBlendMode}getContext2d(t,e){if(typeof t=="undefined"||t===null)throw new Error("You must pass a canvas element in order to create a 2d context");if(typeof t.getContext=="undefined")throw new Error("Your browser does not support HTML5 canvas.");typeof e!="boolean"&&(e=!0);let i=t.getContext("2d",{alpha:e});return i.canvas||(i.canvas=t),this.setAntiAlias(i,this.settings.antiAlias),i}getColor(){return this.currentColor}globalAlpha(){return this.currentColor.glArray[3]}overlaps(t){return t.left<=this.width&&t.right>=0&&t.top<=this.height&&t.bottom>=0}resize(t,e){let i=this.getCanvas();(t!==i.width||e!==i.height)&&(i.width=t,i.height=e,this.currentScissor[0]=0,this.currentScissor[1]=0,this.currentScissor[2]=t,this.currentScissor[3]=e,M(li,t,e))}setAntiAlias(t,e){let i=t.canvas;Ur("imageSmoothingEnabled",e===!0,t),e!==!0?(i.style["image-rendering"]="optimizeSpeed",i.style["image-rendering"]="-moz-crisp-edges",i.style["image-rendering"]="-o-crisp-edges",i.style["image-rendering"]="-webkit-optimize-contrast",i.style["image-rendering"]="optimize-contrast",i.style["image-rendering"]="crisp-edges",i.style["image-rendering"]="pixelated",i.style.msInterpolationMode="nearest-neighbor"):i.style["image-rendering"]="auto"}setProjection(t){this.projectionMatrix.copy(t)}stroke(t,e){switch(t.type){case"RoundRect":this.strokeRoundRect(t.left,t.top,t.width,t.height,t.radius,e);break;case"Rectangle":case"Bounds":this.strokeRect(t.left,t.top,t.width,t.height,e);break;case"Polygon":case"Line":this.strokePolygon(t,e);break;case"Ellipse":this.strokeEllipse(t.pos.x,t.pos.y,t.radiusV.x,t.radiusV.y,e);break;case"Point":this.strokePoint(t.x,t.y);break;default:throw new Error("Invalid geometry for fill/stroke")}}fill(t){this.stroke(t,!0)}tint(t,e,i){let s=ei(t.width,t.height,!0),n=this.getContext2d(s);return n.save(),n.fillStyle=e instanceof st?e.toRGB():e,n.fillRect(0,0,t.width,t.height),n.globalCompositeOperation=i||"multiply",n.drawImage(t,0,0),n.globalCompositeOperation="destination-atop",n.drawImage(t,0,0),n.restore(),s}setMask(t,e=!1){}clearMask(){}setTint(t,e=t.alpha){this.currentTint.copy(t),this.currentTint.alpha*=e}clearTint(){this.currentTint.setFloat(1,1,1,1)}toBlob(t){return new Promise(e=>{Ee(Ge,()=>{this.canvas.toBlob(i=>{e(i)},t?t.type:void 0,t?t.quality:void 0)})})}toImageBitmap(t){return new Promise(e=>{Ee(Ge,()=>{let i=new Image;i.src=this.canvas.toDataURL(t),i.onload=()=>{createImageBitmap(i).then(s=>e(s))}})})}toDataURL(t){return new Promise(e=>{Ee(Ge,()=>{e(this.canvas.toDataURL(t))})})}}function Kh(r,t,e="default",i="no-repeat"){return{meta:{app:"melonJS",size:{w:r,h:t},repeat:i,image:"default"},frames:[{filename:e,frame:{x:0,y:0,w:r,h:t}}]}}class lt{constructor(t,e,i){if(this.format=null,this.sources=new Map,this.atlases=new Map,typeof t!="undefined"){t=Array.isArray(t)?t:[t];for(let s in t){let n=t[s];if(typeof n.meta!="undefined"){if(n.meta.app.includes("texturepacker")||n.meta.app.includes("free-tex-packer")){if(this.format="texturepacker",typeof e=="undefined"){let o=mt(n.meta.image);if(!o)throw new Error("Atlas texture '"+o+"' not found");this.sources.set(n.meta.image,o)}else this.sources.set(n.meta.image||"default",typeof e=="string"?mt(e):e);this.repeat="no-repeat"}else if(n.meta.app.includes("ShoeBox")){if(!n.meta.exporter||!n.meta.exporter.includes("melonJS"))throw new Error("ShoeBox requires the JSON exporter : https://github.com/melonjs/melonJS/tree/master/media/shoebox_JSON_export.sbx");this.format="ShoeBox",this.repeat="no-repeat",this.sources.set("default",typeof e=="string"?mt(e):e)}else n.meta.app.includes("melonJS")&&(this.format="melonJS",this.repeat=n.meta.repeat||"no-repeat",this.sources.set("default",typeof e=="string"?mt(e):e));this.atlases.set(n.meta.image||"default",this.parse(n))}else typeof n.framewidth!="undefined"&&typeof n.frameheight!="undefined"&&(this.format="Spritesheet (fixed cell size)",this.repeat="no-repeat",typeof e!="undefined"&&(n.image=typeof e=="string"?mt(e):e),this.atlases.set("default",this.parseFromSpriteSheet(n)),this.sources.set("default",n.image))}}if(this.atlases.length===0)throw new Error("texture atlas format not supported");i!==!1&&this.sources.forEach(s=>{k.cache.set(s,this)})}parse(t){let e={};return t.frames.forEach(i=>{if(i.hasOwnProperty("filename")){let s=i.frame,n,o,h=i.spriteSourceSize&&i.sourceSize&&i.pivot;h&&(n=i.sourceSize.w*i.pivot.x-(i.trimmed?i.spriteSourceSize.x:0),o=i.sourceSize.h*i.pivot.y-(i.trimmed?i.spriteSourceSize.y:0)),e[i.filename]={name:i.filename,texture:t.meta.image||"default",offset:new C(s.x,s.y),anchorPoint:h?new C(n/s.w,o/s.h):null,trimmed:!!i.trimmed,width:s.w,height:s.h,angle:i.rotated===!0?-ga:0},this.addUVs(e,i.filename,t.meta.size.w,t.meta.size.h)}}),e}parseFromSpriteSheet(t){let e={},i=t.image,s=t.spacing||0,n=t.margin||0,o=i.width,h=i.height,f=g.pull("Vector2d",~~((o-n+s)/(t.framewidth+s)),~~((h-n+s)/(t.frameheight+s)));if(o%(t.framewidth+s)!==0||h%(t.frameheight+s)!==0){let u=f.x*(t.framewidth+s),c=f.y*(t.frameheight+s);u-o!==s&&c-h!==s&&(o=u,h=c,console.warn("Spritesheet Texture for image: "+i.src+" is not divisible by "+(t.framewidth+s)+"x"+(t.frameheight+s)+", truncating effective size to "+o+"x"+h))}for(let u=0,c=f.x*f.y;u<c;u++){let a=""+u;e[a]={name:a,texture:"default",offset:new C(n+(s+t.framewidth)*(u%f.x),n+(s+t.frameheight)*~~(u/f.x)),anchorPoint:t.anchorPoint||null,trimmed:!1,width:t.framewidth,height:t.frameheight,angle:0},this.addUVs(e,a,o,h)}return g.push(f),e}getAtlas(t){return typeof t=="string"?this.atlases.get(t):this.atlases.values().next().value}getFormat(){return this.format}getTexture(t){return typeof t=="object"&&typeof t.texture=="string"?this.sources.get(t.texture):this.sources.values().next().value}addRegion(t,e,i,s,n){k.settings.verbose===!0&&console.warn("Adding texture region",t,"for texture",this);let o=this.getTexture(),h=this.getAtlas(),f=o.width,u=o.height;return h[t]={name:t,offset:new C(e,i),width:s,height:n,angle:0},this.addUVs(h,t,f,u),h[t]}getRegion(t,e){let i;if(typeof e=="string")i=this.getAtlas(e)[t];else for(let s of this.atlases.values())if(typeof s[t]!="undefined"){i=s[t];break}return i}getUVs(t){let e=this.getRegion(t);if(typeof e=="undefined"){let i=t.split(","),s=+i[0],n=+i[1],o=+i[2],h=+i[3];e=this.addRegion(t,s,n,o,h)}return e.uvs}addUVs(t,e,i,s){if(typeof k.gl!="undefined"){let n=t[e].offset,o=t[e].width,h=t[e].height;t[e].uvs=new Float32Array([n.x/i,n.y/s,(n.x+o)/i,(n.y+h)/s]);let f=n.x+","+n.y+","+i+","+s;t[f]=t[e]}return t[e].uvs}createSpriteFromName(t,e,i=!1){return g.pull(i===!0?"me.NineSliceSprite":"me.Sprite",0,0,Object.assign({image:this,region:t},e||{}))}createAnimationFromName(t,e){let i=[],s={},n=0,o=0,h;for(let f=0;f<t.length;++f){if(h=this.getRegion(t[f]),h==null)throw new Error("Texture - region for "+t[f]+" not found");i[f]=h,s[t[f]]=f,n=Math.max(h.width,n),o=Math.max(h.height,o)}return new rt(0,0,Object.assign({image:this,framewidth:n,frameheight:o,margin:0,spacing:0,atlas:i,atlasIndices:s},e||{}))}}class Zr{constructor(t,e){if(this.size_=0,this.map=new Map,this.operator=t,e)for(const[i,s]of e)this.put(i,s);return this}get size(){return this.size_}get(t){const e=this.map.get(t);return e?this.operator.clone(e):this.operator.create()}put(t,e){let i=this.map.get(t);return i||(i=this.operator.create()),this.operator.add(e,i)?(this.map.set(t,i),this.size_++,!0):!1}putAll(t,e){let i=0;if(e){const s=t,n=e;for(const o of n)this.put(s,o),i++}else if(t instanceof Zr)for(const[s,n]of t.entries())this.put(s,n),i++;else throw new TypeError("unexpected arguments");return i>0}has(t){return this.map.has(t)}hasEntry(t,e){return this.operator.has(e,this.get(t))}delete(t){return this.size_-=this.operator.size(this.get(t)),this.map.delete(t)}deleteEntry(t,e){const i=this.get(t);return this.operator.delete(e,i)?(this.map.set(t,i),this.size_--,!0):!1}clear(){this.map.clear(),this.size_=0}keys(){return this.map.keys()}entries(){const t=this;function*e(){for(const[i,s]of t.map.entries())for(const n of s)yield[i,n]}return e()}values(){const t=this;function*e(){for(const[,i]of t.entries())yield i}return e()}forEach(t,e){for(const[i,s]of this.entries())t.call(e===void 0?this:e,s,i,this)}[Symbol.iterator](){return this.entries()}asMap(){const t=new Map;for(const e of this.keys())t.set(e,this.operator.clone(this.get(e)));return t}}class Ug extends Zr{constructor(t){super(new Vg,t)}get[Symbol.toStringTag](){return"ArrayMultimap"}}class Vg{create(){return[]}clone(t){return t.slice()}add(t,e){return e.push(t),!0}size(t){return t.length}delete(t,e){const i=e.indexOf(t);return i>-1?(e.splice(i,1),!0):!1}has(t,e){return e.includes(t)}}class qh{constructor(t=1/0){this.cache=new Ug,this.tinted=new Map,this.units=new Map,this.usedUnits=new Set,this.max_size=t,this.clear()}clear(){this.cache.clear(),this.tinted.clear(),this.units.clear(),this.usedUnits.clear()}allocateTextureUnit(){for(let t=0;t<this.max_size;t++)if(!this.usedUnits.has(t))return this.usedUnits.add(t),t;throw new Error("Texture cache overflow: "+this.max_size+" texture units available for this GPU.")}freeTextureUnit(t){let e=this.units.get(t);typeof e!="undefined"&&(this.usedUnits.delete(e),this.units.delete(t))}get(t,e){let i;return typeof e=="undefined"?i=this.cache.get(t)[0]:this.cache.forEach((s,n)=>{let o=s.getAtlas()[0];n===t&&o.width===e.framewidth&&o.height===e.frameheight&&(i=s)}),typeof i=="undefined"&&(e||(e=Kh(t.width,t.height,t.src?us(t.src):void 0)),i=new lt(e,t,!1),this.set(t,i)),i}delete(t){if(this.cache.has(t)){let e=this.cache.get(t)[0];typeof e!="undefined"&&this.freeTextureUnit(e),this.cache.delete(t)}}tint(t,e){let i=this.tinted.get(t);return i===void 0&&(i=this.tinted.set(t,new Map)),i.has(e)||i.set(e,k.tint(t,e,"multiply")),i.get(e)}set(t,e){let i=t.width,s=t.height;if(k.WebGLVersion===1&&(!$t(i)||!$t(s))){let n=typeof t.src!="undefined"?t.src:t;console.warn("[Texture] "+n+" is not a POT texture ("+i+"x"+s+")")}return this.cache.put(t,e)}getUnit(t){return this.units.has(t)||this.units.set(t,this.allocateTextureUnit()),this.units.get(t)}}class $r extends fe{constructor(t){super(t),this.context=this.getContext2d(this.getCanvas(),this.settings.transparent),this.setBlendMode(this.settings.blendMode),this.setColor(this.currentColor),this.cache=new qh,this.settings.textureSeamFix!==!1&&!this.settings.antiAlias&&(this.uvOffset=1),this.type="CANVAS",this.getCanvas().addEventListener("contextlost",e=>{e.preventDefault(),this.isContextValid=!1,M(is,this)},!1),this.getCanvas().addEventListener("contextrestored",()=>{this.isContextValid=!0,M($e,this)},!1),O(ke,()=>{this.reset()})}reset(){super.reset(),this.clearColor(this.currentColor,this.settings.transparent!==!0)}resetTransform(){this.getContext().setTransform(1,0,0,1,0,0)}setBlendMode(t="normal",e){switch(e=e||this.getContext(),this.currentBlendMode=t,t){case"screen":e.globalCompositeOperation="screen";break;case"lighter":case"additive":e.globalCompositeOperation="lighter";break;case"multiply":e.globalCompositeOperation="multiply";break;default:e.globalCompositeOperation="source-over",this.currentBlendMode="normal";break}}clear(){if(this.settings.transparent===!1){let t=this.getCanvas();this.getContext().clearRect(0,0,t.width,t.height)}}clearColor(t="#000000",e=!1){let i=this.getCanvas(),s=this.getContext();this.save(),this.resetTransform(),s.globalAlpha=1,s.globalCompositeOperation=e===!0?"copy":"source-over",s.fillStyle=t instanceof st?t.toRGBA():t,this.fillRect(0,0,i.width,i.height),this.restore()}clearRect(t,e,i,s){this.getContext().clearRect(t,e,i,s)}createPattern(t,e){return this.getContext().createPattern(t,e)}drawImage(t,e,i,s,n,o,h,f,u){if(this.getGlobalAlpha()<1/255)return;let c=this.getContext();typeof s=="undefined"?(s=f=t.width,n=u=t.height,o=e,h=i,e=0,i=0):typeof o=="undefined"&&(o=e,h=i,f=s,u=n,s=t.width,n=t.height,e=0,i=0),this.settings.subPixel===!1&&(o=~~o,h=~~h);let a=t,l=this.currentTint.toArray();(l[0]!==1||l[1]!==1||l[2]!==1)&&(a=this.cache.tint(t,this.currentTint.toRGB())),c.drawImage(a,e,i,s,n,o,h,f,u)}drawPattern(t,e,i,s,n){if(this.getGlobalAlpha()<1/255)return;let o=this.getContext(),h=o.fillStyle;o.fillStyle=t,o.fillRect(e,i,s,n),o.fillStyle=h}beginPath(){this.getContext().beginPath()}moveTo(t,e){this.getContext().moveTo(t,e)}lineTo(t,e){this.getContext().lineTo(t,e)}rect(t,e,i,s){this.getContext().rect(t,e,i,s)}roundRect(t,e,i,s,n){this.getContext().roundRect(t,e,i,s,n)}stroke(t,e){typeof t=="undefined"?e===!0?this.getContext().fill():this.getContext().stroke():super.stroke(t,e)}fill(t){this.stroke(t,!0)}closePath(){this.getContext().closePath()}strokeArc(t,e,i,s,n,o,h=!1){if(this.getGlobalAlpha()<1/255)return;let f=this.getContext();f.translate(t,e),f.beginPath(),f.arc(0,0,i,s,n,o||!1),f[h===!0?"fill":"stroke"](),f.translate(-t,-e)}fillArc(t,e,i,s,n,o){this.strokeArc(t,e,i,s,n,o||!1,!0)}strokeEllipse(t,e,i,s,n=!1){if(this.getGlobalAlpha()<1/255)return;let o=this.getContext(),h=i,f=s,u=t-h,c=t+h,a=e-f,l=e+f,d=h*.551784,p=f*.551784,m=t-d,x=t+d,y=e-p,_=e+p;o.beginPath(),o.moveTo(t,a),o.bezierCurveTo(x,a,c,y,c,e),o.bezierCurveTo(c,_,x,l,t,l),o.bezierCurveTo(m,l,u,_,u,e),o.bezierCurveTo(u,y,m,a,t,a),o[n===!0?"fill":"stroke"](),o.closePath()}fillEllipse(t,e,i,s){this.strokeEllipse(t,e,i,s,!0)}strokeLine(t,e,i,s){if(this.getGlobalAlpha()<1/255)return;let n=this.getContext();n.beginPath(),n.moveTo(t,e),n.lineTo(i,s),n.stroke()}fillLine(t,e,i,s){this.strokeLine(t,e,i,s)}strokePolygon(t,e=!1){if(this.getGlobalAlpha()<1/255)return;let i=this.getContext(),s=t.points,n=s.length,o=s[0];this.translate(t.pos.x,t.pos.y),i.beginPath(),i.moveTo(o.x,o.y);for(let h=1;h<n;h++){const f=s[h];i.lineTo(f.x,f.y)}i.lineTo(o.x,o.y),i[e===!0?"fill":"stroke"](),i.closePath(),this.translate(-t.pos.x,-t.pos.y)}fillPolygon(t){this.strokePolygon(t,!0)}strokeRect(t,e,i,s,n=!1){if(this.getGlobalAlpha()<1/255)return;this.getContext()[n===!0?"fillRect":"strokeRect"](t,e,i,s)}fillRect(t,e,i,s){this.strokeRect(t,e,i,s,!0)}strokeRoundRect(t,e,i,s,n,o=!1){if(this.getGlobalAlpha()<1/255)return;let h=this.getContext();h.beginPath(),h.roundRect(t,e,i,s,n),h[o===!0?"fill":"stroke"]()}fillRoundRect(t,e,i,s,n){this.strokeRoundRect(t,e,i,s,n,!0)}strokePoint(t,e){this.strokeLine(t,e,t+1,e+1)}fillPoint(t,e){this.strokePoint(t,e)}restore(){this.getContext().restore(),this.currentColor.glArray[3]=this.getGlobalAlpha(),this.currentScissor[0]=0,this.currentScissor[1]=0,this.currentScissor[2]=this.getCanvas().width,this.currentScissor[3]=this.getCanvas().height}save(){this.getContext().save()}rotate(t){this.getContext().rotate(t)}scale(t,e){this.getContext().scale(t,e)}setColor(t){let e=this.currentColor,i=this.getContext();e.copy(t),i.strokeStyle=i.fillStyle=e.toRGBA()}setGlobalAlpha(t){this.getContext().globalAlpha=t}getGlobalAlpha(){return this.getContext().globalAlpha}setLineWidth(t){this.getContext().lineWidth=t}setTransform(t,e,i,s,n,o){this.resetTransform(),this.transform(t,e,i,s,n,o)}transform(t,e,i,s,n,o){if(typeof t=="object"){let h=t.toArray();t=h[0],e=h[1],i=h[3],s=h[4],n=h[6],o=h[7]}this.settings.subPixel===!1&&(n|=0,o|=0),this.getContext().transform(t,e,i,s,n,o)}translate(t,e){this.settings.subPixel===!1?this.getContext().translate(~~t,~~e):this.getContext().translate(t,e)}clipRect(t,e,i,s){let n=this.getCanvas();if(t!==0||e!==0||i!==n.width||s!==n.height){let o=this.currentScissor;if(o[0]!==t||o[1]!==e||o[2]!==i||o[3]!==s){let h=this.getContext();h.beginPath(),h.rect(t,e,i,s),h.clip(),o[0]=t,o[1]=e,o[2]=i,o[3]=s}}}setMask(t,e=!1){let i=this.getContext();if(this.maskLevel===0&&(i.save(),typeof t!="undefined"&&i.beginPath()),typeof t!="undefined")switch(t.type){case"RoundRect":i.roundRect(t.top,t.left,t.width,t.height,t.radius);break;case"Rectangle":case"Bounds":i.rect(t.top,t.left,t.width,t.height);break;case"Polygon":{const s=t.pos.x,n=t.pos.y;i.moveTo(s+t.points[0].x,n+t.points[0].y);for(let o=1;o<t.points.length;o++){const h=t.points[o];i.lineTo(s+h.x,n+h.y)}}break;case"Ellipse":{const s=t.pos.x,n=t.pos.y,o=t.radiusV.x,h=t.radiusV.y,f=s-o,u=s+o,c=n-h,a=n+h;let l=o*.551784,d=h*.551784,p=s-l,m=s+l,x=n-d,y=n+d;i.moveTo(s,c),i.bezierCurveTo(m,c,u,x,u,n),i.bezierCurveTo(u,y,m,a,s,a),i.bezierCurveTo(p,a,f,y,f,n),i.bezierCurveTo(f,x,p,c,s,c)}break;default:throw new Error("Invalid geometry for setMask")}this.maskLevel++,e===!0?(i.closePath(),i.globalCompositeOperation="destination-atop",i.fill()):i.clip()}clearMask(){this.maskLevel>0&&(this.maskLevel=0,this.getContext().restore())}}function zg(r,t){let e=new Array(t);for(let i=0;i<t;i++){e[i]=new Array(r);for(let s=0;s<r;s++)e[i][s]=null}return e}function Zn(r,t,e){let i=0,s,n;typeof t.rows=="undefined"?(s=t.width,n=t.height):(s=t.cols,n=t.rows);for(let o=0;o<n;o++)for(let h=0;h<s;h++){const f=e[i++];f!==0&&(r.layerData[h+t.x][o+t.y]=r.getTileById(f,h+t.x,o+t.y))}}class Fe extends N{constructor(t,e,i,s,n,o,h){super(0,0,0,0),this.tilewidth=e.tilewidth||i,this.tileheight=e.tileheight||s,this.orientation=n,this.x=0,this.y=0,this.tilesets=o,this.tileset=this.tilesets?this.tilesets.getTilesetByIndex(0):null,this.maxTileSize={width:0,height:0};for(let u=0;u<this.tilesets.length;u++){const c=this.tilesets.getTilesetByIndex(u);this.maxTileSize.width=Math.max(this.maxTileSize.width,c.tilewidth),this.maxTileSize.height=Math.max(this.maxTileSize.height,c.tileheight)}this.animatedTilesets=[],this.isAnimated=!1,this.renderorder=e.renderorder||"right-down",this.class=e.class,this.pos.z=h,this.anchorPoint.set(0,0),this.name=e.name,this.cols=+e.width,this.rows=+e.height;let f=typeof e.visible!="undefined"?+e.visible:1;this.setOpacity(f?+e.opacity:0),typeof e.tintcolor=="string"&&this.tint.parseHex(e.tintcolor,!0),this.orientation==="isometric"?(this.width=(this.cols+this.rows)*(this.tilewidth/2),this.height=(this.cols+this.rows)*(this.tileheight/2)):(this.width=this.cols*this.tilewidth,this.height=this.rows*this.tileheight),Be(this,e),this.setRenderer(t.getRenderer()),this.layerData=zg(this.rows,this.cols),t.infinite===0?Zn(this,this,Xi(e.data,e.encoding,e.compression)):t.infinite===1&&e.chunks.forEach(u=>{Zn(this,u,Xi(u.data,e.encoding,e.compression))})}onActivateEvent(){if(this.animatedTilesets===void 0&&(this.animatedTilesets=[]),this.tilesets){let t=this.tilesets.tilesets;for(let e=0;e<t.length;e++)t[e].isAnimated&&this.animatedTilesets.push(t[e])}this.isAnimated=this.animatedTilesets.length>0,typeof this.preRender=="undefined"&&this.isAnimated===!1?this.preRender=this.ancestor.getRootAncestor().preRender:this.preRender=!1,this.preRender===!0&&!this.canvasRenderer&&(this.canvasRenderer=new $r({canvas:ei(this.width,this.height),width:this.width,heigth:this.height,transparent:!0}),this.getRenderer().drawTileLayer(this.canvasRenderer,this,this)),this.isDirty=!0}onDeactivateEvent(){this.animatedTilesets=void 0}setRenderer(t){this.renderer=t,this.isDirty=!0}getRenderer(){return this.renderer}getTileId(t,e){let i=this.getTile(t,e);return i?i.tileId:null}getTile(t,e){let i=null;if(this.contains(t,e)){let s=this.getRenderer().pixelToTileCoords(t,e,g.pull("Vector2d"));i=this.cellAt(s.x,s.y),g.push(s)}return i}setTile(t,e,i){return this.layerData[e][i]=t,this.isDirty=!0,t}getTileById(t,e,i){return this.tileset.contains(t)||(this.tileset=this.tilesets.getTilesetByGid(t)),new Wh(e,i,t,this.tileset)}cellAt(t,e,i){let s=~~t,n=~~e,o=this.getRenderer();return i===!1||s>=0&&s<o.cols&&n>=0&&n<o.rows?this.layerData[s][n]:null}clearTile(t,e){this.layerData[t][e]=null,this.preRender&&this.canvasRenderer.clearRect(t*this.tilewidth,e*this.tileheight,this.tilewidth,this.tileheight),this.isDirty=!0}update(t){let e=this.isDirty;if(this.isAnimated)for(let i=0;i<this.animatedTilesets.length;i++)e=this.animatedTilesets[i].update(t)||e;return e}draw(t,e){if(this.preRender){const i=Math.min(e.width,this.width),s=Math.min(e.height,this.height);t.drawImage(this.canvasRenderer.getCanvas(),e.pos.x,e.pos.y,i,s,e.pos.x,e.pos.y,i,s)}else this.getRenderer().drawTileLayer(t,this,e)}}class Gg{constructor(t,e,i){this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.tintcolor=e.tintcolor,this.class=e.class,this.z=i,this.objects=[];let s=typeof e.visible!="undefined"?e.visible:!0;this.opacity=s===!0?E(+e.opacity||1,0,1):0,Be(this,e),e.objects&&e.objects.forEach(n=>{n.tintcolor=this.tintcolor,this.objects.push(new Fg(t,n,i))}),e.layers&&e.layers.forEach(n=>{let o=new Fe(t,n,t.tilewidth,t.tileheight,t.orientation,t.tilesets,i++);o.setRenderer(t.getRenderer()),this.width=Math.max(this.width,o.width),this.height=Math.max(this.height,o.height),this.objects.push(o)})}destroy(){this.objects=null}getObjectCount(){return this.objects.length}getObjectByIndex(t){return this.objects[t]}}function jg(r,t){this.removeChildNow(r,t)}let Ei=0;class Q extends N{constructor(t=0,e=0,i,s,n=!1){super(t,e,typeof i=="undefined"?typeof w.viewport!="undefined"?w.viewport.width:1/0:i,typeof s=="undefined"?typeof w.viewport!="undefined"?w.viewport.height:1/0:s),this.pendingSort=null,this.root=n,this.children=void 0,this.sortOn="z",this.autoSort=!0,this.autoDepth=!0,this.clipping=!1,this.onChildChange=function(o){},this.enableChildBoundsUpdate=!1,this.backgroundColor=g.pull("Color",0,0,0,0),this.drawCount=0,this.autoTransform=!0,this.isKinematic=!1,this.anchorPoint.set(0,0),this.root===!0&&O(li,()=>{this.enableChildBoundsUpdate,this.updateBounds(),this.enableChildBoundsUpdate})}reset(){this.pendingSort&&(clearTimeout(this.pendingSort),this.pendingSort=null);let t=this.getChildren();for(let e=t.length,i;e>=0;i=t[--e])i&&i.isPersistent!==!0&&this.removeChildNow(i);typeof this.currentTransform!="undefined"&&this.currentTransform.identity(),this.backgroundColor.setColor(0,0,0,0)}addChild(t,e){if(t.ancestor instanceof Q?t.ancestor.removeChildNow(t):t.isRenderable&&(t.GUID=nr(t.id)),t.ancestor=this,this.getChildren().push(t),typeof t.updateBounds=="function"&&(this.isFloating===!0&&(t.floating=!1),t.updateBounds()),typeof t.pos!="undefined"&&(typeof e=="number"?t.pos.z=e:this.autoDepth===!0&&(t.pos.z=this.getChildren().length)),this.autoSort===!0&&this.sort(),typeof t.onActivateEvent=="function"&&this.isAttachedToRoot()&&t.onActivateEvent(),this.enableChildBoundsUpdate===!0&&this.updateBounds(),this.isAttachedToRoot()){let i=this.getRootAncestor();t.body instanceof xt&&i.addBody(t.body),t instanceof Q&&t.forEach(s=>{s.body instanceof xt&&i.addBody(s.body)})}return this.isDirty=!0,this.onChildChange.call(this,this.getChildren().length-1),t}addChildAt(t,e){if(e>=0&&e<this.getChildren().length){if(t.ancestor instanceof Q?t.ancestor.removeChildNow(t):t.isRenderable&&(t.GUID=nr()),t.ancestor=this,this.getChildren().splice(e,0,t),typeof t.updateBounds=="function"&&(this.isFloating===!0&&(t.floating=!1),t.updateBounds()),typeof t.onActivateEvent=="function"&&this.isAttachedToRoot()&&t.onActivateEvent(),this.enableChildBoundsUpdate===!0&&this.updateBounds(),this.isAttachedToRoot()){let i=this.getRootAncestor();t.body instanceof xt&&i.addBody(t.body),t instanceof Q&&t.forEach(s=>{s.body instanceof xt&&i.addBody(s.body)})}return this.isDirty=!0,this.onChildChange.call(this,e),t}else throw new Error("Index ("+e+") Out Of Bounds for addChildAt()")}forEach(t,e){let i=this,s=0,n=this.getChildren(),o=n.length;if(typeof t!="function")throw new Error(t+" is not a function");for(arguments.length>1&&(i=e);s<o;)t.call(i,n[s],s,n),s++}swapChildren(t,e){let i=this.getChildIndex(t),s=this.getChildIndex(e);if(i!==-1&&s!==-1){let n=t.pos.z;t.pos.z=e.pos.z,e.pos.z=n,this.getChildren()[i]=e,this.getChildren()[s]=t,this.isDirty=!0}else throw new Error(t+" Both the supplied childs must be a child of the caller "+this)}getChildAt(t){if(t>=0&&t<this.getChildren().length)return this.getChildren()[t];throw new Error("Index ("+t+") Out Of Bounds for getChildAt()")}getChildIndex(t){return this.getChildren().indexOf(t)}getNextChild(t){let e=this.getChildren().indexOf(t)-1;if(e>=0&&e<this.getChildren().length)return this.getChildAt(e)}hasChild(t){return this===t.ancestor}getChildByProp(t,e){let i=[];function s(n,o){let h=n[o];e instanceof RegExp&&typeof h=="string"?e.test(h)&&i.push(n):h===e&&i.push(n)}return this.forEach(n=>{s(n,t),n instanceof Q&&(i=i.concat(n.getChildByProp(t,e)))}),i}getChildByType(t){let e=[];return this.forEach(i=>{i instanceof t&&e.push(i),i instanceof Q&&(e=e.concat(i.getChildByType(t)))}),e}getChildByName(t){return this.getChildByProp("name",t)}getChildByGUID(t){let e=this.getChildByProp("GUID",t);return e.length>0?e[0]:null}getChildren(){return typeof this.children=="undefined"&&(this.children=[]),this.children}updateBounds(t=!0){let e=this.getBounds();return super.updateBounds(t),this.enableChildBoundsUpdate===!0&&this.forEach(i=>{if(i.isRenderable){let s=i.updateBounds(!0);s.isFinite()&&e.addBounds(s)}}),e}isAttachedToRoot(){if(this.root===!0)return!0;{let t=this.ancestor;for(;t;){if(t.root===!0)return!0;t=t.ancestor}return!1}}getRootAncestor(){if(this.root===!0)return this;{let t=this.ancestor;for(;t&&t.root!==!0;)t=t.ancestor;return t}}updateBoundsPos(t=this.pos.x,e=this.pos.y){super.updateBoundsPos(t,e),this.forEach(i=>{i.isRenderable&&i.updateBoundsPos(i.pos.x+t-this.pos.x,i.pos.y+e-this.pos.y)})}onActivateEvent(){this.forEach(t=>{typeof t.onActivateEvent=="function"&&t.onActivateEvent()})}removeChild(t,e){if(this.hasChild(t))zt(jg,this,t,e);else throw new Error("Child is not mine.")}removeChildNow(t,e){if(this.hasChild(t)&&this.getChildIndex(t)>=0){typeof t.onDeactivateEvent=="function"&&t.onDeactivateEvent(),t.body instanceof xt&&this.getRootAncestor().removeBody(t.body),e||g.push(t,!1)===!1&&typeof t.destroy=="function"&&t.destroy();let i=this.getChildIndex(t);i>=0&&(this.getChildren().splice(i,1),t.ancestor=void 0),this.enableChildBoundsUpdate===!0&&this.updateBounds(),this.isDirty=!0,this.onChildChange.call(this,i)}}setChildsProperty(t,e,i){this.forEach(s=>{i===!0&&s instanceof Q&&s.setChildsProperty(t,e,i),s[t]=e})}moveUp(t){let e=this.getChildIndex(t);e-1>=0&&(this.swapChildren(t,this.getChildAt(e-1)),this.isDirty=!0)}moveDown(t){let e=this.getChildIndex(t);e>=0&&e+1<this.getChildren().length&&(this.swapChildren(t,this.getChildAt(e+1)),this.isDirty=!0)}moveToTop(t){let e=this.getChildIndex(t);if(e>0){let i=this.getChildren();i.splice(0,0,i.splice(e,1)[0]),t.pos.z=i[1].pos.z+1,this.isDirty=!0}}moveToBottom(t){let e=this.getChildIndex(t),i=this.getChildren();e>=0&&e<i.length-1&&(i.splice(i.length-1,0,i.splice(e,1)[0]),t.pos.z=i[i.length-2].pos.z-1,this.isDirty=!0)}sort(t){this.pendingSort||(t===!0&&this.forEach(e=>{e instanceof Q&&e.sort(t)}),this.pendingSort=zt(function(){this.getChildren().sort(this["_sort"+this.sortOn.toUpperCase()]),this.pendingSort=null,this.isDirty=!0},this))}onDeactivateEvent(){this.forEach(t=>{typeof t.onDeactivateEvent=="function"&&t.onDeactivateEvent()})}_sortZ(t,e){return e.pos&&t.pos?e.pos.z-t.pos.z:t.pos?-1/0:1/0}_sortReverseZ(t,e){return t.pos&&e.pos?t.pos.z-e.pos.z:t.pos?1/0:-1/0}_sortX(t,e){if(!e.pos||!t.pos)return t.pos?-1/0:1/0;let i=e.pos.z-t.pos.z;return i||e.pos.x-t.pos.x}_sortY(t,e){if(!e.pos||!t.pos)return t.pos?-1/0:1/0;let i=e.pos.z-t.pos.z;return i||e.pos.y-t.pos.y}destroy(){this.reset(),super.destroy(arguments)}update(t){let e=!1,i=L.isPaused(),s=this.getChildren();const n=s.length;for(let o=n,h;o--,h=s[o];)i&&!h.updateWhenPaused||(h.isRenderable?(e=Ei>0||h.floating,e&&Ei++,h.inViewport=!1,L.current().cameras.forEach(f=>{f.isVisible(h,e)&&(h.inViewport=!0)}),this.isDirty|=(h.inViewport||h.alwaysUpdate)&&h.update(t),Ei>0&&Ei--):this.isDirty|=h.update(t));return super.update(t)}draw(t,e){let i=!1,s=this.getBounds();this.drawCount=0,this.root===!1&&this.clipping===!0&&s.isFinite()===!0&&t.clipRect(s.left,s.top,s.width,s.height),t.translate(this.pos.x,this.pos.y),this.backgroundColor.alpha>1/255&&t.clearColor(this.backgroundColor);let n=this.getChildren();for(let o=n.length,h;o--,h=n[o];)h.isRenderable&&(i=h.floating===!0,(h.inViewport||i)&&(i&&(t.save(),t.resetTransform()),h.preDraw(t),h.draw(t,e),h.postDraw(t),i&&t.restore(),this.drawCount++))}}class tn{constructor(t,e,i,s){this.cols=t,this.rows=e,this.tilewidth=i,this.tileheight=s,this.bounds=new ct}canRender(t){return this.tilewidth===t.tilewidth&&this.tileheight===t.tileheight}getBounds(t){let e=t instanceof Fe?g.pull("Bounds"):this.bounds;return e.setMinMax(0,0,this.cols*this.tilewidth,this.rows*this.tileheight),e}pixelToTileCoords(t,e,i){return i}tileToPixelCoords(t,e,i){return i}drawTile(t,e,i,s){}drawTileLayer(t,e,i){}}class Hg extends tn{constructor(t){super(t.cols,t.rows,t.tilewidth,t.tileheight)}canRender(t){return t.orientation==="orthogonal"&&super.canRender(t)}pixelToTileCoords(t,e,i){return(i||new C).set(t/this.tilewidth,e/this.tileheight)}tileToPixelCoords(t,e,i){return(i||new C).set(t*this.tilewidth,e*this.tileheight)}adjustPosition(t){typeof t.gid=="number"&&(t.y-=t.height)}drawTile(t,e,i,s){let n=s.tileset;n.drawTile(t,n.tileoffset.x+e*this.tilewidth,n.tileoffset.y+(i+1)*this.tileheight-n.tileheight,s)}drawTileLayer(t,e,i){let s=1,n=1,o=this.pixelToTileCoords(Math.max(i.pos.x-(e.maxTileSize.width-e.tilewidth),0),Math.max(i.pos.y-(e.maxTileSize.height-e.tileheight),0),g.pull("Vector2d")).floorSelf(),h=this.pixelToTileCoords(i.pos.x+i.width+this.tilewidth,i.pos.y+i.height+this.tileheight,g.pull("Vector2d")).ceilSelf();switch(h.x=h.x>this.cols?this.cols:h.x,h.y=h.y>this.rows?this.rows:h.y,e.renderorder){case"right-up":h.y=o.y+(o.y=h.y)-h.y,n=-1;break;case"left-down":h.x=o.x+(o.x=h.x)-h.x,s=-1;break;case"left-up":h.x=o.x+(o.x=h.x)-h.x,h.y=o.y+(o.y=h.y)-h.y,s=-1,n=-1;break}for(let f=o.y;f!==h.y;f+=n)for(let u=o.x;u!==h.x;u+=s){let c=e.cellAt(u,f,!1);c&&this.drawTile(t,u,f,c)}g.push(o),g.push(h)}}class Yg extends tn{constructor(t){super(t.cols,t.rows,t.tilewidth,t.tileheight),this.hTilewidth=this.tilewidth/2,this.hTileheight=this.tileheight/2,this.originX=this.rows*this.hTilewidth}canRender(t){return t.orientation==="isometric"&&super.canRender(t)}getBounds(t){let e=t instanceof Fe?g.pull("Bounds"):this.bounds;return e.setMinMax(0,0,(this.cols+this.rows)*(this.tilewidth/2),(this.cols+this.rows)*(this.tileheight/2)),e}pixelToTileCoords(t,e,i){return(i||new C).set(e/this.tileheight+(t-this.originX)/this.tilewidth,e/this.tileheight-(t-this.originX)/this.tilewidth)}tileToPixelCoords(t,e,i){return(i||new C).set((t-e)*this.hTilewidth+this.originX,(t+e)*this.hTileheight)}adjustPosition(t){let e=t.x/this.hTilewidth,i=t.y/this.tileheight,s=g.pull("Vector2d");this.tileToPixelCoords(e,i,s),t.x=s.x,t.y=s.y,g.push(s)}drawTile(t,e,i,s){let n=s.tileset;n.drawTile(t,(this.cols-1)*n.tilewidth+(e-i)*n.tilewidth>>1,-n.tilewidth+(e+i)*n.tileheight>>2,s)}drawTileLayer(t,e,i){let s=e.tileset,n=this.pixelToTileCoords(i.pos.x-s.tilewidth,i.pos.y-s.tileheight,g.pull("Vector2d")).floorSelf(),o=this.pixelToTileCoords(i.pos.x+i.width+s.tilewidth,i.pos.y+i.height+s.tileheight,g.pull("Vector2d")).ceilSelf(),h=this.tileToPixelCoords(o.x,o.y,g.pull("Vector2d")),f=this.tileToPixelCoords(n.x,n.y,g.pull("Vector2d"));f.x-=this.hTilewidth,f.y+=this.tileheight;let u=f.y-i.pos.y>this.hTileheight,c=i.pos.x-f.x<this.hTilewidth;u&&(c?(n.x--,f.x-=this.hTilewidth):(n.y--,f.x+=this.hTilewidth),f.y-=this.hTileheight);let a=u^c,l=n.clone();for(let d=f.y*2;d-this.tileheight*2<h.y*2;d+=this.tileheight){l.setV(n);for(let p=f.x;p<h.x;p+=this.tilewidth){let m=e.cellAt(l.x,l.y);if(m){s=m.tileset;let x=s.tileoffset;s.drawTile(t,x.x+p,x.y+d/2-s.tileheight,m)}l.x++,l.y--}a?(n.y++,f.x-=this.hTilewidth,a=!1):(n.x++,f.x+=this.hTilewidth,a=!0)}g.push(l),g.push(n),g.push(o),g.push(h),g.push(f)}}const Xg=[{x:0,y:0},{x:1,y:-1},{x:1,y:0},{x:2,y:0}],Wg=[{x:0,y:0},{x:-1,y:1},{x:0,y:1},{x:0,y:2}];class Qh extends tn{constructor(t){super(t.cols,t.rows,t.tilewidth&-2,t.tileheight&-2),this.hexsidelength=t.hexsidelength||0,this.staggerX=t.staggeraxis==="x",this.staggerEven=t.staggerindex==="even",this.sidelengthx=0,this.sidelengthy=0,t.orientation==="hexagonal"&&(this.staggerX?this.sidelengthx=this.hexsidelength:this.sidelengthy=this.hexsidelength),this.sideoffsetx=(this.tilewidth-this.sidelengthx)/2,this.sideoffsety=(this.tileheight-this.sidelengthy)/2,this.columnwidth=this.sideoffsetx+this.sidelengthx,this.rowheight=this.sideoffsety+this.sidelengthy,this.centers=[new C,new C,new C,new C]}canRender(t){return t.orientation==="hexagonal"&&super.canRender(t)}getBounds(t){let e=t instanceof Fe?g.pull("Bounds"):this.bounds;return this.staggerX?(e.setMinMax(0,0,this.cols*this.columnwidth+this.sideoffsetx,this.rows*(this.tileheight+this.sidelengthy)),e.width>1&&(e.height+=this.rowheight)):(e.setMinMax(0,0,this.cols*(this.tilewidth+this.sidelengthx),this.rows*this.rowheight+this.sideoffsety),e.height>1&&(e.width+=this.columnwidth)),e}doStaggerX(t){return this.staggerX&&t&1^this.staggerEven}doStaggerY(t){return!this.staggerX&&t&1^this.staggerEven}topLeft(t,e,i){let s=i||new C;return this.staggerX?t&1^this.staggerEven?s.set(t-1,e):s.set(t-1,e-1):e&1^this.staggerEven?s.set(t,e-1):s.set(t-1,e-1),s}topRight(t,e,i){let s=i||new C;return this.staggerX?t&1^this.staggerEven?s.set(t+1,e):s.set(t+1,e-1):e&1^this.staggerEven?s.set(t+1,e-1):s.set(t,e-1),s}bottomLeft(t,e,i){let s=i||new C;return this.staggerX?t&1^this.staggerEven?s.set(t-1,e+1):s.set(t-1,e):e&1^this.staggerEven?s.set(t,e+1):s.set(t-1,e+1),s}bottomRight(t,e,i){let s=i||new C;return this.staggerX?t&1^this.staggerEven?s.set(t+1,e+1):s.set(t+1,e):e&1^this.staggerEven?s.set(t+1,e+1):s.set(t,e+1),s}pixelToTileCoords(t,e,i){let s=i||new C;this.staggerX?t-=this.staggerEven?this.tilewidth:this.sideoffsetx:e-=this.staggerEven?this.tileheight:this.sideoffsety;let n=g.pull("Vector2d",Math.floor(t/(this.columnwidth*2)),Math.floor(e/(this.rowheight*2))),o=g.pull("Vector2d",t-n.x*(this.columnwidth*2),e-n.y*(this.rowheight*2));this.staggerX?(n.x=n.x*2,this.staggerEven&&++n.x):(n.y=n.y*2,this.staggerEven&&++n.y);let h,f,u,c;this.staggerX?(h=this.sidelengthx/2,u=h+this.columnwidth,c=this.tileheight/2,this.centers[0].set(h,c),this.centers[1].set(u,c-this.rowheight),this.centers[2].set(u,c+this.rowheight),this.centers[3].set(u+this.columnwidth,c)):(f=this.sidelengthy/2,u=this.tilewidth/2,c=f+this.rowheight,this.centers[0].set(u,f),this.centers[1].set(u-this.columnwidth,c),this.centers[2].set(u+this.columnwidth,c),this.centers[3].set(u,c+this.rowheight));let a=0,l=Number.MAX_VALUE;for(let p=0;p<4;++p){const m=this.centers[p].sub(o).length2();m<l&&(l=m,a=p)}let d=this.staggerX?Xg:Wg;return s.set(n.x+d[a].x,n.y+d[a].y),g.push(n),g.push(o),s}tileToPixelCoords(t,e,i){let s=Math.floor(t),n=Math.floor(e),o=i||new C;return this.staggerX?(o.y=n*(this.tileheight+this.sidelengthy),this.doStaggerX(s)&&(o.y+=this.rowheight),o.x=s*this.columnwidth):(o.x=s*(this.tilewidth+this.sidelengthx),this.doStaggerY(n)&&(o.x+=this.columnwidth),o.y=n*this.rowheight),o}adjustPosition(t){typeof t.gid=="number"&&(t.y-=t.height)}drawTile(t,e,i,s){let n=s.tileset,o=this.tileToPixelCoords(e,i,g.pull("Vector2d"));n.drawTile(t,n.tileoffset.x+o.x,n.tileoffset.y+o.y+(this.tileheight-n.tileheight),s),g.push(o)}drawTileLayer(t,e,i){let s,n=this.pixelToTileCoords(i.pos.x,i.pos.y,g.pull("Vector2d"));n.sub(e.pos);let o=this.tileToPixelCoords(n.x+e.pos.x,n.y+e.pos.y,g.pull("Vector2d")),h=n.clone(),f=o.clone(),u=i.pos.y-o.y<this.sideoffsety,c=i.pos.x-o.x<this.sideoffsetx;u&&n.y--,c&&n.x--;let a=e.cols,l=e.rows;if(this.staggerX){n.x=Math.max(0,n.x),n.y=Math.max(0,n.y),o=this.tileToPixelCoords(n.x+e.pos.x,n.y+e.pos.y,o);let d=this.doStaggerX(n.x+e.pos.x);for(;o.y<i.bottom&&n.y<l;){for(h.setV(n),f.setV(o);f.x<i.right&&h.x<a;h.x+=2)s=e.cellAt(h.x,h.y,!1),s&&s.tileset.drawTile(t,f.x,f.y,s),f.x+=this.tilewidth+this.sidelengthx;d?(n.x-=1,n.y+=1,o.x-=this.columnwidth,d=!1):(n.x+=1,o.x+=this.columnwidth,d=!0),o.y+=this.rowheight}g.push(h),g.push(f)}else{for(n.x=Math.max(0,n.x),n.y=Math.max(0,n.y),o=this.tileToPixelCoords(n.x+e.pos.x,n.y+e.pos.y,o),this.doStaggerY(n.y)&&(o.x-=this.columnwidth);o.y<i.bottom&&n.y<l;n.y++){for(h.setV(n),f.setV(o),this.doStaggerY(n.y)&&(f.x+=this.columnwidth);f.x<i.right&&h.x<a;h.x++)s=e.cellAt(h.x,h.y,!1),s&&s.tileset.drawTile(t,f.x,f.y,s),f.x+=this.tilewidth+this.sidelengthx;o.y+=this.rowheight}g.push(h),g.push(f)}g.push(n),g.push(o)}}class Kg extends Qh{canRender(t){return t.orientation==="staggered"&&super.canRender(t)}pixelToTileCoords(t,e,i){let s=i||new C,n=t,o=e;this.staggerX?n-=this.staggerEven?this.sideoffsetx:0:o-=this.staggerEven?this.sideoffsety:0;let h=g.pull("Vector2d",Math.floor(n/this.tilewidth),Math.floor(o/this.tileheight));this.staggerX?(h.x=h.x*2,this.staggerEven&&++h.x):(h.y=h.y*2,this.staggerEven&&++h.y);let f=g.pull("Vector2d",n-h.x*this.tilewidth,o-h.y*this.tileheight),u=f.x*(this.tileheight/this.tilewidth);return this.sideoffsety-u>f.y&&(h=this.topLeft(h.x,h.y,h)),-this.sideoffsety+u>f.y&&(h=this.topRight(h.x,h.y,h)),this.sideoffsety+u<f.y&&(h=this.bottomLeft(h.x,h.y,h)),this.sideoffsety*3-u<f.y&&(h=this.bottomRight(h.x,h.y,h)),s=this.tileToPixelCoords(h.x,h.y,s),s.set(t-s.x,e-s.y),s.set(s.x-this.tilewidth/2,s.y*(this.tilewidth/this.tileheight)),s.div(this.tilewidth/Math.sqrt(2)).rotate(Pr(-45)).add(h),g.push(h),g.push(f),s}}function qg(r){switch(r.orientation){case"orthogonal":return new Hg(r);case"isometric":return new Yg(r);case"hexagonal":return new Qh(r);case"staggered":return new Kg(r);default:throw new Error(r.orientation+" type TMX Tile Map not supported!")}}function It(r,t,e){const i="melonJS: %s is deprecated since version %s, please use %s";let s=new Error().stack;console.groupCollapsed?console.groupCollapsed("%c"+i,"font-weight:normal;color:yellow;",r,e,t):console.warn(i,r,e,t),typeof s!="undefined"&&console.warn(s),console.groupCollapsed&&console.groupEnd()}function Qg(r,t,e){return new Fe(r,t,r.tilewidth,r.tileheight,r.orientation,r.tilesets,e)}function Jg(r,t,e){Be(t.properties,t);let i=g.pull("ImageLayer",+t.offsetx||+t.x||0,+t.offsety||+t.y||0,Object.assign({name:t.name,image:t.image,ratio:g.pull("Vector2d",+t.parallaxx||1,+t.parallaxy||1),tint:typeof t.tintcolor!="undefined"?g.pull("Color").parseHex(t.tintcolor,!0):void 0,z:e},t.properties)),s=typeof t.visible!="undefined"?t.visible:!0;return i.setOpacity(s?+t.opacity:0),i}function Zg(r){return new Mg(r)}function $n(r,t,e){return new Gg(r,t,e)}class to{constructor(t,e){this.data=e,this.name=t,this.cols=+e.width,this.rows=+e.height,this.tilewidth=+e.tilewidth,this.tileheight=+e.tileheight,this.infinite=+e.infinite||0,this.orientation=e.orientation,this.renderorder=e.renderorder||"right-down",this.version=""+e.version,this.tiledversion=""+e.tiledversion,this.class=e.class,this.tilesets=null,typeof this.layers=="undefined"&&(this.layers=[]),typeof this.objectGroups=="undefined"&&(this.objectGroups=[]),this.isEditor=e.editor==="melon-editor",this.nextobjectid=+e.nextobjectid||void 0,this.hexsidelength=+e.hexsidelength,this.staggeraxis=e.staggeraxis,this.staggerindex=e.staggerindex,this.bounds=this.getRenderer().getBounds().clone(),this.width=this.bounds.width,this.height=this.bounds.height,this.backgroundcolor=e.backgroundcolor,this.version!=="undefined"&&this.version!==""&&Qr(this.version,"1.5")<0&&It("("+this.name+") Tiled Map format version 1.4 and below","format 1.5 or higher","10.4.4"),Be(this,e),this.initialized=!1}getRenderer(){return(typeof this.renderer=="undefined"||!this.renderer.canRender(this))&&(this.renderer=qg(this)),this.renderer}getBounds(){return this.bounds}readMapObjects(t){if(this.initialized===!0)return;let e=0;this.tilesets||(this.tilesets=new Rg),typeof t.tilesets!="undefined"&&t.tilesets.forEach(s=>{this.tilesets.add(Zg(s))}),this.background_image&&this.layers.push(g.pull("ImageLayer",0,0,{name:"background_image",image:this.background_image,z:e++})),t.layers.forEach(i=>{switch(i.type){case"imagelayer":this.layers.push(Jg(this,i,e++));break;case"tilelayer":this.layers.push(Qg(this,i,e++));break;case"objectgroup":this.objectGroups.push($n(this,i,e++));break;case"group":this.objectGroups.push($n(this,i,e++));break}}),this.initialized=!0}addTo(t,e,i){let s=t.autoSort,n=t.autoDepth,o=this.getBounds();t.autoSort=!1,t.autoDepth=!1,this.backgroundcolor&&t.backgroundColor.parseCSS(this.backgroundcolor),this.getLayers().forEach(f=>{t.addChild(f)}),this.getObjects(e).forEach(f=>{t.addChild(f)}),t.resize(this.bounds.width,this.bounds.height),t.sort(!0);function h(f,u){w.viewport.setBounds(0,0,Math.max(o.width,f),Math.max(o.height,u)),t.pos.set(Math.max(0,~~((f-o.width)/2)),Math.max(0,~~((u-o.height)/2)),t.pos.z)}i===!0&&(Ut(Gt,h),h(w.viewport.width,w.viewport.height),O(Gt,h,this)),t.autoSort=s,t.autoDepth=n}getObjects(t){let e=[],i=!1,s;this.readMapObjects(this.data);for(let n=0;n<this.objectGroups.length;n++){let o=this.objectGroups[n];i=o.name.toLowerCase().includes(Ig),t===!1&&(s=new Q(0,0,this.width,this.height),s.anchorPoint.set(0,0),s.name=o.name,s.pos.z=o.z,s.setOpacity(o.opacity),s.autoSort=!1,s.autoDepth=!1);for(let h=0;h<o.objects.length;h++){let f=o.objects[h],u,c;typeof f.anchorPoint=="undefined"&&(f.anchorPoint={x:0,y:0}),typeof f.tintcolor!="undefined"&&(f.tint=g.pull("Color"),f.tint.parseHex(f.tintcolor,!0)),f instanceof Fe?u=f:typeof f.text=="object"?(typeof f.text.anchorPoint=="undefined"&&(f.text.anchorPoint=f.anchorPoint),f.text.bitmap===!0?u=g.pull("BitmapText",f.x,f.y,f.text):u=g.pull("Text",f.x,f.y,f.text),u.pos.z=f.z):typeof f.tile=="object"?(c=f.shapes,typeof c=="undefined"&&(c=g.pull("Polygon",0,0,[g.pull("Vector2d",0,0),g.pull("Vector2d",this.width,0),g.pull("Vector2d",this.width,this.height)])),u=f.tile.getRenderable(f),u.body=new xt(u,c),u.body.setStatic(!0),u.pos.setMuted(f.x,f.y,f.z)):(typeof f.name!="undefined"&&f.name!==""?u=g.pull(f.name,f.x,f.y,f):(u=g.pull("Renderable",f.x,f.y,f.width,f.height),c=f.shapes,typeof c=="undefined"&&(c=g.pull("Polygon",0,0,[g.pull("Vector2d",0,0),g.pull("Vector2d",this.width,0),g.pull("Vector2d",this.width,this.height)])),u.anchorPoint.set(0,0),u.name=f.name,u.type=f.type,u.class=f.class||f.type,u.id=f.id,u.body=new xt(u,c),u.body.setStatic(!0),u.resize(u.body.getBounds().width,u.body.getBounds().height)),u.pos.z=f.z),i&&!f.name&&u.body&&(u.body.collisionType=F.types.WORLD_SHAPE,u.body.isStatic=!0),t!==!1?(u.isRenderable===!0&&(u.setOpacity(u.getOpacity()*o.opacity),typeof u.renderable!="undefined"&&u.renderable.isRenderable===!0&&u.renderable.setOpacity(u.renderable.getOpacity()*o.opacity)),e.push(u)):s.addChild(u)}t===!1&&s.children.length>0&&(s.autoSort=!0,s.autoDepth=!0,e.push(s))}return e}getLayers(){return this.readMapObjects(this.data),this.layers}destroy(){this.tilesets=void 0,this.layers.length=0,this.objectGroups.length=0,this.initialized=!1}}let Lt={},Xt=[],me=0;function eo(r,t,e){t.container.reset(),w.reset(),Lt[De.getCurrentLevelId()]&&Lt[De.getCurrentLevelId()].destroy(),me=Xt.indexOf(r),$g(r,t.container,t.flatten,t.setViewportBounds),M(es,r),t.onLoaded(r),e&&L.restart()}function $g(r,t,e,i){let s=Lt[r];Gh(r,s.nextobjectid),t.anchorPoint.set(0,0),s.addTo(t,e,i)}let De={add(r,t,e){switch(r){case"tmx":if(Lt[t]==null)Lt[t]=new to(t,rn(t)),Xt.push(t);else return!1;return e&&e(),!0;default:throw new Error("no level loader defined for format "+r)}},load(r,t){if(t=Object.assign({container:w.world,onLoaded:w.onLevelLoaded,flatten:w.mergeGroup,setViewportBounds:!0},t||{}),typeof Lt[r]=="undefined")throw new Error("level "+r+" not found");if(Lt[r]instanceof to)L.isRunning()?(L.stop(),zt(eo,this,r,t,!0)):eo(r,t);else throw new Error("no level loader defined");return!0},getCurrentLevelId(){return Xt[me]},getCurrentLevel(){return Lt[this.getCurrentLevelId()]},reload(r){return this.load(this.getCurrentLevelId(),r)},next(r){return me+1<Xt.length?this.load(Xt[me+1],r):!1},previous(r){return me-1>=0?this.load(Xt[me-1],r):!1},levelCount(){return Xt.length}};function io(r,t,e){function i(o){re[r.name]=o,r.type==="tmx"&&De.add(r.type,r.name)}if(r.data){i(r.data),typeof t=="function"&&t();return}let s=new XMLHttpRequest,n=qr(r.src);return s.overrideMimeType&&(n==="json"?s.overrideMimeType("application/json"):s.overrideMimeType("text/xml")),s.open("GET",r.src+ue,!0),s.withCredentials=ui,s.ontimeout=e,s.onreadystatechange=function(){if(s.readyState===4)if(s.status===200||s.status===0&&s.responseText){let o=null;switch(n){case"xml":case"tmx":case"tsx":{if(ot.match(/msie/i)||!s.responseXML)if(globalThis.DOMParser)o=new DOMParser().parseFromString(s.responseText,"text/xml");else throw new Error("XML file format loading not supported, use the JSON file format instead");else o=s.responseXML;const h=it(o);switch(n){case"tmx":o=h.map;break;case"tsx":o=h.tilesets[0];break}break}case"json":case"tmj":case"tsj":o=JSON.parse(s.responseText);break;default:throw new Error("TMX file format "+n+" not supported !")}i(o),typeof t=="function"&&t()}else typeof e=="function"&&e(r.name)},s.send(),1}function ty(r,t,e){let i=new XMLHttpRequest;return i.overrideMimeType&&i.overrideMimeType("application/json"),i.open("GET",r.src+ue,!0),i.withCredentials=ui,i.ontimeout=e,i.onreadystatechange=function(){i.readyState===4&&(i.status===200||i.status===0&&i.responseText?(oe[r.name]=JSON.parse(i.responseText),typeof t=="function"&&t()):typeof e=="function"&&e(r.name))},i.send(),1}function ey(r,t,e){let i=new XMLHttpRequest;return i.open("GET",r.src+ue,!0),i.withCredentials=ui,i.responseType="arraybuffer",i.onerror=e,i.onload=function(){let s=i.response;if(s){let n=new Uint8Array(s),o=[];for(let h=0;h<n.byteLength;h++)o[h]=String.fromCharCode(n[h]);ne[r.name]=o.join(""),typeof t=="function"&&t()}},i.send(),1}function iy(r,t,e){let i=globalThis.document.createElement("script");return i.src=r.src,i.type="text/javascript",i.defer=!0,typeof t=="function"&&(i.onload=()=>{t()}),typeof e=="function"&&(i.onerror=()=>{e(r.name)}),globalThis.document.getElementsByTagName("body")[0].appendChild(i),1}let ri,sy,hr=new Map,Jh=!1,en=0,lr=0,so=0;function ry(){bt("binary",ey),bt("image",Cg),bt("json",ty),bt("js",iy),bt("tmx",io),bt("tsx",io),bt("audio",Ha),bt("fontface",Pg),Jh=!0}function Zh(r){if(lr===en)if(typeof r=="function"||ri){clearTimeout(so);let t=r||ri;setTimeout(()=>{t(),M(Ra)},300)}else throw new Error("no load callback defined");else so=setTimeout(()=>{Zh(r)},100)}function ny(r){lr++;let t=lr/en;M(Ui,t,r)}function oy(r){throw new Error("Failed loading resource "+r.src)}function bt(r,t){if(typeof t!="function")throw new Error("invalid parser function for "+r);typeof hr.get(r)!="undefined"&&It("overriding parser for "+r+" format"),hr.set(r,t)}function ay(r,t,e=!0){for(let i=0;i<r.length;i++)en+=sn(r[i],ny.bind(this,r[i]),oy.bind(this,r[i]));typeof t!="undefined"&&(ri=t),e===!0&&L.change(L.LOADING),Zh(ri)}function sn(r,t,e){Jh===!1&&ry(),typeof ht[r.type]!="undefined"&&(r.src=ht[r.type]+r.src);let i=hr.get(r.type);if(typeof i=="undefined")throw new Error("load : unknown or invalid resource type : "+r.type);return i.call(this,r,t,e)}function we(r){switch(r.type){case"binary":return r.name in ne?(delete ne[r.name],!0):!1;case"image":return r.name in vt?(delete vt[r.name],!0):!1;case"json":return r.name in oe?(delete oe[r.name],!0):!1;case"js":return!0;case"fontface":return!0;case"tmx":case"tsx":return r.name in re?(delete re[r.name],!0):!1;case"audio":return Nr(r.name);default:throw new Error("unload : unknown or invalid resource type : "+r.type)}}function hy(){let r;for(r in ne)ne.hasOwnProperty(r)&&we({name:r,type:"binary"});for(r in vt)vt.hasOwnProperty(r)&&we({name:r,type:"image"});for(r in re)re.hasOwnProperty(r)&&we({name:r,type:"tmx"});for(r in oe)oe.hasOwnProperty(r)&&we({name:r,type:"json"});Qa()}function rn(r){return r=""+r,r in re?re[r]:null}function ur(r){return r=""+r,r in ne?ne[r]:null}function mt(r){return r=us(""+r),r in vt?vt[r]:null}function ly(r){return r=""+r,r in oe?oe[r]:null}var W={__proto__:null,baseURL:ht,crossOrigin:ep,getBinary:ur,getImage:mt,getJSON:ly,getTMX:rn,load:sn,get nocache(){return ue},onProgress:sy,get onload(){return ri},preload:ay,setBaseURL:ip,setNocache:Ua,setParser:bt,unload:we,unloadAll:hy,withCredentials:ui};class rt extends N{constructor(t,e,i){if(super(t,e,0,0),this.animationpause=!1,this.animationspeed=100,this.offset=g.pull("Vector2d",0,0),this.source=null,this.anim={},this.resetAnim=void 0,this.current={name:void 0,length:0,offset:g.pull("Vector2d"),width:0,height:0,angle:0,idx:0},this.dt=0,this._flicker={isFlickering:!1,duration:0,callback:null,state:!1},i.image instanceof lt){if(this.source=i.image,this.image=this.source.getTexture(),this.textureAtlas=i.image,typeof i.region!="undefined"){let s=this.source.getRegion(i.region);if(s)this.setRegion(s);else throw new Error("Texture - region for "+i.region+" not found")}}else{if(this.image=typeof i.image=="object"?i.image:mt(i.image),!this.image)throw new Error("me.Sprite: '"+i.image+"' image/texture not found!");this.width=this.current.width=i.framewidth=i.framewidth||this.image.width,this.height=this.current.height=i.frameheight=i.frameheight||this.image.height,this.source=k.cache.get(this.image,i),this.textureAtlas=this.source.getAtlas()}typeof i.atlas!="undefined"&&(this.textureAtlas=i.atlas,this.atlasIndices=i.atlasIndices),typeof i.flipX!="undefined"&&this.flipX(!!i.flipX),typeof i.flipY!="undefined"&&this.flipY(!!i.flipY),typeof i.rotation!="undefined"&&this.rotate(i.rotation),i.anchorPoint&&this.anchorPoint.set(i.anchorPoint.x,i.anchorPoint.y),typeof i.tint!="undefined"&&(i.tint instanceof st?this.tint.copy(i.tint):this.tint.parseCSS(i.tint)),typeof i.name=="string"&&(this.name=i.name),typeof i.z!="undefined"&&(this.pos.z=i.z),this.addAnimation("default",null)!==0&&this.setCurrentAnimation("default")}isFlickering(){return this._flicker.isFlickering}flicker(t,e){return this._flicker.duration=t,this._flicker.duration<=0?(this._flicker.isFlickering=!1,this._flicker.callback=null):this._flicker.isFlickering||(this._flicker.callback=e,this._flicker.isFlickering=!0),this}addAnimation(t,e,i){this.anim[t]={name:t,frames:[],idx:0,length:0};let s=0;if(typeof this.textureAtlas!="object")return 0;e==null&&(e=[],Object.keys(this.textureAtlas).forEach((n,o)=>{e[o]=o}));for(let n=0,o=e.length;n<o;n++){let h=e[n],f;typeof h=="number"||typeof h=="string"?f={name:h,delay:i||this.animationspeed}:f=h;let u=f.name;if(typeof u=="number")typeof this.textureAtlas[u]!="undefined"&&(this.anim[t].frames[n]=Object.assign({},this.textureAtlas[u],f),s++);else{if(this.source.getFormat().includes("Spritesheet"))throw new Error("string parameters for addAnimation are not allowed for standard spritesheet based Texture");this.anim[t].frames[n]=Object.assign({},this.textureAtlas[this.atlasIndices[u]],f),s++}}return this.anim[t].length=s,s}setCurrentAnimation(t,e,i=!1){if(typeof this.anim[t]!="undefined")this.isCurrentAnimation(t)||(this.current.name=t,this.current.length=this.anim[this.current.name].length,typeof e=="string"?this.resetAnim=this.setCurrentAnimation.bind(this,e,null,!0):typeof e=="function"?this.resetAnim=e:this.resetAnim=void 0,this.setAnimationFrame(0),i||(this.dt=0),this.isDirty=!0);else throw new Error("animation id '"+t+"' not defined");return this}reverseAnimation(t){return typeof t!="undefined"&&typeof this.anim[t]!="undefined"?this.anim[t].frames.reverse():this.anim[this.current.name].frames.reverse(),this.isDirty=!0,this}isCurrentAnimation(t){return this.current.name===t}setRegion(t){return this.image=this.source.getTexture(t),this.current.offset.setV(t.offset),this.current.angle=typeof t.angle=="number"?t.angle:0,this.width=this.current.width=t.width,this.height=this.current.height=t.height,t.anchorPoint&&this.anchorPoint.setMuted(this._flip.x&&t.trimmed===!0?1-t.anchorPoint.x:t.anchorPoint.x,this._flip.y&&t.trimmed===!0?1-t.anchorPoint.y:t.anchorPoint.y),this.updateBounds(),this.isDirty=!0,this}setAnimationFrame(t=0){return this.current.idx=t%this.current.length,this.setRegion(this.getAnimationFrameObjectByIndex(this.current.idx))}getCurrentAnimationFrame(){return this.current.idx}getAnimationFrameObjectByIndex(t){return this.anim[this.current.name].frames[t]}update(t){if(!this.animationpause&&this.current.length>1){let e=this.getAnimationFrameObjectByIndex(this.current.idx).delay;for(this.dt+=t;this.dt>=e;){this.isDirty=!0,this.dt-=e;let i=this.current.length>1?this.current.idx+1:this.current.idx;if(this.setAnimationFrame(i),this.current.idx===0&&typeof this.resetAnim=="function"&&this.resetAnim()===!1){this.setAnimationFrame(this.current.length-1),this.dt%=e;break}e=this.getAnimationFrameObjectByIndex(this.current.idx).delay}}return this._flicker.isFlickering&&(this._flicker.duration-=t,this._flicker.duration<0&&(typeof this._flicker.callback=="function"&&this._flicker.callback(),this.flicker(-1)),this.isDirty=!0),super.update(t)}destroy(){g.push(this.offset),this.offset=void 0,super.destroy()}draw(t,e){if(this._flicker.isFlickering&&(this._flicker.state=!this._flicker.state,!this._flicker.state))return;let i=this.current,s=this.pos.x,n=this.pos.y,o=i.width,h=i.height,f=i.offset,u=this.offset;i.angle!==0&&(t.translate(-s,-n),t.rotate(i.angle),s-=h,o=i.height,h=i.width),t.drawImage(this.image,u.x+f.x,u.y+f.y,o,h,s,n,o,h)}}var uy="data:image/png;base64,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";class fy extends N{constructor(t,e,i,s){super(t,e,i,s),this.barHeight=s,this.anchorPoint.set(0,0),O(Ui,this.onProgressUpdate,this),O(Gt,this.resize,this),this.anchorPoint.set(0,0),this.progress=0}onProgressUpdate(t){this.progress=~~(t*this.width),this.isDirty=!0}draw(t,e){t.setColor("black"),t.fillRect(this.pos.x,e.centerY,t.width,this.barHeight/2),t.setColor("#55aa00"),t.fillRect(this.pos.x,e.centerY,this.progress,this.barHeight/2)}onDestroyEvent(){Ut(Ui,this.onProgressUpdate),Ut(Gt,this.resize)}}class dy extends gi{onResetEvent(){w.world.backgroundColor.parseCSS("#202020"),w.world.addChild(new fy(0,k.height/2,k.width,8),1),sn({name:"melonjs_logo",type:"image",src:uy},()=>{w.world.addChild(new rt(k.width/2,k.height/2,{image:"melonjs_logo",framewidth:256,frameheight:256}),2)})}onDestroyEvent(){we({name:"melonjs_logo",type:"image"})}}let dt=-1,ae=-1,Wi=!1,$={},Yt={color:"",duration:0},fr=null,dr=null,Rt=0;function $h(){ae===-1&&dt!==-1&&(ae=globalThis.requestAnimationFrame(tl))}function cy(){Wi&&dt!==-1&&(Wi=!1)}function py(){Wi=!0}function tl(r){M(Rr,r),ae!==-1&&(ae=globalThis.requestAnimationFrame(tl))}function el(){globalThis.cancelAnimationFrame(ae),ae=-1}function Is(r){el(),$[dt]&&$[dt].stage.destroy(),$[r]&&(dt=r,$[dt].stage.reset.apply($[dt].stage,dr),$h(),M($i),fr&&fr())}O(hi,()=>{Wt.set(Wt.LOADING,new dy),Wt.set(Wt.DEFAULT,new gi),O(Br,()=>{Wt.change(Wt.DEFAULT,!0)})});let Wt={LOADING:0,MENU:1,READY:2,PLAY:3,GAMEOVER:4,GAME_END:5,SCORE:6,CREDITS:7,SETTINGS:8,DEFAULT:9,USER:100,stop(r=!1){dt!==this.LOADING&&this.isRunning()&&(el(),r===!0&&r(),Rt=globalThis.performance.now(),M(Aa))},pause(r=!1){dt!==this.LOADING&&!this.isPaused()&&(py(),r===!0&&Xa(),Rt=globalThis.performance.now(),M(Ea))},restart(r=!1){this.isRunning()||($h(),r===!0&&Qs(),Rt=globalThis.performance.now()-Rt,M(Zi,Rt))},resume(r=!1){this.isPaused()&&(cy(),r===!0&&Qs(),Rt=globalThis.performance.now()-Rt,M(Me,Rt))},isRunning(){return ae!==-1},isPaused(){return Wi},set(r,t,e=!1){if(!(t instanceof gi))throw new Error(t+" is not an instance of me.Stage");$[r]={},$[r].stage=t,$[r].transition=!0,e===!0&&this.change(r)},get(r=dt){if(typeof $[r]!="undefined")return $[r].stage},current(){return this.get()},transition(r,t,e){r==="fade"&&(Yt.color=t,Yt.duration=e)},setTransition(r,t){$[r].transition=t},change(r,t){if(typeof $[r]=="undefined")throw new Error("Undefined Stage for state '"+r+"'");this.isCurrent(r)||(dr=null,arguments.length>1&&(dr=Array.prototype.slice.call(arguments,1)),Yt.duration&&$[r].transition?(fr=()=>{w.viewport.fadeOut(Yt.color,Yt.duration)},w.viewport.fadeIn(Yt.color,Yt.duration,function(){zt(Is,this,r)})):t===!0?Is(r):zt(Is,this,r))},isCurrent(r){return dt===r}};var L=Wt;class gy{constructor(){this.tick=1,this.fps=0,this.maxfps=60,this.interpolation=!1,this.framecount=0,this.framedelta=0,this.last=0,this.now=0,this.delta=0,this.step=0,this.minstep=0,this.timers=[],this.timerId=0,O(hi,()=>{this.reset(),this.now=this.last=0,O(ts,t=>this.update(t))}),O(Me,()=>{this.reset()}),O(Zi,()=>{this.reset()}),O($i,()=>{this.reset()})}reset(){this.last=this.now=globalThis.performance.now(),this.delta=0,this.framedelta=0,this.framecount=0,this.step=Math.ceil(1e3/this.maxfps),this.minstep=1e3/this.maxfps*1.25}setTimeout(t,e,i,...s){return this.timers.push({fn:t,delay:e,elapsed:0,repeat:!1,timerId:++this.timerId,pauseable:i===!0||!0,args:s}),this.timerId}setInterval(t,e,i,...s){return this.timers.push({fn:t,delay:e,elapsed:0,repeat:!0,timerId:++this.timerId,pauseable:i===!0||!0,args:s}),this.timerId}clearTimeout(t){t>0&&zt(this.clearTimer.bind(this),this,t)}clearInterval(t){t>0&&zt(this.clearTimer.bind(this),this,t)}getTime(){return this.now}getDelta(){return this.delta}countFPS(){this.framecount++,this.framedelta+=this.delta,this.framecount%10===0&&(this.fps=E(Math.round(1e3*this.framecount/this.framedelta),0,this.maxfps),this.framedelta=0,this.framecount=0)}update(t){this.last=this.now,this.now=t,this.delta=this.now-this.last,this.delta<0&&(this.delta=0),this.tick=this.delta>this.minstep&&this.interpolation?this.delta/this.step:1,this.updateTimers()}clearTimer(t){for(let e=0,i=this.timers.length;e<i;e++)if(this.timers[e].timerId===t){this.timers.splice(e,1);break}}updateTimers(){for(let t=0,e=this.timers.length;t<e;t++){let i=this.timers[t];i.pauseable&&L.isPaused()||(i.elapsed+=this.delta),i.elapsed>=i.delay&&(i.fn.apply(null,i.args),i.repeat===!0?i.elapsed-=i.delay:this.clearTimeout(i.timerId))}}}const yy=new gy;var z=yy;class xt{constructor(t,e,i){if(this.ancestor=t,typeof this.bounds=="undefined"&&(this.bounds=g.pull("Bounds")),typeof this.shapes=="undefined"&&(this.shapes=[]),this.collisionMask=F.types.ALL_OBJECT,this.collisionType=F.types.ENEMY_OBJECT,typeof this.vel=="undefined"&&(this.vel=g.pull("Vector2d")),this.vel.set(0,0),typeof this.force=="undefined"&&(this.force=g.pull("Vector2d")),this.force.set(0,0),typeof this.friction=="undefined"&&(this.friction=g.pull("Vector2d")),this.friction.set(0,0),this.bounce=0,this.mass=1,typeof this.maxVel=="undefined"&&(this.maxVel=g.pull("Vector2d")),this.maxVel.set(490,490),this.isStatic=!1,this.gravityScale=1,this.ignoreGravity=!1,this.falling=!1,this.jumping=!1,typeof i=="function"&&(this.onBodyUpdate=i),this.bounds.clear(),typeof e!="undefined")if(Array.isArray(e))for(let s=0;s<e.length;s++)this.addShape(e[s]);else this.addShape(e);this.ancestor.isKinematic=!1}setStatic(t=!0){this.isStatic=t===!0}addShape(t){if(t instanceof tt||t instanceof ct){let e=t.toPolygon();this.shapes.push(e),this.bounds.add(e.points),this.bounds.translate(e.pos)}else t instanceof Qe?(this.shapes.includes(t)||this.shapes.push(t),this.bounds.addBounds(t.getBounds()),this.bounds.translate(t.getBounds().x,t.getBounds().y)):t instanceof Vt?(this.shapes.includes(t)||this.shapes.push(t),this.bounds.add(t.points),this.bounds.translate(t.pos)):t instanceof Je?(this.shapes.includes(t)||this.shapes.push(t),this.bounds.addPoint(t)):this.fromJSON(t);return typeof this.onBodyUpdate=="function"&&this.onBodyUpdate(this),this.shapes.length}setVertices(t,e=0,i=!0){let s=this.getShape(e);s instanceof Vt?s.setShape(0,0,t):this.shapes[e]=g.pull("Polygon",0,0,t),this.bounds.add(this.shapes[e].points,i),typeof this.onBodyUpdate=="function"&&this.onBodyUpdate(this)}addVertices(t,e=0){this.setVertices(t,e,!1)}fromJSON(t,e){let i=t;if(typeof e!="undefined"&&(i=t[e]),typeof i=="undefined")throw new Error("Identifier ("+e+") undefined for the given JSON object)");if(i.length){for(let s=0;s<i.length;s++)this.addVertices(i[s].shape,s);this.mass=i[0].density||0,this.friction.set(i[0].friction||0,i[0].friction||0),this.bounce=i[0].bounce||0}return i.length}getShape(t){return this.shapes[t||0]}getBounds(){return this.bounds}removeShape(t){this.bounds.clear(),Ze(this.shapes,t);for(let e=0;e<this.shapes.length;e++)this.addShape(this.shapes[e]);return this.shapes.length}removeShapeAt(t){return this.removeShape(this.getShape(t))}setCollisionMask(t=F.types.ALL_OBJECT){this.collisionMask=t}setCollisionType(t){if(typeof t!="undefined")if(typeof F.types[t]!="undefined")this.collisionType=F.types[t];else throw new Error("Invalid value for the collisionType property")}respondToCollision(t){let e=t.overlapV;if(this.ancestor.pos.sub(e),e.x!==0&&(this.vel.x=~~(.5+this.vel.x-e.x)||0,this.bounce>0&&(this.vel.x*=-this.bounce)),e.y!==0&&(this.vel.y=~~(.5+this.vel.y-e.y)||0,this.bounce>0&&(this.vel.y*=-this.bounce),!this.ignoreGravity)){let i=this.falling===!0?1:this.jumping===!0?-1:0;this.falling=e.y>=i,this.jumping=e.y<=-i}}forEach(t,e){let i=this,s=0,n=this.shapes,o=n.length;if(typeof t!="function")throw new Error(t+" is not a function");for(arguments.length>1&&(i=e);s<o;)t.call(i,n[s],s,n),s++}contains(){let t,e;if(arguments.length===2?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y),this.getBounds().contains(t,e)){for(let i=this.shapes.length,s;i--,s=this.shapes[i];)if(s.contains(t,e))return!0}return!1}rotate(t,e=this.getBounds().center){return t!==0&&(this.bounds.clear(),this.forEach(i=>{i.rotate(t,e),this.bounds.addBounds(i.getBounds())})),this}setMaxVelocity(t,e){this.maxVel.x=t,this.maxVel.y=e}setFriction(t=0,e=0){this.friction.x=t,this.friction.y=e}update(t){let e=z.tick;if(this.force.x!==0&&(this.vel.x+=this.force.x*e),this.force.y!==0&&(this.vel.y+=this.force.y*e),this.friction.x>0){let i=this.friction.x*e,s=this.vel.x+i,n=this.vel.x-i;this.vel.x=s<0?s:n>0?n:0}if(this.friction.y>0){let i=this.friction.y*e,s=this.vel.y+i,n=this.vel.y-i;this.vel.y=s<0?s:n>0?n:0}return this.vel.y!==0&&(this.vel.y=E(this.vel.y,-this.maxVel.y,this.maxVel.y)),this.vel.x!==0&&(this.vel.x=E(this.vel.x,-this.maxVel.x,this.maxVel.x)),this.falling=this.vel.y*Math.sign(this.force.y)>0,this.jumping=this.falling?!1:this.jumping,this.ancestor.pos.add(this.vel),this.vel.x!==0||this.vel.y!==0}destroy(){g.push(this.bounds),g.push(this.vel),g.push(this.force),g.push(this.friction),g.push(this.maxVel),this.shapes.forEach(t=>{g.push(t,!1)}),this.onBodyUpdate=void 0,this.ancestor=void 0,this.bounds=void 0,this.vel=void 0,this.force=void 0,this.friction=void 0,this.maxVel=void 0,this.shapes.length=0,this.setStatic(!1)}}let He={Linear:{None:function(r){return r}},Quadratic:{In:function(r){return r*r},Out:function(r){return r*(2-r)},InOut:function(r){return(r*=2)<1?.5*r*r:-.5*(--r*(r-2)-1)}},Cubic:{In:function(r){return r*r*r},Out:function(r){return--r*r*r+1},InOut:function(r){return(r*=2)<1?.5*r*r*r:.5*((r-=2)*r*r+2)}},Quartic:{In:function(r){return r*r*r*r},Out:function(r){return 1- --r*r*r*r},InOut:function(r){return(r*=2)<1?.5*r*r*r*r:-.5*((r-=2)*r*r*r-2)}},Quintic:{In:function(r){return r*r*r*r*r},Out:function(r){return--r*r*r*r*r+1},InOut:function(r){return(r*=2)<1?.5*r*r*r*r*r:.5*((r-=2)*r*r*r*r+2)}},Sinusoidal:{In:function(r){return 1-Math.cos(r*Math.PI/2)},Out:function(r){return Math.sin(r*Math.PI/2)},InOut:function(r){return .5*(1-Math.cos(Math.PI*r))}},Exponential:{In:function(r){return r===0?0:Math.pow(1024,r-1)},Out:function(r){return r===1?1:1-Math.pow(2,-10*r)},InOut:function(r){return r===0?0:r===1?1:(r*=2)<1?.5*Math.pow(1024,r-1):.5*(-Math.pow(2,-10*(r-1))+2)}},Circular:{In:function(r){return 1-Math.sqrt(1-r*r)},Out:function(r){return Math.sqrt(1- --r*r)},InOut:function(r){return(r*=2)<1?-.5*(Math.sqrt(1-r*r)-1):.5*(Math.sqrt(1-(r-=2)*r)+1)}},Elastic:{In:function(r){return r===0?0:r===1?1:-Math.pow(2,10*(r-1))*Math.sin((r-1.1)*5*Math.PI)},Out:function(r){return r===0?0:r===1?1:Math.pow(2,-10*r)*Math.sin((r-.1)*5*Math.PI)+1},InOut:function(r){return r===0?0:r===1?1:(r*=2,r<1?-.5*Math.pow(2,10*(r-1))*Math.sin((r-1.1)*5*Math.PI):.5*Math.pow(2,-10*(r-1))*Math.sin((r-1.1)*5*Math.PI)+1)}},Back:{In:function(r){return r*r*((1.70158+1)*r-1.70158)},Out:function(r){return--r*r*((1.70158+1)*r+1.70158)+1},InOut:function(r){const t=2.5949095;return(r*=2)<1?.5*(r*r*((t+1)*r-t)):.5*((r-=2)*r*((t+1)*r+t)+2)}},Bounce:{In:function(r){return 1-He.Bounce.Out(1-r)},Out:function(r){return r<1/2.75?7.5625*r*r:r<2/2.75?7.5625*(r-=1.5/2.75)*r+.75:r<2.5/2.75?7.5625*(r-=2.25/2.75)*r+.9375:7.5625*(r-=2.625/2.75)*r+.984375},InOut:function(r){return r<.5?He.Bounce.In(r*2)*.5:He.Bounce.Out(r*2-1)*.5+.5}}},Te={Linear:function(r,t){let e=r.length-1,i=e*t,s=Math.floor(i),n=Te.Utils.Linear;return t<0?n(r[0],r[1],i):t>1?n(r[e],r[e-1],e-i):n(r[s],r[s+1>e?e:s+1],i-s)},Bezier:function(r,t){let e=0,i=r.length-1,s=Math.pow,n=Te.Utils.Bernstein,o;for(o=0;o<=i;o++)e+=s(1-t,i-o)*s(t,o)*r[o]*n(i,o);return e},CatmullRom:function(r,t){let e=r.length-1,i=e*t,s=Math.floor(i),n=Te.Utils.CatmullRom;return r[0]===r[e]?(t<0&&(s=Math.floor(i=e*(1+t))),n(r[(s-1+e)%e],r[s],r[(s+1)%e],r[(s+2)%e],i-s)):t<0?r[0]-(n(r[0],r[0],r[1],r[1],-i)-r[0]):t>1?r[e]-(n(r[e],r[e],r[e-1],r[e-1],i-e)-r[e]):n(r[s?s-1:0],r[s],r[e<s+1?e:s+1],r[e<s+2?e:s+2],i-s)},Utils:{Linear:function(r,t,e){return(t-r)*e+r},Bernstein:function(r,t){let e=Te.Utils.Factorial;return e(r)/e(t)/e(r-t)},Factorial:function(){let r=[1];return function(t){let e=1,i;if(r[t])return r[t];for(i=t;i>1;i--)e*=i;return r[t]=e,e}}(),CatmullRom:function(r,t,e,i,s){let n=(e-r)*.5,o=(i-t)*.5,h=s*s,f=s*h;return(2*t-2*e+n+o)*f+(-3*t+3*e-2*n-o)*h+n*s+t}}};class ro{constructor(t){this.setProperties(t)}onResetEvent(t){this.setProperties(t)}setProperties(t){this._object=t,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._repeat=0,this._yoyo=!1,this._reversed=!1,this._delayTime=0,this._startTime=null,this._easingFunction=He.Linear.None,this._interpolationFunction=Te.Linear,this._chainedTweens=[],this._onStartCallback=null,this._onStartCallbackFired=!1,this._onUpdateCallback=null,this._onCompleteCallback=null,this._tweenTimeTracker=w.lastUpdate,this.isPersistent=!1,this.updateWhenPaused=!1,this.isRenderable=!1;for(let e in t)typeof t!="object"&&(this._valuesStart[e]=parseFloat(t[e]))}_resumeCallback(t){this._startTime&&(this._startTime+=t)}onActivateEvent(){O(Me,this._resumeCallback,this)}onDeactivateEvent(){Ut(Me,this._resumeCallback)}to(t,e){return this._valuesEnd=t,typeof e!="undefined"&&(typeof e=="number"?this._duration=e:typeof e=="object"&&(e.duration&&(this._duration=e.duration),e.yoyo&&this.yoyo(e.yoyo),e.easing&&this.easing(e.easing),e.repeat&&this.repeat(e.repeat),e.delay&&this.delay(e.delay),e.interpolation&&this.interpolation(e.interpolation),e.autoStart&&this.start())),this}start(t=z.getTime()){this._onStartCallbackFired=!1,w.world.addChild(this),this._startTime=t+this._delayTime;for(let e in this._valuesEnd){if(this._valuesEnd[e]instanceof Array){if(this._valuesEnd[e].length===0)continue;this._valuesEnd[e]=[this._object[e]].concat(this._valuesEnd[e])}this._valuesStart[e]=this._object[e],this._valuesStart[e]instanceof Array||(this._valuesStart[e]*=1),this._valuesStartRepeat[e]=this._valuesStart[e]||0}return this}stop(){return w.world.removeChildNow(this),this}delay(t){return this._delayTime=t,this}repeat(t){return this._repeat=t,this}yoyo(t){return this._yoyo=t,this}easing(t){if(typeof t!="function")throw new Error("invalid easing function for me.Tween.easing()");return this._easingFunction=t,this}interpolation(t){return this._interpolationFunction=t,this}chain(){return this._chainedTweens=arguments,this}onStart(t){return this._onStartCallback=t,this}onUpdate(t){return this._onUpdateCallback=t,this}onComplete(t){return this._onCompleteCallback=t,this}update(t){this._tweenTimeTracker=w.lastUpdate>this._tweenTimeTracker?w.lastUpdate:this._tweenTimeTracker+t;let e=this._tweenTimeTracker,i;if(e<this._startTime)return!0;this._onStartCallbackFired===!1&&(this._onStartCallback!==null&&this._onStartCallback.call(this._object),this._onStartCallbackFired=!0);let s=(e-this._startTime)/this._duration;s=s>1?1:s;let n=this._easingFunction(s);for(i in this._valuesEnd){let o=this._valuesStart[i]||0,h=this._valuesEnd[i];h instanceof Array?this._object[i]=this._interpolationFunction(h,n):(typeof h=="string"&&(h=o+parseFloat(h)),typeof h=="number"&&(this._object[i]=o+(h-o)*n))}if(this._onUpdateCallback!==null&&this._onUpdateCallback.call(this._object,n),s===1)if(this._repeat>0){isFinite(this._repeat)&&this._repeat--;for(i in this._valuesStartRepeat){if(typeof this._valuesEnd[i]=="string"&&(this._valuesStartRepeat[i]=this._valuesStartRepeat[i]+parseFloat(this._valuesEnd[i])),this._yoyo){let o=this._valuesStartRepeat[i];this._valuesStartRepeat[i]=this._valuesEnd[i],this._valuesEnd[i]=o}this._valuesStart[i]=this._valuesStartRepeat[i]}return this._yoyo&&(this._reversed=!this._reversed),this._startTime=e+this._delayTime,!0}else{w.world.removeChildNow(this),this._onCompleteCallback!==null&&this._onCompleteCallback.call(this._object);for(let o=0,h=this._chainedTweens.length;o<h;o++)this._chainedTweens[o].start(e);return!1}return!0}static get Easing(){return He}static get Interpolation(){return Te}}const my={bool:"1i",int:"1i",float:"1f",vec2:"2fv",vec3:"3fv",vec4:"4fv",bvec2:"2iv",bvec3:"3iv",bvec4:"4iv",ivec2:"2iv",ivec3:"3iv",ivec4:"4iv",mat2:"Matrix2fv",mat3:"Matrix3fv",mat4:"Matrix4fv",sampler2D:"1i"};function xy(r,t){let e={},i=/uniform\s+(\w+)\s+(\w+)/g,s={},n={},o={},h;return[t.vertex,t.fragment].forEach(f=>{for(;h=i.exec(f);)s[h[2]]=h[1]}),Object.keys(s).forEach(f=>{let u=s[f];o[f]=r.getUniformLocation(t.program,f),n[f]={get:function(c){return function(){return o[c]}}(f),set:function(c,a,l){return a.indexOf("mat")===0?function(d){r[l](o[c],!1,d)}:function(d){let p=l;d.length&&l.slice(-1)!=="v"&&(p+="v"),r[p](o[c],d)}}(f,u,"uniform"+my[u])}}),Object.defineProperties(e,n),e}function vy(r,t){let e={},i=/attribute\s+\w+\s+(\w+)/g,s,n=0;for(;s=i.exec(t.vertex);)e[s[1]]=n++;return e}function no(r,t,e){let i=r.createShader(t);if(r.shaderSource(i,e),r.compileShader(i),!r.getShaderParameter(i,r.COMPILE_STATUS))throw new Error(r.getShaderInfoLog(i));return i}function _y(r,t,e,i){let s=no(r,r.VERTEX_SHADER,t),n=no(r,r.FRAGMENT_SHADER,e),o=r.createProgram();r.attachShader(o,s),r.attachShader(o,n);for(let h in i)r.bindAttribLocation(o,i[h],h);if(r.linkProgram(o),!r.getProgramParameter(o,r.LINK_STATUS)){let h="Error initializing Shader "+this+`
gl.VALIDATE_STATUS: `+r.getProgramParameter(o,r.VALIDATE_STATUS)+`
gl.getError()`+r.getError()+`
gl.getProgramInfoLog()`+r.getProgramInfoLog(o);throw r.deleteProgram(o),o=null,new Error(h)}return r.useProgram(o),r.deleteShader(s),r.deleteShader(n),o}function oo(r,t){return r.substring(0,9)!=="precision"?"precision "+t+" float;"+r:r}function ao(r){return r.getShaderPrecisionFormat(r.VERTEX_SHADER,r.HIGH_FLOAT).precision>0&&r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.HIGH_FLOAT).precision>0?"highp":r.getShaderPrecisionFormat(r.VERTEX_SHADER,r.MEDIUM_FLOAT).precision>0&&r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}function ho(r){return r=r.replace(/\/\*[\s\S]*?\*\/|([^\\:]|^)\/\/.*$/gm,"$1"),r=r.replace(/(\\n\s+)|(\s+\\n)/g,""),r=r.replace(/(\\r|\\n)+/g,""),r=r.replace(/\s*([;,[\](){}\\\/\-+*|^&!=<>?~%])\s*/g,"$1"),r}class by{constructor(t,e,i,s){this.gl=t,this.vertex=oo(ho(e),s||ao(this.gl)),this.fragment=oo(ho(i),s||ao(this.gl)),this.attributes=vy(this.gl,this),this.program=_y(this.gl,this.vertex,this.fragment,this.attributes),this.uniforms=xy(this.gl,this),O(is,this.destroy,this)}bind(){this.gl.useProgram(this.program)}getAttribLocation(t){let e=this.attributes[t];return typeof e!="undefined"?e:-1}setUniform(t,e){let i=this.uniforms;if(typeof i[t]!="undefined")typeof e=="object"&&typeof e.toArray=="function"?i[t]=e.toArray():i[t]=e;else throw new Error("undefined ("+t+") uniform for shader "+this)}setVertexAttributes(t,e,i){for(let s=0;s<e.length;++s){let n=e[s],o=this.getAttribLocation(n.name);o!==-1?(t.enableVertexAttribArray(o),t.vertexAttribPointer(o,n.size,n.type,n.normalized,i,n.offset)):t.disableVertexAttribArray(s)}}destroy(){this.uniforms=null,this.attributes=null,this.gl.deleteProgram(this.program),this.vertex=null,this.fragment=null}}class wy{constructor(t,e){this.vertexSize=t,this.objSize=e,this.maxVertex=256,this.vertexCount=0,this.buffer=new ArrayBuffer(this.maxVertex*this.vertexSize*this.objSize),this.bufferF32=new Float32Array(this.buffer),this.bufferU32=new Uint32Array(this.buffer)}clear(){this.vertexCount=0}isFull(t=this.objSize){return this.vertexCount+t>=this.maxVertex}resize(t){for(;t>this.maxVertex;)this.maxVertex<<=1;let e=this.bufferF32;return this.buffer=new ArrayBuffer(this.maxVertex*this.vertexSize*this.objSize),this.bufferF32=new Float32Array(this.buffer),this.bufferU32=new Uint32Array(this.buffer),this.bufferF32.set(e),this}push(t,e,i,s,n){let o=this.vertexCount*this.vertexSize;return this.vertexCount>=this.maxVertex&&this.resize(this.vertexCount),this.bufferF32[o]=t,this.bufferF32[++o]=e,typeof i!="undefined"&&(this.bufferF32[++o]=i,this.bufferF32[++o]=s),typeof n!="undefined"&&(this.bufferU32[++o]=n),this.vertexCount++,this}toFloat32(t,e){return typeof e!="undefined"?this.bufferF32.subarray(t,e):this.bufferF32}toUint32(t,e){return typeof e!="undefined"?this.bufferU32.subarray(t,e):this.bufferU32}length(){return this.vertexCount}isEmpty(){return this.vertexCount===0}}class il{constructor(t,e){this.init(t,e)}init(t,e){if(this.renderer=t,this.gl=t.gl,this.color=t.currentColor,this.viewMatrix=t.currentTransform,this.defaultShader=void 0,this.currentShader=void 0,this.mode=this.gl.TRIANGLES,this.attributes=[],this.vertexByteSize=0,this.vertexSize=0,this.vertexData=null,typeof e!="undefined"&&Array.isArray(e.attributes))e.attributes.forEach(i=>{this.addAttribute(i.name,i.size,i.type,i.normalized,i.offset),this.vertexData=new wy(this.vertexSize,6)});else throw new Error("attributes definition missing");if(typeof e!="undefined"&&typeof e.shader!="undefined")this.defaultShader=new by(this.gl,e.shader.vertex,e.shader.fragment);else throw new Error("shader definition missing")}reset(){this.gl=this.renderer.gl,this.vertexData.clear()}bind(){this.renderer.currentProgram!==this.defaultShader.program&&this.useShader(this.defaultShader)}useShader(t){this.renderer.currentProgram!==t.program&&(this.flush(),t.bind(),t.setUniform("uProjectionMatrix",this.renderer.projectionMatrix),t.setVertexAttributes(this.gl,this.attributes,this.vertexByteSize),this.currentShader=t,this.renderer.currentProgram=this.currentShader.program)}addAttribute(t,e,i,s,n){switch(this.attributes.push({name:t,size:e,type:i,normalized:s,offset:n}),i){case this.gl.BYTE:this.vertexByteSize+=e*Int8Array.BYTES_PER_ELEMENT;break;case this.gl.UNSIGNED_BYTE:this.vertexByteSize+=e*Uint8Array.BYTES_PER_ELEMENT;break;case this.gl.SHORT:this.vertexByteSize+=e*Int16Array.BYTES_PER_ELEMENT;break;case this.gl.UNSIGNED_SHORT:this.vertexByteSize+=e*Uint16Array.BYTES_PER_ELEMENT;break;case this.gl.INT:this.vertexByteSize+=e*Int32Array.BYTES_PER_ELEMENT;break;case this.gl.UNSIGNED_INT:this.vertexByteSize+=e*Uint32Array.BYTES_PER_ELEMENT;break;case this.gl.FLOAT:this.vertexByteSize+=e*Float32Array.BYTES_PER_ELEMENT;break;default:throw new Error("Invalid GL Attribute type")}this.vertexSize=this.vertexByteSize/Float32Array.BYTES_PER_ELEMENT}setProjection(t){this.currentShader.setUniform("uProjectionMatrix",t)}flush(t=this.mode){let e=this.vertexData,i=e.vertexCount;if(i>0){let s=this.gl,n=e.vertexSize;this.renderer.WebGLVersion>1?s.bufferData(s.ARRAY_BUFFER,e.toFloat32(),s.STREAM_DRAW,0,i*n):s.bufferData(s.ARRAY_BUFFER,e.toFloat32(0,i*n),s.STREAM_DRAW),s.drawArrays(t,0,i),e.clear()}}}var Ty=`// Current vertex point
attribute vec2 aVertex;
attribute vec4 aColor;

// Projection matrix
uniform mat4 uProjectionMatrix;

varying vec4 vColor;

void main(void) {
    // Transform the vertex position by the projection matrix
    gl_Position = uProjectionMatrix * vec4(aVertex, 0.0, 1.0);
    // Pass the remaining attributes to the fragment shader
    vColor = vec4(aColor.bgr * aColor.a, aColor.a);
}
`,Ey=`varying vec4 vColor;

void main(void) {
    gl_FragColor = vColor;
}
`;class Ay extends il{init(t){super.init(t,{attributes:[{name:"aVertex",size:2,type:t.gl.FLOAT,normalized:!1,offset:0*Float32Array.BYTES_PER_ELEMENT},{name:"aColor",size:4,type:t.gl.UNSIGNED_BYTE,normalized:!0,offset:2*Float32Array.BYTES_PER_ELEMENT}],shader:{vertex:Ty,fragment:Ey}})}drawVertices(t,e,i=e.length){let s=this.viewMatrix,n=this.vertexData,o=this.renderer.getGlobalAlpha(),h=this.renderer.currentColor.toUint32(o);n.isFull(i)&&this.flush(),t!==this.mode&&(this.flush(this.mode),this.mode=t),s.isIdentity()?e.forEach(f=>{n.push(f.x,f.y,void 0,void 0,h)}):e.forEach(f=>{s.apply(f),n.push(f.x,f.y,void 0,void 0,h)}),(this.mode===this.gl.LINE_STRIP||this.mode===this.gl.LINE_LOOP)&&this.flush(this.mode)}}var Sy=`// Current vertex point
attribute vec2 aVertex;
attribute vec2 aRegion;
attribute vec4 aColor;

// Projection matrix
uniform mat4 uProjectionMatrix;

varying vec2 vRegion;
varying vec4 vColor;

void main(void) {
    // Transform the vertex position by the projection matrix
    gl_Position = uProjectionMatrix * vec4(aVertex, 0.0, 1.0);
    // Pass the remaining attributes to the fragment shader
    vColor = vec4(aColor.bgr * aColor.a, aColor.a);
    vRegion = aRegion;
}
`,Cy=`uniform sampler2D uSampler;
varying vec4 vColor;
varying vec2 vRegion;

void main(void) {
    gl_FragColor = texture2D(uSampler, vRegion) * vColor;
}
`;let Ai=[new C,new C,new C,new C];class Py extends il{init(t){super.init(t,{attributes:[{name:"aVertex",size:2,type:t.gl.FLOAT,normalized:!1,offset:0*Float32Array.BYTES_PER_ELEMENT},{name:"aRegion",size:2,type:t.gl.FLOAT,normalized:!1,offset:2*Float32Array.BYTES_PER_ELEMENT},{name:"aColor",size:4,type:t.gl.UNSIGNED_BYTE,normalized:!0,offset:4*Float32Array.BYTES_PER_ELEMENT}],shader:{vertex:Sy,fragment:Cy}}),this.currentTextureUnit=-1,this.boundTextures=[]}reset(){super.reset();for(let t=0;t<this.renderer.maxTextures;t++){let e=this.getTexture2D(t);typeof e!="undefined"&&this.deleteTexture2D(e)}this.currentTextureUnit=-1}createTexture2D(t,e=null,i,s="no-repeat",n=e.width,o=e.height,h=!0,f=!0){let u=this.gl,c=$t(n)&&$t(o),a=s.search(/^repeat(-x)?$/)===0&&(c||this.renderer.WebGLVersion>1)?u.REPEAT:u.CLAMP_TO_EDGE,l=s.search(/^repeat(-y)?$/)===0&&(c||this.renderer.WebGLVersion>1)?u.REPEAT:u.CLAMP_TO_EDGE,d=u.createTexture();return this.bindTexture2D(d,t),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,a),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,l),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,i),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,i),u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,h),e===null||typeof e.byteLength!="undefined"?u.texImage2D(u.TEXTURE_2D,0,u.RGBA,n,o,0,u.RGBA,u.UNSIGNED_BYTE,e,0):typeof globalThis.OffscreenCanvas!="undefined"&&e instanceof globalThis.OffscreenCanvas?u.texImage2D(u.TEXTURE_2D,0,u.RGBA,u.RGBA,u.UNSIGNED_BYTE,e.transferToImageBitmap()):u.texImage2D(u.TEXTURE_2D,0,u.RGBA,u.RGBA,u.UNSIGNED_BYTE,e),c&&f===!0&&u.generateMipmap(u.TEXTURE_2D),d}deleteTexture2D(t){this.gl.deleteTexture(t),this.unbindTexture2D(t)}getTexture2D(t){return this.boundTextures[t]}bindTexture2D(t,e){let i=this.gl;t!==this.boundTextures[e]?(this.flush(),this.currentTextureUnit!==e&&(this.currentTextureUnit=e,i.activeTexture(i.TEXTURE0+e)),i.bindTexture(i.TEXTURE_2D,t),this.boundTextures[e]=t):this.currentTextureUnit!==e&&(this.flush(),this.currentTextureUnit=e,i.activeTexture(i.TEXTURE0+e))}unbindTexture2D(t,e){return typeof e=="undefined"&&(e=this.boundTextures.indexOf(t)),e!==-1&&(delete this.boundTextures[e],e===this.currentTextureUnit&&(this.currentTextureUnit=-1)),e}uploadTexture(t,e,i,s=!1){let n=this.renderer.cache.getUnit(t),o=this.boundTextures[n];return typeof o=="undefined"||s?this.createTexture2D(n,t.getTexture(),this.renderer.settings.antiAlias?this.gl.LINEAR:this.gl.NEAREST,t.repeat,e,i,t.premultipliedAlpha):this.bindTexture2D(o,n),this.currentTextureUnit}addQuad(t,e,i,s,n,o,h,f,u,c){let a=this.vertexData;a.isFull(6)&&this.flush();let l=this.uploadTexture(t);this.currentShader.setUniform("uSampler",l);let d=this.viewMatrix,p=Ai[0].set(e,i),m=Ai[1].set(e+s,i),x=Ai[2].set(e,i+n),y=Ai[3].set(e+s,i+n);d.isIdentity()||(d.apply(p),d.apply(m),d.apply(x),d.apply(y)),a.push(p.x,p.y,o,h,c),a.push(m.x,m.y,f,h,c),a.push(x.x,x.y,o,u,c),a.push(x.x,x.y,o,u,c),a.push(m.x,m.y,f,h,c),a.push(y.x,y.y,f,u,c)}}class My extends fe{constructor(t){super(t),this.WebGLVersion=1,this.GPUVendor=void 0,this.GPURenderer=void 0,this.context=this.gl=this.getContextGL(this.getCanvas(),t.transparent,t.depthTest==="z-buffer"),this.vertexBuffer=this.gl.createBuffer(),this.maxTextures=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),this._colorStack=[],this._matrixStack=[],this._scissorStack=[],this._blendStack=[],this.currentTransform=new Xe,this.currentCompositor=void 0,this.currentProgram=void 0,this.compositors=new Map,this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBuffer),this.addCompositor(new(this.settings.compositor||Py)(this),"quad",!0),this.addCompositor(new(this.settings.compositor||Ay)(this),"primitive"),this.depthTest=t.depthTest,this.depthTest==="z-buffer"?(this.gl.enable(this.gl.DEPTH_TEST),this.gl.depthFunc(this.gl.LEQUAL),this.gl.depthMask(!0)):(this.gl.disable(this.gl.DEPTH_TEST),this.gl.depthMask(!1)),this.gl.disable(this.gl.SCISSOR_TEST),this.gl.enable(this.gl.BLEND),this.setBlendMode(this.settings.blendMode);let e=this.gl.getExtension("WEBGL_debug_renderer_info");e!==null&&(this.GPUVendor=this.gl.getParameter(e.UNMASKED_VENDOR_WEBGL),this.GPURenderer=this.gl.getParameter(e.UNMASKED_RENDERER_WEBGL)),this.customShader=void 0,this.cache=new qh(this.maxTextures),this.type="WebGL"+this.WebGLVersion,this.getCanvas().addEventListener("webglcontextlost",i=>{i.preventDefault(),this.isContextValid=!1,M(is,this)},!1),this.getCanvas().addEventListener("webglcontextrestored",()=>{this.reset(),this.isContextValid=!0,M($e,this)},!1),O(ke,()=>{this.reset()}),O(li,(i,s)=>{this.flush(),this.setViewport(0,0,i,s)})}reset(){super.reset(),this._colorStack.forEach(t=>{g.push(t)}),this._matrixStack.forEach(t=>{g.push(t)}),this._colorStack.length=0,this._matrixStack.length=0,this._blendStack.length=0,this.clear(),this.setViewport(),this.gl.getParameter(this.gl.ARRAY_BUFFER_BINDING)!==this.vertexBuffer&&this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBuffer),this.currentCompositor=void 0,this.currentProgram=void 0,this.customShader=void 0,this.compositors.forEach(t=>{this.isContextValid===!1?t.init(this):t.reset()}),this.setCompositor("quad"),this.gl.disable(this.gl.SCISSOR_TEST)}addCompositor(t,e="default",i=!1){if(typeof this.compositors.get(e)!="undefined")throw new Error("Invalid Compositor name");this.compositors.set(e,t),i===!0&&this.setCompositor(e)}setCompositor(t="default",e=this.customShader){let i=this.compositors.get(t);if(typeof i=="undefined")throw new Error("Invalid Compositor");return this.currentCompositor!==i&&(this.currentCompositor!==void 0&&this.currentCompositor.flush(),this.currentCompositor=i),t==="quad"&&typeof e=="object"?this.currentCompositor.useShader(e):this.currentCompositor.bind(),this.currentCompositor}resetTransform(){this.currentTransform.identity()}createPattern(t,e){if(this.setCompositor("quad"),k.WebGLVersion===1&&(!$t(t.width)||!$t(t.height))){let s=typeof t.src!="undefined"?t.src:t;throw new Error("[WebGL Renderer] "+s+" is not a POT texture ("+t.width+"x"+t.height+")")}let i=new lt(Kh(t.width,t.height,"pattern",e),t);return this.currentCompositor.uploadTexture(i),i}flush(){this.currentCompositor.flush()}setProjection(t){super.setProjection(t),this.currentCompositor.setProjection(t)}setViewport(t=0,e=0,i=this.getCanvas().width,s=this.getCanvas().height){this.gl.viewport(t,e,i,s)}clear(){let t=this.gl;t.clearColor(0,0,0,this.settings.transparent?0:1),this.depthTest==="z-buffer"?t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT):t.clear(t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT)}clearColor(t="#000000",e=!1){let i,s=this.gl;if(t instanceof st)i=t.toArray();else{let n=g.pull("me.Color");i=n.parseCSS(t).toArray(),g.push(n)}s.clearColor(i[0],i[1],i[2],e===!0?1:i[3]),s.clear(s.COLOR_BUFFER_BIT)}clearRect(t,e,i,s){this.save(),this.clipRect(t,e,i,s),this.clearColor(),this.restore()}drawImage(t,e,i,s,n,o,h,f,u){typeof s=="undefined"?(s=f=t.width,n=u=t.height,o=e,h=i,e=0,i=0):typeof o=="undefined"&&(o=e,h=i,f=s,u=n,s=t.width,n=t.height,e=0,i=0),this.settings.subPixel===!1&&(o|=0,h|=0),this.setCompositor("quad");let c=this.cache.get(t),a=c.getUVs(e+","+i+","+s+","+n);this.currentCompositor.addQuad(c,o,h,f,u,a[0],a[1],a[2],a[3],this.currentTint.toUint32(this.getGlobalAlpha()))}drawPattern(t,e,i,s,n){let o=t.getUVs("0,0,"+s+","+n);this.setCompositor("quad"),this.currentCompositor.addQuad(t,e,i,s,n,o[0],o[1],o[2],o[3],this.currentTint.toUint32(this.getGlobalAlpha()))}beginPath(){this.path2D.beginPath()}moveTo(t,e){this.path2D.moveTo(t,e)}lineTo(t,e){this.path2D.lineTo(t,e)}rect(t,e,i,s){this.path2D.rect(t,e,i,s)}roundRect(t,e,i,s,n){this.path2D.roundRect(t,e,i,s,n)}stroke(t,e){this.setCompositor("primitive"),typeof t=="undefined"?e===!0?this.currentCompositor.drawVertices(this.gl.TRIANGLES,this.path2D.triangulatePath()):this.currentCompositor.drawVertices(this.gl.LINES,this.path2D.points):super.stroke(t,e)}fill(t){this.stroke(t,!0)}closePath(){this.path2D.closePath()}getContextGL(t,e=!1,i=!1){if(typeof t=="undefined"||t===null)throw new Error("You must pass a canvas element in order to create a GL context");let s={alpha:e,antialias:this.settings.antiAlias,depth:i,stencil:!0,preserveDrawingBuffer:!1,premultipliedAlpha:e?this.settings.premultipliedAlpha:!1,powerPreference:this.settings.powerPreference,failIfMajorPerformanceCaveat:this.settings.failIfMajorPerformanceCaveat},n;if(this.settings.preferWebGL1===!1&&(n=t.getContext("webgl2",s),n&&(this.WebGLVersion=2)),n||(this.WebGLVersion=1,n=t.getContext("webgl",s)||t.getContext("experimental-webgl",s)),!n)throw new Error("A WebGL context could not be created.");return n}getContext(){return this.gl}setBlendMode(t="normal",e=this.gl){if(this.currentBlendMode!==t)switch(this.flush(),e.enable(e.BLEND),this.currentBlendMode=t,t){case"screen":e.blendFunc(e.ONE,e.ONE_MINUS_SRC_COLOR);break;case"lighter":case"additive":e.blendFunc(e.ONE,e.ONE);break;case"multiply":e.blendFunc(e.DST_COLOR,e.ONE_MINUS_SRC_ALPHA);break;default:e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA),this.currentBlendMode="normal";break}}restore(){if(this._matrixStack.length!==0){let t=this._colorStack.pop(),e=this._matrixStack.pop();this.currentColor.copy(t),this.currentTransform.copy(e),this.setBlendMode(this._blendStack.pop()),g.push(t),g.push(e)}this._scissorStack.length!==0?this.currentScissor.set(this._scissorStack.pop()):(this.gl.disable(this.gl.SCISSOR_TEST),this.currentScissor[0]=0,this.currentScissor[1]=0,this.currentScissor[2]=this.getCanvas().width,this.currentScissor[3]=this.getCanvas().height)}save(){this._colorStack.push(this.currentColor.clone()),this._matrixStack.push(this.currentTransform.clone()),this.gl.isEnabled(this.gl.SCISSOR_TEST)&&this._scissorStack.push(this.currentScissor.slice()),this._blendStack.push(this.getBlendMode())}rotate(t){this.currentTransform.rotate(t)}scale(t,e){this.currentTransform.scale(t,e)}setAntiAlias(t,e){super.setAntiAlias(t,e)}setGlobalAlpha(t){this.currentColor.alpha=t}getGlobalAlpha(){return this.currentColor.alpha}setColor(t){let e=this.currentColor.alpha;this.currentColor.copy(t),this.currentColor.alpha*=e}setLineWidth(t){this.getContext().lineWidth(t)}strokeArc(t,e,i,s,n,o=!1,h=!1){this.setCompositor("primitive"),this.path2D.beginPath(),this.path2D.arc(t,e,i,s,n,o),h===!1?this.currentCompositor.drawVertices(this.gl.LINES,this.path2D.points):this.currentCompositor.drawVertices(this.gl.TRIANGLES,this.path2D.triangulatePath())}fillArc(t,e,i,s,n,o=!1){this.strokeArc(t,e,i,s,n,o,!0)}strokeEllipse(t,e,i,s,n=!1){this.setCompositor("primitive"),this.path2D.beginPath(),this.path2D.ellipse(t,e,i,s,0,0,360),n===!1?this.currentCompositor.drawVertices(this.gl.LINES,this.path2D.points):this.currentCompositor.drawVertices(this.gl.TRIANGLES,this.path2D.triangulatePath())}fillEllipse(t,e,i,s){this.strokeEllipse(t,e,i,s,!1)}strokeLine(t,e,i,s){this.setCompositor("primitive"),this.path2D.beginPath(),this.path2D.moveTo(t,e),this.path2D.lineTo(i,s),this.currentCompositor.drawVertices(this.gl.LINES,this.path2D.points)}fillLine(t,e,i,s){this.strokeLine(t,e,i,s)}strokePolygon(t,e=!1){const i=t.points,s=i.length;this.setCompositor("primitive"),this.translate(t.pos.x,t.pos.y),this.path2D.beginPath();for(let n=0;n<s-1;n++){const o=i[n],h=i[n+1];this.path2D.moveTo(o.x,o.y),this.path2D.lineTo(h.x,h.y)}this.path2D.closePath(),e===!1?this.currentCompositor.drawVertices(this.gl.LINES,this.path2D.points):this.currentCompositor.drawVertices(this.gl.TRIANGLES,this.path2D.triangulatePath()),this.translate(-t.pos.x,-t.pos.y)}fillPolygon(t){this.strokePolygon(t,!0)}strokeRect(t,e,i,s,n=!1){this.setCompositor("primitive"),this.path2D.beginPath(),this.path2D.rect(t,e,i,s),n===!1?this.currentCompositor.drawVertices(this.gl.LINES,this.path2D.points):this.currentCompositor.drawVertices(this.gl.TRIANGLES,this.path2D.triangulatePath())}fillRect(t,e,i,s){this.strokeRect(t,e,i,s,!0)}strokeRoundRect(t,e,i,s,n,o=!1){this.setCompositor("primitive"),this.path2D.beginPath(),this.path2D.roundRect(t,e,i,s,n),o===!1?this.currentCompositor.drawVertices(this.gl.LINES,this.path2D.points):this.currentCompositor.drawVertices(this.gl.TRIANGLES,this.path2D.triangulatePath())}fillRoundRect(t,e,i,s,n){this.strokeRoundRect(t,e,i,s,n,!0)}strokePoint(t,e){this.strokeLine(t,e,t+1,e+1)}fillPoint(t,e){this.strokePoint(t,e)}setTransform(t,e,i,s,n,o){this.resetTransform(),this.transform(t,e,i,s,n,o)}transform(t,e,i,s,n,o){if(typeof t=="object"?this.currentTransform.multiply(t):this.currentTransform.transform(t,e,i,s,n,o),this.settings.subPixel===!1){let h=this.currentTransform.toArray();h[6]|=0,h[7]|=0}}translate(t,e){let i=this.currentTransform;if(i.translate(t,e),this.settings.subPixel===!1){let s=i.toArray();s[6]|=0,s[7]|=0}}clipRect(t,e,i,s){let n=this.getCanvas(),o=this.gl;if(t!==0||e!==0||i!==n.width||s!==n.height){let h=this.currentScissor;if(o.isEnabled(o.SCISSOR_TEST)&&h[0]===t&&h[1]===e&&h[2]===i&&h[3]===s)return;this.flush(),o.enable(this.gl.SCISSOR_TEST),o.scissor(t+this.currentTransform.tx,n.height-s-e-this.currentTransform.ty,i,s),h[0]=t,h[1]=e,h[2]=i,h[3]=s}else o.disable(o.SCISSOR_TEST)}setMask(t,e=!1){let i=this.gl;this.flush(),this.maskLevel===0&&(i.enable(i.STENCIL_TEST),i.clear(i.STENCIL_BUFFER_BIT)),this.maskLevel++,i.colorMask(!1,!1,!1,!1),i.stencilFunc(i.EQUAL,this.maskLevel,1),i.stencilOp(i.REPLACE,i.REPLACE,i.REPLACE),this.fill(t),this.flush(),i.colorMask(!0,!0,!0,!0),e===!0?i.stencilFunc(i.EQUAL,this.maskLevel+1,1):i.stencilFunc(i.NOTEQUAL,this.maskLevel+1,1),i.stencilOp(i.KEEP,i.KEEP,i.KEEP)}clearMask(){this.maskLevel>0&&(this.flush(),this.maskLevel=0,this.gl.disable(this.gl.STENCIL_TEST))}}let lo={offscreenCanvas:!1,willReadFrequently:!1,antiAlias:!1,context:"2d"};class Iy{constructor(t,e,i=lo){i=Object.assign(lo,i||{}),this.canvas=ei(t,e,i.offscreenCanvas),this.context=this.canvas.getContext(i.context,{willReadFrequently:i.willReadFrequently}),this.setAntiAlias(i.antiAlias)}onResetEvent(t,e){this.clear(),this.resize(t,e)}clear(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}setAntiAlias(t=!1){let e=this.canvas;Ur("imageSmoothingEnabled",t,this.context),typeof e.style!="undefined"&&(t!==!0?(e.style["image-rendering"]="optimizeSpeed",e.style["image-rendering"]="-moz-crisp-edges",e.style["image-rendering"]="-o-crisp-edges",e.style["image-rendering"]="-webkit-optimize-contrast",e.style["image-rendering"]="optimize-contrast",e.style["image-rendering"]="crisp-edges",e.style["image-rendering"]="pixelated",e.style.msInterpolationMode="nearest-neighbor"):e.style["image-rendering"]="auto")}resize(t,e){this.canvas.width=Math.round(t),this.canvas.height=Math.round(e)}getImageData(t,e,i,s){return t=E(Math.floor(t),0,this.canvas.width-1),e=E(Math.floor(e),0,this.canvas.height-1),i=E(i,1,this.canvas.width-t),s=E(s,1,this.canvas.height-e),this.context.getImageData(t,e,i,s)}toBlob(t){return typeof this.canvas.convertToBlob=="function"?this.canvas.convertToBlob(t):new Promise(function(e){this.canvas.toBlob(i=>{e(i)},t?t.type:void 0,t?t.quality:void 0)})}toImageBitmap(t){return new Promise(e=>{if(typeof this.canvas.transferToImageBitmap=="function")e(this.canvas.transferToImageBitmap());else{let i=new Image;i.src=this.canvas.toDataURL(t),i.onload=()=>{createImageBitmap(i).then(s=>e(s))}}})}toDataURL(t){return new Promise(e=>{e(this.canvas.toDataURL(t))})}invalidate(t){typeof t.gl!="undefined"&&(t.setCompositor("quad"),this.glTextureUnit=t.cache.getUnit(t.cache.get(this.canvas)),t.currentCompositor.unbindTexture2D(null,this.glTextureUnit))}destroy(){this.context=void 0,this.canvas=void 0}get width(){return this.canvas.width}set width(t){this.canvas.width=Math.round(t)}get height(){return this.canvas.height}set height(t){this.canvas.height=Math.round(t)}}class uo extends N{constructor(t,e,i){super(0,0,1/0,1/0),this.color=g.pull("Color").parseCSS(e),this.onResetEvent(t,e,i)}onResetEvent(t,e,i=0){this.name=t,this.pos.z=i,this.floating=!0,this.color.parseCSS(e)}draw(t,e){t.save(),t.clipRect(0,0,e.width,e.height),t.clearColor(this.color),t.restore()}destroy(){g.push(this.color),this.color=void 0,super.destroy()}}class cr extends rt{constructor(t,e,i){super(t,e,i),this.floating=!0,this.offset.set(t,e),this.ratio=g.pull("Vector2d",1,1),typeof i.ratio!="undefined"&&(kr(i.ratio)?this.ratio.set(i.ratio,+i.ratio):this.ratio.setV(i.ratio)),typeof i.anchorPoint=="undefined"?this.anchorPoint.set(0,0):typeof i.anchorPoint=="number"?this.anchorPoint.set(i.anchorPoint,i.anchorPoint):this.anchorPoint.setV(i.anchorPoint),this.repeat=i.repeat||"repeat",O($e,this.createPattern,this)}get repeat(){return this._repeat}set repeat(t){switch(this._repeat=t,this._repeat){case"no-repeat":this.repeatX=!1,this.repeatY=!1;break;case"repeat-x":this.repeatX=!0,this.repeatY=!1;break;case"repeat-y":this.repeatX=!1,this.repeatY=!0;break;default:this.repeatX=!0,this.repeatY=!0;break}this.resize(w.viewport.width,w.viewport.height),this.createPattern()}onActivateEvent(){O(Vi,this.updateLayer,this),O(Gt,this.resize,this),Ee(es,()=>{this.updateLayer(w.viewport.pos)}),this.ancestor.root!==!0&&this.updateLayer(w.viewport.pos)}resize(t,e){return super.resize(this.repeatX?1/0:t,this.repeatY?1/0:e)}createPattern(){this._pattern=k.createPattern(this.image,this._repeat)}updateLayer(t){const e=this.ratio.x,i=this.ratio.y;if(e===0&&i===0)return;const s=this.width,n=this.height,o=w.viewport.bounds.width,h=w.viewport.bounds.height,f=this.anchorPoint.x,u=this.anchorPoint.y,c=f*(e-1)*(o-w.viewport.width)+this.offset.x-e*t.x,a=u*(i-1)*(h-w.viewport.height)+this.offset.y-i*t.y;this.repeatX?this.pos.x=c%s:this.pos.x=c,this.repeatY?this.pos.y=a%n:this.pos.y=a,this.isDirty=!0}preDraw(t){t.save(),t.setGlobalAlpha(t.globalAlpha()*this.getOpacity()),t.setTint(this.tint),this.blendMode!==t.getBlendMode()&&t.setBlendMode(this.blendMode)}draw(t,e){const i=this.width,s=this.height,n=e.bounds.width,o=e.bounds.height,h=this.anchorPoint.x,f=this.anchorPoint.y;let u=this.pos.x,c=this.pos.y;this.ratio.x===0&&this.ratio.y===0&&(u=u+h*(n-i),c=c+f*(o-s)),t.translate(u,c),t.drawPattern(this._pattern,0,0,e.width*2,e.height*2)}onDeactivateEvent(){Ut(Vi,this.updateLayer),Ut(Gt,this.resize)}destroy(){g.push(this.ratio),this.ratio=void 0,Ut($e,this.createPattern),super.destroy()}}class fo extends rt{constructor(t,e,i){if(super(t,e,i),typeof i.width!="number"||typeof i.height!="number")throw new Error("height and width properties are mandatory");this.width=Math.floor(i.width),this.height=Math.floor(i.height),this.nss_width=this.width,this.nss_height=this.height,this.insetx=i.insetx,this.insety=i.insety}get width(){return super.width}set width(t){super.width=this.nss_width=t}get height(){return super.height}set height(t){super.height=this.nss_height=t}draw(t){let e=this.current,i=this.pos.x,s=this.pos.y,n=e.width,o=e.height,h=e.offset,f=this.offset;e.angle!==0&&(t.translate(-i,-s),t.rotate(e.angle),i-=o,n=e.height,o=e.width);let u=f.x+h.x,c=f.y+h.y,a=this.insetx||n/4,l=this.insety||o/4;t.drawImage(this.image,u,c,a,l,i,s,a,l),t.drawImage(this.image,u+n-a,c,a,l,i+this.nss_width-a,s,a,l),t.drawImage(this.image,u,c+o-l,a,l,i,s+this.nss_height-l,a,l),t.drawImage(this.image,u+n-a,c+o-l,a,l,i+this.nss_width-a,s+this.nss_height-l,a,l);let d=n-(a<<1),p=o-(l<<1),m=this.nss_width-(a<<1),x=this.nss_height-(l<<1);t.drawImage(this.image,u+a,c,d,l,i+a,s,m,l),t.drawImage(this.image,u+a,c+o-l,d,l,i+a,s+this.nss_height-l,m,l),t.drawImage(this.image,u,c+l,a,p,i,s+l,a,x),t.drawImage(this.image,u+n-a,c+l,a,p,i+this.nss_width-a,s+l,a,x),t.drawImage(this.image,u+a,c+l,d,p,i+a,s+l,m,x)}}function pr(r,t){r.font=t.font,r.fillStyle=t.fillStyle.toRGBA(),r.strokeStyle=t.strokeStyle.toRGBA(),r.lineWidth=t.lineWidth,r.textAlign=t.textAlign,r.textBaseline=t.textBaseline}const Ry=["ex","em","pt","px"],Oy=[12,24,.75,1];class Le extends N{constructor(t,e,i){super(t,e,i.width||0,i.height||0),this.fillStyle=g.pull("Color",0,0,0),this.strokeStyle=g.pull("Color",0,0,0),this.lineWidth=0,this.textAlign="left",this.textBaseline="top",this.lineHeight=1,this.wordWrapWidth=-1,this.fontSize=10,this._text=[],this.onResetEvent(t,e,i)}onResetEvent(t,e,i){typeof this.fillStyle=="undefined"&&(this.fillStyle=g.pull("Color",0,0,0)),typeof this.strokeStyle=="undefined"&&(this.strokeStyle=g.pull("Color",0,0,0)),typeof i.fillStyle!="undefined"&&(i.fillStyle instanceof st?this.fillStyle.copy(i.fillStyle):this.fillStyle.parseCSS(i.fillStyle)),typeof i.strokeStyle!="undefined"&&(i.strokeStyle instanceof st?this.strokeStyle.copy(i.strokeStyle):this.strokeStyle.parseCSS(i.strokeStyle)),this.lineWidth=i.lineWidth||0,this.textAlign=i.textAlign||"left",this.textBaseline=i.textBaseline||"top",this.lineHeight=i.lineHeight||1,this.wordWrapWidth=i.wordWrapWidth||-1,this.fontSize=10,typeof i.anchorPoint!="undefined"?this.anchorPoint.setV(i.anchorPoint):this.anchorPoint.set(0,0),typeof i.floating!="undefined"&&(this.floating=!!i.floating),this.setFont(i.font,i.size),i.bold===!0&&this.bold(),i.italic===!0&&this.italic(),this.canvasTexture=g.pull("CanvasTexture",2,2,{offscreenCanvas:!1}),this.metrics=new sl(this),this.setText(i.text)}bold(){return this.font="bold "+this.font,this.isDirty=!0,this}italic(){return this.font="italic "+this.font,this.isDirty=!0,this}setFont(t,e=10){let i=t.split(",").map(s=>(s=s.trim(),/(^".*"$)|(^'.*'$)/.test(s)?s:'"'+s+'"'));if(typeof e=="number")this.fontSize=e,e+="px";else{let s=e.match(/([-+]?[\d.]*)(.*)/);this.fontSize=parseFloat(s[1]),s[2]?this.fontSize*=Oy[Ry.indexOf(s[2])]:e+="px"}return this.height=this.fontSize,this.font=e+" "+i.join(","),this.isDirty=!0,this}setText(t=""){let e=this.getBounds();this._text.toString()!==t.toString()&&(Array.isArray(t)?this._text=t:this._text=(""+t).split(`
`)),this._text.length>0&&this.wordWrapWidth>0&&(this._text=this.metrics.wordWrap(this._text,this.wordWrapWidth,this.canvasTexture.context)),e.addBounds(this.metrics.measureText(this._text,this.canvasTexture.context),!0);let i=Math.ceil(this.metrics.width),s=Math.ceil(this.metrics.height);return k.WebGLVersion===1&&(i=Gs(this.metrics.width),s=Gs(this.metrics.height)),this.canvasTexture.invalidate(k),(this.canvasTexture.width<i||this.canvasTexture.height<s)&&this.canvasTexture.resize(i,s),this.canvasTexture.clear(),this._drawFont(this.canvasTexture.context,this._text,this.pos.x-this.metrics.x,this.pos.y-this.metrics.y),this.isDirty=!0,this}measureText(t,e=this._text){return this.metrics.measureText(e,this.canvasTexture.context)}draw(t,e,i=this.pos.x,s=this.pos.y){typeof this.ancestor=="undefined"&&((this.pos.x!==i||this.pos.y!==s)&&(this.pos.x=i,this.pos.y=s,this.isDirty=!0),this.setText(e),t.save(),t.setGlobalAlpha(t.globalAlpha()*this.getOpacity())),i=this.metrics.x,s=this.metrics.y,t.settings.subPixel===!1&&(i=~~i,s=~~s),t.drawImage(this.canvasTexture.canvas,i,s),typeof this.ancestor=="undefined"&&t.restore()}drawStroke(t,e,i,s){this.draw(t,e,i,s)}_drawFont(t,e,i,s){pr(t,this);for(let n=0;n<e.length;n++){const o=e[n].trimEnd();this.fillStyle.alpha>0&&t.fillText(o,i,s),this.lineWidth>0&&this.strokeStyle.alpha>0&&t.strokeText(o,i,s),s+=this.metrics.lineHeight()}return this.metrics}destroy(){typeof k.gl!="undefined"&&(k.setCompositor("quad"),k.currentCompositor.deleteTexture2D(k.currentCompositor.getTexture2D(this.glTextureUnit)),this.glTextureUnit=void 0),k.cache.delete(this.canvasTexture.canvas),g.push(this.canvasTexture),this.canvasTexture=void 0,g.push(this.fillStyle),g.push(this.strokeStyle),this.fillStyle=this.strokeStyle=void 0,this.metrics=void 0,this._text.length=0,super.destroy()}}class sl extends ct{constructor(t){super(),this.ancestor=t,this.setMinMax(0,0,0,0)}lineHeight(){return this.ancestor instanceof Le?this.ancestor.fontSize*this.ancestor.lineHeight:this.ancestor.fontData.capHeight*this.ancestor.lineHeight*this.ancestor.fontScale.y}lineWidth(t,e){if(this.ancestor instanceof Le)return e.measureText(t).width;{let i=t.split("");const s=i.length;let n=0,o=null;for(let h=0;h<s;h++){let f=i[h].charCodeAt(0),u=this.ancestor.fontData.glyphs[f];if(typeof u!="undefined"){let c=o&&o.kerning?o.getKerning(f):0;n+=(u.xadvance+c)*this.ancestor.fontScale.x,o=u}}return n}}measureText(t,e){let i;Array.isArray(t)?i=t:i=(""+t).split(`
`),typeof e!="undefined"&&(e.save(),pr(e,this.ancestor)),this.width=this.height=0;for(let s=0;s<i.length;s++)this.width=Math.max(this.lineWidth(i[s].trimEnd(),e),this.width),this.height+=this.lineHeight();return this.width=Math.ceil(this.width),this.height=Math.ceil(this.height),this.x=Math.floor(this.ancestor.textAlign==="right"?this.ancestor.pos.x-this.width:this.ancestor.textAlign==="center"?this.ancestor.pos.x-this.width/2:this.ancestor.pos.x),this.y=Math.floor(this.ancestor.textBaseline.search(/^(top|hanging)$/)===0?this.ancestor.pos.y:this.ancestor.textBaseline==="middle"?this.ancestor.pos.y-this.lineHeight()/2:this.ancestor.pos.y-this.lineHeight()),typeof e!="undefined"&&e.restore(),this}wordWrap(t,e,i){let s,n="",o=[];Array.isArray(t)&&(t=t.join(" ")),s=t.replace(/[\r\n]+/g," ").split(" "),typeof i!="undefined"&&(i.save(),pr(i,this.ancestor));for(let h=0;h<s.length;h++){let f=s[h];this.lineWidth(n+f+" ",i)<e?n+=f+" ":(o.push(n+`
`),n=f+" ")}return o.push(n),typeof i!="undefined"&&i.restore(),o}}class Ce extends N{constructor(t,e,i){super(t,e,i.width||0,i.height||0),this.textAlign=i.textAlign||"left",this.textBaseline=i.textBaseline||"top",this.lineHeight=i.lineHeight||1,this.wordWrapWidth=i.wordWrapWidth||-1,this._text=[],this.fontScale=g.pull("Vector2d",1,1),this.fontImage=typeof i.font=="object"?i.font:mt(i.font),typeof i.fontData!="string"?this.fontData=g.pull("BitmapTextData",ur(i.font)):this.fontData=g.pull("BitmapTextData",i.fontData.includes("info face")?i.fontData:ur(i.fontData)),typeof i.floating!="undefined"&&(this.floating=!!i.floating),typeof i.fillStyle!="undefined"&&(this.fillStyle=i.fillStyle),typeof i.anchorPoint!="undefined"?this.anchorPoint.set(i.anchorPoint.x,i.anchorPoint.y):this.anchorPoint.set(0,0),this.metrics=new sl(this),typeof i.size=="number"&&i.size!==1&&this.resize(i.size),this.setText(i.text)}set(t,e){return this.textAlign=t,e&&this.resize(e),this.isDirty=!0,this}setText(t=""){return this._text.toString()!==t.toString()&&(Array.isArray(t)?this._text=t:this._text=(""+t).split(`
`),this.isDirty=!0),this._text.length>0&&this.wordWrapWidth>0&&(this._text=this.metrics.wordWrap(this._text,this.wordWrapWidth)),this.updateBounds(),this}updateBounds(t=!0){let e=this.getBounds();if(e.clear(),typeof this.metrics!="undefined"){let i,s;switch(e.addBounds(this.metrics.measureText(this._text)),this.textAlign){case"right":i=this.metrics.width*1;break;case"center":i=this.metrics.width*.5;break;default:i=this.metrics.width*0;break}switch(this.textBaseline){case"middle":s=this.metrics.height*.5;break;case"ideographic":case"alphabetic":case"bottom":s=this.metrics.height*1;break;default:s=this.metrics.height*0;break}e.translate(i,s)}return t===!0&&typeof this.ancestor!="undefined"&&typeof this.ancestor.getAbsolutePosition=="function"&&this.floating!==!0&&e.translate(this.ancestor.getAbsolutePosition()),e}get fillStyle(){return this.tint}set fillStyle(t){t instanceof st?this.tint.copy(t):this.tint.parseCSS(t)}resize(t){return this.fontScale.set(t,t),this.updateBounds(),this.isDirty=!0,this}measureText(t=this._text){return this.metrics.measureText(t)}draw(t,e,i,s){let n=t.globalAlpha();typeof this.ancestor=="undefined"?(this.setText(e),t.setGlobalAlpha(n*this.getOpacity())):(i=this.pos.x,s=this.pos.y);let o=i,h=this.metrics.lineHeight(),f=0;for(let u=0;u<this._text.length;u++){i=o;const c=this._text[u].trimEnd();let a=this.metrics.lineWidth(c);switch(this.textAlign){case"right":i-=a;break;case"center":i-=a*.5;break}switch(this.textBaseline){case"middle":s-=h*.5;break;case"ideographic":case"alphabetic":case"bottom":s-=h;break}this.isDirty===!0&&typeof this.ancestor=="undefined"&&(u===0&&(this.pos.y=s),f<a&&(f=a,this.pos.x=i));let l=null;for(let d=0,p=c.length;d<p;d++){let m=c.charCodeAt(d),x=this.fontData.glyphs[m];if(typeof x!="undefined"){let y=x.width,_=x.height,v=l&&l.kerning?l.getKerning(m):0,b=this.fontScale.x,T=this.fontScale.y;y!==0&&_!==0&&t.drawImage(this.fontImage,x.x,x.y,y,_,i+x.xoffset*b,s+x.yoffset*T,y*b,_*T),i+=(x.xadvance+v)*b,l=x}else console.warn("BitmapText: no defined Glyph in for "+String.fromCharCode(m))}s+=h}typeof this.ancestor=="undefined"&&t.setGlobalAlpha(n),this.isDirty=!1}destroy(){g.push(this.fontScale),this.fontScale=void 0,g.push(this.fontData),this.fontData=void 0,this._text.length=0,this.metrics=void 0,super.destroy()}}class rl extends rt{constructor(t,e,i){super(t,e,i),this.isClickable=!0,this.holdThreshold=250,this.isHoldable=!1,this.hover=!1,this.holdTimeout=-1,this.released=!0,this.floating=!0,this.isKinematic=!1}clicked(t){if(t.button===0&&this.isClickable)return this.isDirty=!0,this.released=!1,this.isHoldable&&(z.clearTimeout(this.holdTimeout),this.holdTimeout=z.setTimeout(()=>this.hold(),this.holdThreshold,!1),this.released=!1),this.onClick(t)}onClick(t){return!1}enter(t){return this.hover=!0,this.isDirty=!0,this.onOver(t)}onOver(t){}leave(t){return this.hover=!1,this.isDirty=!0,this.release(t),this.onOut(t)}onOut(t){}release(t){if(this.released===!1)return this.released=!0,this.isDirty=!0,z.clearTimeout(this.holdTimeout),this.holdTimeout=-1,this.onRelease(t)}onRelease(){return!1}hold(){z.clearTimeout(this.holdTimeout),this.holdTimeout=-1,this.isDirty=!0,this.released||this.onHold()}onHold(){}onActivateEvent(){ye("pointerdown",this,t=>this.clicked(t)),ye("pointerup",this,t=>this.release(t)),ye("pointercancel",this,t=>this.release(t)),ye("pointerenter",this,t=>this.enter(t)),ye("pointerleave",this,t=>this.leave(t))}onDeactivateEvent(){Qt("pointerdown",this),Qt("pointerup",this),Qt("pointercancel",this),Qt("pointerenter",this),Qt("pointerleave",this),z.clearTimeout(this.holdTimeout),this.holdTimeout=-1}}class co extends rt{constructor(t,e,i){super(t,e,i),this.name=i.name,this.type=i.type,this.id=i.id;let s=i.shapes;typeof s=="undefined"&&(s=g.pull("Polygon",0,0,[g.pull("Vector2d",0,0),g.pull("Vector2d",this.width,0),g.pull("Vector2d",this.width,this.height)])),this.body=new xt(this,s),this.body.collisionType=F.types.COLLECTABLE_OBJECT,this.body.setCollisionMask(F.types.PLAYER_OBJECT),this.body.setStatic(!0),i.anchorPoint?this.anchorPoint.set(i.anchorPoint.x,i.anchorPoint.y):this.anchorPoint.set(0,0)}}class po extends N{constructor(t,e,i){super(t,e,i.width||0,i.height||0),this.anchorPoint.set(0,0),this.fade=i.fade,this.duration=i.duration,this.fading=!1,this.name="Trigger",this.type=i.type,this.id=i.id,this.gotolevel=i.to,this.triggerSettings={event:"level"},["type","container","onLoaded","flatten","setViewportBounds","to"].forEach(n=>{typeof i[n]!="undefined"&&(this.triggerSettings[n]=i[n])});let s=i.shapes;typeof s=="undefined"&&(s=g.pull("Polygon",0,0,[g.pull("Vector2d",0,0),g.pull("Vector2d",this.width,0),g.pull("Vector2d",this.width,this.height)])),this.body=new xt(this,s),this.body.collisionType=F.types.ACTION_OBJECT,this.body.setCollisionMask(F.types.PLAYER_OBJECT),this.body.setStatic(!0),this.resize(this.body.getBounds().width,this.body.getBounds().height)}getTriggerSettings(){let t=this.ancestor.getRootAncestor();return typeof this.triggerSettings.container=="string"&&(this.triggerSettings.container=t.getChildByName(this.triggerSettings.container)[0]),this.triggerSettings}onFadeComplete(){let t=this.ancestor.getRootAncestor();De.load(this.gotolevel,this.getTriggerSettings()),t.app.viewport.fadeOut(this.fade,this.duration)}triggerEvent(){let t=this.getTriggerSettings(),e=this.ancestor.getRootAncestor();if(t.event==="level")this.gotolevel=t.to,this.fade&&this.duration?this.fading||(this.fading=!0,e.app.viewport.fadeIn(this.fade,this.duration,()=>this.onFadeComplete())):De.load(this.gotolevel,t);else throw new Error("Trigger invalid type")}onCollision(t,e){return this.name==="Trigger"&&this.triggerEvent.apply(this),!1}}function By(r){let t=r.texture.context,e=r.texture.width/2,i=r.texture.height/2,s=r.radiusX,n=r.radiusY,o,h,f,u,c;r.texture.clear(),s>=n?(o=1,f=1,h=n/s,u=s/n,c=t.createRadialGradient(e,i*u,0,e,n*u,s)):(h=1,u=1,o=s/n,f=n/s,c=t.createRadialGradient(e*f,i,0,e*f,i,n)),c.addColorStop(0,r.color.toRGBA(r.intensity)),c.addColorStop(1,r.color.toRGBA(0)),t.fillStyle=c,t.setTransform(o,0,0,h,0,0),t.fillRect(0,0,r.texture.width*f,r.texture.height*u)}class go extends N{constructor(t,e,i,s=i,n="#FFF",o=.7){super(t,e,i*2,s*2),this.color=g.pull("Color").parseCSS(n),this.radiusX=i,this.radiusY=s,this.intensity=o,this.blendMode="lighter",this.visibleArea=g.pull("Ellipse",this.centerX,this.centerY,this.width,this.height),this.texture=g.pull("CanvasTexture",this.width,this.height,{offscreenCanvas:!1}),this.anchorPoint.set(0,0),By(this)}getVisibleArea(){return this.visibleArea.setShape(this.getBounds().centerX,this.getBounds().centerY,this.width,this.height)}draw(t,e){t.drawImage(this.texture.canvas,this.getBounds().x,this.getBounds().y)}destroy(){g.push(this.color),this.color=void 0,g.push(this.texture),this.texture=void 0,g.push(this.visibleArea),this.visibleArea=void 0,super.destroy()}}const Ve=9,yo=1<<Ve;class nl{constructor(){this.id=0,this.x=0,this.y=0,this.width=0,this.height=0,this.u=0,this.v=0,this.u2=0,this.v2=0,this.xoffset=0,this.yoffset=0,this.xadvance=0,this.fixedWidth=!1}getKerning(t){if(this.kerning){let e=this.kerning[t>>>Ve];if(e)return e[t&yo-1]||0}return 0}setKerning(t,e){this.kerning||(this.kerning={});let i=this.kerning[t>>>Ve];typeof i=="undefined"&&(this.kerning[t>>>Ve]={},i=this.kerning[t>>>Ve]),i[t&yo-1]=e}}const mo=["M","N","B","D","C","E","F","K","A","G","H","I","J","L","O","P","Q","R","S","T","U","V","W","X","Y","Z"];function xo(r,t){let e=r.match(t);if(!e)throw new Error("Could not find pattern "+t+" in string: "+r);return e[0].split("=")[1]}function Dy(r){let t=Object.keys(r);for(let e=0;e<t.length;e++)if(t[e]>32)return r[t[e]];return null}function Ly(r){let t=" ".charCodeAt(0),e=r[t];e||(e=new nl,e.id=t,e.xadvance=Dy(r).xadvance,r[t]=e)}class vo{constructor(t){this.onResetEvent(t)}onResetEvent(t){this.padTop=0,this.padRight=0,this.padBottom=0,this.padLeft=0,this.lineHeight=0,this.capHeight=1,this.descent=0,this.glyphs={},this.parse(t)}parse(t){if(!t)throw new Error("File containing font data was empty, cannot load the bitmap font.");let e=t.split(/\r\n|\n/),i=t.match(/padding\=\d+,\d+,\d+,\d+/g);if(!i)throw new Error("Padding not found in first line");let s=i[0].split("=")[1].split(",");this.padTop=parseFloat(s[0]),this.padLeft=parseFloat(s[1]),this.padBottom=parseFloat(s[2]),this.padRight=parseFloat(s[3]),this.lineHeight=parseFloat(xo(e[1],/lineHeight\=\d+/g));let n=parseFloat(xo(e[1],/base\=\d+/g)),o=this.padTop+this.padBottom,h=null;for(let u=4;u<e.length;u++){let c=e[u],a=c.split(/=|\s+/);if(!(!c||/^kernings/.test(c)))if(/^kerning\s/.test(c)){let l=parseFloat(a[2]),d=parseFloat(a[4]),p=parseFloat(a[6]);h=this.glyphs[l],h!==null&&typeof h!="undefined"&&h.setKerning(d,p)}else{h=new nl;let l=parseFloat(a[2]);h.id=l,h.x=parseFloat(a[4]),h.y=parseFloat(a[6]),h.width=parseFloat(a[8]),h.height=parseFloat(a[10]),h.xoffset=parseFloat(a[12]),h.yoffset=parseFloat(a[14]),h.xadvance=parseFloat(a[16]),h.width>0&&h.height>0&&(this.descent=Math.min(n+h.yoffset,this.descent)),this.glyphs[l]=h}}this.descent+=this.padBottom,Ly(this.glyphs);let f=null;for(let u=0;u<mo.length;u++){let c=mo[u];if(f=this.glyphs[c.charCodeAt(0)],f)break}if(f)this.capHeight=f.height;else for(let u in this.glyphs)if(this.glyphs.hasOwnProperty(u)){if(h=this.glyphs[u],h.height===0||h.width===0)continue;this.capHeight=Math.max(this.capHeight,h.height)}this.capHeight-=o}}const gr=-1,ky=0,yr=1;let R=[];for(let r=0;r<10;r++)R.push(new C);let Kt=[];for(let r=0;r<5;r++)Kt.push([]);function _o(r,t,e){let i=Number.MAX_VALUE,s=-Number.MAX_VALUE,n=r.length;for(let o=0;o<n;o++){const h=r[o].dot(t);h<i&&(i=h),h>s&&(s=h)}e[0]=i,e[1]=s}function bo(r,t,e,i,s,n){let o=Kt.pop(),h=Kt.pop(),f=R.pop().copy(t).sub(r),u=f.dot(s);if(_o(e,s,o),_o(i,s,h),h[0]+=u,h[1]+=u,o[0]>h[1]||h[0]>o[1])return R.push(f),Kt.push(o),Kt.push(h),!0;if(n){let c=0;if(o[0]<h[0])if(n.aInB=!1,o[1]<h[1])c=o[1]-h[0],n.bInA=!1;else{let l=o[1]-h[0],d=h[1]-o[0];c=l<d?l:-d}else if(n.bInA=!1,o[1]>h[1])c=o[0]-h[1],n.aInB=!1;else{let l=o[1]-h[0],d=h[1]-o[0];c=l<d?l:-d}let a=Math.abs(c);a<n.overlap&&(n.overlap=a,n.overlapN.copy(s),c<0&&n.overlapN.negateSelf())}return R.push(f),Kt.push(o),Kt.push(h),!1}function Rs(r,t){let e=r.length2(),i=t.dot(r);return i<0?gr:i>e?yr:ky}function Fy(r,t,e,i,s){let n=t.points,o=t.normals,h=o.length,f=i.points,u=i.normals,c=u.length,a=R.pop().copy(r.pos).add(r.ancestor.getAbsolutePosition()).add(t.pos),l=R.pop().copy(e.pos).add(e.ancestor.getAbsolutePosition()).add(i.pos);for(let d=0;d<h;d++)if(bo(a,l,n,f,o[d],s))return R.push(a),R.push(l),!1;for(let d=0;d<c;d++)if(bo(a,l,n,f,u[d],s))return R.push(a),R.push(l),!1;return s&&(s.a=r,s.b=e,s.overlapV.copy(s.overlapN).scale(s.overlap)),R.push(a),R.push(l),!0}function Ny(r,t,e,i,s){let n=R.pop().copy(e.pos).add(e.ancestor.getAbsolutePosition()).add(i.pos).sub(r.pos).add(r.ancestor.getAbsolutePosition()).sub(t.pos),o=t.radius,h=i.radius,f=o+h,u=f*f,c=n.length2();if(c>u)return R.push(n),!1;if(s){let a=Math.sqrt(c);s.a=r,s.b=e,s.overlap=f-a,s.overlapN.copy(n.normalize()),s.overlapV.copy(n).scale(s.overlap),s.aInB=o<=h&&a<=h-o,s.bInA=h<=o&&a<=o-h}return R.push(n),!0}function ol(r,t,e,i,s){let n=R.pop().copy(e.pos).add(e.ancestor.getAbsolutePosition()).add(i.pos).sub(r.pos).add(r.ancestor.getAbsolutePosition()).sub(t.pos),o=i.radius,h=o*o,f=t.points,u=t.edges,c=u.length,a=R.pop(),l=R.pop(),d=R.pop(),p=0;for(let m=0;m<c;m++){const x=m===c-1?0:m+1,y=m===0?c-1:m-1;let _=0,v=null;a.copy(u[m]),d.copy(n).sub(f[m]),s&&d.length2()>h&&(s.aInB=!1);let b=Rs(a,d),T=!0;if(b===gr){let A=null;if(c>1&&(a.copy(u[y]),A=R.pop().copy(n).sub(f[y]),b=Rs(a,A),b!==yr&&(T=!1)),T){if(p=d.length(),p>o)return R.push(n),R.push(a),R.push(l),R.push(d),A&&R.push(A),!1;s&&(s.bInA=!1,v=d.normalize(),_=o-p)}A&&R.push(A)}else if(b===yr){if(c>1&&(a.copy(u[x]),d.copy(n).sub(f[x]),b=Rs(a,d),b!==gr&&(T=!1)),T){if(p=d.length(),p>o)return R.push(n),R.push(a),R.push(l),R.push(d),!1;s&&(s.bInA=!1,v=d.normalize(),_=o-p)}}else{l.copy(t.normals[m]),p=d.dot(l);let A=Math.abs(p);if((c===1||p>0)&&A>o)return R.push(n),R.push(a),R.push(l),R.push(d),!1;s&&(v=l,_=o-p,(p>=0||_<2*o)&&(s.bInA=!1))}v&&s&&Math.abs(_)<Math.abs(s.overlap)&&(s.overlap=_,s.overlapN.copy(v))}return s&&(s.a=r,s.b=e,s.overlapV.copy(s.overlapN).scale(s.overlap)),R.push(n),R.push(a),R.push(l),R.push(d),!0}function Uy(r,t,e,i,s){let n=ol(e,i,r,t,s);if(n&&s){let o=s.a,h=s.aInB;s.overlapN.negateSelf(),s.overlapV.negateSelf(),s.a=s.b,s.b=o,s.aInB=s.bInA,s.bInA=h}return n}var wo={__proto__:null,testEllipseEllipse:Ny,testEllipsePolygon:Uy,testPolygonEllipse:ol,testPolygonPolygon:Fy};class Vy{constructor(){this.a=null,this.b=null,this.overlapN=new C,this.overlapV=new C,this.aInB=!0,this.bInA=!0,this.indexShapeA=-1,this.indexShapeB=-1,this.overlap=Number.MAX_VALUE}clear(){return this.aInB=!0,this.bInA=!0,this.overlap=Number.MAX_VALUE,this.indexShapeA=-1,this.indexShapeB=-1,this}}let zy={pos:new C(0,0),ancestor:{_absPos:new C(0,0),getAbsolutePosition:function(){return this._absPos}}},Os=new ct,Bs=new ct;class Gy{constructor(t){this.world=t,this.response=new Vy}shouldCollide(t,e){let i=t.body,s=e.body;return typeof i=="object"&&typeof s=="object"&&t!==e&&t.isKinematic!==!0&&e.isKinematic!==!0&&i.shapes.length>0&&s.shapes.length>0&&!(i.isStatic===!0&&s.isStatic===!0)&&(i.collisionMask&s.collisionType)!==0&&(i.collisionType&s.collisionMask)!==0}collides(t,e,i=this.response){for(let s=t.shapes.length,n;s--,n=t.shapes[s];)for(let o=e.shapes.length,h;o--,h=e.shapes[o];)if(wo["test"+n.type+h.type].call(this,t.ancestor,n,e.ancestor,h,i.clear())===!0)return i.indexShapeA=s,i.indexShapeB=o,!0;return!1}collisions(t){let e=0,i=this.world.broadphase.retrieve(t);return Os.addBounds(t.getBounds(),!0),Os.addBounds(t.body.getBounds()),i.forEach(s=>{this.shouldCollide(t,s)&&(Bs.addBounds(s.getBounds(),!0),Bs.addBounds(s.body.getBounds()),Os.overlaps(Bs)&&this.collides(t.body,s.body)&&(e++,t.onCollision&&t.onCollision(this.response,s)!==!1&&t.body.isStatic===!1&&t.body.respondToCollision.call(t.body,this.response),s.onCollision&&s.onCollision(this.response,t)!==!1&&s.body.isStatic===!1&&s.body.respondToCollision.call(s.body,this.response)))}),e>0}rayCast(t,e=[]){let i=0,s=this.world.broadphase.retrieve(t);for(let n=s.length,o;n--,o=s[n];)if(o.body&&t.getBounds().overlaps(o.getBounds())){const h=o.body.shapes.length;if(o.body.shapes.length===0)continue;let f=t,u=0;do{let c=o.body.getShape(u);wo["test"+f.type+c.type].call(this,zy,f,o,c)&&(e[i]=o,i++),u++}while(u<h)}return e.length=i,e}}class jy extends Q{constructor(t=0,e=0,i=1/0,s=1/0){super(t,e,i,s,!0),this.name="rootContainer",this.anchorPoint.set(0,0),this.app=void 0,this.physic="builtin",this.fps=60,this.gravity=new C(0,.98),this.preRender=!1,this.bodies=new Set,this.broadphase=new wa(this,this.getBounds().clone(),F.maxChildren,F.maxDepth),this.detector=new Gy(this),O(ke,this.reset,this),O(es,()=>{this.broadphase.clear(this.getBounds())})}reset(){this.broadphase.clear(),this.anchorPoint.set(0,0),super.reset(),this.bodies.clear()}addBody(t){return this.physic==="builtin"&&this.bodies.add(t),this}removeBody(t){return this.physic==="builtin"&&this.bodies.delete(t),this}bodyApplyGravity(t){if(!t.ignoreGravity&&t.gravityScale!==0){let e=this.gravity;t.force.x+=t.mass*e.x*t.gravityScale,t.force.y+=t.mass*e.y*t.gravityScale}}update(t){return(this.physic==="builtin"||Dh()===!0)&&(this.broadphase.clear(),this.broadphase.insertContainer(this)),this.step(t),super.update(t)}step(t){if(this.physic==="builtin"){let e=L.isPaused();this.bodies.forEach(i=>{if(!i.isStatic){let s=i.ancestor;!(e&&!s.updateWhenPaused)&&(s.inViewport||s.alwaysUpdate)&&(this.bodyApplyGravity(i),i.update(t)===!0&&(s.isDirty=!0),this.detector.collisions(s),i.force.set(0,0))}})}M(Ia,t)}}const Hy={width:1,height:1,image:void 0,textureSize:8,tint:"#fff",totalParticles:50,angle:Math.PI/2,angleVariation:0,minLife:1e3,maxLife:3e3,speed:2,speedVariation:1,minRotation:0,maxRotation:0,minStartScale:1,maxStartScale:1,minEndScale:0,maxEndScale:0,gravity:0,wind:0,followTrajectory:!1,textureAdditive:!1,blendMode:"normal",onlyInViewport:!0,floating:!1,maxParticles:10,frequency:100,duration:1/0,framesToSkip:0};function Yy(r=8,t=8){let e=g.pull("CanvasTexture",r,t,{offscreenCanvas:!0});return e.context.fillStyle="#fff",e.context.fillRect(0,0,r,t),e}class al extends Q{constructor(t,e,i={}){super(t,e,i.width|1,i.height|1),this.settings={},this.centerOn(t,e),this._stream=!1,this._frequencyTimer=0,this._durationTimer=0,this._enabled=!1,this.alwaysUpdate=!0,this.autoSort=!1,this._updateCount=0,this._dt=0,this.reset(i)}reset(t={}){Object.assign(this.settings,Hy,t),typeof this.settings.image=="undefined"&&(this._defaultParticle=Yy(t.textureSize,t.textureSize),this.settings.image=this._defaultParticle.canvas),this.floating=this.settings.floating,this.isDirty=!0}getRandomPointX(){return wt(0,this.getBounds().width)}getRandomPointY(){return wt(0,this.getBounds().height)}addParticles(t){for(let e=0;e<t;e++)this.addChild(g.pull("Particle",this),this.pos.z);this.isDirty=!0}isRunning(){return this._enabled&&this._stream}streamParticles(t){this._enabled=!0,this._stream=!0,this.settings.frequency=Math.max(1,this.settings.frequency),this._durationTimer=typeof t=="number"?t:this.settings.duration}stopStream(){this._enabled=!1}burstParticles(t){this._enabled=!0,this._stream=!1,this.addParticles(typeof t=="number"?t:this.settings.totalParticles),this._enabled=!1}update(t){if(++this._updateCount>this.settings.framesToSkip&&(this._updateCount=0),this._updateCount>0)return this._dt+=t,this.isDirty;if(t+=this._dt,this._dt=0,this.isDirty|=super.update(t),this._enabled&&this._stream){if(this._durationTimer!==1/0&&(this._durationTimer-=t,this._durationTimer<=0))return this.stopStream(),this.isDirty;this._frequencyTimer+=t;const e=this.children.length;e<this.settings.totalParticles&&this._frequencyTimer>=this.settings.frequency&&(e+this.settings.maxParticles<=this.settings.totalParticles?this.addParticles(this.settings.maxParticles):this.addParticles(this.settings.totalParticles-e),this._frequencyTimer=0,this.isDirty=!0)}return this.isDirty}destroy(){super.destroy(arguments),typeof this._defaultParticle!="undefined"&&(g.push(this._defaultParticle),this._defaultParticle=void 0),this.settings.image=void 0,this.settings=void 0}}class To extends N{constructor(t){super(t.getRandomPointX(),t.getRandomPointY(),t.settings.image.width,t.settings.image.height),this.onResetEvent(t,!0)}onResetEvent(t,e=!1){e===!1?(this.pos.set(t.getRandomPointX(),t.getRandomPointY()),this.resize(t.settings.image.width,t.settings.image.height),this.currentTransform.identity()):this.vel=g.pull("Vector2d"),this.image=t.settings.image,this.alwaysUpdate=!0,typeof t.settings.tint=="string"&&this.tint.parseCSS(t.settings.tint),t.settings.textureAdditive===!0&&(this.blendMode="additive"),t.settings.blendMode!=="normal"&&(this.blendMode=t.settings.blendMode);let i=t.settings.angle+(t.settings.angleVariation>0?(wt(0,2)-1)*t.settings.angleVariation:0),s=t.settings.speed+(t.settings.speedVariation>0?(wt(0,2)-1)*t.settings.speedVariation:0);this.vel.set(s*Math.cos(i),-s*Math.sin(i)),this.life=wt(t.settings.minLife,t.settings.maxLife),this.startLife=this.life,this.startScale=E(wt(t.settings.minStartScale,t.settings.maxStartScale),t.settings.minStartScale,t.settings.maxStartScale),this.endScale=E(wt(t.settings.minEndScale,t.settings.maxEndScale),t.settings.minEndScale,t.settings.maxEndScale),this.gravity=t.settings.gravity,this.wind=t.settings.wind,this.followTrajectory=t.settings.followTrajectory,this.onlyInViewport=t.settings.onlyInViewport,this._deltaInv=z.maxfps/1e3,t.settings.followTrajectory||(this.angle=wt(t.settings.minRotation,t.settings.maxRotation))}update(t){let e=t*this._deltaInv;if(this.life=this.life>t?this.life-t:0,this.life<=0)return this.ancestor.removeChild(this),!1;let i=this.life/this.startLife,s=this.startScale;this.startScale>this.endScale?(s*=i,s=s<this.endScale?this.endScale:s):this.startScale<this.endScale&&(s/=i,s=s>this.endScale?this.endScale:s),this.alpha=i,this.vel.x+=this.wind*e,this.vel.y+=this.gravity*e;let n=this.followTrajectory?Math.atan2(this.vel.y,this.vel.x):this.angle;return this.pos.x+=this.vel.x*e,this.pos.y+=this.vel.y*e,this.currentTransform.setTransform(s,0,0,0,s,0,this.pos.x,this.pos.y,1).rotate(n),this.isDirty=this.inViewport||!this.onlyInViewport,super.update(t)}draw(t){let e=this.width,i=this.height;t.drawImage(this.image,0,0,e,i,-e/2,-i/2,e,i)}}class J extends N{constructor(t,e,i){if(typeof i.width!="number"||typeof i.height!="number")throw new Error("height and width properties are mandatory when passing settings parameters to an object entity");super(t,e,i.width,i.height),this.children=[],i.image&&(i.framewidth=i.framewidth||i.width,i.frameheight=i.frameheight||i.height,this.renderable=new rt(0,0,i)),i.anchorPoint?this.anchorPoint.setMuted(i.anchorPoint.x,i.anchorPoint.y):this.anchorPoint.setMuted(0,0),typeof i.name=="string"&&(this.name=i.name),this.type=i.type||"",this.id=i.id||"",this.alive=!0,typeof i.shapes=="undefined"&&(i.shapes=g.pull("Polygon",0,0,[g.pull("Vector2d",0,0),g.pull("Vector2d",this.width,0),g.pull("Vector2d",this.width,this.height),g.pull("Vector2d",0,this.height)])),this.body=new xt(this,i.shapes,()=>this.onBodyUpdate()),this.width===0&&this.height===0&&this.resize(this.body.getBounds().width,this.body.getBounds().height),this.body.setCollisionMask(i.collisionMask),this.body.setCollisionType(i.collisionType),this.autoTransform=!1}get renderable(){return this.children[0]}set renderable(t){if(t instanceof N)this.children[0]=t,this.children[0].ancestor=this,this.updateBounds();else throw new Error(t+"should extend me.Renderable")}update(t){return this.renderable&&(this.isDirty|=this.renderable.update(t)),super.update(t)}updateBounds(t=!0){let e=this.getBounds();if(e.clear(),e.addFrame(0,0,this.width,this.height),this.children&&this.children.length>0&&e.addBounds(this.children[0].getBounds()),this.body&&e.addBounds(this.body.getBounds()),t===!0){let i=this.getAbsolutePosition();e.centerOn(i.x+e.x+e.width/2,i.y+e.y+e.height/2)}return e}onBodyUpdate(){this.updateBounds()}preDraw(t){t.save(),t.translate(this.pos.x+this.body.getBounds().x,this.pos.y+this.body.getBounds().y),this.renderable instanceof N&&t.translate(this.anchorPoint.x*this.body.getBounds().width,this.anchorPoint.y*this.body.getBounds().height)}draw(t,e){let i=this.renderable;i instanceof N&&(i.preDraw(t),i.draw(t,e),i.postDraw(t))}destroy(){this.renderable&&(this.renderable.destroy.apply(this.renderable,arguments),this.children.splice(0,1)),super.destroy(arguments)}onDeactivateEvent(){this.renderable&&this.renderable.onDeactivateEvent&&this.renderable.onDeactivateEvent()}}function Xy(r){try{if(wh(r))return new My(r)}catch(t){console.log("Error creating WebGL renderer :"+t.message)}return new $r(r)}function Wy(r,t,e){let i=r.renderer,s=i.getCanvas(),n=i.getContext(),o=i.settings,h=jr,f=o.zoomX=s.width*t*h,u=o.zoomY=s.height*e*h;i.scaleRatio.set(t*h,e*h),s.style.width=f/h+"px",s.style.height=u/h+"px",i.setAntiAlias(n,o.antiAlias),i.setBlendMode(o.blendMode,n),r.repaint()}function Si(r){let t=r.renderer,e=t.settings,i=e.scale,s=e.scale,n;if(e.autoScale){let o=1/0,h=1/0;if(globalThis.getComputedStyle){let a=globalThis.getComputedStyle(t.getCanvas(),null);o=parseInt(a.maxWidth,10)||1/0,h=parseInt(a.maxHeight,10)||1/0}typeof r.settings.scaleTarget!="undefined"?n=os(r.settings.scaleTarget):n=bh(r.getParentElement());let f=Math.min(o,n.width),u=Math.min(h,n.height),c=f/u;if(e.scaleMethod==="fill-min"&&c>t.designRatio||e.scaleMethod==="fill-max"&&c<t.designRatio||e.scaleMethod==="flex-width"){let a=Math.min(o,e.height*c);i=s=f/a,t.resize(Math.floor(a),e.height)}else if(e.scaleMethod==="fill-min"&&c<t.designRatio||e.scaleMethod==="fill-max"&&c>t.designRatio||e.scaleMethod==="flex-height"){let a=Math.min(h,e.width*(u/f));i=s=u/a,t.resize(e.width,Math.floor(a))}else e.scaleMethod==="flex"?t.resize(Math.floor(f),Math.floor(u)):e.scaleMethod==="stretch"?(i=f/e.width,s=u/e.height):c<t.designRatio?i=s=f/e.width:i=s=u/e.height}Wy(r,i,s)}const Ky={parent:void 0,renderer:2,autoScale:!1,scale:1,scaleMethod:"manual",scaleTarget:void 0,transparent:!1,premultipliedAlpha:!0,blendMode:"normal",physic:"builtin",antiAlias:!1,failIfMajorPerformanceCaveat:!0,subPixel:!1,preferWebGL1:!1,powerPreference:"default",verbose:!1,consoleHeader:!0,legacy:!1};function qy(r){let t=r.renderer.type,e=typeof r.renderer.GPURenderer=="string"?" ("+r.renderer.GPURenderer+")":"",i=t.includes("WebGL")&&r.renderer.depthTest==="z-buffer"?"Depth Test | ":"",s=Gr?"Web Audio":"HTML5 Audio";console.log(t+" renderer"+e+" | "+i+s+" | pixel ratio "+jr+" | "+(Ie.nodeJS?"node.js":Ie.isMobile?"mobile":"desktop")+" | "+ns()+" | "+fh),console.log("resolution: requested "+r.settings.width+"x"+r.settings.height+", got "+r.renderer.width+"x"+r.renderer.height)}class Qy{constructor(t,e,i){this.parentElement=void 0,this.renderer=void 0,this.viewport=void 0,this.world=void 0,this.mergeGroup=!0,this.lastUpdate=0,this.isInitialized=!1,this.settings=void 0,this.pauseOnBlur=!0,this.resumeOnFocus=!0,this.stopOnBlur=!1,this.isDirty=!0,this.isAlwaysDirty=!1,this.frameCounter=0,this.frameRate=1,this.accumulator=0,this.accumulatorMax=0,this.accumulatorUpdateDelta=0,this.stepSize=1e3/60,this.updateDelta=0,this.lastUpdateStart=null,this.updateAverageDelta=0,i.legacy!==!0&&this.init(t,e,i)}init(t,e,i){this.settings=Object.assign(Ky,i||{}),this.settings.width=t,this.settings.height=e,this.settings.transparent=!!this.settings.transparent,this.settings.antiAlias=!!this.settings.antiAlias,this.settings.failIfMajorPerformanceCaveat=!!this.settings.failIfMajorPerformanceCaveat,this.settings.depthTest=this.settings.depthTest==="z-buffer"?"z-buffer":"sorting",this.settings.subPixel=!!this.settings.subPixel,this.settings.verbose=!!this.settings.verbose,this.settings.scaleMethod.search(/^(fill-(min|max)|fit|flex(-(width|height))?|stretch)$/)!==-1?this.settings.autoScale=this.settings.scale==="auto"||!0:(this.settings.scaleMethod="fit",this.settings.autoScale=this.settings.scale==="auto"||!1);let s=Jr();if(s.webgl===!0||s.webgl1===!0||s.webgl2===!0?(this.settings.renderer=tr,s.webgl1===!0&&(this.settings.preferWebGL1=!0)):s.canvas===!0&&(this.settings.renderer=Th),this.settings.scale=this.settings.autoScale?1:+this.settings.scale||1,this.settings.zoomX=t*this.settings.scale,this.settings.zoomY=e*this.settings.scale,this.parentElement=Gi(this.settings.parent),typeof this.settings.scaleTarget!="undefined"&&(this.settings.scaleTarget=Gi(this.settings.scaleTarget)),typeof this.settings.renderer=="number")switch(this.settings.renderer){case Eh:case tr:this.renderer=Xy(this.settings);break;default:this.renderer=new $r(this.settings);break}else{let n=this.settings.renderer;this.renderer=new n(this.settings)}O(Dr,()=>Si(this),this),O(je,()=>Si(this),this),this.parentElement.appendChild(this.renderer.getCanvas()),Ie.isMobile&&vh(!1),Si(this),"MutationObserver"in globalThis&&new MutationObserver(()=>Si(this)).observe(this.parentElement,{attributes:!1,childList:!0,subtree:!0}),this.settings.consoleHeader!==!1&&qy(this),this.world=new jy(0,0,this.settings.width,this.settings.height),this.world.app=this,this.world.physic=this.settings.physic,this.lastUpdate=globalThis.performance.now(),this.world.autoSort=!(this.renderer.type==="WEBGL"&&this.settings.depthTest==="z-buffer"),this.isInitialized=!0,M(Sa,this),O($i,this.repaint,this),O(Zi,this.repaint,this),O(Me,this.repaint,this),O(Or,this.reset,this),O(Rr,n=>{this.update(n),this.draw()},this),O(Fi,()=>{this.stopOnBlur===!0&&L.stop(!0),this.pauseOnBlur===!0&&L.pause(!0)}),O(Ni,()=>{this.stopOnBlur===!0&&L.restart(!0),this.resumeOnFocus===!0&&L.resume(!0)})}reset(){let t=L.get();typeof t!="undefined"&&(this.viewport=t.cameras.get("default")),M(ke),this.updateFrameRate()}get sortOn(){return this.world.sortOn}set sortOn(t){this.world.sortOn=t}onLevelLoaded(){}updateFrameRate(){this.frameCounter=0,this.frameRate=~~(.5+60/z.maxfps),this.stepSize=1e3/this.world.fps,this.accumulator=0,this.accumulatorMax=this.stepSize*10,this.isAlwaysDirty=z.maxfps>this.world.fps}getParentElement(){return this.parentElement}repaint(){this.isDirty=!0}update(t){if(++this.frameCounter%this.frameRate===0){for(this.frameCounter=0,M(ts,t),this.accumulator+=z.getDelta(),this.accumulator=Math.min(this.accumulator,this.accumulatorMax),this.updateDelta=z.interpolation?z.getDelta():this.stepSize,this.accumulatorUpdateDelta=z.interpolation?this.updateDelta:Math.max(this.updateDelta,this.updateAverageDelta);this.accumulator>=this.accumulatorUpdateDelta||z.interpolation;)if(this.lastUpdateStart=globalThis.performance.now(),L.isPaused()!==!0&&M(Pa,t),this.isDirty=this.world.update(this.updateDelta),this.isDirty=L.current().update(this.updateDelta)||this.isDirty,this.lastUpdate=globalThis.performance.now(),this.updateAverageDelta=this.lastUpdate-this.lastUpdateStart,this.accumulator-=this.accumulatorUpdateDelta,z.interpolation){this.accumulator=0;break}M(Ca,this.lastUpdate)}}draw(){this.renderer.isContextValid===!0&&(this.isDirty||this.isAlwaysDirty)&&(M(Ma,globalThis.performance.now()),this.renderer.clear(),L.current().draw(this.renderer,this.world),this.isDirty=!1,this.renderer.flush(),M(Ge,globalThis.performance.now()))}}let Pe={};class nn{constructor(t=w){this.version="15.12.0",this.app=t}}class Jy extends nn{constructor(){It("plugin.Base","plugin.BasePlugin","15.1.6"),super()}}function Zy(r,t,e){if(typeof r.prototype!="undefined"&&(r=r.prototype),typeof r[t]=="function"){let i=r[t];Object.defineProperty(r,t,{configurable:!0,value:function(s,n){return function(){this._patched=i;let o=n.apply(this,arguments);return this._patched=null,o}}(t,e)})}else throw new Error(t+" is not an existing function")}function $y(r,t=r.toString().match(/ (\w+)/)[1]){if(Pe[t])throw new Error("plugin "+t+" already registered");let e=[];arguments.length>2&&(e=Array.prototype.slice.call(arguments,1)),e[0]=r;let i=new(r.bind.apply(r,e));if(typeof i=="undefined"||!(i instanceof nn))throw new Error("Plugin should extend the BasePlugin Class !");if(Qr(i.version,mr)>0)throw new Error("Plugin version mismatch, expected: "+i.version+", got: "+mr);Pe[t]=i}function t0(r){for(const t in Pe)if(typeof r=="string"&&r===t||Pe[t]instanceof r)return Pe[t]}var Nt={__proto__:null,Base:Jy,BasePlugin:nn,cache:Pe,get:t0,patch:Zy,register:$y};Object.defineProperty(fe.prototype,"Texture",{get:function(){return It("me.video.renderer.Texture","me.TextureAtlas","10.4.0"),lt}});fe.prototype.getScreenCanvas=function(){return It("getScreenCanvas","getCanvas","13.1.0"),this.getCanvas()};fe.prototype.getScreenContext=function(){return It("getScreenContext","getContext","13.1.0"),this.getContext()};class hl extends rl{constructor(t,e,i){It("GUI_Object","UISpriteElement or UITextButton","14.0.0"),super(t,e,i)}}fe.prototype.getWidth=function(){return It("getWidth","width","15.12.0"),this.width};fe.prototype.getHeight=function(){return It("getHeight","height","15.12.0"),this.height};const mr="15.12.0";let xr=!1;const w=new Qy(0,0,{legacy:!0});function e0(){xr!==!0&&(console.log("melonJS 2 (v"+mr+") | http://melonjs.org"),g.register("me.Entity",J),g.register("me.Collectable",co),g.register("me.Trigger",po),g.register("me.Light2d",go),g.register("me.Tween",ro,!0),g.register("me.Color",st,!0),g.register("me.Particle",To,!0),g.register("me.Sprite",rt),g.register("me.NineSliceSprite",fo),g.register("me.Renderable",N),g.register("me.Text",Le,!0),g.register("me.BitmapText",Ce),g.register("me.BitmapTextData",vo,!0),g.register("me.ImageLayer",cr),g.register("me.ColorLayer",uo,!0),g.register("me.Vector2d",C,!0),g.register("me.Vector3d",Et,!0),g.register("me.ObservableVector2d",At,!0),g.register("me.ObservableVector3d",St,!0),g.register("me.Matrix2d",Xe,!0),g.register("me.Matrix3d",Bi,!0),g.register("me.Rect",tt,!0),g.register("me.RoundRect",Li,!0),g.register("me.Polygon",Vt,!0),g.register("me.Line",Di,!0),g.register("me.Point",Je,!0),g.register("me.Ellipse",Qe,!0),g.register("me.Bounds",ct,!0),g.register("Entity",J),g.register("Collectable",co),g.register("Trigger",po),g.register("Light2d",go),g.register("Tween",ro,!0),g.register("Color",st,!0),g.register("Particle",To,!0),g.register("Sprite",rt),g.register("NineSliceSprite",fo),g.register("Renderable",N),g.register("Text",Le,!0),g.register("BitmapText",Ce),g.register("BitmapTextData",vo,!0),g.register("ImageLayer",cr),g.register("ColorLayer",uo,!0),g.register("Vector2d",C,!0),g.register("Vector3d",Et,!0),g.register("ObservableVector2d",At,!0),g.register("ObservableVector3d",St,!0),g.register("Matrix2d",Xe,!0),g.register("Matrix3d",Bi,!0),g.register("Rect",tt,!0),g.register("RoundRect",Li,!0),g.register("Polygon",Vt,!0),g.register("Line",Di,!0),g.register("Point",Je,!0),g.register("Ellipse",Qe,!0),g.register("Bounds",ct,!0),g.register("CanvasTexture",Iy,!0),M(hi),Ua(Jr().nocache||!1),Ph(),xr=!0)}xh(()=>{e0()});var B={data:{score:0,level1:"begin"},texture:null,controlsTexture:null,switchTexture:null,eggTexture:null,machineTexture:null,topoTexture:null,topoGroundTexture:null,isBarrierOpen:!1,topo_ground_existance:!0},i0=[{name:"tileset",type:"image",src:"/bounce_tales/data/img/tileset.png"},{name:"background",type:"image",src:"/bounce_tales/data/img/background.png"},{name:"clouds",type:"image",src:"/bounce_tales/data/img/clouds.png"},{name:"tree",type:"image",src:"/bounce_tales/data/img/tree.png"},{name:"side_tree",type:"image",src:"/bounce_tales/data/img/side_tree.png"},{name:"improved_tileset",type:"image",src:"/bounce_tales/data/img/improved_tileset.png"},{name:"blocks",type:"image",src:"/bounce_tales/data/img/blocks.png"},{name:"bouncing_tales_map1",type:"image",src:"/bounce_tales/data/img/bouncing_tales_map1.png"},{name:"sky_trees",type:"image",src:"/bounce_tales/data/img/sky_trees.png"},{name:"egg",type:"image",src:"/bounce_tales/data/img/egg.png"},{name:"barrier",type:"image",src:"/bounce_tales/data/img/barrier.png"},{name:"title_screen",type:"image",src:"/bounce_tales/data/img/title_screen.png"},{name:"level1_map",type:"tmx",src:"/bounce_tales/data/map/level1_map.tmx"},{name:"level2_map",type:"tmx",src:"/bounce_tales/data/map/level1_map.tmx"},{name:"tileset",type:"tsx",src:"/bounce_tales/data/map/tileset.tsx"},{name:"side_tree",type:"tsx",src:"/bounce_tales/data/map/side_tree.tsx"},{name:"tree",type:"tsx",src:"/bounce_tales/data/map/tree.tsx"},{name:"improved_tileset",type:"tsx",src:"/bounce_tales/data/map/improved_tileset.tsx"},{name:"blocks",type:"tsx",src:"/bounce_tales/data/map/blocks.tsx"},{name:"sky",type:"tsx",src:"/bounce_tales/data/map/sky.tsx"},{name:"bouncing_tales_map1",type:"tsx",src:"/bounce_tales/data/map/bouncing_tales_map1.tsx"},{name:"bounce",type:"image",src:"/bounce_tales/data/img/bounce.png"},{name:"bounce",type:"json",src:"/bounce_tales/data/img/bounce.json"},{name:"controlsTexture",type:"image",src:"/bounce_tales/data/img/controlsTexture.png"},{name:"controlsTexture",type:"json",src:"/bounce_tales/data/img/controlsTexture.json"},{name:"switch",type:"image",src:"/bounce_tales/data/img/switch.png"},{name:"switch",type:"json",src:"/bounce_tales/data/img/switch.json"},{name:"machine",type:"image",src:"/bounce_tales/data/img/machine.png"},{name:"machine",type:"json",src:"/bounce_tales/data/img/machine.json"},{name:"topo",type:"image",src:"/bounce_tales/data/img/topo.png"},{name:"topo",type:"json",src:"/bounce_tales/data/img/topo.json"},{name:"topo_ground",type:"image",src:"/bounce_tales/data/img/topo_ground.png"},{name:"topo_ground",type:"json",src:"/bounce_tales/data/img/topo_ground.json"},{name:"egg",type:"image",src:"/bounce_tales/data/img/egg.png"},{name:"egg",type:"json",src:"/bounce_tales/data/img/egg.json"},{name:"start",type:"audio",src:"/bounce_tales/data/bgm/"},{name:"main",type:"audio",src:"/bounce_tales/data/bgm/"},{name:"win",type:"audio",src:"/bounce_tales/data/bgm/"},{name:"PressStart2P",type:"image",src:"/bounce_tales/data/fnt/PressStart2P.png"},{name:"PressStart2P",type:"binary",src:"/bounce_tales/data/fnt/PressStart2P.fnt"}];class s0 extends rl{constructor(t,e){super(t,e,{image:B.controlsTexture,region:"mute.png"}),this.setOpacity(.5),this.isMute=!1,this.floating=!1}onOver(){this.setOpacity(1)}onOut(){this.setOpacity(.5)}onClick(){return this.isMute?(Jt.unmuteAll(),this.setRegion(B.controlsTexture.getRegion("mute.png")),this.isMute=!1):(Jt.muteAll(),this.setRegion(B.controlsTexture.getRegion("unmute.png")),this.isMute=!0),!1}}class r0 extends Ce{constructor(t,e){super(w.viewport.width+t,w.viewport.height+e,{font:"PressStart2P",textAlign:"right",textBaseline:"bottom",text:"0"}),this.relative=new C(t,e),this.floating=!1,this.score=-1,Y.on(Y.CANVAS_ONRESIZE,function(i,s){this.pos.set(i,s,0).add(this.relative)}.bind(this))}update(t){return this.score!==B.data.score&&(this.score=B.data.score,this.setText(this.score),this.isDirty=!1),super.update(t)}}class n0 extends Q{constructor(){super(),this.isPersistent=!0,this.floating=!0,this.z=1/0,this.name="HUD",this.addChild(new r0(-10,-10)),this.addChild(new s0(36,56))}}class o0 extends hl{constructor(t,e){super(t,e,{image:B.controlsTexture,region:"controler_jump.png"}),this.setOpacity(.25),this.anchorPoint.set(0,0)}onClick(t){return this.setOpacity(.5),S.triggerKeyEvent(S.KEY.SPACE,!0),!1}onRelease(t){return this.setOpacity(.25),S.triggerKeyEvent(S.KEY.SPACE,!1),!1}}class a0 extends hl{constructor(t,e){super(t,e,{image:B.controlsTexture,region:"controler_left_right.png",anchorPoint:new C(0,0)}),this.pad=new rt(t,e,{image:B.controlsTexture,region:"controler_left_right.png",anchorPoint:new C(0,0)}),this.relative=new C(this.width/2-this.pad.width/2,this.height/2-this.pad.height/2),this.joypad_offset=new C,this.setOpacity(.25),this.cursors={up:!1,down:!1,left:!1,right:!1},S.registerPointerEvent("pointermove",this,this.pointerMove.bind(this))}onDestroyEvent(){S.releasePointerEvent("pointermove",this)}pointerMove(t){if(this.released===!1){var e=t.gameScreenX+t.width/2,i=t.gameScreenY+t.height/2;this.getBounds().contains(e,i)?(this.cursors.left===!0||this.cursors.right===!0)&&this.checkDirection.call(this,e,i):this.onRelease.call(this,t)}}checkDirection(t,e){t-this.pos.x<this.width/2&&(this.cursors.left===!1&&(S.triggerKeyEvent(S.KEY.LEFT,!0),this.cursors.left=!0),this.cursors.right===!0&&(S.triggerKeyEvent(S.KEY.RIGHT,!1),this.cursors.right=!1)),t-this.pos.x>this.width/2&&(this.cursors.right===!1&&(S.triggerKeyEvent(S.KEY.RIGHT,!0),this.cursors.right=!0),this.cursors.left===!0&&(S.triggerKeyEvent(S.KEY.LEFT,!1),this.cursors.left=!1))}onClick(t){var e=t.gameScreenX+t.width/2,i=t.gameScreenY+t.height/2;return this.setOpacity(.5),this.checkDirection.call(this,e,i),!1}onRelease(t){return this.setOpacity(.25),this.cursors.left===!0&&(S.triggerKeyEvent(S.KEY.LEFT,!1),this.cursors.left=!1),this.cursors.right===!0&&(S.triggerKeyEvent(S.KEY.RIGHT,!1),this.cursors.right=!1),this.joypad_offset.set(0,0),!1}draw(t){super.draw(t),this.pad.pos.setV(this.pos).add(this.relative).add(this.joypad_offset),this.pad.draw(t)}}class h0 extends Q{constructor(){super(),this.isPersistent=!0,this.floating=!0,this.z=1/0,this.name="VirtualJoypad",this.joypad=new a0(50,w.viewport.height-200),this.button=new o0(w.viewport.width-150,w.viewport.height-150),this.addChild(this.joypad),this.addChild(this.button);var t=this;Y.on(Y.VIEWPORT_ONRESIZE,function(e,i){t.button.pos.set(e-150,i-150,t.button.pos.z)})}}class l0 extends gi{onResetEvent(){De.load("level1_map"),typeof this.HUD=="undefined"&&(this.HUD=new n0),w.world.addChild(this.HUD),(Nt.cache.debugPanel&&Nt.cache.debugPanel.panel.visible||$s.touch)&&(typeof this.virtualJoypad=="undefined"&&(this.virtualJoypad=new h0),w.world.addChild(this.virtualJoypad)),Jt.playTrack("main")}onDestroyEvent(){w.world.removeChild(this.HUD),this.virtualJoypad&&w.world.hasChild(this.virtualJoypad)&&w.world.removeChild(this.virtualJoypad),Jt.stopTrack("main")}}class u0 extends J{constructor(t,e,i){super(t,e,i),this.body.setMaxVelocity(3,15),this.body.setFriction(.2,.2),this.body.collisionType=F.types.PLAYER_OBJECT,w.viewport.follow(this,w.viewport.AXIS.BOTH,.1),S.bindKey(S.KEY.LEFT,"left"),S.bindKey(S.KEY.RIGHT,"right"),S.bindKey(S.KEY.X,"jump",!0),S.bindKey(S.KEY.UP,"jump",!0),S.bindKey(S.KEY.SPACE,"jump",!0),S.bindKey(S.KEY.DOWN,"down"),S.bindKey(S.KEY.A,"left"),S.bindKey(S.KEY.D,"right"),S.bindKey(S.KEY.W,"jump",!0),S.bindKey(S.KEY.S,"down"),this.alwaysUpdate=!0,this.renderable=B.texture.createAnimationFromName(["bounce001.png","bounce002.png","bounce003.png","bounce004.png"]),this.renderable.addAnimation("stand",[{name:"bounce001.png",delay:100}]),this.renderable.addAnimation("walk",[{name:"bounce001.png",delay:100},{name:"bounce002.png",delay:100},{name:"bounce003.png",delay:100},{name:"bounce004.png",delay:100}]),this.renderable.addAnimation("jump",[{name:"bounce001.png",delay:150}]),this.renderable.setCurrentAnimation("walk"),this.anchorPoint.set(.5,.5)}update(t){return S.isKeyPressed("left")?(this.renderable.flipX(!0),this.body.force.x=-this.body.maxVel.x,this.renderable.isCurrentAnimation("walk")||this.renderable.setCurrentAnimation("walk")):S.isKeyPressed("right")?(this.renderable.flipX(!1),this.body.force.x=this.body.maxVel.x,this.renderable.isCurrentAnimation("walk")||this.renderable.setCurrentAnimation("walk")):this.renderable.setCurrentAnimation("stand"),S.isKeyPressed("jump")?!this.body.jumping&&!this.body.falling&&(this.body.force.y=-this.body.maxVel.y):this.body.force.y=0,super.update(t)||this.body.vel.x!==0||this.body.vel.y!==0}onCollision(){return!0}}class f0 extends J{constructor(t,e,i){super(t,e,i),this.body.setMaxVelocity(3,5),this.body.setFriction(.9,0),this.body.isStatic=!0,this.color=i.color,this.body.setCollisionMask(F.types.PLAYER_OBJECT),this.renderable=B.eggTexture.createAnimationFromName(["egg.png","blue_egg.png","stars_1.png","stars_2.png","stars_3.png","stars_4.png","stars_5.png"]),i.color==="blue"?this.renderable.addAnimation("normal",["blue_egg.png"]):this.renderable.addAnimation("normal",["egg.png"]),this.renderable.addAnimation("smash",[{name:"stars_1.png",delay:50},{name:"stars_2.png",delay:50},{name:"stars_3.png",delay:50},{name:"stars_4.png",delay:50},{name:"stars_5.png",delay:50}]),this.renderable.setCurrentAnimation("normal")}onCollision(t,e){return this.body.setCollisionMask(F.types.NO_OBJECT),this.renderable.setCurrentAnimation("smash"),this.color==="blue"?B.data.score=B.data.score+4:B.data.score++,setTimeout(()=>{w.world.removeChild(this)},250),!1}}class d0 extends J{constructor(t,e,i){super(t,e,i),this.open=!1,this.body.mass=10,this.body.setMaxVelocity(3,5),this.body.setFriction(.9,0),this.body.isStatic=!0,this.alwaysUpdate=!0,this.body.ignoreGravity=!0,this.body.setCollisionMask(F.types.PLAYER_OBJECT)}update(t){return B.isBarrierOpen&&!this.open&&(this.body.isStatic=!1,this.body.force.y=-this.body.maxVel.y,setTimeout(()=>{this.body.isStatic=!0},1e3),this.open=!0),super.update(t)||this.body.vel.x!==0||this.body.vel.y!==0}onCollision(t,e){return!1}}class c0 extends J{constructor(t,e,i){super(t,e,i),this.body.setMaxVelocity(3,5),this.body.setFriction(.9,0),this.body.isStatic=!0,this.body.setCollisionMask(F.types.PLAYER_OBJECT),this.renderable=B.switchTexture.createAnimationFromName(["switch_off.png","switch_on.png"]),this.renderable.addAnimation("off",[{name:"switch_off.png",delay:150}]),this.renderable.addAnimation("on",[{name:"switch_on.png",delay:150}]),this.renderable.setCurrentAnimation("off"),this.anchorPoint.set(.5,.5)}onCollision(t,e){return B.isBarrierOpen||(console.log(B.isBarrierOpen),this.renderable.isCurrentAnimation("on")||this.renderable.setCurrentAnimation("on"),B.isBarrierOpen=!0),!1}}class p0 extends J{constructor(t,e,i){super(t,e,i),this.body.isStatic=!0,this.runing=!0,this.body.setCollisionMask(F.types.PLAYER_OBJECT),this.renderable=B.machineTexture.createAnimationFromName(["machine_1.png","machine_2.png","machine_3.png","machine_broken.png"]),this.renderable.addAnimation("runing",[{name:"machine_1.png",delay:150},{name:"machine_2.png",delay:150},{name:"machine_3.png",delay:150}]),this.renderable.addAnimation("breaked",[{name:"machine_broken.png",delay:100}]),this.renderable.setCurrentAnimation("runing"),this.anchorPoint.set(-.35,-.45),this.particleTint="#ffd724ff"}onCollision(t,e){if(t.overlapN.y>.5&&this.runing){this.body.setStatic(!0),this.renderable.setCurrentAnimation("breaked");var i=new al(this.centerX,this.centerY,{width:5,height:5,tint:this.particleTint,totalParticles:64,angle:0,angleVariation:6.283185307179586,maxLife:5,speed:3});w.world.addChild(i,this.pos.z),i.burstParticles(),this.runing=!1}return!1}}class g0 extends J{constructor(t,e,i){super(t,e,i);var s=i.width||i.framewidth;i.width=i.framewidth,i.height=i.frameheight,i.shapes[0]=new tt(0,0,i.framewidth,i.frameheight),this.body.setMaxVelocity(3,15),this.body.setFriction(.4,0),e=this.pos.y,this.startY=e,this.endY=e+s-i.frameheight,this.pos.y=e+s-i.frameheight,this.body.gravityScale=0,this.isMovingDown=!1,this.moveSteps=1,this.body.setMaxVelocity(i.velX||1,i.velY||1),this.body.collisionType=F.types.ENEMY_OBJECT,this.body.setCollisionMask(F.types.PLAYER_OBJECT),this.alwaysUpdate=!1,this.isMovingEnemy=!0,this.particleTint="#FFF"}update(t){return this.alive&&(this.isMovingDown?this.pos.y<this.startY+8?(this.body.setStatic(!1),this.body.force.y=1):(this.body.setStatic(!0),setTimeout(()=>{this.isMovingDown=!1,this.body.force.y=-1,this.renderable.flipX(!0)},500)):this.pos.y>this.startY-8?(this.body.setStatic(!1),this.body.force.y=-1):(this.body.setStatic(!0),setTimeout(()=>{this.isMovingDown=!0,this.body.force.y=1,this.renderable.flipX(!1)},500))),super.update(t)}onCollision(t){if(this.alive&&t.overlapV.y>.5&&t.a.body.falling){this.alive=!1,this.body.setCollisionMask(F.types.NO_OBJECT),this.body.setStatic(!0),this.renderable.setCurrentAnimation("dead");var e=new al(this.centerX,this.centerY,{width:this.width/4,height:this.height/4,tint:this.particleTint,totalParticles:32,angle:0,angleVariation:6.283185307179586,maxLife:5,speed:3});w.world.addChild(e,this.pos.z),w.world.removeChild(this),B.topo_ground_existance=!1,e.burstParticles()}return!1}}class y0 extends g0{constructor(t,e,i){super(t,e,i),this.renderable=B.topoTexture.createAnimationFromName(["topo.png"]),i.animationspeed&&(this.renderable.animationspeed=i.animationspeed),this.renderable.addAnimation("walk",["topo.png"]),this.renderable.addAnimation("dead",[{name:"topo.png",delay:600}]),this.renderable.setCurrentAnimation("walk"),this.anchorPoint.set(0,.5),this.particleTint="#85c5f1",this.incr=0}}class m0 extends J{constructor(t,e,i){super(t,e,i),this.body.setMaxVelocity(3,5),this.body.setFriction(.9,0),this.body.isStatic=!0,this.body.setCollisionMask(F.types.PLAYER_OBJECT),this.renderable=B.topoGroundTexture.createAnimationFromName(["topo_ground_1.png","topo_ground_2.png","topo_ground_3.png"]),i.animationspeed&&(this.renderable.animationspeed=i.animationspeed),this.renderable.addAnimation("moving",[{name:"topo_ground_1.png",delay:500},{name:"topo_ground_3.png",delay:1e3},{name:"topo_ground_2.png",delay:500}]),this.renderable.addAnimation("stoped",[{name:"topo_ground_1.png",delay:100}]),this.renderable.setCurrentAnimation("moving"),this.anchorPoint.set(0,0)}update(t){B.topo_ground_existance||w.world.removeChild(this)}onCollision(t,e){this.body.setCollisionMask(F.types.NO_OBJECT)}}class x0 extends J{constructor(t,e,i){super(t,e,i),this.body.setMaxVelocity(3,5),this.body.setFriction(.9,0),this.body.isStatic=!0,this.body.setCollisionMask(F.types.PLAYER_OBJECT),this.renderable=B.eggTexture.createAnimationFromName(["blue_egg.png","stars_1.png","stars_2.png","stars_3.png","stars_4.png","stars_5.png"]),this.renderable.addAnimation("normal",["blue_egg.png"]),this.renderable.addAnimation("smash",[{name:"stars_1.png",delay:50},{name:"stars_2.png",delay:50},{name:"stars_3.png",delay:50},{name:"stars_4.png",delay:50},{name:"stars_5.png",delay:50}])}update(t){B.topo_ground_existance||this.renderable.setCurrentAnimation("normal")}onCollision(t,e){return this.body.setCollisionMask(F.types.NO_OBJECT),this.renderable.setCurrentAnimation("smash"),setTimeout(()=>{w.world.removeChild(this)},250),!1}}class v0 extends gi{onResetEvent(){var t=new rt(w.viewport.width/2,w.viewport.height/2,{image:W.getImage("title_screen")});t.scale(w.viewport.width/t.width,w.viewport.height/t.height),w.world.addChild(t,1),S.bindKey(S.KEY.ENTER,"enter",!0),S.bindPointer(S.pointer.LEFT,S.KEY.ENTER)}onDestroyEvent(){S.unbindKey(S.KEY.ENTER),S.unbindPointer(S.pointer.LEFT),Y.off(Y.KEYDOWN,this.handler)}}class _0 extends J{constructor(t,e,i){super(t,e,i),this.body.setMaxVelocity(3,5),this.body.setFriction(.9,0),this.body.isStatic=!0}update(t){return!1}onCollision(t,e){return B.data.level1!=="completed"&&setTimeout(()=>{B.data.level1="completed",L.change(L.MENU)},500),!1}}/*!
 * melonJS debug plugin - v14.8.0
 * http://www.melonjs.org
 * @melonjs/debug-plugin is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 * @copyright (C) 2011 - 2023 Olivier Biot (AltByte Pte Ltd)
 */var b0="@melonjs/debug-plugin",w0="14.8.0",T0="https://github.com/melonjs/debug-plugin#readme",E0={melonjs:"15.12.0"};class A0{constructor(){this.stats=[]}reset(){Object.keys(this.stats).forEach(t=>{this.stats[t]=0})}inc(t,e){this.stats[t]+=e||1}get(t){return this.stats[t]||0}}var S0="data:image/png;base64,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",C0=`info face=PressStart2P size=10 bold=0 italic=0 charset= unicode= stretchH=100 smooth=1 aa=1 padding=1,1,1,1 spacing=0,0 outline=0
common lineHeight=10 base=10 scaleW=128 scaleH=128 pages=1 packed=0
page id=0 file="PressStart2P.png"
chars count=95
char id=32 x=1 y=1 width=0 height=0 xoffset=0 yoffset=10 xadvance=10 page=0 chnl=15
char id=33 x=1 y=2 width=5 height=10 xoffset=3 yoffset=0 xadvance=10 page=0 chnl=15
char id=34 x=1 y=13 width=8 height=5 xoffset=1 yoffset=0 xadvance=10 page=0 chnl=15
char id=35 x=7 y=1 width=10 height=10 xoffset=0 yoffset=0 xadvance=10 page=0 chnl=15
char id=36 x=1 y=19 width=10 height=10 xoffset=0 yoffset=0 xadvance=10 page=0 chnl=15
char id=37 x=1 y=30 width=10 height=10 xoffset=0 yoffset=0 xadvance=10 page=0 chnl=15
char id=38 x=1 y=41 width=10 height=10 xoffset=0 yoffset=0 xadvance=10 page=0 chnl=15
char id=39 x=10 y=12 width=4 height=5 xoffset=3 yoffset=0 xadvance=10 page=0 chnl=15
char id=40 x=1 y=52 width=6 height=10 xoffset=3 yoffset=0 xadvance=10 page=0 chnl=15
char id=41 x=1 y=63 width=6 height=10 xoffset=1 yoffset=0 xadvance=10 page=0 chnl=15
char id=42 x=1 y=74 width=10 height=8 xoffset=0 yoffset=1 xadvance=10 page=0 chnl=15
char id=43 x=8 y=52 width=9 height=8 xoffset=1 yoffset=1 xadvance=10 page=0 chnl=15
char id=44 x=8 y=61 width=5 height=5 xoffset=1 yoffset=6 xadvance=10 page=0 chnl=15
char id=45 x=8 y=67 width=9 height=2 xoffset=1 yoffset=4 xadvance=10 page=0 chnl=15
char id=46 x=14 y=61 width=4 height=4 xoffset=3 yoffset=6 xadvance=10 page=0 chnl=15
char id=47 x=12 y=18 width=10 height=10 xoffset=0 yoffset=0 xadvance=10 page=0 chnl=15
char id=48 x=18 y=1 width=10 height=10 xoffset=0 yoffset=0 xadvance=10 page=0 chnl=15
char id=49 x=12 y=29 width=9 height=10 xoffset=1 yoffset=0 xadvance=10 page=0 chnl=15
char id=50 x=12 y=40 width=10 height=10 xoffset=0 yoffset=0 xadvance=10 page=0 chnl=15
char id=51 x=22 y=29 width=10 height=10 xoffset=0 yoffset=0 xadvance=10 page=0 chnl=15
char id=52 x=23 y=12 width=10 height=10 xoffset=0 yoffset=0 xadvance=10 page=0 chnl=15
char id=53 x=29 y=1 width=10 height=10 xoffset=0 yoffset=0 xadvance=10 page=0 chnl=15
char id=54 x=1 y=83 width=10 height=10 xoffset=0 yoffset=0 xadvance=10 page=0 chnl=15
char id=55 x=1 y=94 width=10 height=10 xoffset=0 yoffset=0 xadvance=10 page=0 chnl=15
char id=56 x=1 y=105 width=10 height=10 xoffset=0 yoffset=0 xadvance=10 page=0 chnl=15
char id=57 x=1 y=116 width=10 height=10 xoffset=0 yoffset=0 xadvance=10 page=0 chnl=15
char id=58 x=18 y=51 width=4 height=8 xoffset=3 yoffset=1 xadvance=10 page=0 chnl=15
char id=59 x=12 y=70 width=5 height=9 xoffset=1 yoffset=1 xadvance=10 page=0 chnl=15
char id=60 x=12 y=80 width=8 height=10 xoffset=1 yoffset=0 xadvance=10 page=0 chnl=15
char id=61 x=23 y=23 width=10 height=5 xoffset=0 yoffset=3 xadvance=10 page=0 chnl=15
char id=62 x=18 y=66 width=8 height=10 xoffset=1 yoffset=0 xadvance=10 page=0 chnl=15
char id=63 x=23 y=40 width=10 height=10 xoffset=0 yoffset=0 xadvance=10 page=0 chnl=15
char id=64 x=33 y=29 width=10 height=10 xoffset=0 yoffset=0 xadvance=10 page=0 chnl=15
char id=65 x=23 y=51 width=10 height=10 xoffset=0 yoffset=0 xadvance=10 page=0 chnl=15
char id=66 x=34 y=12 width=10 height=10 xoffset=0 yoffset=0 xadvance=10 page=0 chnl=15
char id=67 x=40 y=1 width=10 height=10 xoffset=0 yoffset=0 xadvance=10 page=0 chnl=15
char id=68 x=12 y=91 width=10 height=10 xoffset=0 yoffset=0 xadvance=10 page=0 chnl=15
char id=69 x=21 y=77 width=10 height=10 xoffset=0 yoffset=0 xadvance=10 page=0 chnl=15
char id=70 x=27 y=62 width=10 height=10 xoffset=0 yoffset=0 xadvance=10 page=0 chnl=15
char id=71 x=34 y=40 width=10 height=10 xoffset=0 yoffset=0 xadvance=10 page=0 chnl=15
char id=72 x=34 y=51 width=10 height=10 xoffset=0 yoffset=0 xadvance=10 page=0 chnl=15
char id=73 x=44 y=23 width=9 height=10 xoffset=1 yoffset=0 xadvance=10 page=0 chnl=15
char id=74 x=45 y=12 width=10 height=10 xoffset=0 yoffset=0 xadvance=10 page=0 chnl=15
char id=75 x=51 y=1 width=10 height=10 xoffset=0 yoffset=0 xadvance=10 page=0 chnl=15
char id=76 x=12 y=102 width=9 height=10 xoffset=1 yoffset=0 xadvance=10 page=0 chnl=15
char id=77 x=12 y=113 width=10 height=10 xoffset=0 yoffset=0 xadvance=10 page=0 chnl=15
char id=78 x=22 y=102 width=10 height=10 xoffset=0 yoffset=0 xadvance=10 page=0 chnl=15
char id=79 x=23 y=88 width=10 height=10 xoffset=0 yoffset=0 xadvance=10 page=0 chnl=15
char id=80 x=32 y=73 width=10 height=10 xoffset=0 yoffset=0 xadvance=10 page=0 chnl=15
char id=81 x=38 y=62 width=10 height=10 xoffset=0 yoffset=0 xadvance=10 page=0 chnl=15
char id=82 x=23 y=113 width=10 height=10 xoffset=0 yoffset=0 xadvance=10 page=0 chnl=15
char id=83 x=33 y=99 width=10 height=10 xoffset=0 yoffset=0 xadvance=10 page=0 chnl=15
char id=84 x=34 y=84 width=9 height=10 xoffset=1 yoffset=0 xadvance=10 page=0 chnl=15
char id=85 x=43 y=73 width=10 height=10 xoffset=0 yoffset=0 xadvance=10 page=0 chnl=15
char id=86 x=34 y=110 width=10 height=10 xoffset=0 yoffset=0 xadvance=10 page=0 chnl=15
char id=87 x=44 y=84 width=10 height=10 xoffset=0 yoffset=0 xadvance=10 page=0 chnl=15
char id=88 x=44 y=95 width=10 height=10 xoffset=0 yoffset=0 xadvance=10 page=0 chnl=15
char id=89 x=45 y=106 width=9 height=10 xoffset=1 yoffset=0 xadvance=10 page=0 chnl=15
char id=90 x=45 y=117 width=10 height=10 xoffset=0 yoffset=0 xadvance=10 page=0 chnl=15
char id=91 x=45 y=34 width=6 height=10 xoffset=3 yoffset=0 xadvance=10 page=0 chnl=15
char id=92 x=45 y=45 width=10 height=10 xoffset=0 yoffset=0 xadvance=10 page=0 chnl=15
char id=93 x=52 y=34 width=6 height=10 xoffset=1 yoffset=0 xadvance=10 page=0 chnl=15
char id=94 x=34 y=23 width=8 height=4 xoffset=1 yoffset=0 xadvance=10 page=0 chnl=15
char id=95 x=34 y=121 width=10 height=2 xoffset=0 yoffset=9 xadvance=10 page=0 chnl=15
char id=96 x=15 y=12 width=4 height=4 xoffset=4 yoffset=0 xadvance=10 page=0 chnl=15
char id=97 x=54 y=23 width=10 height=7 xoffset=0 yoffset=3 xadvance=10 page=0 chnl=15
char id=98 x=56 y=12 width=10 height=10 xoffset=0 yoffset=0 xadvance=10 page=0 chnl=15
char id=99 x=62 y=1 width=10 height=7 xoffset=0 yoffset=3 xadvance=10 page=0 chnl=15
char id=100 x=49 y=56 width=10 height=10 xoffset=0 yoffset=0 xadvance=10 page=0 chnl=15
char id=101 x=56 y=45 width=10 height=8 xoffset=0 yoffset=3 xadvance=10 page=0 chnl=15
char id=102 x=59 y=31 width=9 height=10 xoffset=1 yoffset=0 xadvance=10 page=0 chnl=15
char id=103 x=54 y=67 width=10 height=9 xoffset=0 yoffset=3 xadvance=10 page=0 chnl=15
char id=104 x=60 y=54 width=10 height=10 xoffset=0 yoffset=0 xadvance=10 page=0 chnl=15
char id=105 x=67 y=42 width=9 height=10 xoffset=1 yoffset=0 xadvance=10 page=0 chnl=15
char id=106 x=67 y=9 width=8 height=11 xoffset=1 yoffset=0 xadvance=10 page=0 chnl=15
char id=107 x=69 y=21 width=10 height=10 xoffset=0 yoffset=0 xadvance=10 page=0 chnl=15
char id=108 x=76 y=1 width=9 height=10 xoffset=1 yoffset=0 xadvance=10 page=0 chnl=15
char id=109 x=76 y=12 width=10 height=8 xoffset=0 yoffset=3 xadvance=10 page=0 chnl=15
char id=110 x=69 y=32 width=10 height=8 xoffset=0 yoffset=3 xadvance=10 page=0 chnl=15
char id=111 x=86 y=1 width=10 height=8 xoffset=0 yoffset=3 xadvance=10 page=0 chnl=15
char id=112 x=97 y=1 width=10 height=9 xoffset=0 yoffset=3 xadvance=10 page=0 chnl=15
char id=113 x=108 y=1 width=10 height=9 xoffset=0 yoffset=3 xadvance=10 page=0 chnl=15
char id=114 x=87 y=10 width=9 height=8 xoffset=1 yoffset=3 xadvance=10 page=0 chnl=15
char id=115 x=97 y=11 width=10 height=7 xoffset=0 yoffset=3 xadvance=10 page=0 chnl=15
char id=116 x=108 y=11 width=9 height=10 xoffset=1 yoffset=0 xadvance=10 page=0 chnl=15
char id=117 x=87 y=19 width=10 height=7 xoffset=0 yoffset=3 xadvance=10 page=0 chnl=15
char id=118 x=98 y=19 width=9 height=8 xoffset=1 yoffset=3 xadvance=10 page=0 chnl=15
char id=119 x=80 y=27 width=10 height=7 xoffset=0 yoffset=3 xadvance=10 page=0 chnl=15
char id=120 x=108 y=22 width=10 height=8 xoffset=0 yoffset=3 xadvance=10 page=0 chnl=15
char id=121 x=91 y=28 width=10 height=9 xoffset=0 yoffset=3 xadvance=10 page=0 chnl=15
char id=122 x=80 y=35 width=10 height=7 xoffset=0 yoffset=3 xadvance=10 page=0 chnl=15
char id=123 x=118 y=11 width=6 height=10 xoffset=3 yoffset=0 xadvance=10 page=0 chnl=15
char id=124 x=102 y=28 width=4 height=10 xoffset=4 yoffset=0 xadvance=10 page=0 chnl=15
char id=125 x=119 y=22 width=6 height=10 xoffset=1 yoffset=0 xadvance=10 page=0 chnl=15
char id=126 x=91 y=38 width=10 height=5 xoffset=0 yoffset=3 xadvance=10 page=0 chnl=15
char id=32 x=0 y=0 width=0 height=0 xoffset=0 yoffset=3 xadvance=10 page=0 chnl=15
`;const Eo=50;class P0 extends N{constructor(t){super(0,0,ji.renderer.width,Eo),this.isKinematic=!1,this.checkbox={},this.counters=new A0(["shapes","sprites","velocity","bounds","children"]),this.pos.z=1/0,this.visible=!1,this.frameUpdateTime=0,this.frameDrawTime=0,this.GUID="debug-"+or.createGUID(),this.name="debugPanel",this.version="14.8.0",this.isPersistent=!0,this.floating=!0,this.isRenderable=!0,this.alwaysUpdate=!0,this.canvas=ji.createCanvas(this.width,this.height,!0),this.font_size=10,this.mod=2,this.width<500&&(this.font_size=7,this.mod=this.mod*(this.font_size/10));var e=new Image;e.src=S0,this.font=new Ce(0,0,{fontData:C0,font:e}),this.font.name="debugPanelFont";var i=or.getUriFragment(),s=10*this.mod;this.checkbox.renderHitBox=new tt(250,2,s,s),this.checkbox.renderHitBox.selected=i.hitbox||!1,this.checkbox.renderVelocity=new tt(250,17,s,s),this.checkbox.renderVelocity.selected=i.velocity||!1,this.checkbox.renderQuadTree=new tt(410,2,s,s),this.checkbox.renderVelocity.selected=i.quadtree||!1,this.debugToggle=t,this.help_str="["+String.fromCharCode(32+this.debugToggle)+"]show/hide",this.help_str_len=this.font.measureText(this.help_str).width,this.fps_str_len=this.font.measureText("00/00 fps").width,this.memoryPositionX=325*this.mod,Y.on(Y.CANVAS_ONRESIZE,n=>{this.resize(n,Eo)}),this.frameUpdateStartTime=0,this.frameDrawStartTime=0,this.frameUpdateTime=0,this.frameDrawTime=0,Y.on(Y.GAME_BEFORE_UPDATE,n=>{this.frameUpdateStartTime=n}),Y.on(Y.GAME_AFTER_UPDATE,n=>{this.frameUpdateTime=n-this.frameUpdateStartTime}),Y.on(Y.GAME_BEFORE_DRAW,n=>{this.frameDrawStartTime=n,this.counters.reset()}),Y.on(Y.GAME_AFTER_DRAW,n=>{this.frameDrawTime=n-this.frameDrawStartTime}),this.anchorPoint.set(0,0),this.patchSystemFn()}patchSystemFn(){var t=this;Nt.patch(N,"postDraw",function(e){if(this._patched.apply(this,arguments),typeof this.image!="undefined"&&t.counters.inc("sprites"),t.counters.inc("bounds"),this instanceof Q&&t.counters.inc("children"),t.visible&&!(this instanceof J)&&!(this.ancestor instanceof J)&&!(this instanceof Le)&&!(this instanceof Ce)&&!(this instanceof Uh)&&!(this instanceof cr)&&t.checkbox.renderHitBox.selected&&this.getBounds().isFinite()){if(typeof this.ancestor!="undefined"&&(e.save(),!this.floating)){var i=this.ancestor.getAbsolutePosition();e.translate(-i.x,-i.y)}var s=this.getBounds();if(e.setColor("green"),e.stroke(s),typeof this.mask!="undefined"&&(e.setColor("orange"),e.stroke(this.mask)),typeof this.body!="undefined"){e.translate(s.x,s.y),e.setColor("orange"),e.stroke(this.body.getBounds()),e.setColor("red");for(var n=this.body.shapes.length,o;n--,o=this.body.shapes[n];)e.stroke(o),t.counters.inc("shapes");e.translate(-s.x,-s.y)}typeof this.ancestor!="undefined"&&e.restore()}}),Nt.patch(Ce,"draw",function(e){if(this._patched.apply(this,arguments),t.visible&&t.checkbox.renderHitBox.selected&&this.name!=="debugPanelFont"){var i=this.getBounds();if(typeof this.ancestor!="undefined"){var s=this.anchorPoint.x*i.width,n=this.anchorPoint.y*i.height;e.save(),e.translate(s,n)}e.setColor("green"),e.stroke(i),typeof this.ancestor!="undefined"&&e.restore()}}),Nt.patch(Le,"draw",function(e){if(this._patched.apply(this,arguments),t.visible&&t.checkbox.renderHitBox.selected){var i=this.getBounds();if(typeof this.ancestor!="undefined"&&(e.save(),!this.root&&!this.ancestor.root&&this.ancestor.isFloating)){var s=this.ancestor.getAbsolutePosition();e.translate(-s.x,-s.y)}e.setColor("green"),e.stroke(i),typeof this.ancestor!="undefined"&&e.restore()}}),Nt.patch(J,"postDraw",function(e){if(t.visible){if(t.checkbox.renderHitBox.selected){if(e.save(),typeof this.ancestor!="undefined"&&!this.floating){var i=this.ancestor.getAbsolutePosition();e.translate(-i.x,-i.y)}if(this.renderable instanceof N){var s=this.renderable.getBounds(),n=-s.x-this.anchorPoint.x*s.width,o=-s.y-this.anchorPoint.y*s.height;e.setColor("green"),e.translate(n,o),e.stroke(s),e.translate(-n,-o)}e.translate(this.body.getBounds().x,this.body.getBounds().y),e.translate(-this.anchorPoint.x*this.body.getBounds().width,-this.anchorPoint.y*this.body.getBounds().height),e.setColor("orange"),e.stroke(this.body.getBounds()),e.setColor("red");for(var h=this.body.shapes.length,f;h--,f=this.body.shapes[h];)e.stroke(f),t.counters.inc("shapes");e.restore()}if(t.checkbox.renderVelocity.selected&&(this.body.vel.x||this.body.vel.y)){var u=this.body.getBounds(),c=u.width/2,a=u.height/2;e.save(),e.setLineWidth(1),e.setColor("blue"),e.translate(0,-a),e.strokeLine(0,0,~~(this.body.vel.x*c),~~(this.body.vel.y*a)),t.counters.inc("velocity"),e.restore()}}this._patched.apply(this,arguments)})}show(){this.visible||(w.world.addChild(this,1/0),S.registerPointerEvent("pointerdown",this,this.onClick.bind(this)),this.visible=!0,w.repaint())}hide(){this.visible&&(S.releasePointerEvent("pointerdown",this),w.world.removeChild(this,!0),this.visible=!1,w.repaint())}update(){return z.countFPS(),this.visible}onClick(t){this.checkbox.renderHitBox.contains(t.gameX,t.gameY)?this.checkbox.renderHitBox.selected=!this.checkbox.renderHitBox.selected:this.checkbox.renderVelocity.contains(t.gameX,t.gameY)?this.checkbox.renderVelocity.selected=!this.checkbox.renderVelocity.selected:this.checkbox.renderQuadTree.contains(t.gameX,t.gameY)&&(this.checkbox.renderQuadTree.selected=!this.checkbox.renderQuadTree.selected),w.repaint()}drawQuadTreeNode(t,e){var i=e.bounds;if(e.nodes.length===0){var s=e.objects.length*.4/F.maxChildren;s>0&&(t.save(),t.setColor("rgba(255,0,0,"+s+")"),t.fillRect(i.left,i.top,i.width,i.height),t.restore())}else for(var n=0;n<e.nodes.length;n++)this.drawQuadTreeNode(t,e.nodes[n])}drawQuadTree(t){var e=w.viewport.pos.x,i=w.viewport.pos.y;t.translate(-e,-i),this.drawQuadTreeNode(t,w.world.broadphase),t.translate(e,i)}drawMemoryGraph(t,e){if(window&&window.performance&&window.performance.memory){var i=Ln.round(window.performance.memory.usedJSHeapSize/1048576,2),s=Ln.round(window.performance.memory.totalJSHeapSize/1048576,2),n=~~(e-this.memoryPositionX-5),o=n*(i/s);t.setColor("#0065AD"),t.fillRect(this.memoryPositionX,0,n,20),t.setColor("#3AA4F0"),t.fillRect(this.memoryPositionX+1,1,o-1,17),this.font.draw(t,"Heap : "+i+"/"+s+" MB",this.memoryPositionX+5,2*this.mod)}else this.font.draw(t,"Heap : ??/?? MB",this.memoryPositionX,2*this.mod);this.font.draw(t,"Pool : "+g.getInstanceCount(),this.memoryPositionX,10*this.mod)}draw(t){t.save(),this.checkbox.renderQuadTree.selected===!0&&this.drawQuadTree(t),t.setGlobalAlpha(.5),t.setColor("black"),t.fillRect(this.left,this.top,this.width,this.height),t.setGlobalAlpha(1),t.setColor("white"),this.font.textAlign="left",this.font.draw(t,"#objects : "+w.world.children.length,5*this.mod,2*this.mod),this.font.draw(t,"#draws   : "+w.world.drawCount,5*this.mod,10*this.mod),this.font.draw(t,"?hitbox   ["+(this.checkbox.renderHitBox.selected?"x":" ")+"]",75*this.mod,2*this.mod),this.font.draw(t,"?velocity ["+(this.checkbox.renderVelocity.selected?"x":" ")+"]",75*this.mod,10*this.mod),this.font.draw(t,"?QuadTree ["+(this.checkbox.renderQuadTree.selected?"x":" ")+"]",150*this.mod,2*this.mod),this.font.draw(t,"Update : "+this.frameUpdateTime.toFixed(2)+" ms",225*this.mod,2*this.mod),this.font.draw(t,"Draw   : "+this.frameDrawTime.toFixed(2)+" ms",225*this.mod,10*this.mod),this.font.draw(t,"Shapes   : "+this.counters.get("shapes"),5*this.mod,17*this.mod),this.font.draw(t,"Sprites   : "+this.counters.get("sprites"),75*this.mod,17*this.mod),this.font.draw(t,"Velocity  : "+this.counters.get("velocity"),150*this.mod,17*this.mod),this.font.draw(t,"Bounds : "+this.counters.get("bounds"),225*this.mod,17*this.mod),this.font.draw(t,"Children : "+this.counters.get("children"),325*this.mod,17*this.mod);var e=this.width-5;this.drawMemoryGraph(t,e-this.help_str_len),this.font.textAlign="right",this.font.draw(t,this.help_str,e,17*this.mod);var i=z.fps+"/"+z.maxfps+" fps";this.font.draw(t,i,e,2*this.mod),t.restore()}onDestroyEvent(){this.hide()}}class M0 extends Nt.BasePlugin{constructor(t=S.KEY.S){super(),this.version=E0.melonjs,console.log(`${b0} ${w0} | ${T0}`),this.debugToggle=t,this.panel=new P0(t),this.keyHandler=Y.on(Y.KEYDOWN,(e,i)=>{i===this.debugToggle&&this.toggle()}),or.getUriFragment().debug===!0&&this.show()}show(){this.panel.show()}hide(){this.panel.hide()}toggle(){this.panel.visible?this.panel.hide():this.panel.show()}}function I0(){if(!ji.init(4e3,668,{parent:"screen",scaleMethod:"flex-width",renderer:ji.WEBGL,preferWebGL1:!1,depthTest:"z-buffer",subPixel:!1})){alert("Your browser does not support HTML5 canvas.");return}Nt.register(M0,"debugPanel"),Jt.init("ogg,mp3"),W.crossOrigin="anonymous",W.preload(i0,()=>{L.set(L.PLAY,new l0),L.set(L.MENU,new v0),L.transition("fade","#FFFFFF",250),Jt.setVolume(Jt.getVolume()-.3),g.register("mainPlayer",u0),g.register("BarrierEntity",d0),g.register("switchEntity",c0,!0),g.register("machineEntity",p0,!0),g.register("topoEntity",y0,!0),g.register("topoGroundEntity",m0),g.register("EggTopoEntity",x0),g.register("EndGameEntity",_0),g.register("EggEntity",f0,!0),B.texture=new lt(W.getJSON("bounce"),W.getImage("bounce")),B.switchTexture=new lt(W.getJSON("switch"),W.getImage("switch")),B.machineTexture=new lt(W.getJSON("machine"),W.getImage("machine")),B.topoTexture=new lt(W.getJSON("topo"),W.getImage("topo")),B.topoGroundTexture=new lt(W.getJSON("topo_ground"),W.getImage("topo_ground")),B.eggTexture=new lt(W.getJSON("egg"),W.getImage("egg")),B.controlsTexture=new lt(W.getJSON("controlsTexture"),W.getImage("controlsTexture")),L.change(L.MENU),setTimeout(()=>{L.change(L.PLAY)},1e3)})}$s.onReady(()=>{$s.pauseOnBlur=!1,I0()});
